{
  "id": 2094,
  "origin_website": "Cell",
  "title": "Integrating neuroimaging and gene expression data using the imaging transcriptomics toolbox",
  "procedures": [
    "Step-by-step method details\nStep-by-step method details\nIn the following sections, we describe step-by-step how to perform an imaging transcriptomics analysis of a neuroimaging map from start to finish. This includes identifying genes whose expression correlate spatially with the neuroimaging map and performing gene set enrichment analysis to inform the biological interpretation of the results. Such analyses require detailed information on gene expression across multiple regions of the post-mortem human brain, which right now can only be accessed through the Allen Human Brain Atlas (AHBA).\nThe toolbox allows implementing two types of analyses to quantify the association between neuroimaging and gene expression data: i) a simple mass-univariate Spearman correlation analysis; ii) a multi-variate PLS regression analysis. The method to be used is defined as an input by the user. Both methods have been used in previous works applying imaging transcriptomics (Fulcher et al., 2021[href=https://www.wicell.org#bib7]; Morgan et al., 2019[href=https://www.wicell.org#bib17]) and have their own strengths and weaknesses that should be considered on a case-by-case basis. Ultimately, the toolbox provides a list of genes ranked by how well they associate with the distribution of a neuroimaging marker input by the user and identifies which genes are significantly associated with the marker using state-of-the-art methods that account for bias induced by the spatial autocorrelation of the data.",
    "In order to perform imaging transcriptomics analyses, both neuroimaging and gene expression should be mapped into the same space. Currently, the analyses implemented in the toolbox are based on the Desikan-Killiany (DK) parcellation (Desikan et al., 2006[href=https://www.wicell.org#bib5]). For the neuroimaging data, the toolbox implements a simple averaging of the signal across all voxels of each parcel in the atlas. For the gene expression data, the process of mapping the AHBA data to DK parcels was implemented a priori using the abagen toolbox (https://www.github.com/netneurolab/abagen[href=https://www.github.com/netneurolab/abagen]). Briefly, genetic probes were reannotated and only probes that could reliable be matched to genes were kept and filtered based on their value relative to the background noise by using a threshold of 50%, yielding a total of 15,633 probes (Arnatkevičiūtė et al., 2019[href=https://www.wicell.org#bib3]). Next, tissue samples were assigned to brain regions using their corrected MNI coordinates (https://github.com/chrisfilo/alleninf[href=https://github.com/chrisfilo/alleninf]), samples were matched to regions constraining this to hemisphere and cortical/subcortical subdivisions. Samples were assigned to brain regions in the atlas if their coordinates in MNI space were within 2 mm of a given parcel. To reduce the potential for misassignment, sample-to-region matching was constrained by hemisphere and gross structural divisions (i.e., cortex, subcortex/brainstem, and cerebellum). All tissue samples not assigned to a brain region in the provided atlas were discarded (Markello et al., 2021[href=https://www.wicell.org#bib13]). Samples were then averaged across donors and normalized, resulting in a final single matrix with rows corresponding to brain regions and columns corresponding to the 15,633 genes.",
    "Irrespectively of the statistical method selected by the user (PLS or Spearman correlation), the inferential statistics is calculated using gold-standard methods that are robust to the intrinsic autocorrelation of the imaging data. All significance testing is based on permutation testing, where 1,000 null spatial maps are derived using a combination of spin rotations of the cortical regions and resampling of the subcortical regions. The spin rotations are implemented using the Vasa method as in previous studies (Alexander-Bloch et al., 2013a[href=https://www.wicell.org#bib1], 2013b[href=https://www.wicell.org#bib2]; Markello and Misic, 2021[href=https://www.wicell.org#bib14]; Váša et al., 2018[href=https://www.wicell.org#bib19]). The same nulls are then used in the ensemble gene set enrichment analyses to control for false positives related to the spatial autocorrelation of the data, as recently recommended (Fulcher et al., 2021[href=https://www.wicell.org#bib7]).\nTo illustrate the various steps of the analysis with the toolbox, we will use as an example a publicly available positron emission tomography (PET) average template of the serotonin receptor 5-HT2A ([11C]Cimbi-36) from (Beliveau et al., 2017[href=https://www.wicell.org#bib4]).\nNote: The scan downloadable from the online repository (https://xtra.nru.dk/FS5ht-atlas/[href=https://xtra.nru.dk/FS5ht-atlas/]) must be reshaped since it has a data matrix of 182 × 218 × 182 × 1 (for more see troubleshooting 2[href=https://www.wicell.org#sec5.3]). In addition, to avoid problems with the file system the scan should be renamed by replacing the dots ( . ) in the name with underscores ( _ ). For the scope of the following example the scan has been renamed to 5-HT2A_mean_bmax.nii.gz.\nSelect the path of your input file.\nNote: For the input, either common neuroimaging scan formats (NIfTI - .nii, .nii.gz) or text files (i.e., .tsv, .csv, .txt) can be used. The path should be provided as an absolute path (e.g., “/home/username/data_folder/myfile” instead of “./data_folder/myfile”).",
    "Critical: If the input is a neuroimaging scan, this must be already in standard MNI152 space and have a voxel size of 1 mm isotropic (imaging matrix size of 182 × 218 × 182). On the other hand, if the input is a text file, this must have only one column, with no header and a regional value in each row, following the order of the DK atlas (the full list of regions is available in the supplement file Table S1[href=https://prod-shared-star-protocols.s3.amazonaws.com/protocols/1578-Mmc1.pdf]).\nPartial least square regression analysis\nTiming:  < 5 min\nThis step is the first of two alternative ways to run the analysis, and it employs PLS regression to identify latent components that maximize the correlation between neuroimaging and gene expression data.\nRun the script imagingtranscriptomics using the pls option:\n> imagingtranscriptomics --input <input_path> [--output <output-path>][--regions <all|cort+sub|cort>] [--no-gsea] [--genest] pls <pls_options>\nThe arguments to be provided are:\n--input <input_path>: the path to the input file (the path from step 1).\n--output <output_path> (optional): the path where the results should be saved.\nNote: If this is not provided the results will be saved in the path of the input file.\n--regions <all|cort+sub|cort>(optional): Allows the user to select which regions to use in the analysis. This is particularly useful with certain types of data (e.g., EEG) where subcortical regions might not be available. The available options are all (or equivalently cort+sub), which specifies that all regions should be used, or cort where only cortical regions are used.\n--no-gsea (optional): this flag allows running the script without performing GSEA.\nNote: If this is not provided, the script will also run the GSEA step (described below).\n--geneset (optional): Name of the gene set to be used in the GSEA analysis.",
    "Note: If the --no-gsea flag is provided, this option will be ignored. If you also want to perform GSEA (i.e., excluding the --no-gsea flag), a gene set should be selected - for more information on the available gene sets refer to the GSEA step.\npls <pls_options>: uses PLS regression to analyze the data. After the pls keyword, only one of the following inputs is required:\n--ncomp <n>: number of components to use in the PLS regression (this must be an integer between 1 and 15).\n--var <n>: percentage of the variance to explain. With this option, the optimal number of components will be automatically calculated by the script (this must be a float between 0 and 1).\nFor instance, with the example data, we can run the command:\n> imagingtranscriptomics --input 5-HT2A_mean_bmax.nii.gz --regions all --no-gsea pls --ncomp 1\nWhich will run the analysis with one PLS component on the example scan, without running GSEA, and save the results the same directory as the input scan (the results will be in a folder named Imt_5-HT2A_mean_bmax_pls).\nMass-univariate correlation analysis\nTiming:  > 30 min\nAs an alternative to PLS regression, the toolbox also offers the option to run the analysis using mass-univariate Spearman correlations. This option will simply calculate Spearman correlations between the neuroimaging vector and the expression of each gene.\nNote: if you want to analyze the data with PLS regression, you can skip this step.\nRun the script imagingtranscriptomics using the correlation option:\n> imagingtranscritomics --input <input_path> [--output <output-path>][--regions <all|cort+sub|cort>] [--no-gsea] [--genest] corr [--cpu <n_cpu>]\nThe first optional input is described in the PLS analysis section (points 2a-2e); the additional optional input for the script in this case is:\n--cpu <n_cpu>: number of cpu to be used for the calculation of the correlations (the default number is 4).",
    "Note: This step takes a considerably longer time compared to the PLS analysis, since the number of correlations to estimate is much greater.\nWith the example data we can run the command:\n> imagingtranscriptomics --input 5-HT2A_mean_bmax.nii.gz --regions all --no-gsea corr\nThis command will run the analysis on all brain regions, without running GSEA, with mass univariate correlation and save the results in the same directory as the input scan (the results will be saved in a folder named Imt_5-HT2A_mean_bmax_corr).\nNote: Irrespective of the method selected (PLS regression or mass-univariate correlation), the toolbox produces lists of genes ranked according to the strength of the spatial alignment between the neuroimaging phenotypes (e.g., regional distribution of a PET tracer, statistical map reflecting effects of a drug or case-control differences for a certain neuroimaging metric) and their expression. Please, note that when the user does not have a priori hypotheses about specific genes or pathways, interpreting the output in biological terms can be challenging. For instance, one might be interested in understanding if the top genes positively associated with a certain neuroimaging phenotype belong to specific biological pathways or brain cell-types. Answers to this type of questions can be provided by gene set enrichment analyses, which we will describe in the next section.\nEnsemble gene set enrichment analysis (GSEA)\nTiming:  > 1 h",
    "GSEA uses a statistical hypothesis-testing framework to assess which categories of genes (i.e., set of genes sharing a certain biological function, such as neuronal genes or astrocytic genes) are most strongly related to a given phenotype, leveraging annotations of genes to categories from open ontologies, like the Gene Ontology (GO). Performing GSEA in the context of imaging transcriptomics is associated with methodological challenges that the application of the same algorithms in other circumstances do not necessarily raise, mainly, within-category gene–gene co-expression and spatial autocorrelation are now known to drive false-positive bias, which requires particular attention in the way it is dealt with (for further information on this topic, please see Fulcher et al., 2021[href=https://www.wicell.org#bib7]). In this toolbox, we implement the recently introduced ensemble GSEA framework, which overcomes false-positive gene-category enrichment in the analysis of spatially resolved transcriptomic brain atlas data, using a pre-ranked approach. These analyses are implemented through the imt_gsea script, which requires the .pkl file generated as a result of the previous step.\nNote: This step can be run as part of a single command as explained above; this is equivalent to omitting the --no-gsea flag and specifying the input --geneset in the previous script.\nDefine which gene set you want to use for the analysis; as an example, we will use the “Lake” brain cell-type gene set included with the toolbox (this set includes genes expressed in 30 brain cell-types as identified in a previous single-cell transcriptomic study (Lake et al., 2018[href=https://www.wicell.org#bib21])). Other available gene sets are provided and can be searched by running the command:\n> imt_gsea --geneset avail",
    "Note: The toolbox offers the users the possibility to select their own gene set file; this should nevertheless be in a compatible format, i.e., gmt (see here the instructions on how to create your own gene set file https://www.gsea-msigdb.org/gsea/doc/GSEAUserGuideFrame.html[href=https://www.gsea-msigdb.org/gsea/doc/GSEAUserGuideFrame.html]). If the users decide to use their own genes, the file must be provided as an absolute path as the argument of the --geneset flag.\nRun the ensemble GSEA using the command:\n> imt_gsea --input /path_to_yourfile/file.pkl --geneset lake\nThe imt_gsea script accepts the following arguments:\n--input: path to the .pkl file generated by the previous step.\n--output (optional): path where the results will be saved; if none is provided, the parent directory of the input file will be used instead.\n--geneset: name of the gene set to be used in the analysis.\nNote: Depending on the gene set and analysis used, the GSEA will take longer to run, i.e., running the ensemble GSEA on an analysis with 2 PLS components will take twice the amount of time as running GSEA on an analysis with 1 PLS component.\nWith the results from either step 2 we can run the GSEA analysis by running the command (similar for the results from step 3):\n> imt_gsea --input Imt_5-HT2A_mean_bmax_pls/pls_analysis.pkl --geneset lake\nTo run the GSEA analysis using the lake gene set.\nCheck the results in the folder where the .pkl file was stored if no output path was specified.",
    "The interpretation of the ensemble GSEA output does not differ much from the standard GSEA analysis. The primary result of the gene set enrichment analysis is the enrichment score (ES), which reflects the degree to which a gene set is overrepresented at the top (positive score) or bottom (negative score) of a ranked list of genes. Significant enrichment is identified by p-values, corrected for multiple comparisons, less than 0.05 (i.e., pFDR<0.05). In ensemble GSEA, this means that the enrichment observed is higher than one would expect for a null neuroimaging phenotype with the same embedded spatial autocorrelation."
  ],
  "subjectAreas": [
    "Sequence Analysis",
    "Bioinformatics",
    "Computer Sciences",
    "Health Sciences",
    "Neuroscience"
  ],
  "bigAreas": [
    "Biomedical & Clinical Research",
    "Molecular Biology & Genetics",
    "Bioinformatics & Computational Biology"
  ]
}