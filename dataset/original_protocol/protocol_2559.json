{
  "id": 2704,
  "origin_website": "Cell",
  "title": "Protocol for recording and analyzing spontaneous locomotion in Drosophila",
  "procedures": [
    "Step-by-step method details\nStep-by-step method details\nVideo recording\nTiming: 10–60 min\nThis step generates the video files that will be processed with the FlyTracker MATLAB package. The locomotion recording device and the video recording set-up is shown in Figure 2[href=https://www.wicell.org#fig2] below (see also Figure 1 from Barwell et al.1[href=https://www.wicell.org#bib1]).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2193-Fig2.jpg\nFigure 2. Locomotion recording device and video recording set-up\nNote: The effect of circadian rhythms on activity that can affect reproducibility and variability are avoided by always recording at the same time of the day, ideally during the well-known morning period of activity.\nLoad the locomotion recording device (Methods video S1[href=https://www.wicell.org#mmc1]: Fly loading).\nNote: Use the configuration table to keep track of the location of each fly.\nA single fly of any desired age is captured with an aspirator to avoid any anesthesia.\nA chamber strip with the circle-side down is placed on the base such that the loading hole connects to the first chamber.\nTransfer the fly to the chamber through the loading hole.\nSlide the chamber strip such that the loading hole connects to the next chamber.\nRepeat from step 1a. until the 5 chambers have been loaded.\nSlide the strip into place using the guides on the base.\nRepeat steps 1a–f. until all chambers are loaded.\n    Your browser does not support HTML5 video.\n  \nMethods video S1. Fly loading, related to step 1\nVideo: Methods video S1[href=https://www.wicell.org#mmc1]: Fly loading, related to step 1. The process of loading flies. By taking advantage of the negative geotactic response, it is possible to aspirate multiple flies and load several chambers, therefore accelerating the process.\nPlace the loaded device atop a light box inside a dark 25°C room.\nPosition an iPod touch 40 cm above the device.",
    "Critical: This is the maximal height that can be used with 1080p (1920 × 1080 resolution) cameras without losing the ability to track accurately every individual fly. This height does not allow to record more than 10 chamber strips simultaneously.\nTurn on the light box and let the flies acclimatize for at least 5 min.\nRecord .mp4 or .m4v video file for at least 3 min.\nNote: It is convenient to append the configuration number from the configuration table to the name of the file.\nRemove the flies from the device and return them to their respective vials by sliding and aspiration through the loading hole.\nNote: This step is not required if one chooses to perform a cross-sectional study instead of a longitudinal study. For any experiment examining the effect of age/time, the data from a longitudinal study are more reliable than the data from a cross-sectional study.10[href=https://www.wicell.org#bib10]\nTransfer the video file to a computer that has the MATLAB software installed.\nNote: For an iPod touch (or iPhone), the video is imported into “Photos” and then dragged to the desktop.\nPause point: Video can be analyzed in the second step at later time if the experimental design requires the recording of multiple videos and/or recording over multiple time points.\nVideo analysis\nTiming: 10 min–2 h\nThis step processes the video recorded in the previous step with the MATLAB FlyTracker software that is able to detect multiple flies and track the position, orientation, angle of the wings and legs, and the distance to the wall of the chamber housing the fly. The length of this step is dependent on the number of animals tracked as well as the processing power of the computer used. FlyTracker requires that the video file(s) is stored in a folder.",
    "Video: Methods video S2[href=https://www.wicell.org#mmc2]: Flytracker analysis, related to steps 9–24.\nCreate a folder containing the video file (Figure 3[href=https://www.wicell.org#fig3]).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2193-Fig3.jpg\nFigure 3. Directory of the tracking folder after addition of the video file\nOpen MATLAB and use “Browse for folder” to select the folder containing the FlyTracker software (Figure 4[href=https://www.wicell.org#fig4]).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2193-Fig4.jpg\nFigure 4. MATLAB interface after selection of the FlyTracker folder\nRight-click the “tracker.m” file and select “Run”. The FlyTracker interface will pop-up (Figure 5[href=https://www.wicell.org#fig5]).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2193-Fig5.jpg\nFigure 5. The FlyTracker interface\nClick the “VIDEO folder” button and select the folder created in step 8 (Figure 6[href=https://www.wicell.org#fig6]).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2193-Fig6.jpg\nFigure 6. The FlyTracker interface after loading of the tracking folder\nNote: FlyTracker automatically detects the format of the video file(s) in the VIDEO folder by indicating the file extension (.m4v). Change it to the correct extension if needed.\nOptional: By default, the output folder is set to the same location as the video folder but it is possible to change the output of the analysis to a different folder by clicking the “OUTPUT folder” button.\nClick the “CALIBRATE” button and the Calibrator interface will pop-up (Figure 7[href=https://www.wicell.org#fig7]).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2193-Fig7.jpg\nFigure 7. The Calibrator interface\nNote: The Calibration is required to define the scale of the video and to apply background subtraction methods to the video to enhance detection accuracy.\nFlyTracker automatically detects and fills the frame rate per second.\nNote: 30 fps is the default frame rate for most cameras but one may need to adjust the fps to the frame rate used for recording the video.\nMove the red segment to one of the chamber and extend it across the diameter, and enter the known diameter of the chamber in millimeters in the “length of ruler (mm):” field (Figure 8[href=https://www.wicell.org#fig8]).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2193-Fig8.jpg\nFigure 8. The Calibrator interface after scale adjustment",
    "Click the “continue” button (Figure 9[href=https://www.wicell.org#fig9]).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2193-Fig9.jpg\nFigure 9. The Calibrator interface after background processing\nNote: FlyTracker will process the background of the video file and it may take some time for the Calibrator interface to display the adjusted video and the interface to input the experimental setup.\nNote: During this step, a folder with the name of the video is created and a background data file is created within this folder labeled with “-bg.mat” appended to the name of the folder.\nClick the “automatically detect chambers” pull-down menu and select “manually set chambers”. Enter below the number and arrangement (rows × columns, 10 × 5 for 50 chambers). Click on the “rectangular” pull-down menu and select “circular” (Figure 10[href=https://www.wicell.org#fig10]).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2193-Fig10.jpg\nFigure 10. The Calibrator interface after the addition of the chambers\nThe numbering of the chambers goes by row then column and the blue chamber displayed by the calibrator interface defines the chamber 1.\nNote: The numbering is shown in Figure 10[href=https://www.wicell.org#fig10] in red (the numbers have been added digitally and will not be displayed by the Calibrator interface).\nAdjust the size of all the chambers identically and simultaneously by click-holding the resizing handles of the blue chamber.\nNote: It is also possible to resize every single chamber if needed. It is not necessary to resize to the exact dimension of the physical chambers and the tracking is not affected by the light gray shadow from the wall of the chambers.\nClick drag each chamber to overlay them to the physical location of each chamber (Figure 11[href=https://www.wicell.org#fig11]).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2193-Fig11.jpg\nFigure 11. The Calibrator interface after the resizing/positioning of the chambers",
    "Critical: Make sure that the ordering of the chambers is not swapped while repositioning since it will also swap the tracking data and incorrectly assign the data to the corresponding genotype/condition. It is convenient to be able to modify the ordering of the chambers if the experimentalist loads in a different position than the one specified in the configuration table.\nClick “continue” and the calibrator displays the detected individual and adds two sliders to the interface to adjust the foreground and body threshold to optimize the detection. Clicking the “random>>” button will display the detected individual in a different chamber (Figure 12[href=https://www.wicell.org#fig12]).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2193-Fig12.jpg\nFigure 12. Fly detection in the Calibrator interface\nClick “FINISH” and it may take some time for the calibrator to generate and save the “calibration.mat” calibration file to the output folder (Figure 13[href=https://www.wicell.org#fig13]).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2193-Fig13.jpg\nFigure 13. The FlyTracker interface after calibration\nNote: It is possible to load a calibration file by clicking the “calibration file” button and therefore use the same calibration parameters for multiple videos as long as the experimentalist ensures that the positioning of the chambers is strictly identical for each video recording session (chamber strips always in the same order and the base has a fixed position on the light box).\nSpecify the length of the video to be analyzed by entering the number of minutes in the “max minutes:” field before clicking “TRACK”.\nNote: It is not possible to specify a section of the video file and will always start processing from the beginning of the video file. It is easier to use this option to ensure that the same number of frames is processed for each video file than trying to always record the same exact number of frames.",
    "It will take some time depending on the processing power of the computer used and the number of chambers tracked. This step generates two files labeled with “-feat.mat” and “-track.mat” appended to the name of the video that are saved in the folder with the name of the video (Figure 14[href=https://www.wicell.org#fig14]).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2193-Fig14.jpg\nFigure 14. The folder and files output by FlyTracker in the tracking folder directory\nVerify that the tracking has been accurate by right-clicking the “visualizer.m” file and select “Run” to display the Visualizer interface (Figure 15[href=https://www.wicell.org#fig15]).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2193-Fig15.jpg\nFigure 15. The Visualizer interface\nClick the “Video” menu and select “Open” to open the video file in the visualizer (Figure 16[href=https://www.wicell.org#fig16]).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2193-Fig16.jpg\nFigure 16. The Visualizer interface with the video file loaded\nClick “play” and the Visualizer will play the video with colored overlays showing the current location and tracks of each fly (Figure 17[href=https://www.wicell.org#fig17]).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2193-Fig17.jpg\nFigure 17. Magnification of the fly tracks displayed in the Visualizer interface\nCritical: It is critical to visually inspect the whole video (it only takes 3 min) during this step to ensure that the tracking was accurate.\nPause point: Once the analysis is completed and the resulting files saved, the next step can be performed at any time.\n    Your browser does not support HTML5 video.\n  \nMethods video S2. FlyTracker analysis, related to steps 9–34\nData extraction\nTiming: 5–10 min\nThis step uses the DataExtraction script to extract and process data from the two MATLAB structure array files (NameOfVideo-feat.mat and NameOfVideo-track.mat) generated in the previous step.\nNote: The track.mat structure has 4 data containers (fields) whereas the feat.mat structure has 3 (Figure 18[href=https://www.wicell.org#fig18])\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2193-Fig18.jpg\nFigure 18. The fields of the _-track.mat (trk) and _-feat.mat (feat) MATLAB structure array files",
    "The track.mat data field contains the raw data from the analysis of the video. Each chamber is reported in a table with rows corresponding to the video frames and 35 columns reporting the x and y coordinates, length and angles of the fly body, wings and legs. In the example above the data field contains the data of the analysis of 5 chambers in a video with 5411 video frames. The names of the 35 columns are listed in the names field. The DataExtraction script only uses the x and y coordinates data to calculate the distance between each video frame and the total distance travelled.\nThe feat.mat data field contains data calculated by FlyTracker from the analysis of the video. Each chamber is reported in a table with rows corresponding to the video frames and 9 columns reporting velocity, wing angles and length, ratios and distance to the wall of the arena. The names of the 9 columns are listed in the names field. The DataExtraction script only uses the velocities to calculate the average velocity and the percentage of time (frames) when the fly remains in the same location.\nThe steps 25–34 are shown in Methods video S2[href=https://www.wicell.org#mmc2]: FlyTracker analysis.\nVideo: Methods video S2[href=https://www.wicell.org#mmc2]: FlyTracker analysis, related to steps 25–34.\nLoad the DataExtractionScript and the two MATLAB structure array files (NameOfVideo-feat.mat and NameOfVideo-track.mat) generated in the previous step by using the “Open” button in MATLAB and select the files (Figure 19[href=https://www.wicell.org#fig19]).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2193-Fig19.jpg\nFigure 19. Loading the DataExtractionScript and the two MATLAB structure array files\nNote: The Script should open in the MATLAB Editor and the “feat” and “trk” structure array files are listed in the MATLAB Workspace (Figure 20[href=https://www.wicell.org#fig20]).\nCritical: The script will abort if the “feat” and “trk” files have not been dragged/opened in MATLAB.\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2193-Fig20.jpg",
    "Figure 20. The MATLAB interface after the loading of the DataExtractionScript and structure files\nClick the “Run” icon in the MATLAB Editor.\nThe script starts with an information dialog that will auto dismiss after 2 s (Figure 21[href=https://www.wicell.org#fig21]).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2193-Fig21.jpg\nFigure 21. Initial information displayed by the DataExtractionScript\nA file Selection interface will then be displayed for the user to select the Configuration Table file (Figure 22[href=https://www.wicell.org#fig22]).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2193-Fig22.jpg\nFigure 22. DataExtractionScript file selection interface to load the configuration table\nNote: If the user clicks “Cancel” instead of selecting a file, a message will pop-up to give the options to abort the script or reselect a file.\nA dialog box prompts the user to enter the number of video frames tracked with FlyTracker to be extracted (Figure 23[href=https://www.wicell.org#fig23]).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2193-Fig23.jpg\nFigure 23. Video frames input dialog of the DataExtractionScript\nNote: In general, we use the step 20 to restrict the analysis by FlyTracker to the first 3 min of video files and this step can be used to further reduce the number of frames to extract data from.\nNote: This dialog box will prompt the user again if a non-numerical value is entered or if the “Cancel” button is clicked.\nA dialog box prompts the user to select the configuration used (Figure 24[href=https://www.wicell.org#fig24]).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2193-Fig24.jpg\nFigure 24. Configuration selection dialog of the DataExtractionScript\nCritical: Make sure that the script has been modified (line 40) to reflect the number of configurations in the Configuration table if more than 16 possible configurations are needed.\nDialog boxes prompts the user to enter the sex and age of the animals tracked (Figure 25[href=https://www.wicell.org#fig25]).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2193-Fig25.jpg\nFigure 25. Sex and age input dialogs of the DataExtractionScript\nA dialog box prompts the user to enter the number of the chamber (arena) to start to extract FlyTracker data (Figure 26[href=https://www.wicell.org#fig26]).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2193-Fig26.jpg",
    "Figure 26. Starting chamber input dialog of the DataExtractionScript\nNote: It may rarely happen that the tracking of one chamber is not satisfactory during the visual inspection with the visualizer in steps 22 and 23. In such case, FlyTracker analysis is re-run starting at step 10 and slight adjustments of the foreground and/or body threshold are applied. Such adjustment does not change the outcome of the tracking of the other chambers and this option can be used to save processing time.\nIt may take a couple of minutes (dependent on the processing power of the computer used and the number of chambers tracked) before a file selection interface will prompt the user for the location to save the spreadsheet files with the extracted data (Figure 27[href=https://www.wicell.org#fig27]).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2193-Fig27.jpg\nFigure 27. DataExtractionScript file selection interface to save the output of the script\nNote: It is also possible to rename the files to be saved during this step.\nThe script outputs two spreadsheet-compatible files (.csv and .xls) (Figure 28[href=https://www.wicell.org#fig28]).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2193-Fig28.jpg\nFigure 28. The files output by the DataExtractionScript in the tracking folder directory\nData compilation\nTiming: 5–10 min\nThis step uses the DataCompilation script to combine in a single .xls file the results obtained in multiple .xls files.\nCreate a Compilation folder with the .xls files generated by the DataExtraction script (Figure 29[href=https://www.wicell.org#fig29]).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2193-Fig29.jpg\nFigure 29. Directory of the compilation folder after addition of video files\nLoad the DataCompilationScript by dragging the file onto the MATLAB icon in the Mac OS dock or by using the “Open” button in MATLAB and select the file.\nNote: The Script should open in the MATLAB Editor.\nClick the “Run” icon in the MATLAB Editor.\nA file Selection interface is displayed for the user to select the location of the Compilation folder.",
    "Note: If the user clicks “Cancel” instead of selecting a folder or if the selected folder does not contain any .xls files, messages will pop-up to give the options to abort the script or reselect the folder.\nCritical: MATLAB will generate errors and the execution of the script will abort if all the .xls files put in the Compilation folder do not have the same dimensions.\nThe script copies into a new table the labeled table from the first .xls file in the Compilation folder.\nNote: For each subsequent .xls file, the script copies into the new table the unlabelled tables below the previous table.\nThe new table is saved as “Compilation.xls” in the Compilation folder (Figure 30[href=https://www.wicell.org#fig30]).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2193-Fig30.jpg\nFigure 30. The compilation file output by the DataCompilation script in the compilation folder directory\nNote: The “Compilation.xls” name can be changed by modifying the line 32 of the DataCompilation script."
  ],
  "subjectAreas": [
    "Neuroscience",
    "Model Organisms",
    "Behavior",
    "Genetics"
  ],
  "bigAreas": [
    "Biomedical & Clinical Research",
    "Molecular Biology & Genetics",
    "Ecology & Environmental Biology"
  ]
}