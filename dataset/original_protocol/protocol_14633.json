{
  "id": 18459,
  "origin_website": "Jove",
  "title": "A Pipeline for 3D Multimodality Image Integration and Computer-assisted Planning in Epilepsy Surgery",
  "procedures": [
    "NOTE: Software commands provided here are specific to the current version (19.01.2015) of the software and may change upon subsequent software releases. Manuals for individual versions are available on request.\n1. Perform Image Integration and Visualization\nAcquire imaging.\n\t\nAcquire neuronavigation T1-weighted MRI scan with gadolinium enhancement- this will be the reference image. (Note: Image acquisition requirements are available from the neuronavigation commercial supplier11,12. See Table 1).\nCollect all other imaging done during presurgical evaluation in DICOM or Nifti format (may include functional MRI (fMRI), diffusion tensor imaging (DTI) tractography, fluoro-deoxyglucose positron emission tomography (FDG-PET), ictal-interictal single photon emission CT (SPECT), magnetoencephalography (MEG) dipole, 3D phase contrast MRI, CT angiography) See Table 1.\nRun pre-processing outside in-house software.\n\t\nProcess isometric T1 weighted MRI with open source Freesurfer software, run on a linux workstation using the command 'recon-all', to generate cortical segmentations.\nConvert wmparc.mgz and ribbon.mgz files to nifti format using the command 'mrconvert'\nOpen in-house software on Windows PC and load data (Figure 1).\n\t\nNote 2 x 2 window display, DataManager on far left, icons on top representing different image processing tools and selected tool on far right.\nImport data using 'drag and drop', by accessing the main menu \"File/Open\" or by a speed button (icon) \"Open\". Scroll through different data sets to ensure completeness. Note the zoom function by right clicking and moving mouse, and the hierarchical nature of DataManager, with consecutive image overlay.\nCoregister images.\n\t\nSingle images.\n\t\t\nSelect NiftyReg tool from speed icons.\nSelect neuronavigation T1 with gadolinium in DataManager- this will be reference image that all other imaging is coregistered to.\nSelect 'floating image' to be coregistered to reference image.\nDefine name and location of registered image. Set optimization parameters to level number 4, level to perform 3, iteration number 5, coregistration type rigid body.",
    "Run automated rigid body coregistration by clicking on 'Run' button.\nCheck accuracy of coregistration. Inspect the registered image over the reference image, and alter transparency of registered image by right-clicking on the image in DataManager, and moving the 'Opacity' cursor. Verify coregistration by inspecting clear anatomical landmarks such as the foramen of Monroe.\nPaired images.\n\t\t\nCoregister 'space-defining image' first (eg. Fractional anisotropic map), using the NiftyReg tool as in steps 1.4.1.1 - 1.4.1.6.\nSelect RegResample tool from speed icons.\nSelect neuronavigation T1 with gadolinium in DataManager as reference image.\nSelect image with results of processing (e.g., tractography image) as floating image.\nUse txt file generated from previous registration of 'space-defining image' as input transformation.\nDefine name and location of registered image. Select interpolation type as 0.\nRun resampling of 'result of processing' by clicking on 'Run' button.\nView new generated image by selecting in DataManager\nCheck accuracy of coregistration as in step 1.4.1.6.\nRepeat steps 1.4.1 - 1.4.2 for all data sets.\nSegment images.\n\t\nSelect image to be segmented in DataManager, and select Segmentation Editor tool from speed icons.\nUse advanced segmentation tools (manual segmentation, region-growing, subtracting) to draw region of interest on several slices of imaging in axial, coronal and sagittal planes\nSelect 3D interpolation to visualise evolving segmented structure in 3D window. Confirm segmentation to generate new Nifti file of segmented structure.\nRepeat steps 1.5.1 - 1.5.3 for all images where manual segmentation is indicated.\nGenerate brain models.\n\t\nSelect wmparc.nii image on DataManager, and ensure wmparc.nii is coregistered with reference image using steps 1.4.1.\nSelect Basic Processing Tools from speed icons.\nApply a threshold to wmparc.nii from 1-5002 to create binarised mask of cortex.",
    "Render regions of interest as 3D surfaces (Figure 2, 3). Note: Visualization of data sets as 3D surface renderings (stl files) can be done in two ways:\n\t\nUse Surface Extractor tool.\n\t\t\nSelect Surface Extractor icon. Define threshold for surface extraction and select Apply. Name surface rendering in DataManager.\nRight click on Nifti file in DataManager and select' Smooth Polygon Surface'.\nExtract surface models of vessels (Figure 4). Note: Extracting vessels from dedicated vascular imaging (3D phase contrast MRI, CT angiography, T1 weighted MRI with gadolinium) can be done in two ways.\n\t\nUse Surface Extractor tool.\n\t\t\nCoregister the vascular imaging to the reference image using NiftiReg. 3D surface render the image using Surface Extractor.\nGenerate intracranial mask by applying the dilation and closing functions in Basic Image Processing to the binarised mask of cortex. Apply intracranial mask to the vascular imaging using the multiply function in Basic Image Processing to remove extracranial vessels.\nRemove noise from the stl file by processing outside in-house software, using 3D mesh processing software package. Note: Instructions for use of this tool are freely available online.\nUse VesselExtractor tool.\n\t\t\nSelect the VesselExtractor tool from the speed icons. Select vascular image data set and specify the name and location of the vessel-extraction Nifti file.\nRun VesselExtractor by clicking on 'Run'. Apply intracranial mask to the results of VesselExtractor using the multiply function in Basic Image Processing to remove extracranial vessels. Note: Intracranial mask generated by applying the dilation and closing functions in Basic Image Processing to the binarised mask of cortex as in 1.8.1.2.\nRepeat process of 1.8.1 or 1.8.2 for CT angiography, 3D phase contrast MRI and neuronavigation T1 with gadolinium.\nGenerate volume rendering of brain (Figure 5).\n\t\nSelect wmparc.nii image on DataManager, and ensure wmparc.nii is coregistered with reference image using steps 1.4.1.",
    "Select Basic Processing Tools from speed icons.\nApply Gaussian smoothing to wmparc.nii image, using Basic Processing tools.\nSelect volume rendering tool from speed icons, and ensure smoothed wmparc.nii file is highlighted in DataManager.\nTick 'volume rendering' box inside volume rendering tool to generate volume rendering of cortex.\n2. Perform Manual Planning\nUse Trajectory Planner speed icon.\n\t\nSelect neuronavigation T1 scan as the reference image. Select New Plan, and New trajectory.\nSelect target point on planar imaging by pressing 'Alt' and right-click on the mouse, based on list of desired anatomical target points by clinicians. Note: examples of targets include mesial temporal structures (amygdala, hippocampus), insula, cingulate gyrus.\nSelect entry point on planar imaging by pressing 'Alt' and left-click on the mouse, based on the list of desired entry points by clinicians. Note: examples of entry points include middle temporal gyrus, precentral gyrus, supramarginal gyrus.\nObserve linear trajectory generated between target and entry point.\nVisualise risk.\n\t\nSelect Risk Visualization speed icon to examine trajectory length.\nSelect 'Link view planes' to link Probes eye viewer to orthogonal view planes in main window.\nScroll along trajectory, examining Probes eye viewer to ensure avascular path.\n3. Perform Computer-assisted Planning\nPrepare data.\n\t\nPrepare grey matter surface.\n\t\t\nSelect the ribbon.nii file generated from cortical segmentation software.\nCo-register ribbon.nii file to reference image using NiftiReg.\n3D surface render co-registered image by using 'Smooth polygon surface' function.\nPrepare scalp and scalp exclusion template.\n\t\t\nSelect T1 neuronavigation image as reference image.\nUse Basic Image Processing tool to apply Gaussian transformation.\nSurface render image using Surface Extractor, to generate scalp surface.\nSave and export image as stl file.\nLoad stl fle into 3D mesh processing software.\nFor scalp, use cleaning and editing tools to delete intracranial contents.",
    "For scalp exclusion template, use manual editing tools to remove areas not appropriate for electrode entry points (i.e., face, ears, contralateral hemisphere, area below tentorium cerebelli).\nPrepare surface sulci surface.\n\t\t\nGenerate whole sulci.\n\t\t\t\nBinarise wmparc.nii file using the Basic Image Processing tool as in step 1.6.3.\nClose binarised wmparc.nii file by 3 using Basic Image Processing tool.\nSubtract binarised file generated in 3.1.3.1.1 from closed binarised file generated in 3.1.3.1.2 using Basic Image Processing tool.\nRemove the sulci at depth to generate the surface sulci image. Note: using surface sulci image as a critical structure has the advantage of spacing trajectories away from sulci at the surface of the brain, and permitting trajectories to approach sulci at depth, which is where grey matter lies.\n\t\t\t\nReduce the closed, binarised wmparc file generated in 3.1.3.1.2 using the Basic Image Processing tool.\nInvert file generated in 3.1.3.2.1 using the Basic Image Processing tool.\nMultiply file generated in 3.1.3.2.2 by the whole sulci generated in 3.1.3.1.3, using the Basic Image Processing tool.\nRun multi-trajectory planner (Figure 6).\n\tNOTE: Automated multi-trajectory planning is dependent on robust data preparation; surface renderings of the scalp, scalp exclusion mask, intracranial vasculature, surface sulci, cortex and grey matter are required.\n\t\nSelect Trajectory Planner from speed icons. Select reference image as neuronavigation T1 MRI.\nSelect 'target points'; multiple target points can be entered by 'Shift' and mouse left-click, or by loading a saved target point set. Note: examples of target include mesial temporal structures (amygdala, hippocampus), insula, cingulate gyrus.\nSelect 'entry points', and select scalp exclusion mask on the attached dropdown menu. Note: This has the purpose of restricting the search of possible entry points to a restricted area that is surgically feasible to implement.",
    "Select critical structures, marking the surfaces from the dropdown list that the trajectories should avoid. Select advanced settings; adjust the user-defined constraints regarding trajectory length, angle of entry and distance between trajectories as preferred.\nSelect grey matter- white matter evaluation and stratify risk sort to optimise the proportion of the trajectories that lie in grey matter.\nRun multi-trajectory planner by selecting Add New Plan, and Recompute Plan.\nVisualise risk (Figure 7).\n\t\nAssess risk and safety profiles after trajectory planning, using the Risk Visualization speed icon.\n\t\tNote: For each trajectory there are metrics for length, angle of entry, cumulative risk, minimum distance to blood vessel and grey matter white matter ratios, plus graphic representation along the trajectory path of distance to critical structures. A probes eye viewer is also included.\nSelect Risk map in DataManager to show a colour-coded contour map overlying the scalp exclusion mask, with potential entry points represented and the associated level of risk colour coded, with red representing high risk and green representing low risk for any selected trajectory.\nManual adjustment of trajectories.\n\t\nSelect trajectory.\nSelect new entry point by pressing Alt and mouse right-click, and new target point by pressing Alt and mouse left-click.\nAssess new trajectory using the Risk Visualization speed icon as in step 3.3.\n4. Export Plans and Models to the Operating Theater\nCheck that reference image is in DICOM format. Select S7 Export from speed icon.\nDefine the reference image, the plans and trajectories and the models that are to be exported, and specify the destination of the saved archive. Run S7 export tool.\nUpload generated archive onto a USB stick for transfer to a neuronavigation system in the operating theater, and load archived folder on the neuronavigation system for clinical implementation of planned trajectories.\n5. Reconstructing Electrode Implantation Post-operatively",
    "Acquire post-operative CT imaging.\nLoad CT head onto in-house software, and load previously saved patient data set.\nCoregister CT to reference T1 weighted MRI using the NiftyReg tool.\nGenerate 3D surface rendering of electrodes using the SurfaceExtractor tool on the registered CT, with high thresholding.\nClean surface rendered electrodes of noise, and wires using the cleaning and repair functions of 3D mesh processing software."
  ],
  "subjectAreas": [
    "Medicine"
  ],
  "bigAreas": [
    "Biomedical & Clinical Research"
  ]
}