{
  "id": 1632,
  "origin_website": "Cell",
  "title": "Protocol for Projecting Allele Frequency Change under Future Climate Change at Adaptive-Associated Loci",
  "procedures": [
    "Step-By-Step Method Details\nStep-By-Step Method Details\nNote: all steps are performed in the statistical computing environment “R”. Example code for each step can be found at https://github.com/blumsteinm/Projecting_MAF_ClimateChange/STAR_Protocol_Example_Code.R[href=https://github.com/blumsteinm/Projecting_MAF_ClimateChange/blob/master/STAR_Protocol_Example_Code.R]\nCalculate Minor Allele Frequencies by Population for Loci of Interest\nTiming: 10–30 min depending on file sizes\nThis step uses R to pull information on the loci of interest from the genomic data files and uses it to calculate the minor allele frequency (MAF) by population.\nPull the allele information from the .bed files for each loci of interest using the “read.plink” function from the package snpStats in R.\nIf the allele information is in a large file, we recommend using “fread” from data.table instead of “read.csv” for faster loading.\nInstead of reading the whole .bed file into R, use the “select.snps” parameter within “read.plink” to feed a list of loci of interest names or locations.\nCalculate the MAF by population.\nMerge the sample allele information with your population information so that you have a dataframe indicating the sample name, sample population, and what the samples’ alleles at each loci are.\nOur species, Populus trichocarpa, is diploid. Thus our .bed files indicate any individual is either homozygous with 01 (AA) or 03 (BB) as the alleles value, or heterozygous with 02 (AB) as the alleles value. In our data, the minor allele is always 1/A.\nCreate a function for calculating the minor allele frequency by population.\nfreq <- function(alleles = NULL){ converted_alleles <- sapply(as.numeric( alleles ), function(x) ifelse(x == 1, 1, ifelse(x == 2, 0.5, ifelse(x == 3, 0, NA)))) allele_frequency <- sum(converted_alleles)/length(converted_alleles) return(allele_frequency) }\nUse “aggregate” from base R and the “freq” function from above to calculate the MAF (allele A) by population\nDefine the Major Axes of Climate Variation Using a Principal Component Analysis\nTiming: 10–20 min",
    "This step takes the climatic data from the past Normals data and future GCM projections and puts them into principal components (PC) space. PCs pull out major axes of explanatory variation, which is particularly useful when many climate variables are highly correlated and thus difficult to use in a statistical model.\nOrder rows in both climate files by population to ensure they match. This is essential for the principal component analysis (PCA) predictions.\nUse “prcomp” from the vegan package to run a PCA of the past climate Normals data, inputting a matrix of all climate variables as the object.\nEnsure that both “scale” and “center” are equal to TRUE. If not, climate variables with large values will disproportionately drive axis variation.\nUse “predict” and the future climate data as “newdata” to project the future climate variables into PC space.\nCheck results using “biplot” from the vegan package (Figure 1[href=https://www.wicell.org#fig1]).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/109-Fig1.jpg\nFigure 1. Visualizing Current and Future Climate in Principle Components Space\nA visualization of (A) climate variable correlations and (B) climate principal components space. The (A) correlations plot shows positive (blue) and negative (red) correlations between climate variables, with circle size and depth of color indicating the strength of the correlation. The (B) PCA plot depicts climate variables (blue arrows) in the first two axes of pc space. Where populations fall in PC space are shown with the colored dots, with the closed dots representing the past 30-years of climate data and their open counterparts representing where populations are expected to fall in the PC space in 2080.\nFit a Canonical Correspondence Analysis to Current Allele Frequencies versus Climate\nTiming: 15–30 min",
    "This step uses the climate PCs and the MAFs by population that we have tabulated to fit a canonical correspondence analysis (CCA) model. This model is the relationship between past climate and current MAFs. This CCA will be used to project MAFs into the future under climate change.\nMerge the past climate dataframe and MAFs dataframe using “merge” in base R. We merged based on “population name”, so that when data is put into models in subsequent steps, all columns are in the same order by population.\nRecord the index of the climate and MAF columns so that you can distinguish between the two when running the CCA.\nRun a Null Model CCA with no predictors using “cca” from package vegan.\nThis will be used for model comparisons in a future step. In this case, no explanatory predictors are put into the model, just allele data.\nWe ran ours with 4,000 permutations.\nRun a CCA with all climate predictors included using “cca” from package vegan.\nAgain, we ran this with 4,000 permutations.\nDrop environmental predictors that are collinear/non-significant via a step-wise model comparison using “ordistep” in the vegan package.\nWe inputted the null CCA as the object, with the scope set to the full CCA predictor model.\nWe ran ours in both directions, forward and backward, then used the optimal model returned as our CCA model. Using “$anova” with the model object will return the significance of variables remaining in the model.\nFurther Assess CCA Model Fit and Accuracy\nTiming: 20 min\nThis step delves further into how much variation the CCA model explains and how well it does recapitulating our current data.\nCalculate the percent of variation in the MAF data that the model explains as the constrained inertial value divided by the total inertia value.",
    "Note: The “total inertia” is the total variance in allele frequency distributions. The “constrained inertia” is the variance explained by the environmental variables.\nTest whether the model explains more variation in MAF than expected by chance (p = 0.05) using “anova.cca” from the vegan package. If model is not significant, you should reevaluate the climate predictors that you are including.\nFinally, visually compare to what degree predicted MAF values match actual MAF values, given the past climate Normals data (Figure 2[href=https://www.wicell.org#fig2]).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/109-Fig2.jpg\nFigure 2. Predicted Minor Allele Frequencies under Past Climate Normals Plotted by Actual Current Minor Allele Frequencies\nText shows the R2 of each population’s linear regression results. The black line indicates a 1:1 line, while gray lines are population-level fits.\nWe performed linear regressions by population to assess which populations were more poorly predicted than others.\nIn our example data, there are a few populations with non-significant p-values and low R2’s because we do not use the full dataset. These populations may need to be dropped in a real analysis should you find similar results in your data as the model is to replicating the pattern better than chance.\nProject Future Minor Allele Frequencies Given Predicted Climate Change\nTiming: 10 min\nThis step uses the projected climate PCs and the CCA model formed in step 3 to predict MAF change in 60 years and calculate summary statistics.\nUse the “predict” function with CCA model created in step 3 and the future climate PC dataframe in the “newdata” parameter to predict MAF under future climate conditions.\nCalculate the average predicted MAF change across all loci between the climate of the past 30 years and projected climate in 2080 (Figure 3[href=https://www.wicell.org#fig3]).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/109-Fig3.jpg\nFigure 3. The Proportion of Loci Missing the Minor Allele and the Average Predicted MAF Change by Latitude",
    "Plots of (A) the proportion of loci that have only one allele by population and (B) the average project MAF change by population. Both are plotted against population latitude.\nStart by subtracting current MAFs from projected MAFs. This should result in a matrix of differences for each population (rows) at each loci (columns).\nSum the absolute value of each row to get average change by population.\nNote: we chose to look at the absolute value of change as we were interested in capturing both large increases and decreases in allele frequency.\nCalculate the number of loci currently missing the minor allele by population (Figure 3[href=https://www.wicell.org#fig3]).\nWe did this by setting all values in the current MAF matrix below 0.01 to 0 and all else to 1, then summing by populations (rows)."
  ],
  "subjectAreas": [
    "Genomics",
    "Bioinformatics",
    "Genetics"
  ],
  "bigAreas": [
    "Molecular Biology & Genetics",
    "Bioinformatics & Computational Biology"
  ]
}