{
  "id": 9754,
  "origin_website": "Jove",
  "title": "An Experimental Platform to Study the Closed-loop Performance of Brain-machine Interfaces",
  "procedures": [
    "1. Fly Preparation\nThe first step in setting up the experiments involves preparing the fly so that no involuntary motion corrupts the stability of the neuronal recordings and that the head of the fly is correctly oriented with the visual stimulation equipment. To begin preparing the fly, cool it on ice and then use blunted cocktail sticks to hold the wings down, and fix the back of the fly to a piece of double-sided-tape on a microscope slide.\nNext, use an electro-cauterizing needle to apply bees wax to attach the wings to the slide and also to block the action of the flight motor. This step requires quick and accurate handling so that the fly does not warm up during the procedure.\nNow under the microscope, hold each leg with forceps and use a pair of small scissors to cut them off at the joints closest to the body. Repeat this for the proboscis. To prevent the fly from drying out, the holes must be sealed with wax.\nNext, cut one of the wings off and then turn the fly on its side.  Remove any remaining pieces of wing, while leaving the calyptra covering the halteres, and seal the hole with wax.  Repeat this procedure for the other wing.\nTo stimulate a target neuron in a defined way, the fly's head has to be properly aligned with the computer monitors. To do this, you will need a customized holder that has a broad space for the fly's body and an appendage on one end with a notch cut where the fly's neck will be placed.",
    "Place the fly onto the holder with its neck in the notch, pressing it down while gluing the abdomen in place.  Now place the fly holder in a stand so that you can see the front of the fly's head through the microscope.\nViewing the fly with red light, an optical phenomenon called the pseudo-pupil can be seen in each eye. The pseudo-pupil provides a reference frame which can be used to align the fly's head with the stimulus (Franceschini 1975). If the pseudo-pupil assumes a certain shape, as shown by the image insert below, then the orientation of the fly's head is perfectly defined.imgsrc://cloudfront.jove.com/files/ftp_upload/1677/1677fig0.jpg\nUse a micromanipulator to correctly orient the fly's head, and then use wax to glue it to the holder.\nNext, Press the thorax down flat and wax it to the holder. This allows the rear head capsule to be opened so that electrodes can be inserted into the fly brain.\nUse a micro scalpel or a fine injection needle to carefully cut a window into the cuticle of the right head capsule. Be careful not to cut the neural tissue right underneath the cuticle. Once the piece of cuticle is removed, add a few drops of Ringer solution.\nUse forceps to remove any floating hairs, fat deposits, or muscle tissue that may cover the lobula plate. The lobula plate can be identified by a characteristic branching pattern of silvery trachea that covers its posterior surface. \nCut a small hole into the cuticle of the left rear head capsule for positioning a reference electrode. With the fly prepared, lets see how to position the recording electrode.\n2. Positioning the Recording Electrode",
    "With the fly prepared, let’s proceed to locating and recording signals from the H1 neuron. The recording electrode must be placed in close proximity to the H1 neuron. The H1 neuron mainly responds to horizontal back-to-front motion presented to its receptive field (Krapp et al. 2001).\nTo position the recording electrode, use the trachea as a visual landmark. Initially, place the electrode between the uppermost trachea.\nIt helps to use an audio amplifier to convert the recorded electrical potentials into acoustic signals. Each individual spike is turned into a characteristic clicking sound. The closer the electrode gets to an individual neuron, the clearer the clicking sound becomes.\nTo identify the H1 neuron by means of its motion preference, stimulate it with motion in the horizontal direction. With the recording electrode in place, lets move on to visual stimulation and recordings.\n3. Visual Stimulation and Recordings\nThe closed-loop experiments are setup such that such that stimulation of the H1 neuron results in the robot compensating for the movement of the turn-table. To begin, place a fly in front of two CRT computer monitors. Because the fly visual system is 10 times faster than the human’s, the monitors must display 200 frames per second. The monitors and other electrical equipment must be electromagnetically shielded to minimize external noise in the measured neuronal signal.\nPosition the centres of the monitors at +/- 45 degrees relative to the fly's orientation. As seen from the fly's eye equator, each monitor subtends an angle of +/-25 degrees in the horizontal, and +/-19 degrees in the vertical plane.\nSynchronized input to the computer monitors is provided by two video cameras mounted on a small, two-wheeled ASURO robot that has been modified for the experiment.",
    "Position the robot on a turn-table within a cylindrical area whose walls are lined with a pattern of vertically oriented, black and white stripes. By rotating the turn-table in the horizontal plane, the movements of the robot are limited to only one degree of freedom.\nInitially both the turn-table and robot are at rest. When the turn-table starts moving, its rotation carries the robot, in the same direction and the video cameras record the relative motion between the robot and the striped pattern of the arena.\nThe battery-powered video cameras on the robot are mounted at an orientation of +/- 45 degrees. They capture 200 images per second to match the frame rate of the computer monitors in front of the fly.\nLog the images presented to the computer monitors at 200 frames per second at a resolution of 640 x 480 (gray-scale).\nWhile the fly is watching the movements of the striped pattern, record the band-passed filtered (for example, between 300 and 2 kHz) electrical signals with a Digital Acquisition board using a sampling rate of at least 10 kHz.\nA threshold is applied to the band-passed filtered electrical signals to separate the spikes from the background activity. A causal, half-gaussian filter is convolved with the spikes to obtain a smooth spiking activity estimate for the H1 cell. \nTo close the loop of the brain machine interface, a control algorithm is used to convert the spike rate of the H1 cell to a robot speed which is fed back via a Bluetooth interface to control the two DC motors driving the wheels of the robot.",
    "Pure sine waves are chosen as velocity profiles for the turn-table. The sine waves have a DC-offset such that the turn-table only rotates in the direction which stimulates the H1 neuron along its preferred direction. Stimulation of the H1 neuron results in the robot compensating for the movement of the turn-table.imgsrc://cloudfront.jove.com/files/ftp_upload/1677/1677fig1.jpgFigure 1: Closed loop setup. In our setup, spiking activity of the left H1 cell is used to control the motion of a robot mounted on a turntable. Visual image motion generated as a result of relative motion between the robot and the turn-table is captured via high-speed cameras and displayed on two CRT monitors in front of the fly. H1 spiking activity from the left hemisphere is used to estimate the real-time spike rate which then uses a control law to calculate a compensation speed for the robot. The robot counter-rotation stabilizes the visual image motion observed by the fly during closed-loop control.\n4. Representative Outcome and Results\nWhen set up correctly, visual stabilization is achieved when the counter-rotation of the robot matches the rotation of the turn-table, resulting in little or no pattern movement on the computer monitors. The overall performance of the system depends on the control algorithm being used to close the loop.",
    "The first algorithm we test is a proportional controller (figure 2) where the updated robot speed is proportional to the difference in angular velocities between the robot, ωr, and the turn-table, ωp. Different values for the static gain, Kp, and input frequencies for the turn-table signal, ωp, are chosen to test the performance of the controller.imgsrc://cloudfront.jove.com/files/ftp_upload/1677/1677fig2.jpgFigure 2: Proportional controller. (a) Relative motion between the robot and the turn-table in the preferred direction stimulates the H1 cell to give the spike rate, F. This spike rate is converted into a speed error, E, and a proportional controller is used to estimate the updated robot speed, vr(t+1). The spike rate, F, is converted to the speed error, E, based on whether it is less than or greater than the spontaneous spike rate, Fspont. The spike rate to speed error conversion is done by projecting F over a cosine (interval [π,0]) to account for spiking rate threshold nonlinearities. The constants 70 and 150 are used to match the 8-bit input speed of\nthe robot to the minimum and maximum angular velocities of the turn-table. (b) Block diagram showing closed-loop system using a proportional controller. The input to the system is a sinosuidal modulation of the turn-table angular velocity, ωp(t), and the corresponding robot response ωr(t+1) is recorded.",
    "Sample traces for ωp and ωr are shown here for Kp=1 and an input frequency of 0.6 Hz for ωp (see figure 3).  The robot (in green) follows the turn-table (in blue) with a lag and a smaller peak-amplitude. The horizontal component of the pattern motion that stimulates the H1 cell is shown below (in red).imgsrc://cloudfront.jove.com/files/ftp_upload/1677/1677fig3.jpgFigure 3: Closed loop responses. (a) Angular velocities for the turn-table (blue), ωp, and robot (green), ωr, at input frequency = 0.6 Hz. (b) Horizontal optic flow is shown as calculated from logged images (red). Pyramidal Lucas Kanade method (3 pyramid levels) is used to compute the optic flow field between successive image frames. Horizontal angular velocity is calculated by summing the projections of individual vectors in the flow fields onto the horizontal unit vector i. Horizontal back-to-front motion that excites the H1 cell is referred to as PD (preferred direction) while horizontal front-to-back motion that inhibits the H1 cell is referred to as ND (null direction).\nInput frequencies for the turn-table signal, ωp, are chosen between 0.03-3 Hz and the corresponding robot signal, ωr, is recorded. Both signals are transformed into the frequency domain by a fast Fourier transform (see figure 4) and the amplitude and phase values are calculated at the input frequency.imgsrc://cloudfront.jove.com/files/ftp_upload/1677/1677fig4.jpgFigure 4: Frequency response. Angular velocity signals for the turn-table, ωp, and robot, ωr, are transformed into the frequency domain using the fast Fourier transform (FFT) method to calculate amplitude and phase components at the input frequency. Phase components of FFT are not shown in the figure.",
    "The Bode magnitude plot for the proportional controller with Kp=1 shows the response of the system over the tested input frequencies (see figure 5-a). The performance of the controller generally decreases with increasing frequencies. The slightly increased gain at 1 Hz is as a result of oscillations in the robot signal due to using only one H1-cell whose dynamic (output) range mainly covers horizontal back-to-front motion.imgsrc://cloudfront.jove.com/files/ftp_upload/1677/1677fig5.jpgFigure 5: Proportional controller performance. The Bode magnitude and phase plots for the proportional controller (averaged over 8 flies), static gain Kp = 1.0 (a) the bode magnitude plot roughly follows a low pass filter characteristic. The slightly increased gain at 1 Hz is as a result of oscillations in the robot signal, ωr, due to using only one H1-cell whose dynamic (output) range mainly covers horizontal back to front motion. The number of oscillations in the robot signal, ωr, decrease with increasing input frequencies leading to slightly increased gain at these frequencies. (b) the Bode phase plot is less than 180° for input frequencies ≤ 1 Hz and approaches instability at 3 Hz. Beyond a certain input frequency, the controller becomes instable due to the kinematics of the robot. This instability only occurs beyond the known optimal response range of the fly visual system (Warzecha et al. 1999).\nThe Bode phase plot (see figure 5-b) shows a controller phase lag less than Π for input frequencies < 0.6 Hz. This shows that the controller is stable for frequencies < 0.6 Hz and unstable for input frequencies ≥ 1 Hz.",
    "The performance of the proportional controller with a static Kp (in blue) was compared with an adaptive controller (in red), where the value for Kp is updated every 50 ms based on the peak spike rate, Fmax, calculated over time interval [t-500ms - t] (see figure 6). As a result of the large integration time window, the proportional controller performs better than the adaptive controller for the parameter range tested (see figure 7-a). The initial time integration window of 500 ms was chosen for technical reasons related to the robot platform we are using. The adaptive controller had a similar phase characteristic as the proportional controller (see figure 7-b).\nimgsrc://cloudfront.jove.com/files/ftp_upload/1677/1677fig6.jpgFigure 6: Adaptive controller gain. The proportional controller uses a static gain, Kp, whereas the adaptive controller estimates the gain continuously during closed loop control. The dynamic gain, Kp, is inversely proportional to the maximum spike rate, Fmax, over the interval t-500ms ≤ τ ≤ t. Figure shows three instances where Fmax is estimated over time. Based on estimated values of Fmax, Kp is highest during time window 2 (green) and lowest during time window 3 (orange).\nimgsrc://cloudfront.jove.com/files/ftp_upload/1677/1677fig7.jpgFigure 7: Proportional vs. adaptive controller. Bode magnitude and phase plots for the proportional (Kp = 1) and adaptive controller (a) the adaptive controller updates the value of Kp every 50ms based on the peak spike rate estimate Fmax over the last 500ms. The proportional controller gain plot (blue) is higher than that of the adaptive controller (red) indicating that it is performing better at all input frequencies. (b) the Bode phase plots for both controllers are similar with a significant difference at f = 0.3 Hz. Both controllers approach instability at 3 Hz. Significantly different gain and phase values are indicated by an asterix (Wilcoxon rank sum method, p = 0.05).",
    "The grating pattern around the turntable was removed and the lab environment was used as an approximation of naturalistic visual input for the fly H1-cell. On average, the Bode magnitude plot (see figure 8-a) for the naturalistic visual input (in blue) showed slightly higher gains than the one with grating visual input (in red) probably because the wider range of spatial frequencies in naturalistic visual images is exploited. The Bode phase plot characteristics for grating vs naturalistic visual inputs were similar (see figure 8-b).imgsrc://cloudfront.jove.com/files/ftp_upload/1677/1677fig8.jpgFigure 8: Stripped pattern vs. lab environment. The Bode magnitude and phase plots for the proportional controller when presented with stripped patterns (red) vs lab environment (blue) visual images under closed loop (a) the Bode magnitude plot for when lab environment images are used is marginally higher than when stripped pattern is used (except at f = 0.1 Hz) indicating better performance under such stimulus. (b) the Bode phase plot under both visual conditions follow the same pattern, with both approaching instability at 3 Hz. Significantly different gain and phase values are indicated by an asterix (Wilcoxon rank sum method, p = 0.05)."
  ],
  "subjectAreas": [
    "Neuroscience"
  ],
  "bigAreas": [
    "Biomedical & Clinical Research"
  ]
}