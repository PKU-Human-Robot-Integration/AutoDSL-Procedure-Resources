{
  "id": 10293,
  "origin_website": "Jove",
  "title": "Quantifying Fibrillar Collagen Organization with Curvelet Transform-Based Tools",
  "procedures": [
    "NOTE: This protocol describes the use of CT-FIRE and CurveAlign for collagen quantification. These two tools have complementary, but different, main goals and are linked together to some extent. CT-FIRE can be launched from the CurveAlign interface to conduct most operations except for advanced post-processing and ROI analysis. For a full operation of CT-FIRE, it should be launched separately.\n1. Image collection and image requirement\nNOTE: The tool can process any image file with line-like structures readable by MATLAB regardless of the imaging modality used to collect it.\nUse 8-bit grayscale as the image type as the default running parameters are based on this format.\n\tNOTE: SHG imaging is a widely used label-free and high-resolution fibrillar collagen imaging method. SHG images from a breast cancer study19 will be used here for the purpose of demonstration.\n2. Software installation and system requirement\nNOTE: Both standalone and source-code versions are freely available. The source code version requires a full MATLAB installation including toolboxes of Signal Processing, Image Processing, Statistics Analysis, and Parallel Computing. To run the source-code version, all the necessary folders including some from the third-party sources should be added to the MATLAB path. Use of the standalone application (APP) is recommended for most users, which requires an installation of a freely available MATLAB Compiler Runtime (MCR) of specified version. The procedure of installing and launching the APP is described below.\nDownload CT-FIRE version 3.0 (CTF3.0) and CurveAlign Version 5.0 (CA5.0) APP packages from https://eliceirilab.org/software/ctfire/ and https://eliceirilab.org/software/curvealign/, respectively.\n\tNOTE: Each package includes the standalone APP, manual, and test images.\nFollow the detailed requirements and installation instructions from the above websites to install MATLAB MCR 2018b.\nLaunch the APP.\n\t\nFor a Windows 64-bit system, double click on the APP icon to launch it.",
    "For a Mac system, follow the following steps to launch it: Right click on the APP (ctrl-click) | Show Package Contents | Contents | MacOS | applauncher (right-click and choose open).\n\t\tNOTE: Other details can be seen in the software websites listed in 2.1.\n3. Individual fiber extraction with CT-FIRE\nNOTE: CT-FIRE uses CT to denoise the image, enhance the fiber edges, and then uses a fiber extraction algorithm to track individual fibers. Length, angle, width, and straightness are calculated for individual fibers.\nCT-FIRE on single image or multiple images\n\t\nLaunch the APP as described in 2.3.\nClick on the Open File(s) button in the main graphical user interface (GUI, Figure 3A), and then select one or more images/or image stacks from the prompt window. Use the technique appropriate for the operating system to select multiple images in the dialog (e.g., in Windows, hold CTRL while selecting multiple files).\n\t\tNOTE: If two or more image files are selected, all the images must use the same running parameters for the analysis. Make sure that all the images are acquired under the same or similar conditions.\nSelect parallel computing options by checking the Parallel checkbox on the top right corner for multiple images analysis.\nFor the image stack, move the slice slider under the file listbox to select the slice to be analyzed.\nSet running properties. Use default parameters for an initial analysis of some images. If using default parameters, skip to step 3.1.6. To set different parameter(s), click on the Update button in the Parameters panel. Follow the manual to properly tune the parameters.",
    "NOTE: The most frequently adjusted parameters include the background threshold (thresh_im2) and the nucleation searching radius (s_xlinkbox). If the background noise level is high, set thresh_im2 to a larger value; s_xlinkbox is associated with the average radius of the fibers, set a smaller value to detect thin fibers.\nClick on the Run button.\n\t\tNOTE: The progress information will be displayed in both the information window and the command window. After the analysis is complete, the output table will be displayed (Figure 3B).\nClick on any item in the output table to see the histogram of fiber measures (Figure 3C and Figure 3F) of the image including length, width, angle, and straightness.\n\t\tNOTE: The fiber images with fibers overlaid on the original image will also be displayed (Figure 3E).\nCheck the subfolder named ctFIREout under the image folder for the output files including the overlaid image “.tiff” file, “.csv” file, and “.mat” file.\nCT-FIRE region of interest (ROI) analysis\n\t\nROI annotation using ROI Manager\n\t\t\nClick on the Open File(s) button in the main GUI (Figure 3A) to load one or more images.\nSelect the image to be annotated in the file list.\nSelect the ROI Manager in the dropdown menu of ROI Options panel.\nClick on the RUN button to launch the ROI Manager module (Figure 3A).\nIn the ROI manager GUI (Figure 4A), click on the dropdown menu below Draw ROI Menu(d) to draw the ROIs, one by one.\n\t\t\tNOTE: The ROI shape can be rectangle, freehand, ellipse, polygon, or specified rectangle. Follow the on-screen instructions to draw, save, and quit ROI annotation.",
    "After selecting the method to draw the ROI, drag the yellow rectangle that appears on the original image to the desired position, and then click on the Save ROI(s) button or press the key s to add this ROI to the ROI list. This ROI will be automatically named.\nDraw a new ROI by dragging the previous ROI to a new position, and save it as mentioned in 3.2.1.6, or repeat steps 3.2.1.5–3.2.1.6 to draw a new ROI.\nPress x or select New ROI? in the ROI shape dropdown menu to quit ROI annotation.\nCheck the checkboxes Show All and Labels to show all the defined ROIs on the list and their names on the original image.\nSelect the ROI on the ROI list to conduct basic ROI operations including Rename ROI, Delete ROI, Save ROI Text, Load ROI from Text, Save ROI Mask, Load ROI from Mask, and Combine ROIs.\nCheck the output file of the ROI manager saved as “.mat” file in a subfolder named ROI_management under the original image folder.\nTo annotate another image in the opened file list, repeat steps 3.2.1.2–3.2.1.11.\nAfter the annotation is done, close the ROI manager GUI, and reset the main GUI by clicking on the Reset button in the main GUI.\nROI analysis for a single image in ROI Manager\n\t\t\nIf full-image CT-FIRE analysis is conducted and the results are saved in the default directory, click on one or more ROIs in the ROI list, then click on the ctFIRE ROI Analyzer button to launch the Post-ROI analysis module.\n\t\t\tNOTE: The results will be automatically saved in a subfolder located at \\\\[image folder]\\ CTF_ROI\\Individual\\ROI_post_analysis\\.\nIn the pop-up window, click on the Check Fibers button to display fibers within the selected ROIs (Figure 4B).",
    "Click on Plot Statistics to display histograms of each ROI (Figure 4C). The corresponding output figures will be displayed.\nIf full image CT-FIRE analysis has not been conducted, click on one or more ROIs in the ROI list, and click on the Apply ctFIRE on ROI button to directly apply CT-FIRE analysis to the selected ROIs.\nFollow the instructions in the prompt window to run the analysis.\n\t\t\tNOTE: The parameters for running the CT-FIRE are passed through the main GUI, and the user can update the running parameters as described in step 3.1.5 as needed. After the analysis is complete, the summary statistics of fiber measures will be displayed in the output table. The results will be automatically saved in a subfolder located at \\\\[image folder]\\ CTF_ROI\\Individual\\ROI_analysis\\.\nROI analysis for multiple images using ROI Analyzer\n\t\t\nFollow the steps in 3.2.1 to annotate ROIs for the images to be analyzed.\nOpen one or more images by clicking on the Open File(s) button.\nTo run ROI post analysis when the full image analysis results are available, click on the dropdown menu in the Run Options panel and select the option CTF post-ROI analyzer.\nClick on the RUN button to run ROI analysis for all the loaded images.\nCheck the progress information displayed in the message window at the bottom of the GUI and in the command window.\nAfter the analysis is complete, check the summary statistics for each ROI displayed in an output table.\n\t\t\tNOTE: The detailed output files are automatically saved in a subfolder located at \\\\ [image folder]\\CTF_ROI\\Batch\\ROI_post_analysis\\.",
    "To run a direct analysis when the full image analysis results are not available, follow steps 3.2.3.1–3.2.3.6, except that in step 3.2.3.3, select the option CTF ROI analyzer; in step 3.2.3.4, before clicking on the RUN button, update the running parameters as described in step 3.1.5. After clicking on the RUN button, in a prompt dialog window, choose between Rectangular ROI and ROI mask of any shape.\n\t\t\tNOTE: If all the annotated ROIs are rectangular, the user can choose the “Rectangular ROI”. In step 3.2.3.6, the ROI analysis results are saved in a subfolder located at \\\\[image folder]\\CTF_ROI\\Batch\\ROI_analysis\\.\nPost-processing with CT-FIRE\n\tNOTE: After the regular CT-FIRE analysis described in 3.1, the user can perform further post-processing. Without running the time-consuming fiber extraction again, regular post-processing, described in 3.3.1, can update some basic output figure properties, whereas the advanced post-processing described in 3.3.2 can visualize individual fibers and their properties, perform complex thresholding among all the four fiber properties, generate summary statistics of the selected fibers, and visualize the selected fibers using a customized color map.\n\t\nRegular post-processing with CT-FIRE\n\t\t\nLaunch the CT-FIRE app, or click on the Reset button after other operations to initialize the CT-FIRE main GUI (Figure 3A).\nCheck the .mat checkbox on the top of the main GUI.\nClick on the Open File(s) button to select the CT-FIRE output .mat file in the ctFIREout subfolder.\n\t\t\tNOTE: If multiple files are selected, the Batch checkbox will be checked automatically. The file name of the corresponding images will be displayed in the box list.\nUpdate the options in the Output Figure Control panel.\nKeep the default options in Output Options, which will make sure all the output files will be updated according to the new set of parameters set in 3.3.1.4.",
    "Click on the Post-processing button. Check the progress information in the message window at the bottom of the main GUI as well as in the command window.\nAfter the analysis is complete, click on any item in the output table to see the histogram of fiber measures of the image including length, width, angle, and straightness.\n\t\t\tNOTE: New output files will overwrite the old ones in the ctFIREout subfolder.\nAdvanced post-processing of CT-FIRE\n\t\t\nLaunch the CT-FIRE app, or click on the Reset button after other operations to initialize the CT-FIRE main GUI (Figure 3A).\nCheck the OUT.adv checkbox at the top of the main GUI (Figure 3A).\nClick on the Post-processing button to launch the advanced post-processing GUI named “Analysis Module” (Figure 5A).\nClick on the Select File button to select an image.\nClick on the Visualise Fibers button to enter fiber number based on the labels in the Tab figure Original-fibers.\n\t\t\tNOTE: The measurements of the selected fibers will be displayed in an output table (Figure 5B), and the corresponding fibers will be overlaid on the original image shown in the tab figure named Measured-Fibers (Figure 5C).\nClick on the Confirm/Update button to move to the thresholding operation.\nCheck the thresholding box to enable the threshold settings.\nChoose one of the four thresholding options from the dropdown menu.\nEnter the desired thresholds in the Thresholds panel for one or more fiber properties.\nClick on the Threshold Now button to apply the above thresholding conditions.\nCheck the prompt figure with its name ending with metrics visualization to see the selected fibers overlaid on the original images with the customized color maps as shown in Figure 5E.\nRepeat steps 3.3.2.9–3.3.2.11 to set the desirable thresholds.\nClick on the Save Fibers button to save the selected fiber information.",
    "NOTE: Corresponding selected fibers will be displayed in the tab figure named After-Thresholding.\nClick on the Generate stats button, and then click on the OK button in the pop-up window to generate summary statistics.\n\t\t\tNOTE: An output table (Figure 5D) will show the mean value of the selected fibers. Other statistics of the selected fibers will be saved in an excel file whose location is displayed in the status window at the bottom of this GUI.\nTo include the selected individual fiber information in the output file, check the Generate sheet for raw data box before clicking on the OK button.\nTo combine results from multiple images, in step 3.3.2.4, check the Batch Mode box or Stack Mode and select the multiple images or stack(s) to be analyzed; skip steps 3.3.2.5–3.3.2.6. In steps 3.3.2.8–3.3.2.9, set thresholding conditions, but as the buttons threshold now and Save Fibers are disabled, skip steps 3.3.2.10–3.3.2.13; and lastly, follow the instructions in step 3.3.2.14 to generate summary statistics and individual fiber properties of the selected fibers.\n4. Fiber analysis with CurveAlign\nNOTE: CurveAlign was initially developed to automatically measure angles of fibers with respect to user-defined boundaries. The current version of CurveAlign can be used for bulk assessment of density- and alignment-based features in addition to the relative angle measurement by either loading the individual fiber information extracted by CT-FIRE or directly using the local orientation of the curvelets. CurveAlign calculates up to thirty features related to global or local features mainly including density and alignment as well as individual fiber properties when CT-FIRE is adopted as the fiber tracking method.\nFiber analysis with curvelets\n\t\nLaunch the APP as described in 2.3.\nClick on the Reset button to reset the APP to its initial status if other operations have been conducted.",
    "In the main GUI (Figure 6A), check the Fiber analysis method option to make sure CT is selected (default option).\n\t\tNOTE: In this mode, CT is performed on the image, and the orientation of each curvelet represents the direction of a fiber at the corresponding location.\nClick on the Boundary method dropdown menu, and select the boundary processing mode from the following dropdown menu options: No Boundary, CSV Boundary, and TIFF Boundary.\n\t\tNOTE: If no boundary is needed, skip this step. Refer to 4.3 for how to calculate fiber angles with respect to a boundary.\nClick on the Get Image(s) button in the main GUI (Figure 6A), and then select one or more images/or image stacks from the prompt window. Use the technique appropriate for your operating system to select multiple images in the dialog (e.g., in Windows, hold CTRL while selecting multiple files).\n\t\tNOTE: If two or more image files are selected, all the images must use the same running parameters for analysis. Make sure that all the images are acquired under the same or similar conditions.\nFor the image stack, move the slice slider under the file listbox to select the slice to be analyzed.\nEnter the Fraction of coefs to keep. This value is the fraction of the largest coefficients of CT that will be used in the fiber analysis.\n\t\tNOTE: If the image has a large variation in fiber intensity or contrast, annotate regions of interest with even contrast for the fiber analysis as this mode only detects the brightest fibers in an image. In addition, the larger the image size is, set a smaller value for this fraction.\nKeep all the parameters in the Output Options and others in the Advanced option as the default; the output files may be needed in other future operations.",
    "Click on the Run button at the bottom of the main GUI (Figure 6A).\n\t\tNOTE: The progress information will be displayed in a message window highlighted in green color at the bottom. After the process is done, some summary statistics for each image will be displayed in the output table (Figure 6B), and all the output files will be automatically saved in a sub-folder named CA_Out in the directory of the original image(s).\nClick on any item in the output table (Figure 6B) to see the histogram (Figure 6E) or compass plot (Figure 6F) of fiber angles.\n\t\tNOTE: The overlay image (Figure 6C) and heatmap (Figure 6D) of alignment or angle will also be displayed.\nClick on the Reset button to run other operations, or close the main GUI to quit the APP.\nIndividual fiber analysis with CT-FIRE\n\tNOTE: The procedure is the same as the one described in section 4.1 except that in step 4.1.3, select CT-FIRE related fiber analysis mode, and skip step 4.1.7 as it is not applicable and is disabled in CT-FIRE mode. Specifically, in step 4.1.3, select one among the following three CT-FIRE-based individual fiber analysis methods:\n\t\nSelect CT-FIRE Fibers to use the fiber center point and fiber angle to represent the fiber.\n\t\tNOTE: This option does not consider the changes in fiber orientation along the length of the fiber.\nSelect CT-FIRE Endpoints to use the two endpoints of a fiber and corresponding fiber angle to represent the fiber.\n\t\tNOTE: Compared to 4.2.1, this option uses two positions to represent a fiber rather than one (center point of the fiber).\nSelect CT-FIRE Segments to use segments of a fiber to represent the fiber.",
    "NOTE: Each segment has an equal length (set to 5 pixels by default in CT-FIRE) as well as its orientation and location, which reflects the change in orientation along the whole length of the fiber. This option would be the most time-consuming, but would be the best option among the three CT-FIRE-based fiber analysis methods to track changes in the local orientation of a curvy fiber.\nRelative alignment analysis with boundary\n\tNOTE: Compared to the regular analysis without boundary conditions described in sections 4.2 and 4.3, relative alignment analysis with boundary conditions needs the following:\n\t\nIn step 4.1.3, select the tiff boundary condition.\n\t\tNOTE: The user will need a corresponding boundary file for each image or each stack. Follow the on-screen instructions to manually annotate either a CSV (comma-separated-values format based, x-y coordinates) boundary file or a Tiff boundary file. The boundary files created in CurveAlign will be automatically saved according to the file directory and file naming conventions described in the manual. If a pair of H&E bright-field and SHG images are provided, use the automatic boundary creation module described in section 4.4 to generate the boundary file.\nIn the Primary Parameters panel, enter the distance from the closest boundary to only evaluate the fibers within this distance range.\nIn the Output Options panel, check the boundary association box Bdry Assoc to visualize the point on the boundary that is associated with a fiber, fiber segment, or curvelet.\nAutomatic boundary creation\n\t\nLaunch the APP as described in 2.3.\nClick on the Reset button to reset the APP to its initial status if other operations have already been conducted.\nClick on the BD Creation button to launch the automatic boundary creation module.",
    "Follow the on-screen instructions/clues to create boundary file for one or more images based on a pair of H&E bright-field and SHG images.\nClose the module window, or click on the Reset button in the main GUI (Figure 6A) to quit this module.\nCurveAlign region of interest analysis\n\t\nROI annotation using ROI Manager\n\t\t\nClick on the Get Image(s) button in the main GUI (Figure 6A) to load one or more images.\nSelect the image to be annotated in the file list.\nClick on the ROI Manager to launch the ROI Manager module (Figure 7A).\nFollow steps 3.2.1.5–3.2.1.13 in section 3.2.1.\nROI analysis for a single image in ROI Manager\n\t\t\nIf full image CurveAlign analysis has been conducted, and the results are saved in the default directory, click on one or more ROIs in the ROI list, and then click on the CA ROI Analyzer button to run Post-ROI analysis.\n\t\t\tNOTE: After the analysis is complete, summary statistics will be displayed in an output table (Figure 7C) as well as a histogram figure (Figure 7D) showing the angle distribution.\nClick on any item in the output table to visualize the fibers in a given ROI (Figure 7B) as well as the histogram of the fiber angles.\nCheck the output files saved in a subfolder located at \\\\[image folder]\\ CA_ROI\\Individual\\ROI_post_analysis\\.\nIf full-image CA analysis has not been conducted, click on one or more ROIs in the ROI list, and click on the Apply CA on ROI button to directly apply CA analysis to the selected ROIs. Follow the instructions in the prompt window to run the analysis.",
    "NOTE: The parameters for running the CA analysis are passed through the main GUI; update the running parameters described in step 4.1.7 as needed. After the analysis is complete, the results of the summary statistics of fiber measures will be displayed in the output table. The results will be automatically saved in a subfolder located at \\\\[image folder]\\ CA_ROI\\Individual\\ROI_analysis\\.\nROI analysis for multiple images using ROI Analyzer\n\t\t\nFollow the steps in 4.5.1 to annotate ROIs for the images to be analyzed.\nOpen one or more images by clicking on the Get Image(s) button.\nTo run ROI post analysis when the full image analysis results are available, click on the ROI Analysis button and select the option ROI post-processing.\nCheck the progress information displayed in the message window at the bottom of the GUI and in the command window.\nAfter the analysis is complete, check the summary statistics for each ROI displayed in an output table.\n\t\t\tNOTE: The detailed output files are automatically saved in a subfolder located at \\\\ [image folder]\\CA_ROI\\Batch\\ROI_post_analysis\\.\nTo run a direct analysis with CT-mode when the full image analysis results are not available, follow steps 4.5.3.1–4.5.3.5, except for the following changes: modify step 4.5.3.3 by selecting the option CA on cropped rectangular ROI or CA on mask with ROI of any shape. If all the annotated ROIs are rectangular shape, choose the Rectangular ROI option. After step 4.5.3.2, update the running parameters, as described in 4.1.7.\n\t\t\tNOTE: The ROI analysis results will be saved in a subfolder located at \\\\ [image folder]\\CA_ROI\\Batch\\ROI_analysis\\.\nPost-processing of CurveAlign\n\t\nLaunch the APP as described in section 2.3.\nClick on the Reset button to reset the APP to its initial status if other operations have already been performed.\nClick on the Post-Processing button to launch the post-processing module.",
    "Follow the on-screen instructions/clues to combine the output features or values from different images.\nClose the module window, or click on the Reset button in the main GUI (Figure 6A) to quit this module.\n5. Estimated running time\nWait the estimated running time for processing an image with size of 1024 pixels x 1024 pixels with moderate fiber density. The actual computational time generally depends on multiple factors including the size of the file, the analysis mode, the features to be deployed, the central processing unit (CPU) type, and the amount of available random-access memory (or RAM). CT-FIRE individual fiber extraction takes a couple of minutes. CurveAlign CT-mode without boundary takes a few seconds. CurveAlign CT-FIRE fiber or fiber ends mode without boundary takes tens of seconds. CurveAlign CT-FIRE fiber mode without boundary takes hundreds of seconds. CurveAlign analysis with boundary takes tens of seconds to several minutes, depending on the complexity of the boundaries.\nSubscription Required. Please recommend JoVE to your librarian."
  ],
  "subjectAreas": [
    "Bioengineering"
  ],
  "bigAreas": [
    "Bioengineering & Technology"
  ]
}