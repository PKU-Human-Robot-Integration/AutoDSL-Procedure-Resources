{
  "id": 2701,
  "origin_website": "Cell",
  "title": "Protocol for mathematical prediction of patient response and survival to immune checkpoint inhibitor immunotherapy",
  "procedures": [
    "Step-by-step method details\nStep-by-step method details\nData collection\nTiming: days to months\nThe model predicts patient response and/or survival using time-course tumor burden measurements. It may be used with publicly available published data, or with clinically collected patient data for research purposes. Note that although model predictions have been shown to correlate with clinical outcomes, this research remains ongoing, and these predictions should not replace expert clinical opinions. In all cases, the minimum measurements needed are 1) at baseline (start of treatment) and 2) at first restaging (follow-up). In order to obtain unique solutions for all model parameters, 3) one pre-baseline (usually at time of on-study) tumor burden measurement is also necessary for calculating    α 0   . We have provided a sample data set from Borghaei et al. and Topalian et al.18[href=https://www.wicell.org#bib18],19[href=https://www.wicell.org#bib19] in Data S1[href=https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2190-Mmc1.zip]. Sample data.\nCollecting literature-reported tumor burden data.\nExtract the spider plot of normalized measured tumor burden over time and save locally as an image file.\nNote: Sources of spider plots used in published studies, as well as the specific figure we have collected data from in each of these references, are provided in the key resources table[href=https://www.wicell.org#key-resources-table]. A spider plot graphs the normalized (e.g., percent) change from baseline of the total indexed tumor burden over time for each patient in a study.\nLoad spider plot into WebPlotDigitizer.\nOnce spider plot is loaded, calibrate x-axis and y-axis scales as instructed.\nIn manual extraction mode, place the cursor on each measured point on one curve on the spider plot (including the origin) and place a mark using the ‘A’ key.\nOnce all points are marked, click ‘View Data’ to obtain point values. These may be exported as delimited text and imported or copied and pasted directly into spreadsheet software.",
    "Repeat for each curve on the spider plot, and then assign each patient a unique identifier number.\nCollecting in-house clinical patient data.\nNote: we have included details specific to our study on melanoma brain metastases treated with Ipilimumab and Nivolumab with or without concurrent stereotactic radiosurgery and measured using magnetic resonance imaging (MRI) from Butner et al.2[href=https://www.wicell.org#bib2] as an example case study here. Although the details of your study may vary (for example, different cancer types, drugs used, or imaging modalities), the principles used here for patient eligibility and lesion selection serve as useful guidelines for model application to patient data from alternate disease and ICI drug combinations.\nPatient selection.\nRetrospectively identify eligible patients who are 18 years of age or older, diagnosed with brain metastases from a histologically confirmed melanoma, and have been treated with a combination of the immune check point inhibitor (ICI) immunotherapies ipilimumab and nivolumab as an initial treatment intervention for brain metastasis, with or without concurrent stereotactic radiosurgery (SRS).\nCritical: Enrolled patients must have at least one baseline pre-treatment (acquired within 4 weeks of starting the treatment of interest) and two follow-up post-treatment but pre-operative 3-dimensional (3D) contrast-enhanced T1-weighted MRI scans.\nNote: It is expected that times between scans (both pre-treatment vs. baseline and baseline vs. follow-ups) will vary among scans and among patients. In the study presented in Butner et al.,2[href=https://www.wicell.org#bib2] times between baseline and first restaging ranged from 5–230 days. Because the method presented herein quantifies tumor growth as a rate instead of a scalar, it is uniquely robust to such variation.\nImaging data collection and transfer.\nCollect all available in-house images, in our case from The University of Texas MD Anderson Cancer Center, as well as outside center acquired images if they are of adequate quality.",
    "Export post-contrast enhanced T1-weighted MRI from the picture archiving and communication system (PACS) into a network drive in Digital Imaging and Communications in Medicine (DICOM) format either using manual or automatic batch export.\nImport the serial DICOM MRI images for each patient into image viewing and annotation software.\nNote: We used Raystation 11B in our study, but users will need to choose the one most applicable from those available at their institution. Using a consistent platform along with standard operating procedure will ensure more consistent annotation generation.\nImage registration.\nApply image registration of the serial images for establishing brain location links to ensure accurate identification of the region of interest on the follow-up imaging timepoints.\nLesion segmentation.\nSegment and annotate each visible enhancing brain lesion separately. Use semiautomated or automated approaches, if available.\nNote: Semiautomated approaches are commonly based on intensity values (e.g., a region growing tool). If using semiautomated methods, perform manual adjustments using the brush to ensure accurate delineation of each lesion.\nCritical: Use consistent annotation for each lesion or region of interest for serial imaging. For example, label a melanoma brain metastasis region of interest as “lesion_1” and use consistent labeling as you segment this same lesion on follow-up imaging time points. Another separate lesion can be labeled as “lesion_2”, “lesion_3”, etc.\nVolumetric data extraction.\nExtract and record the volume (e.g., in cm3) of each segmented lesion from the serial imaging timepoints into a separate data collection file (e.g., Excel).",
    "Note: This can be done manually or automated by using a script. Although the details of your script will vary based on the imaging viewing and annotation software used, we used Raystation imaging and segmentation/annotation data export tools including Region of Interest (ROI) name, ROI volume to extract lesion volumes from images, and we have found that plentiful open-source resources to export extracted data from Raystation to Excel are available; for example, the Python script export statistics to excel.py for Raystation (our software of choice) may be found on GitHub).\nClinical data collection.\nCollect and record clinical data of interest for each patient, including treatment agents, treatment start and end dates, stereotactic radiosurgery (SRS) details for each lesion, SRS dates, etc.\nCritical: The model requires at least 2 tumor burden measurements at or after start of treatment; however, full statistics on goodness-of-fit can only be obtained if 3 or more measurements are collected. To obtain unique values for all model parameters, one pre-treatment measurement (this can be estimated, see data processing[href=https://www.wicell.org#sec2.3]) is also required.\nNote: Often, time of baseline imaging may deviate a few days from actual start of treatment. This data can safely be used as an accurate measure of baseline volume without modification.\nCode and directory setup\nTiming: hours\nObtain and install software.\nInstall Mathematica21[href=https://www.wicell.org#bib21] according to manufacturer guidelines for your operating system; see key resources table[href=https://www.wicell.org#key-resources-table].\nAlternatively, other software with differential equation fitting capability may be used (e.g., R, Matlab). However, detailed instructions, guidelines, and hints herein are specific for Mathematica.\nDownload and install WebPlotDigitizer22[href=https://www.wicell.org#bib22]; link in key resources table[href=https://www.wicell.org#key-resources-table].\nOptional: The web-based version of WebPlotDigitizer may be used in place of installation on the local host.\nA software for storing tumor volume measurements is needed. We recommend Microsoft Excel, as will be presented in this manuscript.",
    "Note: Mathematica is also able to import from alternative formats (i.e., Libre Office Calc), but importing data into Mathematica from these may be less straightforward. Delimited text may also be used.\nDirectory setup.\nWe recommend placing the spreadsheet and Mathematica script in the same directory to facilitate data import. Then, instruct Mathematica to look for the data file in its local directory with the following command at the top of the Mathematica notebook:\n>SetDirectory[NotebookDirectory[]];\nData processing\nTiming: hours to days\nDepending on data source used, post-processing may be necessary before model analysis. If using clinical data, missing data due to lesions not being visible on some scans must be addressed first, and lesions receiving non-ICI ancillary treatment (such as radiation therapy) must be excluded.\nPost-processing clinical data.\nIf lesions are not visible on one or more scans, but are confirmed to be still be present on a subsequent scan, then they can reasonably be assumed to be present at the ‘not visible’ time. This can be handled by either estimating the missing data via interpolation or excluding the data for all leasions at that time point.\nIf only a small number of measurement times are available, then the number of unique time measurements should be maximized by estimating lesion value at the missing time; standard interpolation or extrapolation methods may be used.\nNote: In order to reduce error introduced in the estimation process, we recommend linear estimation unless your data clearly demonstrates non-linear behavior.",
    "Critical: In order to reduce estimation error, interpolation should be based on calculated lesion volumes, not by interpolating lesion diameters if using RECIST-based measures. Lesion volume for surrounding times should be calculated as in Coding a script to solve the model: 6.d, missing volume should be interpolated from these, and then the mean diameter for missing lesion can be back-calculated assuming a spherical lesion. If lesion volumes were directly measured via contouring, then interpolation should be done directly between the measured volumes.\nAny lesions that received non-ICI ancillary, targeted treatment, such as radiation therapy or surgical resection, should not be included in this analysis at any time point.\nCritical: Inclusion of any lesions receiving targeted ancillary therapy may introduce dramatic shifts in tumor burden that do not reflect the effects of ICI, and model predictions may not be reliable in this case. Care must be taken to ensure these lesions are excluded.\nLesions that received ancillary treatment, such as targeted radiation therapy or surgery should be excluded, as these do not represent the effects of ICI.\nCoding a script to solve the model\nTiming: hours to days\nThe time-dependent model form presented in Equation 2[href=https://www.wicell.org#fd2] is fit to time-course data collected as described above via nonlinear regression fitting methods. In this two-step process, the pre-treatment growth kinetic is first obtained from an exponential fit to pre-treatment data, and then the full model is fit to lesion volume data at baseline and at least 1 post-baseline volume. The protocol described herein is based on model coding in the Mathematica language, and a sample script containing the code described herein is provided in Data S1[href=https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2190-Mmc1.zip]. Example script; however, other languages (e.g., R, Matlab) may also be used.\nImporting and processing data for model analysis.",
    "First, specify the worksheet and tab where data will be imported from. If the workbook is in the same directory as the Mathematica notebook and working directory has been set as above, this is done as follows:\n>data=Table[Import[\"ExcelFile.xlsx\",{\"Sheets\",\"Sheet1\"}]]\nIf data is in a different directory, then the file path must also be specified.\nOnce data is imported, select the data for only one patient, based on the assigned unique patient ID value (see data collection[href=https://www.wicell.org#sec2.1]) in the appropriate column in the spreadsheet (A=1, B=2, etc.). This is easily done with the Cases[] function.\n>singlePatientData=\n    Cases[data,x_/;(x[[IDNumberColumn]]==patientID)];\nNote: Mathematica identifies columns numerically instead of alphabetically, such that A=1, B=2, etc. All column numbers in this section are converted accordingly.\nIdentify unique lesion numbers and time points.\n>lesionNumbers=DeleteDuplicates[\n    singlePatientData[[All,lesionColumnNumber]]];\n>uniqueTimes=DeleteDuplicates[\n    singlePatientData[[All,timeColumnNumber]]];\nIf lesion axes were measured (i.e., RECIST; see data collection[href=https://www.wicell.org#sec2.1]), then these must be converted into an estimated volume, one for each indexed lesion. If lesion volume was measured by contouring, skip to the next step.\nLong axis (RECIST) and approximately perpendicular short axis should be averaged, and lesion volume may be estimated as a 3D sphere.\n  Volume =  4 3  π   (   1 2   (   (  long axis + short axis  )  2  )   )  3   \nSum lesion volumes at each time point to get a total tumor burden at each time point, and append each volume to a list. In this case, we might name the list allPatientVolumes.\n>AppendTo[allPatientVolumes,totaLesionVolume];\nData must be normalized by the volume at time t = 0, so that the volume at t = 0 is equal to 1. If your data has one pre-treatment measurement, then this would be at index [[2]] on the summed volume list.\n>normalizedVolumesSummedLesions=\n    allPatientVolumes⁄(allPatientVolumes[[2]]);",
    "Note: Baseline (start of treatment) has been defined at t = 0. This means that if pre-treatment lesion measurements are available, they will be at negative times relative to baseline.\nNote: Mathematica starts indexing at [1]; if you are using a language that starts indexing at [0] please adjust the above accordingly.\nMapThread the normalized volumes together with the time coordinates for model analysis in order to obtain a single list of linked {x,y} coordinates.\n>normalizedDataPoints=MapThread[{#1,#2}&,\n    {uniqueTimes,normalizedVolumesSummedLesions}];\nNote: this step may not be necessary if using another mathematical language (e.g., this data format is generally not used for regression analysis in R or Matlab).\nSolving the model.\nIf pre-treatment volume data is available, solve for the pre-treatment growth kinetic (α0). Alternatively, if pre-treatment tumor burden is unknown, the pre-treatment growth kinetic (α0) should be estimated by calculating the growth kinetic for the fastest growing tumor burden(s) from a subset of patients within the population (we used the top 10% fastest growing in Butner et al.2[href=https://www.wicell.org#bib2]) shortly after start of treatment as described in 7.b, using Equation 6[href=https://www.wicell.org#fd6].\nNote: Details on this approach can be found in Butner et al.2[href=https://www.wicell.org#bib2],24[href=https://www.wicell.org#bib24]\nThe model assumes exponential pre-treatment growth between lesion measurement directly preceding baseline and at baseline (see Equation 5[href=https://www.wicell.org#fd5] for details). After extracting these two points, exact solution for the exponential growth rate is accomplished by taking the log of the y-coordinate and performing linear regression.\n>dataToComputeAlpha=\n    normalizedDataPoints[[{1,2},{1,2}];\n>logAlphaData=\n    {#[[1]],Log[#[[2]]]}&/@dataToComputeAlpha;\n>alphaMinusFit=\n    FindFit[logAlphaData,cx+d,{c,d},x];\nNote: This approach only uses one pre-treatment volume measurement, even if others are available. In this case, earlier times should be removed from the data. We recommend at least 2 weeks’ time between pre-treatment measurement and baseline measurement.\nNote: This same method is used to calculate the growth kinetic after start of treatment (α1).",
    "Extract the numeric value of α0 from the exact solution.\n>alphaZero=FromDigits[{c}/.alphaExpFit];\nExtracting the first restaging growth kinetic (α1).\nRepeat the steps described in step 7.a., but using the baseline (t = 0) and first restaging/follow-up (after start of treatment: t > 0) points (see Equation 6[href=https://www.wicell.org#fd6]).\nNote: In the case of unavailable pre-treatment measurements, α0 should be estimated from the α1 of the fastest growing tumor burdens within the patient population (these are assumed to have the least response to therapy, and therefore to give a reasonable estimate of untreated growth rate). We used the average of the top 10% fastest growing in Butner et al.2[href=https://www.wicell.org#bib2]\nFitting the model to data.\nIn order to obtain an exact model solution, the time-dependent model form (see Equation 2[href=https://www.wicell.org#fd2]) is fit numerically to all tumor burden time course data with only t ≥ 0 (dataPositive) using the function NonlinearModelFit.\n>nlm=NonlinearModelFit[dataPositive,\n    {(ρinf⁄((1-(1-ρinf)∗Exp[-A∗t])))},{ρinf,A},t]\nNote: This equation may be expanded such that nlm = f(α0, Λ, μ). This should be avoided, as doing so will introduce a region where the model is undefined (due to dividing by zero) and may cause the algorithm to fail. ρinf and A should also be constrained to be > 0.\nNote: Once obtained, the solution should be plotted against the data to ensure goodness of fit. If the solution is not satisfactory, it may be improved by further refining the numerical method. Mathematica offers many ways to do this, we suggest a dual phase evolution-based method we’ve found to reliably produce satisfactory results here.\nMethod→{NMinimize,Method→\n    {\"DifferentialEvolution\",\"ScalingFactor\"→0.7,\n    \"CrossProbability\"→0.3,\n    \"PostProcess\"→{FindMinimum,AccuracyGoal→0,\n    PrecisionGoal→20,\n    Method→\"LevenbergMarquardt\"}}}\nNote: This method seeks to avoid local minima to find the global best fit. Suggestions to further optimize this approach are provided in troubleshooting[href=https://www.wicell.org#troubleshooting].\nObtaining exact model parameter solutions.\nExtract numerical values for model parameters from the NonlinearModelFit solution, i.e.,",
    ">ρ∞=ρinf/.nlmRhoInf[\"BestFitParameters\"];\nIf pre-treatment tumor burden was known, use these values and the value for α0 obtained in 7.a to solve the system of equations in Equations 3[href=https://www.wicell.org#fd3] and 4[href=https://www.wicell.org#fd4]; this is easily done with the Solve[] function."
  ],
  "subjectAreas": [
    "Immunology",
    "Systems Biology",
    "Health Sciences",
    "Biotechnology And Bioengineering",
    "Cancer"
  ],
  "bigAreas": [
    "Biomedical & Clinical Research",
    "Molecular Biology & Genetics"
  ]
}