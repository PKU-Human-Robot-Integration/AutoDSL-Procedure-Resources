{
  "id": 1881,
  "origin_website": "Cell",
  "title": "An image analysis protocol using CellProfiler for automated quantification of post-ischemic cardiac parameters",
  "procedures": [
    "Step-by-step method details\nStep-by-step method details\nImage pre-processing\nTiming: ∼25–30 s per file with Fiji\nMulti-channel confocal/fluorescence microscopy images can be acquired using many different imaging platforms. Each platform will save image data and accompanying metadata with proprietary file formats, which can be read into Fiji automatically, or using the Bio-Formats importer (Linkert et al., 2010[href=https://www.wicell.org#bib4]). Image pre-processing steps are essential for the accurate segmentation of objects, such as nuclei, capillaries and immune cells. Each Fiji macro (key resources table[href=https://www.wicell.org#key-resources-table]) will run batch processes on a single folder of images, to perform the following: Splitting individual channels, converting from 16-bit to 8-bit (for visualization purposes only), improving contrast and smoothing all images, and inverting WGA-stained CMs.\nNote: Image pre-processing steps below are designed to be performed on the example images found in the VCCRI Github folder (link in the key resources table[href=https://www.wicell.org#key-resources-table]). Each macro will output processed images into a new folder within the user-selected directory. If using on the user’s own image sets, the directory structures may be different, and the running of Macros will need to be adapted accordingly.\nDownload the VCCRI GitHub Cardiac-Image-Analysis repository, which contains all files listed in the key resources table[href=https://www.wicell.org#key-resources-table].\nClick the green “Code” button on the main page.\nDownload the zip folder and move the uncompressed directory to the desired location.\nOpen Fiji and run macro #1 (1_Macro_pipeline1.ijm) on image folder 1 (1_Images_pipeline1_WGA_IB4). This macro splits and pre-processes images for pipeline #1.\nSelect “Plugins > Macro > Run…”.\nSelect macro #1 in the first popup window, click Open.\nSelect the desired input folder, and in the second popup window, click Open.\nWait until the log states the conversion is complete, or the processing updates (in the bottom left corner of the Fiji window) have stopped, before moving to the next step.",
    "This will output a folder named “SplitChannel_1” into the selected input folder, which will be used as the input for CellProfiler pipeline #1.\nIn Fiji, run macro #2 (2_Macro_pipeline2.ijm) on image folder 2 (2_Images_pipeline2_WGA_CD45). This macro splits and pre-processes images for pipeline #2.\nSelect “Plugins > Macro > Run…”.\nSelect macro #2 in the first popup window, click Open.\nSelect the desired input folder, and in the second popup window, click Open.\nWait until the log states the conversion is complete, or the processing updates (in the bottom left corner of the Fiji window) have stopped, before moving to the next step.\nThis will output a folder named “SplitChannel_2” into the selected input folder, which will be used as the input for CellProfiler pipeline #2.\nIn Fiji, run macro #3 (3_Macro_pipeline3.ijm) on image folder 3 (3_Images_pipeline3_EdU+FBNo). This macro splits and pre-processes images for pipeline #3.\nSelect “Plugins > Macro > Run…”.\nSelect macro #3 in the first popup window, click Open.\nSelect the desired input folder, and in the second popup window, click Open.\nWait until the log states the conversion is complete, or the processing updates (in the bottom left corner of the Fiji window) have stopped, before moving to the next step.\nThis will output a folder named “SplitChannel_3” into the selected input folder, which will be used as the input for CellProfiler pipeline #3.\nIn Fiji, run macro #4 (4_Macro_pipeline4.ijm) on image folder 4 (4_Images_pipeline4_TUNEL). This macro splits and pre-processes images for pipeline #4.\nSelect “Plugins > Macro > Run…”.\nSelect macro #4 in the first popup window, click Open.\nSelect the desired input folder, and in the second popup window, click Open.",
    "Wait until the log states the conversion is complete, or the processing updates (in the bottom left corner of the Fiji window) have stopped, before moving to the next step.\nThis will output a folder named “SplitChannel_4” into the selected input folder, which will be used as the input for CellProfiler pipeline #4.\nNote: We have described Macros for splitting confocal images with 3 channels in 2 different orders (i.e., channel 1–3, representing, Green-Red-Blue or Blue-Green-Red, respectively). For confocal images with more or less than 3 channels, channel numbers and order in all Macros must be edited/updated in the Fiji macro editor to correctly split the images (by dragging the macro file into Fiji or selecting “Plugins > Macros > Edit…” and selecting the desired Macro in the popup window). The image-processing parameters for Macros may also need to be optimized for the user’s own images, due to possible differences in image acquisition and image quality. The intention of these Macros is to achieve images similar to those seen in Figure 2[href=https://www.wicell.org#fig2], after pre-processing is complete.\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/1361-Fig1.jpg\nFigure 1. Home Screen View of Fiji Plugins drop-down menu\nFiji Plugins menu, with Macros and Run selected.\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/1361-Fig2.jpg\nFigure 2. Representative images before and after automated processing\n(A) Nuclei labeled with DAPI before (i) and after (ii) automated pre-processing steps.\n(B) Cardiomyocyte boundaries labeled with Wheat Germ Agglutinin (WGA) (i), and processed in two steps (ii-iii).\n(C) Capillaries labeled with Isolectin B4 (IB4) before (i) and after (ii) processing. Scale bar represents 20μm.\nAnalysis using CellProfiler",
    "CellProfiler is capable of running complex image analysis pipelines on batches of several thousands of images in only a few minutes to hours. The software requires the use of analysis modules which run image processing algorithms, threshold-based segmentation, calculations and file processing. Below (Table 2[href=https://www.wicell.org#tbl2]), we outline the function of each module required for the segmentation of nuclei, CMs, capillaries, proliferating CFs, apoptotic cells, and immune cells in 2D confocal images from murine hearts. Table 3[href=https://www.wicell.org#tbl3] can be consulted for troubleshooting problems with segmentation in CellProfiler. Pipelines optimized for three channels (Red, Green and Blue (RGB)) are listed in the key resources table[href=https://www.wicell.org#key-resources-table].\ntable:files/protocols_protocol_1361_2.csv\ntable:files/protocols_protocol_1361_3.csv\n“Settings” indicate how each module is used, while “Functions” outline what each module does in the context of this protocol.\nPipeline #1 – Quantify number of capillaries per cardiomyocyte\nSegmentation of nuclei\nTiming: 10–15 min to set optimal parameters and ∼5–10 s to analyze each file with CellProfiler\nSegmentation, the delineation of objects in an image, is achieved here using a number of strategies involving intensity thresholding, size thresholding, image masking and/or object relationships. The accurate segmentation of objects in tissue sections (as compared to cells in culture) is challenging due to cellular complexity and structural heterogeneity present in the scar tissue. This protocol will define several analysis pipelines for the segmentation of cells in the myocardium and cardiac interstitial space, beginning with the segmentation of nuclei, labeled by DAPI.\nChange the number of “workers” (see Note below) to 16 in CellProfiler to increase the parallel processing:\nOpen CellProfiler.\nSelect “Menu > Preferences > Maximum Number of workers: 16” and click OK.\nBegin by loading the required CellProfiler pipeline, by either:",
    "Drag and drop the pipeline (Pipeline #1 - 1_Capillary_per_CM_segment.cpproj in the Github repository) into the left-hand box (Figure 3[href=https://www.wicell.org#fig3]A-i), below the setup tabs (Methods video S1[href=https://www.wicell.org#mmc1]). See Note below if using a later version of CellProfiler (i.e., version 4);\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/1361-Fig3.jpg\nFigure 3. Home screen view of CellProfiler for setup steps\n(A) The Images Tab with, (i) Images module selected for the importation of image files by drag and drop, and NamesAndTypes module for establishing rules to group images, (ii) Box showing importation of images before and after import, (iii) Box containing View output settings box to change output directory, Addition box for adding modules to the pipeline, Start Test Mode button for testing pipeline and segmentation settings, Analyze Images button for running final pipeline.\n(B) The NamesAndTypes tab with, (i) rules to group image by should always use “File > Does > Contain regular expression > Rule”, (ii) Select Duplicate this image to add another channel, (iii) Update button allowing assessment of channel grouping.\nOr, alternatively, users can build up pipelines to suit their own channel layout and experimental setup, by selecting the “Adjust modules: +” and selecting the modules (Figure 3[href=https://www.wicell.org#fig3]A-iii), based on the logic outlined in Table 2[href=https://www.wicell.org#tbl2] and the segmentation blocks in Figure 4[href=https://www.wicell.org#fig4].\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/1361-Fig4.jpg\nFigure 4. CellProfiler home screen view with full pipeline\n(A) (i) “IdentifyPrimaryObjects” module for nuclei segmentation is highlighted and the following parameters correspond this module, (ii) Checkbox to use the advanced segmentation settings (check Yes), (iii) CellProfiler help button (Question mark), (iv) Size threshold parameters for the removal of objects smaller and larger than the diameter limits, (v) Intensity thresholding method and settings for segmentation, (vi) Methods for dividing segmented objects, (vii) Step button to progress between modules in test mode.\nOpen pre-processed image files in CellProfiler and sort them:",
    "Select the “Images” tab and drag and drop image files or entire folders into CellProfiler (Figure 3[href=https://www.wicell.org#fig3]A-i-ii).\nSelect the “NamesAndTypes” tab (Figure 3[href=https://www.wicell.org#fig3]B-i), and arrange files by selecting the rules that apply to the image names (e.g., 1. “File > Does > Contain regular expression” > blue, then 2. “Name to assign these images” > DAPI).\nAdd another image channel by selecting Duplicate this image (Figure 3[href=https://www.wicell.org#fig3]B-ii).\nClick “Update”, ensuring that the filenames are correctly aligned (Figure 3[href=https://www.wicell.org#fig3]B-iii) (i.e., image sets are paired together).\nSelect “View output settings” to change the output directory to desired file location. Input setting can stay the same, as it is not being used in these pipelines.\nSelect “Start Test Mode” (Figure 3[href=https://www.wicell.org#fig3]B-iii), this will allow the step-by-step setup of the pipeline for the user’s images:\nSelect the “Identify Primary Objects” module (Figure 4[href=https://www.wicell.org#fig4]A-i) and ensure that “Use advanced setting” is checked Yes (Figure 4[href=https://www.wicell.org#fig4]A-ii). Then identify the input image as DAPI (or another name depending on the naming convention used, select the Question mark box to read what each option does (Figure 4[href=https://www.wicell.org#fig4]A-iii)). Nuclear segmentation should generally be performed with an Adaptive, Otsu, Two class threshold:\nSet “Object diameter in pixels” to relatively stringent low minimum and high maximum values (e.g., Sizes = 15 and 60 pixels, respectively) (Figure 4[href=https://www.wicell.org#fig4]A-iv).\nSet “Lower and upper bounds on threshold” between flexible values (e.g., 0.001–1.0), with a flexible (0.8) “Threshold correction factor” (Figure 4[href=https://www.wicell.org#fig4]A-v).\nSet “Threshold smoothing scale” to 1.3488 (Sigma of 1.0) (Figure 4[href=https://www.wicell.org#fig4]A-v).\nSet “Suppress Local maxima distance” and “Size of smoothing filter” to lower than the minimum object size (e.g., 10 for both) (Figure 4[href=https://www.wicell.org#fig4]A-vi).\nFinally, set “Method to distinguish clumped objects” and “Method to draw dividing lines between clumped objects” to Shape and Shape, respectively (Figure 4[href=https://www.wicell.org#fig4]A-vi).",
    "Click “Step” to observe segmentation quality in the popup window with defined settings (Figure 4[href=https://www.wicell.org#fig4]A-vii). If these settings are not appropriate, consult Table 2[href=https://www.wicell.org#tbl2]. and the CellProfiler Question Mark box for troubleshooting (Figure 4[href=https://www.wicell.org#fig4]A-iii).\nOnce the segmentation is accurate (Figures 5[href=https://www.wicell.org#fig5]A and 5B), click “Step” for both “Overlay Objects” and “Display Data on image”, to check segmentation and label objects for downstream analysis quality control.\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/1361-Fig5.jpg\nFigure 5. Representative examples of nuclei and capillary segmentation\n(A and B) CellProfiler output showing representative segmentation of nuclei with box highlighting a zoomed view (B) of the same image. (C) CellProfiler output showing representative segmentation of capillaries with box highlighting a zoomed view (D) of the same image.\nFinally, click “Step” on the “Save Images” module to save segmented images as numbered overlays.\nCritical: Segmentation settings should be tested on 10–20 images in the test mode prior to running finalized analysis, to ensure that they work for many images in a protocol and not just a small subset.",
    "Note: (1) The number of workers simply signifies the number of images that can be processed in parallel in open copies of CellProfiler. It is suggested that the numbers of workers should not exceed the number of physical cores (CPUs) in the computer being used. If using a machine with low RAM (4/8 GB), and only 8 CPUs, it may be optimal to run with only 4 or 8 workers. With the above settings, depending on the number of images to be run and the pipeline complexity, a lot of computer memory may be needed and up to several hours processing time (for 1000+ images). Additionally, CellProfiler generates many popup windows when performing analysis if the “eye” symbol is selected for visualization (Figure 4[href=https://www.wicell.org#fig4]A-i), so it is advisable to close other programs before running segmentation tests. In the requisite pipelines, the “eye” symbols are unchecked as this helps speed up processing. (2) The CellProfiler help button (Question Mark box in Figure 4[href=https://www.wicell.org#fig4]A-iii), gives detailed information on the function performed by each line within the module, and often the settings that can be used if objects are over-segmented (separating objects too much) or under-segmented (not separating clumped objects enough). In addition, the troubleshooting in Table 2[href=https://www.wicell.org#tbl2] can be useful for the segmentation details necessary for “Identify Primary Objects”. (3) Each time that a module setting is changed in “Start Test Mode”, the module will have to be rerun.\n    Your browser does not support HTML5 video.\n  \nMethods video S1. CellProfiler operation, related to step 7\nThis video provides a tutorial for the operation of CellProfiler using pipeline #1 (1_Capillary_per_CM_segment.cpproj), which includes loading pipelines, loading images and grouping by names, segmentation visualization, running in test mode and final analysis of images\nSegmentation of capillaries",
    "Timing: 5–10 min to set optimal parameters and ∼5–10 s to analyze each file with CellProfiler\nRemaining in “Start Test Mode” as above:\nSelect the next “Identify Primary Objects” module, with an Adaptive, Otsu, Two class threshold:\nSet “Object diameter in pixels” to relaxed low minimum and high maximum values (e.g., Sizes = 20 and 300 pixels, respectively).\nSet “Lower and upper bounds on threshold” between flexible values (e.g., 0.04–0.9), with a flexible (0.75) “Threshold correction factor”.\nSet “Threshold smoothing scale” to 1.3488 (Sigma of 1.0).\nSet “Suppress Local maxima distance” and “Size of smoothing filter” to much higher than the minimum object size (e.g., 100 for both).\nFinally, set “Method to distinguish clumped objects” and “Method to draw dividing lines between clumped objects” to Intensity and Shape, respectively.\nClick “Step” to observe segmentation quality in the popup window with defined settings (Figure 4[href=https://www.wicell.org#fig4]A-vii). If these settings are not appropriate, consult Table 2[href=https://www.wicell.org#tbl2]. and the CellProfiler Question Mark box for troubleshooting (Figure 4[href=https://www.wicell.org#fig4]A-iii).\nOnce the segmentation is accurate (Figures 5[href=https://www.wicell.org#fig5]C and 5D), click “Step” for both “Overlay Objects” and “Display Data on image”, to check segmentation and label objects for downstream analysis quality control.\nFinally, click “Step” on the “Save Images” module to save segmented images as numbered overlays.\nSegmentation of CMs\nTiming: ∼15 min to set optimal parameters and ∼20 s to analyze each file with CellProfiler\nGiven the larger size of CMs, nuclei of most CMs are not captured in 2D images acquired in a single plane. One common workaround to this problem is to segment CMs individually in images, rather than using segmented nuclei as a seed region and expanding to cell boundaries labeled with WGA (Figures 6[href=https://www.wicell.org#fig6]A–6H).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/1361-Fig6.jpg\nFigure 6. Representative example of CM segmentation",
    "(A–D) Segmentation of background mask, (B) expansion of background mask, (C) generation of an image of the background mask and (D) application of the mask on the processed CM image.\n(E and F) CellProfiler output showing representative segmentation of ‘seed’ region within CM boundaries, with box highlighting a zoomed view (F) of the same image.\n(G and H) Expansion of the seed region (E) to CM boundaries and removal of the boundary region from the seed (H).\nRemaining in “Start Test Mode” as above, and using “Step” to sequentially test modules, first generate a mask of the blank space in the image (i.e., between myofibers).\nSelect the next “Identify Primary Objects” module, with an Adaptive, Otsu, Two class threshold (Figure 6[href=https://www.wicell.org#fig6]A):\nSet “Object diameter in pixels” to very flexible low minimum and high maximum values (e.g., Sizes = 30 and 200 pixels, respectively, to capture as much background as possible.\nSet “Lower and upper bounds on threshold” to very stringent high values (e.g., 0.98–1.0), with a stringent (1.0) “Threshold correction factor” to detect solely empty background.\nSet “Threshold smoothing scale” to 1.3488 (Sigma of 1.0).\n“Suppress Local maxima distance” and “Size of smoothing filter” can be left to be calculated automatically.\nFinally, set “Method to distinguish clumped objects” and “Method to draw dividing lines between clumped objects” to Intensity and Shape, respectively.\nClick “Step” to observe segmentation quality in the popup window with defined settings.\nSelect “Expand or Shrink Objects” to expand masked objects arbitrarily by a specified number of 5 pixels (Figure 6[href=https://www.wicell.org#fig6]B), click “Step”.\nSelect “Convert Objects to Image” to provide an image to mask blank space (Figure 6[href=https://www.wicell.org#fig6]C), click “Step”.\nSelect “Mask Image” to generate the blank space mask (Figure 6[href=https://www.wicell.org#fig6]D), click “Step”.",
    "Next, it is necessary to segment individual CMs, using the WGA boundaries, to perform a 3-step segmentation.\nFirst, generate a ‘seed’ region which is inside the WGA boundary, selecting the next “Identify Primary Objects” module, with an Adaptive, Otsu, Two class threshold (Figures 6[href=https://www.wicell.org#fig6]E and 6F):\nSet “Object diameter in pixels” to relatively flexible low minimum and high maximum values (e.g., Sizes = 30–50 and 150–250 pixels, respectively.\nSet “Lower and upper bounds on threshold” between relatively stringent values (e.g., 0.5–0.97), with a stringent (1.0) “Threshold correction factor”.\nSet “Threshold smoothing scale” to 1.3488 (Sigma of 1.0).\nSet “Suppress Local maxima distance” and “Size of smoothing filter” to lower than the minimum object size (e.g., 25–30 for both).\nFinally, set “Method to distinguish clumped objects” and “Method to draw dividing lines between clumped objects” to Intensity and Shape, respectively.\nClick “Step” to observe segmentation quality in the popup window with defined settings.\nNext, selecting the “Identify Secondary Objects” module, expand the segmentation outwards from the ‘seed’ region, defined in 14a (Figure 6[href=https://www.wicell.org#fig6]G). This will work best with an Adaptive, Otsu, Gradient Watershed:\nSet “Lower and upper bounds on threshold” between relatively flexible values (e.g., 0.2–1.0), with a stringent (1.0) “Threshold correction factor”\nSet “Threshold smoothing scale” to 1.3488 (Sigma of 1.0).\nClick “Step” to observe segmentation quality in the popup window with defined settings.\nLastly, subtract the objects segmented in 14b (larger object) from 14a (smaller object), selecting the “Identify Tertiary Objects” module, to give the border regions (Figure 6[href=https://www.wicell.org#fig6]H), click “Step”.\nOnce the segmentation is accurate, click “Step” for both “Overlay Objects” and “Display Data on image”, to check segmentation and label objects for downstream analysis quality control.",
    "To quantify the area and sizes of CMs (for hypertrophy studies), or determine the numbers of capillaries present per CM (for rarefaction studies), the following quantification modules can be used (Figures 7[href=https://www.wicell.org#fig7]A–7D):\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/1361-Fig7.jpg\nFigure 7. CellProfiler graphical and statistical outputs\n(A) Average statistics from CM area analysis.\n(B) Quantification of numbers of capillaries per CM in representative segmented image.\n(C) Scatter plot showing 3 independent examples of CM segmented areas against capillary segmented areas.\n(D) Histogram showing 3 independent examples of CM segmented areas.\nSelect the “Measure Object Size Shape” module, to quantify geometric parameters of segmented capillaries (from 12b) and cardiomyocytes (from 14b) (Figure 7[href=https://www.wicell.org#fig7]A), click “Step”.\nSelect the “Measure Image Area Occupied” module, to quantify geometric parameters of segmented capillaries (from 12b) and cardiomyocytes (from 14b), click “Step”.\nSelect the “Calculate Math” module, to quantify the ratio of capillaries to cardiomyocytes (Figure 7[href=https://www.wicell.org#fig7]B) (outputs to “Image” .csv file), click “Step”.\nUse the “Display Density Plot” module, to show the shared distribution of capillary and cardiomyocyte areas (Figure 7[href=https://www.wicell.org#fig7]C), click “Step”.\nSelect the “Display Histogram” module, to show the distribution of cardiomyocyte areas (Figure 7[href=https://www.wicell.org#fig7]D), click “Step”.\nFinally, click “Step” on the “Save Images” module to save segmented images as numbered overlays.\nOnce all segmentation steps are optimized, the pipeline is ready to be run, select “Analyse Images”.\nOnce the run is complete, data, in .csv file format, and segmentation images, in .tiff file format, will be available in the output directory for downstream processing.",
    "Note: (1) Once “Analyze Images” is clicked to run the pipeline, there is often a delay before the analysis starts. Depending on the specification of the computer used and the number of images analyzed, this may vary from 1–10 min. At this point, it is advisable to be patient and wait for analysis to begin. If 10 minutes has passed, there may be an error and CellProfiler may need to be restarted. (2) Following the analysis of the users’ own images, it is advisable to cross check all of the segmentation example .tiff files in the output directory for accurate segmentation and quantification. Due to the inherent variability in the acquisition of microscopy images, the settings may not be applicable for every image in the image set, and as such, it may be necessary to run separate analyses in CellProfiler, with changed settings, on those images not properly segmented. (3) There are additional quantification modules that may be useful for determining features of interest, such as the proximity of CMs to one another (“Measure Object Neighbors”) or internal features of myocytes (“Measure Texture” or “Measure Granularity”). However, these may only be useful for a specific purpose. For the more standardized cardiac phenotype indexing, CM hypertrophy and capillary rarefaction should be sufficient. (4) Depending on the number of images to be run and the pipeline complexity, this may require a lot of computer memory, and up to several hours (for 1000+ images).\nPipeline #2 – Quantify number of immune cells per cardiomyocyte\nSegmentation of immune cells\nTiming: 5–10 min to set optimal parameters and ∼5–10 s to analyze each file with CellProfiler",
    "The irregular shape and projections of invading immune cells (CD45+) in the cardiac interstitium make them inherently challenging to segment. Here, we describe an additional CellProfiler pre-processing step to clean the edges and boundaries of the CD45+ cells analyzed.\nBegin by loading the required CellProfiler pipeline, by either:\nDrag and drop the pipeline (Pipeline #2 - 2_CD45_per_CM_segment.cpproj in the Github repository) into the left-hand box (Figure 3[href=https://www.wicell.org#fig3]A-i), below the setup tabs.\nOr, alternatively, users can build up pipelines to suit their own channel layout and experimental setup, by selecting the “Adjust modules: +” and selecting the modules (Figure 3[href=https://www.wicell.org#fig3]A-iii), based on the logic outlined in Table 2[href=https://www.wicell.org#tbl2] and the segmentation blocks in Figure 4[href=https://www.wicell.org#fig4].\nOpen pre-processed image files in CellProfiler and sort them:\nSelect the “Images” tab and drag and drop image files or entire folders into CellProfiler (Figure 3[href=https://www.wicell.org#fig3]A-i-ii).\nSelect the “NamesAndTypes” tab (Figure 3[href=https://www.wicell.org#fig3]B-i), and arrange files by selecting the rules that apply to the image names (e.g., 1. “File > Does > Contain regular expression” > blue, then 2. “Name to assign these images” > DAPI).\nAdd another image channel by selecting Duplicate this image (Figure 3[href=https://www.wicell.org#fig3]B-ii).\nClick “Update”, ensuring that the file names are correctly aligned (Figure 3[href=https://www.wicell.org#fig3]B-iii) (i.e., channels from each image set are paired up).\nSelect “View output settings” to change the output directory to desired file location. Input setting can stay the same, as it is not being used in these pipelines.\nEnter “Start Test Mode” as above.\nStepwise, progress through the nuclei segmentation steps, from the first “Identify Primary Objects” module, as above (Step 10).\nAfter running the first “Save Images” module, proceed forward with CD45+ cell segmentation below:",
    "Select “Smooth” module to homogenize the appearance of CD45+ cells, using the function Smooth keeping edges, and automatically calculating the Artifact diameter. Keep the Edge Intensity difference at 0.1 (Figure 8[href=https://www.wicell.org#fig8]A), click “Step”.\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/1361-Fig8.jpg\nFigure 8. Representative examples of immune cell processing and segmentation\n(A) CellProfiler output showing immune cell image before and after smoothing.\n(B and C) CellProfiler output showing representative segmentation of smoothed immune cells with box highlighting a zoomed view (C) of the same image.\nSegmentation of CD45+ cells is then performed by selecting the “Identify Primary Objects” module, using an Adaptive, Otsu, Two class threshold:\nSet “Object diameter in pixels” to relatively stringent low minimum and high maximum values (e.g., Sizes = 20 and 100 pixels, respectively.\nSet “Lower and upper bounds on threshold” between flexible values (e.g., 0.005–1.0), with a flexible (0.75) “Threshold correction factor”.\nSet “Threshold smoothing scale” to 1.3488 (Sigma of 1.0).\nSet “Suppress Local maxima distance” and “Size of smoothing filter” to lower than the minimum object size (e.g., 20 for both).\nFinally, set “Method to distinguish clumped objects” and “Method to draw dividing lines between clumped objects” to Shape and Shape, respectively.\nClick “Step” to observe segmentation quality in the popup window with defined settings.\nOnce the segmentation is accurate (Figures 8[href=https://www.wicell.org#fig8]B and 8C), click step for both “Overlay Objects” and “Display Data on image” modules, to check segmentation and label objects for downstream analysis quality control, such as with a comparison against manual CD45+ cell quantification with Fiji (Figure 9[href=https://www.wicell.org#fig9]).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/1361-Fig9.jpg\nFigure 9. Comparison of manual and automated segmentation methods for immune cell quantification",
    "(A and B) Manual quantification of immune cells using Fiji compared with the automated quantification (B) by CellProfiler. The red box identifies a region of the image, where objects were not segmented due to them being below the intensity threshold. This highlights the necessity for correct intensity thresholding across many images.\nFinally, click “Step” on the “Save Images” module to save segmented images as numbered overlays.\nStepwise, progress through the CM segmentation steps, as above (steps 13–16).\nOnce all segmentation steps are optimized, the pipeline is ready to be run, select “Analyse Images”.\nOnce the run is complete, data, in .csv file format, and segmentation images, in .tiff file format, will be available in the output directory for downstream processing.\nPipeline #3 – Quantify number of proliferating fibroblasts\nSegmentation and quantitation of proliferating CFs\nTiming: 5–10 min to set optimal parameters and ∼5–10 s to analyze each file with CellProfiler\nBegin by loading the required CellProfiler pipeline, by either:\nDrag and drop the pipeline (Pipeline #3 - 3_EdU_FB_segment.cpproj in the Github repository) into the left-hand box (Figure 3[href=https://www.wicell.org#fig3]A-i), below the setup tabs.\nOr, alternatively, users can build up pipelines to suit their own channel layout and experimental setup, by selecting the “Adjust modules: +” and selecting the modules (Figure 3[href=https://www.wicell.org#fig3]A-iii), based on the logic outlined in Table 2[href=https://www.wicell.org#tbl2] and the segmentation blocks in Figure 4[href=https://www.wicell.org#fig4].\nOpen pre-processed image files in CellProfiler and sort them:\nSelect the “Images” tab and drag and drop image files or entire folders into CellProfiler (Figure 3[href=https://www.wicell.org#fig3]A-i-ii).\nSelect the “NamesAndTypes” tab (Figure 3[href=https://www.wicell.org#fig3]B-i), and arrange files by selecting the rules that apply to the image names (e.g., 1. “File > Does > Contain regular expression” > blue, then 2. “Name to assign these images” > DAPI).",
    "Add another image channel by selecting Duplicate this image (Figure 3[href=https://www.wicell.org#fig3]B-ii).\nClick “Update”, ensuring that the filenames are correctly aligned (Figure 3[href=https://www.wicell.org#fig3]B-iii) (i.e., image sets are paired together).\nSelect “View output settings” to change the output directory to desired file location. Input setting can stay the same, as it is not being used in these pipelines.\nEnter “Start Test Mode” as above.\nStepwise, progress through the nuclei segmentation steps, from the first “Identify Primary Objects” module, as above (Step 10).\nAfter running the first “Save Images” module, proceed forward with CF TdT+ cell segmentation below:\nSelect “Identify Primary Objects” module, segment with an Adaptive, Otsu, Three class threshold:\nSet “Object diameter in pixels” to relatively stringent low minimum and high maximum values (e.g., Sizes = 30 and 120 pixels, respectively.\nSet “Lower and upper bounds on threshold” between flexible values (e.g., 0.05–1.0), with a flexible (0.75) “Threshold correction factor”.\nSet “Threshold smoothing scale” to 1.3488 (Sigma of 1.0).\n“Assign pixels in the middle intensity class to the: Background”.\nSet “Suppress Local maxima distance” and “Size of smoothing filter” to higher than the minimum object size (e.g., 40 for both).\nFinally, set “Method to distinguish clumped objects” and “Method to draw dividing lines between clumped objects” to Intensity and Shape, respectively.\nClick “Step” to observe segmentation quality in the popup window with defined settings.\nOnce the segmentation is accurate (Figures 10[href=https://www.wicell.org#fig10]A–10D), click “Step” for both “Overlay Objects” and “Display Data on image” modules, to check segmentation and label objects for downstream analysis quality control.\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/1361-Fig10.jpg\nFigure 10. Representative examples of CF segmentation at different stages after Myocardial Infarction\n(A and B) CellProfiler output showing representative segmentation of CFs from the border zone 1-day post-MI with box highlighting a zoomed view (B) of the same image.",
    "(C and D) CellProfiler output showing representative segmentation of CFs from the mid-infarct region 3-days post-MI with box highlighting a zoomed view (D) of the same image.\nSegmenting EdU+ nuclei requires the same process as Step 10a-c (Segmentation of nuclei):\nSelect the “Identify Primary Objects” module and segment with an Adaptive, Otsu, Two class threshold:\nSet “Object diameter in pixels” to relatively stringent low minimum and high maximum values (e.g., Sizes = 15 and 60–80 pixels, respectively).\nSet “Lower and upper bounds on threshold” between flexible values (e.g., 0.001–1.0), with a flexible (0.8) “Threshold correction factor”.\nSet “Threshold smoothing scale” to 1.3488 (Sigma of 1.0).\nSet “Suppress Local maxima distance” and “Size of smoothing filter” to lower than the minimum object size (e.g., 10 for both).\nFinally, set “Method to distinguish clumped objects” and “Method to draw dividing lines between clumped objects” to Shape and Shape, respectively.\nClick “Step” to observe segmentation quality in the popup window with our defined settings.\nOnce the segmentation is accurate, click “Step” and perform both “Overlay Objects” and “Display Data on image”, to quality check segmentation and label objects for downstream analysis quality control.\nTo first quantitate the numbers of proliferating CFs, select the “Measure colocalization” module and select EdU and CF images for comparison, and compare with the threshold set at 10% of the maximum intensity across the entire image. Check Yes for “Run all metrics” option.\nAdditionally, it is necessary to quantify overlapping segmented CFs with segmented EdU+ nuclei. To do this, the segmented objects must be related to one another (i.e., EdU+ nuclei that lie within segmented CF areas) and are then re-counted (Figures 11[href=https://www.wicell.org#fig11]A and 11B):\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/1361-Fig11.jpg\nFigure 11. Example relating segmented proliferating nuclei with segmented CFs",
    "(A and B) CellProfiler example of the related objects process and the quantification (B) showing the percentage of active proliferating CFs of the total segmented CFs.\nFirstly, select the “Relate Objects” module, with segmented CFs as the “Parent objects” and segmented EdU+ nuclei as the “Child objects”, click “Step”.\nSave the children with parents as a new object set (check Yes).\nSelect “Convert objects to image” to save the related EdU+ CFs (double positive) objects as a new Colour image, click “Step”.\nOnce the segmentation is accurate, click “Step” for both “Overlay Objects” and “Display Data on image”, to check segmentation and label objects for downstream analysis quality control.\nLastly, quantify parameters relevant to amounts of double positivity and CF sizes.\nSelect the “Measure Object Size Shape” module, to quantify geometric parameters of segmented CFs, click “Step”.\nSelect the “Measure Image Area Occupied” module, to quantify geometric parameters of segmented CFs, click “Step”.\nSelect the “Calculate Math” module, to quantify the percentage of proliferating CFs (outputs to “Image” .csv file), click “Step”.\nFinally, click “Step” on the “Save Images” module to save segmented images as numbered overlays.\nOnce all segmentation steps are optimized, the pipeline is ready to be run, select “Analyse Images”.\nOnce the run is complete, data, in .csv file format, and segmentation images, in .tiff file format, will be available in the output directory for downstream processing.\nNote: The quantification of proliferating CFs was performed here; however, it is conceivable also to quantify total proliferation or other cell-type proliferation by modifying the modules within the pipeline as necessary.\nPipeline #4 – Quantify number of apoptotic cells\nSegmentation of apoptotic nuclei\nTiming: 5–10 min to set optimal parameters and ∼5–10 s to analyze each file with CellProfiler",
    "TUNEL staining is used to detect DNA breaks formed during the final phase of apoptosis, when DNA fragmentation takes place.\nEnter “Start Test Mode” as above.\nStepwise, progress through the nuclei segmentation steps, from the first “Identify Primary Objects” module, as above (Step 10).\nAfter running the first “Save Images” module, proceed forward with TUNEL+ cell segmentation below.\nSegmenting TUNEL+ nuclei require the same process as Step 10a-c (Segmentation of nuclei):\nSelect the “Identify Primary Objects” module. Nuclear segmentation should generally be performed with an Adaptive, Otsu, Two class threshold:\nSet “Object diameter in pixels” to relatively stringent low minimum and high maximum values (e.g., Sizes = 15 and 60–80 pixels, respectively).\nSet “Lower and upper bounds on threshold” between flexible values (e.g., 0.001–1.0), with a flexible (0.8) “Threshold correction factor”.\nSet “Threshold smoothing scale” to 1.3488 (Sigma of 1.0).\nSet “Suppress Local maxima distance” and “Size of smoothing filter” to lower than the minimum object size (e.g., 10 for both).\nFinally, set “Method to distinguish clumped objects” and “Method to draw dividing lines between clumped objects” to Shape and Shape, respectively.\nClick “Step” to observe segmentation quality in the popup window with our defined settings. If these settings are not appropriate, consult Table 2[href=https://www.wicell.org#tbl2]. and the CellProfiler Question Mark box for troubleshooting.\nOnce the segmentation is accurate, click “Step” for both “Overlay Objects” and “Display Data on image”, to check segmentation and label objects for downstream analysis quality control.\nClick “Step” on the “Save Images” module to save segmented images as numbered overlays.\nAdditionally, it is necessary to quantify overlapping segmented nuclei with segmented TUNEL+ nuclei. To do this, the segmented objects must be related to one another (i.e., TUNEL+ nuclei that lie within segmented nuclear areas) and are then re-counted:",
    "Firstly, select the “Relate Objects” module, with segmented nuclei as the “Parent objects” and segmented TUNEL+ nuclei as the “Child objects”, click “Step”.\nSave the children with parents as a new object set (check Yes).\nSelect “Convert objects to image” to save the related TUNEL+ DAPI+ (double positive) objects as a new Colour image, click “Step”.\nOnce the segmentation is accurate, click “Step” for both “Overlay Objects” and “Display Data on image”, to check segmentation and label objects for downstream analysis quality control.\nOnce all segmentation steps are optimized, the pipeline is ready to be run, select “Analyse Images”.\nOnce the run is complete, data, in .csv file format, and segmentation images, in .tiff file format, will be available in the output directory for downstream processing.\nNote: Segmentation of apoptotic nuclei can be performed for any cell-type specific segmented objects (e.g., CFs, CMs, IB4+ capillaries or CD45+ cells), as performed in Step 46, via the “Relate Objects” module."
  ],
  "subjectAreas": [
    "Computer Sciences",
    "Cell Biology",
    "Microscopy"
  ],
  "bigAreas": [
    "Molecular Biology & Genetics",
    "Bioengineering & Technology"
  ]
}