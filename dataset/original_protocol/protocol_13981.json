{
  "id": 17807,
  "origin_website": "Jove",
  "title": "Inverse Probability of Treatment Weighting (Propensity Score) using the Military Health System Data Repository and National Death Index",
  "procedures": [
    "The following protocol follows the guidelines of our institutional human ethics committees.\n1. Defining the cohort\nDetermine and clearly define the inclusion and exclusion criteria of the planned cohort using either 1) a registry or 2) data points that can be extracted from the MDR such as administrative codes for diagnoses or procedures (i.e., all patients with more than two outpatient diagnoses or one inpatient diagnosis of atrial fibrillation).\n\t\nIf using a registry, include two or more patient identifiers for accurate matching with the Military Health System Data Repository such as medical record number (listed in different data sets as patuniq and edipn), full name, date of birth, and/or sponsor's social security number.\n\t\tNOTE: As with all studies utilizing personal health information, safeguards are required and must be adhered to. Proper encryption and data management must be employed during the collection process, and information should be de-identified as soon as possible.\n\t\tNOTE: When referencing the sponsor's social security number (sponssn), all patients are listed with regard to their relationship to the military member (or sponsor), including an identifier for the sponsor, spouse, and children. Be aware that the relationship code and sponsor's social security number may change over time in the data set when patients become adults and get married or divorced. Thus, multiple patient identifiers help to ensure accuracy.",
    "If defining the cohorts through administrative coding, perform a comprehensive literature search to identify prior studies that have potentially validated the codes of interest. Review ICD-9-CM24 and/or ICD-10-CM25 manuals to clarify code definitions and neighboring codes to ensure the appropriate range of codes is being used. Additionally, review the cross-reference tables included in the manuals for consideration of additional codes for inclusion/exclusion. Prior validation studies contain reports of positive predictive value, sensitivity and specificity for various administrative coding strategies. These aid in optimization of cohort selection as well as outcome identification.\nDetermine if there are restrictions (e.g., based on age) on the desired cohort or other exclusion criteria to include in the data request.\nDefine the study period to include time prior to index date for collection of baseline covariates (generally 12 months in administrative data research) as well as study end date.\n2. Defining covariates and outcomes\nDefine administrative codes for confounding conditions through literature searches and use of the ICD-9-CM24 and/or ICD-10-CM25 manuals as done in step 1.1.2 above.\nDetermine other necessary covariates including demographics, medication, and laboratory data.\nReview available data fields in the MDR Data Dictionary here: https://health.mil/Military-Health-Topics/Technology/Support-Areas/MDR-M2-ICD-Functional-References-and-Specification-Documents[href=https://health.mil/Military-Health-Topics/Technology/Support-Areas/MDR-M2-ICD-Functional-References-and-Specification-Documents].\n3. Submitting a request for the MDR\nObtain approval of the Institutional Review Board.\nComplete a data sharing agreement application that can be found here: https://health.mil/Military-Health-Topics/Privacy-and-Civil-Liberties/Submit-a-Data-Sharing-Application?type=All#RefFeed[href=https://health.mil/Military-Health-Topics/Privacy-and-Civil-Liberties/Submit-a-Data-Sharing-Application?type=All#RefFeed]. As part of the application, specify data fields and files being requested on the DRT Military Health System Data Repository (MDR) Extractions worksheet (linked from application form). Specify whether the team is requesting a data analyst supply the raw data or if the team will access the MDR directly. Further specify whether the request is for a one-time data pull or if regular pulls are requested daily, monthly or yearly.",
    "NOTE: To obtain MDR data by any method, there must be a sponsor that is a government employee (active duty military or GS), who is usually a member of the investigator team.\nIf accessing the MDR directly, complete the \"MDR Authorization Request Form\" and \"MDR CS 2875 Form\" that can be found here: https://health.mil/Military-Health-Topics/Technology/Support-Areas/MDR-M2-ICD-Functional-References-and-Specification-Documents[href=https://health.mil/Military-Health-Topics/Technology/Support-Areas/MDR-M2-ICD-Functional-References-and-Specification-Documents].\n4. Accessing the MDR and extracting relevant data\nIf accessing the MDR directly, follow instructions for accessing and using the MDR including software requirements and example SAS programs that are available in the \"MDR User's Guide\" and \"MDR Functional Guide\" found here: https://health.mil/Military-Health-Topics/Technology/Support-Areas/MDR-M2-ICD-Functional-References-and-Specification-Documents[href=https://health.mil/Military-Health-Topics/Technology/Support-Areas/MDR-M2-ICD-Functional-References-and-Specification-Documents].\n\tNOTE: Files are saved in SAS format and accessed through a unix shell generally using putty.exe as well as an ftp program. Knowledge of SAS is required.\nFor a helpful overview of the MDR setup, review the DOD Guide for DOD Researchers on using MHS Data https://health.mil/Reference-Center/Publications/2012/10/10/Guide-for-DoD-Researchers-on-Using-MHS-Data[href=https://health.mil/Reference-Center/Publications/2012/10/10/Guide-for-DoD-Researchers-on-Using-MHS-Data].\nAs done in step 2.3, review the MDR Data Dictionary for detailed information on all available data files https://health.mil/Military-Health-Topics/Technology/Support-Areas/MDR-M2-ICD-Functional-References-and-Specification-Documents[href=https://health.mil/Military-Health-Topics/Technology/Support-Areas/MDR-M2-ICD-Functional-References-and-Specification-Documents].\n\tNOTE: Not all data files include all patient identifiers for matching/merging. The data dictionary helps list identifiers that are available for each data file. The DOD ID number, also referred to as \"patuniq\" or \"edipn\", is needed to extract pharmacy information, for instance. Having all appropriate patient identifiers in the data mining step is therefore important to ensure the ability to match all patient information across multiple years and multiple data sets. It is important to reiterate that inherent in research that involves PHI, strict adherence to data safeguarding procedures is required after acquiring necessary approval, and PHI should be destroyed after it is no longer needed.\nObtain necessary patient identifiers for the cohort by accessing the vm6 beneficiary data (Sep 2002–present) or pben file (Sep 2000–Sep 2002).",
    "Use the macro below or a similar program to match vm6 data to the cohort file. In this case, the code can be used as written to find patient medical record numbers (MRNs) for a given patient social that is already in a cohort file. Use different variable names in the vm6 data draw and cohort files for patient names and birthdates to help check for errors later. To safeguard PHI, store the data with patient identifiers on the service node in the space provided as part of the data request (see MDR User's Guide).\n\t\tNOTE: MRNs are referred to as the DOD ID number, PATUNIQ or EDIPN in the MDR).\nimgsrc://cloudfront.jove.com/files/ftp_upload/59825/59825eq1.jpg\nAs database entries are never completely free of error, perform error checks after each major step in addition to checking the program log and output for any potential concerns. Use the data step below to review potential mismatches with the code above (patient files are matched based on the patient/beneficiary social). When comparing names from the cohort file (lastname, firstname) with the vm6 file (last_name, first_name), only match on the first three letters to reduce false errors that arise with differences in spelling/spacing between files.\nimgsrc://cloudfront.jove.com/files/ftp_upload/59825/59825eq2.jpg\nReview error data file (\"checkname\"). Ignore errors caused by punctuation (O'Reilly vs. OReilly). Check other errors of concern with manual review of the health record or consider discarding relevant patient/patient information if significant errors exist and if verification is not possible.\nExtract the remaining needed data from the MDR.\n\t\nIf needed, obtain race and sex from vm6ben files (pben files prior to September 2002), merge with the cohort file, and check for errors as done above:\nimgsrc://cloudfront.jove.com/files/ftp_upload/59825/59825eq3.jpg\nObtain death data from the death master file, merge with the cohort file, and check for errors as done above:\nimgsrc://cloudfront.jove.com/files/ftp_upload/59825/59825eq4.jpg",
    "Obtain additional data files needed for analysis (see MDR Functional User's Guide for data location and additional helpful SAS macros and code).\n\t\tNOTE: Data is stored in separate files depending on whether it was directly provided by military health care system or delivered elsewhere and billed to the military health care system. Example files are shown below.\n\t\tCAPER – direct care, outpatient files from fy 2004–present\n\t\tSADR – direct care, outpatient files from 1998–2005\n\t\tSIDR – direct care, inpatient hospitalizations (direct care) from 1989–present\n\t\tTEDI – billed care, institutional claim files fy 2001–present\n\t\tHCSRI – billed care, institutional claims fy 1994–2005\n\t\tTEDNI – billed care, non-institutional claims fy 2001–present\n\t\tHCSRNI – billed care, non-institutional claims fy 1994–2005\n\t\tPDTS – pharmacy file with individual prescriptions fy 2002–present\n5. Merging data and constructing summative files\nWhether data is obtained from a data analyst or obtained directly from the MDR as done in section 4 above, data files will need summated and merged together to form the analysis file. Throughout the process, utilize methods that improve data accuracy, including error checks and review of logs and output as also previously discussed.\n\t\nWhen merging data, use at least two patient identifiers when possible to ensure a strong match (such as medical record number and date of birth), since errors can exist in any field. After the data merge, review the data to ensure expected results. Run the code to ensure that the first three letters of the name match in addition to another identifier or two is useful to verify proper matches (see step 4.5.1).\n\t\tNOTE: The last name may not match if the patient was married during the time period in question. Minor variations may also exist in name fields due to apostrophes or spacing as well as typos.",
    "Pay particular attention to matches at terminal steps in the process such as defining patients who had outcomes.\nExtract baseline comorbidities using ICD-9-CM or ICD-10-CM codes from the period before the index date, the date the patient is considered as entering the study. Generally, use 12 months prior to index date to define comorbidities.\n\t\nEnsure patients had eligibility for the military healthcare system during the baseline period (can be verified monthly in the vm6ben file).\nSearch baseline diagnosis codes in outpatient and/or inpatient files to establish baseline comorbidities during the baseline 12-month period prior to index date. Use ICD-9-CM or ICD-10-CM codes established in section 1. If using Elixhauser comorbidities, use available software from HCUP, making sure to modify the names of diagnosis variables and files as needed. (https://www.hcup-us.ahrq.gov/toolssoftware/comorbidity/comorbidity.jsp#download[href=https://www.hcup-us.ahrq.gov/toolssoftware/comorbidity/comorbidity.jsp#download])\nSearch inpatient and/or inpatient files after the index date for outcomes of interest defined by ICD-9-CM or ICD-10-CM codes, such as hospitalization for myocardial infarction as primary diagnosis (search for 410.x1 in SIDR).\nSet a study end date for all patients as a cutoff for follow-up for patients who have not demonstrated the outcome of interest. Determine which patients need to be censored prior to study end.\n\t\nSearch vm6ben file to ensure eligibility for healthcare through the study end date.; otherwise, censor the patient at the time of loss of eligibility.\nIf it is important to limit the study to active users of the healthcare system independent of eligibility, such as active users of the pharmacy, then determine the last health care contact (such as last medication fill) within the data files and censor the patients at that date.\n\t\tNOTE: Be careful using telephone encounters, as they can be present in the health record after a death has occurred or if the beneficiary has exited the healthcare system in another manner.",
    "6. Match to the national death index (NDI)\nOnce the full cohort is identified, send the information to the national death index for matching if mortality is an endpoint.\n\t\nFirst, include the intent to match to the NDI in the requests for MDR data and IRB approval. Ensure approval and complete all data encryption steps completed before sending protected health information (PHI) to the NDI for matching.\nThe \"National Death Index (NDI) Application Form\" and directions for requesting death data from the National Death Index can be found here: https://www.cdc.gov/nchs/ndi/index.htm[href=https://www.cdc.gov/nchs/ndi/index.htm].\nSend the data on a password-protected CD by overnight mail to the NDI. Results will be sent back approximately 2 weeks later in the same manner.\nAfter receiving the NDI results, review partial matches for potential inclusion/exclusion.\n\t\n\"Chapter 4 - Assessing NDI Output\" provides a helpful overview of reviewing results and can be found on the same webpage: https://www.cdc.gov/nchs/ndi/index.htm[href=https://www.cdc.gov/nchs/ndi/index.htm]. Matches on social security number generally provide the strongest match.\nWhen needed, cross-check deaths in the Social Security Death Index and/or Veterans Affairs Beneficiary Identification Records Locator Subsystem (BIRLS) to improve accuracy. Be aware that service members who die overseas will likely not show up on an NDI search but are often recognized in the MDR vital status file or in the VA BIRLS.\nMerge the death file with main cohort file after completing the review.\n7. De-identifying data\nOnce all necessary information is acquired, de-identify the data files to help protect PHI. Generate a random patient identifier for each patient using \"ranuni\" (see MDR Functional User's Guide). Remove patient social, medical record number, date of birth (after computing age), etc., from data files. If needed (and approved), store a key that links the random patient identifier to the PHI securely on the SCE node.\n8. Computing the propensity score18,19,26",
    "Use logistic regression to model the probability of treatment (proc logistic in SAS).\n\t\nSpecify the data file (\"dat\" in the example).\nUse class statement to specify categorical variables. Use \"ref = first\" to specify the lowest value (such as 0) as the reference value.\nIn the model statement, specify the treatment variable as the dependent variable (Rx) and set the value for the \"event\" as the value for receiving treatment (1 in this case).\nInclude any possible predictors of receiving treatment as covariates in the model, especially if they could be predictors of the outcome (such as death). Consider if interactions between terms may impact treatment. Include them in the model by using an \"*\" (such as male*ckd) or use the syntax shown below placing \"|\" between covariates and \"@2\" at the end to specify all 2 x 2 interactions, as appropriate for the specific model.\nUse the output statement to specify that the predicted probability of treatment (prob) will be defined by \"ps\" and output to the file \"ps_data.\"\nimgsrc://cloudfront.jove.com/files/ftp_upload/59825/59825eq5.jpg\n\t\tNOTE: Variables in model: male: male sex (binary), ckd: chronic kidney disease (binary), liver: chronic liver disease (binary), diabetes (binary), copd: chronic obstructive pulmonary disease (binary), chf: heart failure (binary), cad: coronary artery disease (binary), cvd: cerebrovascular disease (binary), pad: peripheral arterial disease (binary), age (continuous).\nCalculate weights from the predicted probability (propensity score). If the patient received treatment (Rx = 1), then the propensity score weight is 1/(propensity score). If the patient did not receive treatment, then the propensity score weight is 1/(1 - propensity score).\nimgsrc://cloudfront.jove.com/files/ftp_upload/59825/59825eq6.jpg",
    "Stabilize the propensity score by dividing it by the mean weight. In the code below, Proc means outputs the mean weight into the variable \"mn_wt\" in the data file \"m.\" The data set below that retains the mn_wt from data file \"m\" then computes the stabilized propensity scores (st_ps_weight) for each observation.\nimgsrc://cloudfront.jove.com/files/ftp_upload/59825/59825eq7.jpg\nVerify balancing after applying the inverse probability of treatment weighting.\n\t\nThe stddiff macro simplifies computing standardized mean differences for covariates before and after weighting in SAS. The code for the macro can be found here: http://www.lerner.ccf.org/qhs/software/lib/stddiff.sas[href=http://www.lerner.ccf.org/qhs/software/lib/stddiff.sas].\nCalculate the standardized mean difference before weighting. As with all macros, the macro code should be run in SAS prior to calling it. An example call statement is below with the covariates of interest.\nimgsrc://cloudfront.jove.com/files/ftp_upload/59825/59825eq8.jpg\n\t\tInds - input data set, groupvar - variable that defines the study groups, charvars – categorical variables, numvars – continuous variables, stdfmt – format of standardized difference, outds – output data set.\nCall the stddiff macro again to calculate the standardized mean difference after weighting. \"Wtvar\" specifies the variable containing the standardized propensity score and is added to the macro call statement. If the standardized differences are all less than or equal to 0.1, then the balancing is considered successful.\nimgsrc://cloudfront.jove.com/files/ftp_upload/59825/59825eq9.jpg\nThe ASD before and after weighting can be reported in tabular or graph format. For directions for utilizing a SAS macro to generate a plot, please see the Supplementary Materials.\nThe IPTW-adjusted data can be now be used in a univariate analysis after ensuring balancing of measured confounders.\n9. Creating the outcome model and generating a plot of cumulative incidence function\nThere are a few ways that the resultant time-to-event analysis can be plotted, including using proc lifetest to generate a survival plot. Use the weight statement to indicate the standardized propensity weight.",
    "To generate a cif plot using a propensity weight, use proc phreg.\n\t\nIn proc phreg, reference a covariate file to specify covariate values to be used when generating the plot. In this case, the covariate file only contains the single variable Rx, which can be 1 or 0.\nimgsrc://cloudfront.jove.com/files/ftp_upload/59825/59825eq10.jpg\nToggle ods graphics on. Use additional statements as needed to specify output files for the graph or file type (jpeg, etc.; see https://support.sas.com/documentation/cdl/en/statug/63962/HTML/default/viewer.htm#statug_odsgraph_sect014.htm[href=https://support.sas.com/documentation/cdl/en/statug/63962/HTML/default/viewer.htm#statug_odsgraph_sect014.htm]).\nimgsrc://cloudfront.jove.com/files/ftp_upload/59825/59825eq11.jpg\nIn the proc phreg syntax, use the weight statement to specify the standardized propensity score variable. Specify values for baseline covariates using the baseline statement in order to be able to plot the cumulative incidence function. Specify the strata to use for the plot using \"rowid\" (in this case RX 1 vs. 0). The number in parentheses following the outcome variable (\"event\") specifies the value(s) of the variable that should be censored which should include the censoring date and any competing events. In this case, 0 is censored and 1 is a true event.\nimgsrc://cloudfront.jove.com/files/ftp_upload/59825/59825eq12.jpg\nSubscription Required. Please recommend JoVE to your librarian."
  ],
  "subjectAreas": [
    "Medicine"
  ],
  "bigAreas": [
    "Biomedical & Clinical Research"
  ]
}