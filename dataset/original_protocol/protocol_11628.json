{
  "id": 13028,
  "origin_website": "Jove",
  "title": "AMEBaS: Automatic Midline Extraction and Background Subtraction of Ratiometric Fluorescence Time-Lapses of Polarized Single Cells",
  "procedures": [
    "1. Interactive notebook protocol\nThe Jupyter notebook can be used directly on the web using Google Colab at https://colab.research.google.com/github/badain/amebas/blob/main/AMEBAS_Colab.ipynb, where the instructions below were based. Alternatively, the Jupyter notebook is available at https://github.com/badain/amebas, where it can be downloaded and configured to run locally in Jupyter (Anaconda can provide an easy and cross-platform installation process). A complete test data can be found at Zenodo (https://doi.org/10.5281/zenodo.7975350), containing single and dual channel data of Arabidopsis pollen tubes expressing either pH or Ca​2+ reporters14. The pipeline has been divided into parts, where every step can be executed by clicking on the play button after setting the user-specific options. The necessary files for this study are available in AMEBaS- main zip folder (Supplementary Coding File 1).\nOpen Jupyter notebook and read the time-lapse files.\n\t\nNavigate to the homepage of the interactive notebook in Google Colab referred above or download and open the AMEBaS_Local.ipynb notebook from GitHub.\nPrepare the directory setup for the input and output data:\n\t\t\nIf using the local version, place the fluorescence time-lapse as a TIFF file or DV file inside a folder named data that must be in the root folder of the program. A folder named out must be created to receive the generated data. Then run the Setup code block.\nIf using the notebook on Google Colab, run the Setup code block to automatically generate the data and out folders.\nRun the File Input code block to read the time lapse data by clicking the play button. If using the Google Colab version of the notebook, click on the Choose File button to directly upload the time lapse file to the data folder.\n\t\t​NOTE: The number of channels will be automatically detected based on the dimension of the image.",
    "Choose if additional outputs of each step will be generated by setting the 'verbose' parameter to True or False.\nDetect the main cell and segment from the background (Figure 2).\n\t\nRun the Single Cell Segmentation code block to automatically separate the cell of interest from the background by clicking the play button.\n\t\tNOTE: Median and Gaussian filters will be applied as a preprocessing step to remove unwanted noise before segmenting the foreground from the background by Isodata thresholding and isolating the region of the largest area to remove undesired artifacts.\n\t\t\nAdjust the sigma value used by the Gaussian in the 'sigma' variable to fine-tune the smoothness of the segmentation mask. The default value is 2.0.\nSet the variable estimate to False to store the threshold estimated from Isodata directly or to True to smooth it across neighboring frames using local polynomial regression (LOESS). Fine-tune its function by changing the n_points variable. The default value is 40.\nTrace midline along the cell extension (Figure 3).\n\t\nRun the Cell Midline Tracing code block by clicking the play button to automatically skeletonize the cell using Lee's method18 and extend the tip of the last skeleton through linear extrapolation.\n\t\t\nChoose to trace the midline only on the last frame or once per frame by adjusting the complete_skeletonization argument.\n\t\t\tNOTE: When all frames are skeletonized, extrapolation is skipped.\nSet the fraction of points in the skeleton to be interpolated during extrapolation by adjusting the interpolation_fraction variable. The default value is 0.25.\nChoose the length of the midline extrapolation by changing the variable extrapolation_length. The default is -1, which extends the skeleton up to the nearest edge.\nGenerate kymographs for each channel ( Figure 4).\n\t\nRun the first Data Visualization code block by clicking the play button to automatically generate kymographs for both channels.",
    "Choose the size of the Gaussian kernel used for smoothing by adjusting the variable kymograph_kernel.\n\t\t\tNOTE: It corresponds to the size of the neighborhood (in pixels) over which the pixel intensities are averaged. The default is 3 pixels x 3 pixels.\nNonextended skeletons generate capped Kymographs that must use a custom colormap to properly display their intensities. Choose the fraction percentage of the intensities that will be assigned to the background color, black, adjusting the shift_fraction variable. The default value is 0.7.\nCalculate the ratio between channels (Figure 5).\n\t\nRun the second Data Visualization code block by clicking the play button to automatically generate a ratiometric kymograph and a ratiometric timelapse (Figure 6).\n\t\tNOTE: This step is only available when using dual-channel time lapses. The background intensity threshold stored in step 1.2.1.2 is subtracted from each channel.\n\t\t\nAdjust the switch_ratio variable to switch the order of channels used as the numerator and denominator during ratio calculations. The default is False.\nChoose if the ratio timelapse must be further smoothed with a median filter pass by adjusting the smooth_ratio variable. The default is False.\nChoose whether to remove outliers produced by the low signal of the denominator channel by manipulating the reject_outliers variable. Defaults to True and defines outliers as values 1.5 times the interquartile range above the third quartile (where 75% of the values lie).\nChoose whether the background in the ratiometric output must be exported by adjusting the variable background_ratio. The default is False, which replaces it with zeros.\nimgsrc://cloudfront.jove.com/files/ftp_upload/64857/64857fig02.jpg",
    "Figure 2: Single cell segmentation step. Image processing techniques such as filtering, thresholding, and area labeling are used to isolate the signal of interest (step 1.2). This particular data had the following values for Lowest Intensity: 2556, Median: 3441, and Highest Intensity: 32125. Please click here to view a larger version of this figure.[href=https://www.jove.com/files/ftp_upload/64857/64857fig02large.jpg]\nimgsrc://cloudfront.jove.com/files/ftp_upload/64857/64857fig03.jpg\nFigure 3: Midline tracing overview- The midline of the single cell is obtained by calculating its skeleton (white). The tip (magenta) is extrapolated linearly from the last points at the end of the skeleton (step 1.3). In this composition both the midline and its tip are superposed over the original cell. Please click here to view a larger version of this figure.[href=https://www.jove.com/files/ftp_upload/64857/64857fig03large.jpg]\nimgsrc://cloudfront.jove.com/files/ftp_upload/64857/64857fig04.jpg\nFigure 4: Timelapse's kymographs- Comparison of the kymographs for each channel generated with 'complete_skeletonization' turned off (step 1.4). The vertical axis describes the progression of time, and the horizontal axis plots the average intensity of the extrapolated midline path followed by a single cell. For this particular data, the colormap represents the following values for Channel 1 Lowest Intensity: 2886, Median: 3167, Highest Intensity: 21021. Channel 2 Lowest Intensity: 3030, Median: 3400, Highest Intensity: 29688. Please click here to view a larger version of this figure.[href=https://www.jove.com/files/ftp_upload/64857/64857fig04large.jpg]\nimgsrc://cloudfront.jove.com/files/ftp_upload/64857/64857fig05.jpg\nFigure 5: Background threshold smoothing- The background segmentation threshold is estimated via the isodata algorithm and then smoothed via local polynomial regression (step 1.5). Please click here to view a larger version of this figure.[href=https://www.jove.com/files/ftp_upload/64857/64857fig05large.jpg]\nimgsrc://cloudfront.jove.com/files/ftp_upload/64857/64857fig06.jpg\nFigure 6: Ratiometric results- (A) Comparison between the last frame of the ratiometric timelapse and the segmented original first channel. (B) Kymograph generated from the ratiometric timelapse (step 1.5). Please click here to view a larger version of this figure.[href=https://www.jove.com/files/ftp_upload/64857/64857fig06large.jpg]\n2. Batch mode protocol",
    "Download and place the file pipeline.py from the AMEBaS GitHub repository in the same directory as the data.\nType in the file location on the command line after the program file.\nInclude --v as a positional argument to show the internal steps of the pipeline, if desired.\nInclude --s to choose in the sigma value used in the Gaussian Filter preprocessing step in preparation for cell segmentation. The default is 2.\nInclude --a to trace the midline for each frame of the time lapse. By default, the pipeline uses only the last frame.\nInclude --f to choose the fraction [0,1] of the skeleton to be used in the interpolation. The default value is 0.25.\nInclude -e to choose the length in pixels of the extrapolated skeleton. The default is -1, which extends the skeleton up to the nearest edge.\nInclude --sf to choose the fraction of the color range that will be shifted to the background in non-extrapolated kymographs. The default value is 0.7.\nInclude --k to determine the size of the kernel used in the kymograph Gaussian filtering. The default is 3.\nInclude --eb to estimate global background threshold intensity via LOESS polynomial regression of the frame-specific background threshold intensities.\n\t\nCustomize the number of points used in LOESS smoothing of the background threshold values by modifying the parameter --n. The default value is 40.\nSwitch the channels used as the numerator and denominator during ratio calculations, including -r or --switch_ratio, if the timelapse has two channels. By default, the second channel is the numerator and the first is the denominator.\nChoose if the ratio timelapse must be further smoothed with a Median Filter pass with the --sm argument. The default is False.\nInclude -o to reject pixels with abnormal intensities during ratiometric time-lapse generation.",
    "Choose if the background in the ratiometric output must be exported using the argument --b. The default is False, which replaces it with zeros.\nPress enter to run. The output will be generated in the same directory as the program file.\nSubscription Required. Please recommend JoVE to your librarian."
  ],
  "subjectAreas": [
    "Developmental Biology"
  ],
  "bigAreas": [
    "Molecular Biology & Genetics"
  ]
}