{
  "id": 9883,
  "origin_website": "Jove",
  "title": "Implementation of a Real-Time Psychosis Risk Detection and Alerting System Based on Electronic Health Records using CogStack",
  "procedures": [
    "This study was approved by East of England - Cambridgeshire and Hertfordshire Research Ethics Committee (Reference number: 18/EE/0066).\nNOTE: We have developed this protocol based on the CogStack platform and the Python programming language. This system requires Docker (more specifically, Docker Compose https://docs.docker.com/compose/[href=https://docs.docker.com/compose/]), Anaconda Python (https://www.anaconda.com/distribution/[href=https://www.anaconda.com/distribution/]) and Git (https://git-scm.com/downloads[href=https://git-scm.com/downloads]) pre-installed on a device. The commands provided in this protocol are based on the Linux environment. In the following, we provide the details of preparing source data from an EHR database, ingesting the data to CogStack platform, and setting up a real-time risk calculation and alerting system for psychosis based on the CogStack platform. Moreover, an online version of the risk calculator was developed to facilitate numeric calculation of the probability of an individual developing psychosis in secondary mental health care on http://www.psychosis-risk.net[href=http://www.psychosis-risk.net/].\n1. Source data preparation\nNOTE: In most use cases, CogStack ingests source data from a specified database view that can combine data from one or more source database tables, where a view is a searchable object in a database that contains the result set of a stored query on the data. The setup of the ingesting view is tailored by the specific use cases and deployment settings of a health record database system. This protocol is developed based on a psychosis risk calculator developed and externally validated twice by Fusar-Poli et al.14,21 and as part of a pilot implementation feasibility study6. The protocol is based on an EHR database deployed with Microsoft SQL Server 2014.",
    "Create a view object (called \"vwPsychosisBase\" in this protocol) in an existing EHR database system to join necessary information of patients for psychosis risk calculation and alerting. Make sure that this view includes all patients receiving a first primary diagnosis of non-organic and non-psychotic mental disorder (recorded by the International Statistical Classification of Diseases and Related Health Problems, Tenth Revision [ICD-10]), as defined in the original model14,21.\nEnsure that each record in the view involves three types of patient information: 1) the first primary diagnosis of a patient in the EHR system, including ICD-10 diagnosis index (diagnoses were clustered together into the following ten clusters: acute and transient psychotic disorders, anxiety disorders, bipolar mood disorders, childhood and adolescent onset disorders, developmental disorders, nonbipolar mood disorders, mental retardation, personality disorders, physiological syndromes, substance use disorders) and diagnosis date; 2) a patient's demographic data, including gender, ethnicity and date of birth; and 3) the most recent contact information of care team for a patient, such as details of general practice (GP), consultants and care coordinators. The first two types of information are vital for the psychosis risk calculator14,21, and the third type of information is to enable timely risk alerting.\nMake sure that each record in the view has a unique identifier (e.g., \"patient_id\" used in this protocol).\nSelect the last update timestamps of all source information related to a record in the view (e.g., the last update times of a patient's demographic information and the patient's first primary diagnosis information), and choose the latest timestamp as the last update date and time for the record in the view (denoted as \"etl_updated_dttm\" in this protocol). The last update date and time of a record allows CogStack to synchronize updates in the database, such as new and updated records.\n2. Data ingestion",
    "Download or clone the code repository from Github (https://github.com/cogstack-slam/psychosis[href=https://github.com/cogstack-slam/psychosis]) or by typing \"git clone https://github.com/cogstack-slam/psychosis.git[href=https://github.com/cogstack-slam/psychosis.git]\" in a terminal window. The downloaded folder contains the code for psychosis risk calculation and configuration files for deploying a CogStack instance.\nGo to the \"cogstack_deploy/cogstack/\" directory and modify \"psychosis.properties\" to configure CogStack Pipeline for data ingestion. Modify the settings of section \"SOURCE: DB CONFIGURATIONS\" based on the EHR database setup, including specifying the IP address of the database server, database name, database username and password. Modify the view name (i.e. \"vwPsychosisBase\") and field names (e.g., \"patient_id\" and \"etl_updated_dttm\") if necessary. In case of error in configuring this file, follow the instructions at https://cogstack.atlassian.net/wiki/spaces/COGDOC/pages/38043684/Quickstart[href=https://cogstack.atlassian.net/wiki/spaces/COGDOC/pages/38043684/Quickstart].\nGo to the \"cogstack_deploy/common/elasticsearch/config/\" directory and modify the section \"xpack.notification.email.account\" in the \"elasticsearch.yml\" file to configure an Email address for sending alerts. A detailed instruction for Email configuration can be found on https://www.elastic.co/guide/en/kibana/6.4/watcher-create-threshold-alert.html[href=https://www.elastic.co/guide/en/kibana/6.4/watcher-create-threshold-alert.html].\nGo to the \"cogstack_deploy/\" directory and type \"docker-compose up\" to run the CogStack platform. Execute this command with root access. If the process is completed successfully, there will be printed status logs of the currently running services, including CogStack Pipeline, Elasticsearch and Kibana, in the terminal. As a result, all data and updates in the source database view will be timely ingested to an Elasticsearch index called \"psychosis_base\" in the CogStack platform.\nOpen a web browser and access Kibana user interface by typing \"http://localhost:5601/\" (or replacing \"localhost\" with a specific IP address of the server running the CogStack platform). For the first time accessing Kibana, click the Management tab and Index Patterns tab to specify an Elasticsearch index that one wants to access with Kinaba. Type \"psychosis_base\" in the \"Index pattern\" field and click Next step. Select \"etl_updated_dttm\" for the \"Time Filter\" field name and click Create index pattern to add the \"psychosis_base\" index pattern for Kinana.",
    "Once Kibana is connected to the Elasticsearch index (i.e., \"psychosis_base\"), search and browse the source data interactively through the \"Discover\" page. Kibana allows non-technical users to search for both structured metadata and free text. Detailed instructions of using \"Discover\" are available on https://www.elastic.co/guide/en/kibana/6.4/discover.html[href=https://www.elastic.co/guide/en/kibana/6.4/discover.html].\n3. Risk calculation\nOpen a new terminal window and go to the \"psychosis/\" directory. Install all required Python packages (including \"elasticsearch\", \"elasticsearch_dsl\", \"pandas\" and \"numpy\") used in the risk calculator by typing \"conda install package-name\" or \"pip install package-name\" in the terminal.\nType \"python risk_calculator.py\" to run the psychosis risk calculator. If the process is completed successfully, logs of the risk calculation will be printed in the terminal and the risk results will be stored in a new Elasticsearch index called \"psychosis_risk\" within the CogStack platform.\nCheck the risk results by using the Kibana interface. Similar to Steps 2.5 and 2.6, add a new index pattern \"psychosis_risk\" to connect Kinbana with the \"psychosis_risk\" index, and explore the risk results through the \"Discover\" page. To facilitate identifying new patients at-risk, use \"first_primary_diagnosis_date\" as the \"Time Filter\" field in building the \"psychosis_risk\" index. When exploring data in the \"Discover\" page, make sure that the index pattern \"psychosis_risk\" is selected.\n4. Data visualization\nIn addition to searching and accessing individual-level information via the \"Discover\" page in Kibana, one can build visualizations and dashboards to obtain an overview of characteristics for the whole population of at-risk patients. To do this, click on Visualize in the side navigation of Kibana. Then, click the Create new visualization button and choose a visualization type (e.g., pie and line charts). Select \"psychosis_risk\" as the index that one wants to visualize through Kibana. By default, visualizations will include all records/patients in the \"psychosis_risk\" index. Detailed instructions of building Kibana visualizations are available on https://www.elastic.co/guide/en/kibana/6.4/visualize.html[href=https://www.elastic.co/guide/en/kibana/6.4/visualize.html].",
    "To select a specific subset of data for visualization, add a \"filter\". For example, selecting a filter filed as \"h_2_year\", choosing an operator as \"is not between\" and setting values from \"0.0\" to \"0.05\" will only include patients whose risk of psychosis in 2 years are higher than 0.05.\nOnce individual visualizations are built, click on Dashboard in the side navigation of Kibana to create a dashboard that displays a set of related visualizations together. Click Create new dashboard and the Add button to create a new dashboard panel. Click visualizations that one wants to show within the new dashboard panel. Click Save and type a title to save the panel. Instructions on building Kibana dashboards are available at https://www.elastic.co/guide/en/kibana/6.4/dashboard.html[href=https://www.elastic.co/guide/en/kibana/6.4/dashboard.html].\n5. Risk Alerting\nClick on Management in the side navigation of Kibana and then click Watcher under Elasticsearch to create alerting for clinicians when patients were at-risk of psychosis. If the Watcher button is not visible, click License Management and click Start trial or Update license.\nClick Create advanced watch to set up a new Watcher. Type an \"ID\" and \"Name\". Delete the content of \"Watch JSON\" section and copy the content in the \"watcher.json\" file in the \"psychosis\" directory to the \"Watch JSON\" section. This watcher will send alerting Email to \"clinician@nhs.uk\" (which can be replaced with the Email address where one wants to send alerts) from \"username@nhs.uk\" (which was set in Step 2.3) if there are one or more patients whose risk of psychosis in 2 years are higher than 0.05 (a tentative threshold for feasibility testing) in every 24 hours.\nBefore saving the Watcher, click Simulate to test the Watcher execution. If the Watcher is set successfully, one will see the simulation output printed. In case of error in the settings, follow the instructions on https://www.elastic.co/guide/en/elastic-stack-overview/6.4/watcher-getting-started.html[href=https://www.elastic.co/guide/en/elastic-stack-overview/6.4/watcher-getting-started.html].",
    "To stop a Watcher, permanently delete it or temporarily deactivate it from the \"Status\" page of the Watcher."
  ],
  "subjectAreas": [
    "Behavior"
  ],
  "bigAreas": [
    "Ecology & Environmental Biology"
  ]
}