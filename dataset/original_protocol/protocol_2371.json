{
  "id": 2498,
  "origin_website": "Cell",
  "title": "Protocol for gene annotation, prediction, and validation of genomic gene expansion",
  "procedures": [
    "Step-by-step method details\nStep-by-step method details\nGenome annotation\nTiming: days to weeks (depending on genome size and complexity; e.g., ∼15 days for the 3-Gb beaver genome on a 10-node computer cluster with 12-GB memory in each node)\nIn this step, we predict and annotate genes for the de novo genome assembly of a target species, the focus of a particular genome annotation study. Besides Maker2 pipeline described here, researchers can also consider other pipelines as alternative choice, e.g., BRAKER2 (Bruna et al., 2021[href=https://www.wicell.org#bib6]), the Ensemble gene annotation system (Aken et al., 2016[href=https://www.wicell.org#bib2]) etc.\nMask repetitive elements in the genome.\nRepeatMasker.\nConstruct species-specific repetitive elements by RepeatModeler (version 1.0.10). Details about this step can be find at http://weatherby.genetics.utah.edu/MAKER/wiki/index.php/Repeat_Library_Construction--Basic[href=http://weatherby.genetics.utah.edu/MAKER/wiki/index.php/Repeat_Library_Construction--Basic].\n# Collect repetitive elements\n# Input: genomic sequences\n# Output: file “consensi.fa.classified”, containing the receptive sequences\n# path_RM: path of RepeatModeler\n# -pa N: how many cores to run\n# -engine ncbi: refers to blast program for alignment\n  <path_RM>/BuildDatabase -name seqfiledb -engine ncbi <genome.fa>\n  <path_RM>/RepeatModeler -database seqfiledb -pa N > seqfile.out\nMask repeat elements by RepeatMasker (Tarailo-Graovac and Chen, 2009[href=https://www.wicell.org#bib21]), with RepBase repeat libraries (Bao et al., 2015[href=https://www.wicell.org#bib3]), together with specifies-specific repeating elements constructed in the previous step. Repbase stores consensus sequences of repetitive elements among species. This step masks both common repeat elements among species and species-specific repetitive elements in the assembly.\nRepeatRunner. RepeatRunner is a part of the Maker2 pipeline, which also comes with a list of default transposable protein elements in the FASTA format. Maker2 will automatically search for more divergent transposable protein elements.\nNote: Repetitive elements are enriched throughout the genome. Such repetitive elements can cause non-specific gene hits during annotation. By masking repetitive elements, annotation tools can target gene encoding regions more easily.\nTrain the models.\nTrain Augustus.\n# Train Augustus\n# Input: genome assembly",
    "# Output: trained model\n# --long: performs full optimization for Augustus training\n  python <directory_of_BUSCO>/BUSCO.py --cup <number_thread> --in <genome_assembly>.fa --out <output_name> --lineage <directory_BUSCO_lineage_data> --mode genome --long\nNote: The “--long” parameter turns on Augustus optimization mode for self-training, which can improve the accuracy for non-model organisms. The latest lineage data are available at https://busco-data.ezlab.org/v5/data/lineages/[href=https://busco-data.ezlab.org/v5/data/lineages/].\nTrain SNAP. The details of training SNAP can be found in (Campbell et al., 2014[href=https://www.wicell.org#bib7]), which recommends three iterations of training. The trained parameter/HMM file from the current round can be used to seed the next round of training.\n# Train SNAP\n# (a) Generate MAKER control files\n# Generate three files with suffix “.ctl”, through which to provide user input\n  maker -CTL\n# (b) Edit maker_opts.ctl file to provide input parameters\ngenome=<genome_assembly.fa>\n# choose either eukaryotic or prokaryotic\norganism_type=<eukaryotic|prokaryotic>\n# Expressed sequence tags (ESTs) or assembled mRNA\nest=<transcript_evidence.fa>\n# Protein sequences from other organisms (e.g., UniProt)\nprotein=<protein.fa>\n# Gene prediction method\n# (1st round training derive gene mode from EST, i.e., est2genome=1 or protein evidence, i.e., protein2genome=1)\nest2genome=1 | protein2genome=1\n# (c) Run MAKER\n# Run on a single processor by “maker” or on “N” processors by “mpirun -n”\n  maker | mpirun -n N maker\n# (d) Collect annotation result and merge into a single file\n  cd <maker.ouput>\n  gff3_merge -d <genome_datastore_index.log> -g\n# (e) Make a directory for the training\n  mkdir <snapTrain1>\n  cd <snapTrain1>\n# (f) Generate files required for training\n# Generate <genome.ann>, <genome.dna> required to train SNAP\nmaker2zff <../all.gff>\n# “fathom” separates annotation into categories\n# uni: single gene per sequence\n# alt: genes with alternative splicing\n# olp: genes overlap others\n# err: genes with errors\n# wrn: genes with warnings\n  fathom -categorize 1000 <genome.ann> <genome.dna>\n# “fathom” exports the genes\n# Generate export.aa, export.ann, export.dna, export.txt\n  fathom export 1000 uni.ann uni.dna",
    "# (g) Generate new parameters\n  mkdir params\n  cd params\n  forge ../export.ann ../export.dna\n  cd ..\n# (h) Generate new HMM\n  hmm-assembler.pl <genome> params > <genome.hmm>\n  cd ..\n# (i) Update maker_opts.ctl & retrain the model from step (c) to (h)\nsnaphmm=<genome.hmm>\nest2genome=0\nprotein2genome=0\nGene annotation and functional annotation.\nGene structure annotation. In addition to gene prediction models, evidence from orthologous protein sequences and transcriptome assembly could be used to improve annotation quality. Protein sequences of orthologous genes can be obtained from UniProt (The UniProt, 2017[href=https://www.wicell.org#bib22]). Ones from Swiss-Port have been reviewed and thus are of higher quality. Transcriptome assembly may be available from previous studies or can be assembled de novo from RNA-seq reads by Trinity (Haas et al., 2013[href=https://www.wicell.org#bib9]). High quality transcriptome assembly can be selected as described in (Zhang et al., 2021[href=https://www.wicell.org#bib25]).\n# Gene structure annotation\n# (a) Generate MAKER control files\n# Generate three files with suffix “.ctl”, through which to provide user input\n  maker -CTL\n# (b) Edit maker_opts.ctl file to provide input parameters\ngenome=<genome_assembly.fa>\n# choose either eukaryotic or prokaryotic\norganism_type=<eukaryotic|prokaryotic>\n# Expressed sequence tags (ESTs) or assembled mRNA\nest=<transcript_evidence.fa>\n# Protein sequences from other organisms (e.g., UniProt)\nprotein=<protein.fa>\n# Gene prediction models\nsnaphmm=<SNAP_trained_model>\naugustus_species=<augustus_trained_model>\n# (c) Run MAKER\n# Run on a single processor by “maker” or on “N” processors by ‘”mpirun -n”\n  maker | mpirun -n N maker\n# (d) Collect annotation result and merge into a single file\n  cd <maker.ouput>\n  gff3_merge -d <genome_datastore_index.log> -g\nNote: Details about gene structure annotation (Holt and Yandell, 2011[href=https://www.wicell.org#bib10]) can be found at http://gmod.org/wiki/MAKER_Tutorial[href=http://gmod.org/wiki/MAKER_Tutorial], https://darencard.net/blog/2017-05-16-maker-genome-annotation/[href=https://darencard.net/blog/2017-05-16-maker-genome-annotation/], and the protocol (Campbell et al., 2014[href=https://www.wicell.org#bib7]).",
    "Quality measurement and functional annotation. For each predicted gene, Maker2 provides the annotation edit distance (AED) score, which measures the goodness of fit between its predicted gene structure and its evidence support. The lower the score, the more accurate the prediction. If more than 90% genes with AED scores lower than 0.5, the genome can be considered well annotated. In addition to the AED score, a high proportion of recognizable domains contained in predicted protein – e.g., higher than 50% – also indicates a good annotation. Recognizable protein domains can by scanned by InterProScan (Jones et al., 2014[href=https://www.wicell.org#bib12]), assigning potential function to predicted genes.\nNote: Besides the aforementioned quality measurement, we strongly recommend measuring the completeness of the genome assembly and annotation by checking the existence of a set of Benchmarking Universal Single-Copy Orthologs (BUSCO) (Simao et al., 2015[href=https://www.wicell.org#bib19]). A high-level completeness of genome assembly and annotation is imperative for a better identification of gene expansion. Based on the result of this analysis, researchers can decide whether they need to further improve the genome assembly before predicting gene expansion. A detailed protocol of BUSCO is available at (Manni et al., 2021[href=https://www.wicell.org#bib15]).\n# Run BUSCO\n# Input: genome sequence or protein sequence to be measured\n# Output: completeness of input regarding to near-universal single-copy orthologs\n# -i: input file, either a nucleotide fasta file or a protein fasta file\n# -l: lineage dataset\n# -o: folder to save results\n# -m: assessment mode (i.e., genome, protein, transcriptome)\n  busco -i <DNA.fa|protein.fa> -l <lineage> -o <output> -m <mode>\nGene family construction\nTiming: hours to days (e.g., ∼12 h for 26k predicted proteins)",
    "To identify gene expansion, we first need to assign genes into gene families and then count gene copies of each gene family among species in the study. Next, the table of gene counts will be used to identify gene expansion in a particular species. See Figure 1[href=https://www.wicell.org#fig1].\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2006-Fig1.jpg\nFigure 1. Workflow for gene expansion identification and functional analysis\nAfter gene annotation, a gene count table is prepared through OrthoDB (Kriventseva et al., 2019[href=https://www.wicell.org#bib14]), and then replicated genes are predicted by CAFE (Mendes et al., 2020[href=https://www.wicell.org#bib16]). For computational validation, Apollo is used to further improve gene annotation quality if necessary. Protein sequence similarity, synteny, and evolution in gene structure and coding sequences can be used to identify and examine more reliable candidate genes. RNA-seq reads can differentiate gene copies generated by divergent evolution after expansion from false ones resulted from sequencing and/or assembly errors. Final candidates can be further validated by qPCR with primers designed by Primer-Blast (Ye et al., 2012[href=https://www.wicell.org#bib24]). Their genome-wide specificity is checked by MFEprimer (Qu et al., 2012[href=https://www.wicell.org#bib17]) and then further inspected by gel electrophoresis and the melting curve analysis. Amplification efficiency should also be checked. For the functional assessment, GeneWise (Birney et al., 2004[href=https://www.wicell.org#bib4]) can be used to check potential pseudogenization of gene copies, while gene expression pattern of gene copies across different tissues can be measured by Kallisto (Bray et al., 2016[href=https://www.wicell.org#bib5]) with RNA-seq data.\nMap annotated genes into gene families.",
    "OrthoDB (Kriventseva et al., 2019[href=https://www.wicell.org#bib14]) can be used to map annotated genes into gene families. OrthoDB is a database of hierarchical catalog of orthologs, including 1,271 eukaryotes in the current release (v10.1). In addition to species included in the database, users can upload and analyze their own protein sequences and get corresponding ortholog information, which include “ortholog group name”, “gene name”, “score of match”, etc.\nNote: For a customized analysis of OrthoDB, up to 5 species can be selected as references to derive ortholog information for user's data. Well annotated and evolutionally close species are recommended as potential references. Details about customized analysis can be found at https://www.orthodb.org/orthodb_userguide.html#uploading-and-analyzing-your-own-sequences[href=https://www.orthodb.org/orthodb_userguide.html#uploading-and-analyzing-your-own-sequences].\nGene family expansion identification\nTiming: several hours (e.g., ∼3 h for 19k sets of gene homologs from 18 species on a 10-node computer cluster with 12-GB memory in each node)\nThis step will report expanded gene families and corresponding species.\nPrepare the gene count table.\nWith gene families on its rows and species on its columns, this table records the count of each orthologous gene in each species. We recommend removing or further refining gene families with more than 100 genes if present in some species (see the link to a tutorial in Note below), because gene families with a large variance in the gene count can cause erroneous parameter estimation.\nPredict expanded gene families.\nCAFE first calculates an error model for the prediction to account for potential errors in genome assembly and/or annotation and then carries out corrections based on the error model before calculating the gene family size of ancestor nodes. It thus can estimate gene family evolutionary rate more accurately. CAFE 5 (Mendes et al., 2020[href=https://www.wicell.org#bib16]), the latest version, can account for evolution rate variation among families with improved performance on parallelization.",
    "Note: A tutorial for the CAFE tool can be found at http://evomicsorg.wpengine.netdna-cdn.com/wp-content/uploads/2016/06/cafe_tutorial-1.pdf[href=http://evomicsorg.wpengine.netdna-cdn.com/wp-content/uploads/2016/06/cafe_tutorial-1.pdf] and https://github.com/hahnlab/CAFE5[href=https://github.com/hahnlab/CAFE5]. It is a dilemma to further filter less reliable gene copies. Stringent thresholds will help to obtain most reliable predictions, while it may lead to lose some true positives. A reasonable threshold may depend on a particular project. After identifying most reliable gene families showing potential expansion, we recommend to further check all filtered predictions manually, as shown below, in those targeted gene families.\nAdditional filtering.\nGene copies with low protein sequence similarity to other genes within a gene family could be removed (Keane et al., 2015[href=https://www.wicell.org#bib13]; Zhang et al., 2021[href=https://www.wicell.org#bib25]).\nThe validity of gene prediction can be verified by RNA-seq data generated from either separate or pooled samples of many tissues. Marked by a lack of gene expression support, questionable predictions should be filtered, so more reliable ones can be prioritized for experimental validation (Zhang et al., 2021[href=https://www.wicell.org#bib25]).\nNote: Assembly and/or annotation errors could cause false prediction of gene expansion. It is time-consuming to manually check all predictions. To obtain reliable predictions, further filtering should be considered. Kallisto (Bray et al., 2016[href=https://www.wicell.org#bib5]) was recommended to measure gene expression of genes with paralogs, as it shows better performance on paralogs.\nGene family expansion validation\nTiming: several days (e.g., ∼14 days for computational validation of ∼200 candidate gene families and qPCR experimental validation of ∼20 selected ones)\nAbove, we show how to filter out less reliable predictions through computational analysis. Nevertheless, false predictions could still present. More detailed checking is required to ascertain true ones. Here we described some steps to further validate the potential gene expansions (Figure 1[href=https://www.wicell.org#fig1]).\nComputational and manual checking.",
    "Improve the gene annotation. For some predicted gene copies, the annotation of their gene structure could be problematic (e.g., wrong prediction of splicing sites). We recommend improving the annotation quality of gene copies in targeted potentially expanded gene families. Apollo (Dunn et al., 2019[href=https://www.wicell.org#bib8]) is a convenient tool to adjust and improve gene structure annotation.\nNote: BAM files of RNA-seq read alignments provide good evidence to improve gene structure annotation. In addition, alignment of coding sequences between studied species and well annotated species (e.g., human and mouse) could provide useful information and help to identify local regions with poor annotation quality (Abascal et al., 2010[href=https://www.wicell.org#bib1]).\nSynteny analysis of gene loci. Synteny analysis provides information about the conservation of homologous genes and gene orders between genomes of different species. At gene loci of targeted genes, it provides clues about whether the extra gene copies could come from genome assembly errors. Any genome browser – e.g., IGV (Thorvaldsdottir et al., 2013[href=https://www.wicell.org#bib23]) – can be used for this analysis.\nGene structure, coding sequence analysis of predicted genes. After gene duplication, each copy of the gene may evolve independently and shows differences in their gene structure and coding sequences. Existing of such evolutionary changes among different gene copies could indicate true positives rather than false identification due to errors in genome assembly and annotation. Some tools are helpful for such analysis.\nGSDS (Hu et al., 2015[href=https://www.wicell.org#bib11]) can generate plots of gene structure with the input of gene structure information in BED format or GTF format. It is accessible at http://gsds.gao-lab.org/[href=http://gsds.gao-lab.org/].\nTranslatorX (Abascal et al., 2010[href=https://www.wicell.org#bib1]) can align multiple sequences guided by amino acid translations. Accessible at http://www.translatorx.co.uk/[href=http://www.translatorx.co.uk/], it can be used to view evolutionary changes in coding sequences among different copies of the expanded gene.",
    "RNA-seq supports of predicted genes. It is possible that the difference in coding sequences may come from sequencing errors rather than evolutionary changes. The aligned RNA-seq reads are useful to distinguish between them. Sequence differences are most likely real evolutionary changes if they are present in both genomic sequence and RNA-seq reads. Otherwise, they are probably sequencing errors in the genome assembly as they are not verified by corresponding transcript sequences.\nNote: IGV (Thorvaldsdottir et al., 2013[href=https://www.wicell.org#bib23]) can be used to view RNA-seq reads coverage at unique sites among copies by using BAM file of RNA-seq read alignment. By default, STAR will only report alignments of reads with at most 10 mapped loci, which can be adjusted by the parameter “--outFilterMultimapNmax”, in case predicted gene copy number of target gene family is greater than 10.\nGene copy number validation by qPCR.\nSelection of reference genes. To quantify the gene copy number by qPCR, it is important to select reference genes with normal copy numbers. It is reasonable to select genes with no predicted expansion in the studied genome and no known gene expansion in other closely related species. Orthologous databases are useful to identify such genes. For example, for each gene family, OrthoDB (Kriventseva et al., 2019[href=https://www.wicell.org#bib14]) shows number of species with certain number of copies. Genes with consistent copy numbers across all the species are good candidates as reference genes. It is also recommended to select reference genes from both autosomes and the X chromosome, with 2 or 3 candidates each. If the genomic DNA of a male individual was used for the experiments, candidates from autosome and the X chromosome can be validated for each other due to expected double copy number on autosome compared with that on X chromosome.",
    "Primer design. Design primers for genes under expansion could be challenging, because different gene copies evolve differently. Highly conserved coding sequences are good candidates for designing primers. Below shows the procedure to design and select primers.\nWe use Primer-Blast (Ye et al., 2012[href=https://www.wicell.org#bib24]) to design primer candidates in coding sequences of target genes, and set conserved regions among different copies as the searching regions.\nSpecificity of primers – i.e., no other targets except for the copies of the expanded gene – can be first checked by Primer-Blast against all coding sequences of the genome, and then by MFEprimer (Qu et al., 2012[href=https://www.wicell.org#bib17]) on the genomic DNA level.\nFinal candidates can be further inspected by gel electrophoresis and the melting curve analysis.\nqPCR validation. The first step is to check whether the amplification efficiency for each candidate primer is the same, which can be achieved by a standard curve analysis with different amount of DNA input for the replicates. The relative gene copy number can then be calculated by   Δ  C t    (Zhang et al., 2021[href=https://www.wicell.org#bib25]).\nNote: When genomic DNA of a male individual is used, reference genes from both autosome and X chromosome should be used for qPCR validation. For each gene, 2 or 3 candidate primers should be designed, and among them the more accurate ones should be selected.\nFunctional explore of expanded genes\nTiming: several hours (e.g., ∼3 h for 25 RNA-seq samples on a 10-node computer cluster with 12-GB memory in each node)\nIt is important to check whether different copies of an expanded gene function in similar way as the ancient copy. Thus, it is important to check pseudogenization and transcriptional level of each copy of the expanded gene. See Figure 1[href=https://www.wicell.org#fig1].\nPseudogene identification.",
    "Check whether a copy of an expanded gene could be a processed intronless pseudogene through mRNA retrotransposition. Some genes, however, do have only a single exon. To identify processed pseudogenes, one can search whether the gene is known to have a single exon in evolutionarily closely species in a gene ortholog database, such as OrthoDB (Kriventseva et al., 2019[href=https://www.wicell.org#bib14]).\nThen check whether a gene copy was pseudogenized through mutations, such as frameshift indels. GeneWise (Birney et al., 2004[href=https://www.wicell.org#bib4]) can identify such mutations, when it is used to scan the gene locus – e.g., gene body with upstream and downstream 5-kb – against the coding sequence of the functional orthologous gene (e.g., a human ortholog) as the reference. GeneWise is used in our pipeline. Alternatively, researchers can use any other tools, e.g., PseudoPipe (Zhang et al., 2006[href=https://www.wicell.org#bib26]). The genome sequence at the gene locus can be retrieved by the bedtools (Quinlan and Hall, 2010[href=https://www.wicell.org#bib18]).\nNote: The pipeline to identify pseudogene is straightforward and relatively simple here. However, it is sufficient for analyzing a small number of genes. More complicated methods for genome-wide identification of pseudogenes can be found in other studies (Sisu et al., 2020[href=https://www.wicell.org#bib20]).\n# Run bedtools\n# Input: genome sequence, gene coordinate (±5 kb) in bed format\n# Output: genome sequence in gene coordinate (±5 kb)\n# fi: the genomic sequence\n# -bed: gene coordinate in bed format (extend to upstream/downstream 5 kb)\n# -s: force strandedness. Return reverse complement if the gene is on the antisense strand.\n# -name: use “name” column in bed file as fasta headers of output\n  bedtools getfasta -fi <genomic.fa> -bed <geneCoordinate.bed> -s -name > genomic-region.fa\n# Run GeneWise\n# Input: protein sequence of homolog, DNA sequence of genomic region of a predicted gene copy\n# Output: report mutations that pseudogenized the gene copy",
    "# -sum: show summary output\n# -pretty: show pretty ascii output\n# -pseudo: mark genes with frameshifts as pseudo genes\n# -genes: show gene structure\n# -cdna: show predicted cDNA sequence\n# -trans: show protein translation\n# -pep: show predicted peptide\n# -para: show parameters\n# -both: check both strand\n# -quiet: no report on stderr\n  genewise <protein.fa> <genomic-region.fa> -sum -pretty -pseudo -genes -cdna -trans -pep -para -both -quiet > out.gw[href=http://out.gw/]\nGene expression.\nThe transcription level of each copy of an expanded gene can be checked to explore its functionality. RNA-seq data from different tissues can be used to examine gene expression pattern across tissues and identify tissue-specific expression of some copies. Kallisto (Bray et al., 2016[href=https://www.wicell.org#bib5]) shows better performances on paralogs."
  ],
  "subjectAreas": [
    "Evolutionary Biology",
    "Gene Expression",
    "Genomics",
    "Bioinformatics"
  ],
  "bigAreas": [
    "Molecular Biology & Genetics",
    "Bioinformatics & Computational Biology"
  ]
}