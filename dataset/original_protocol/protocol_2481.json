{
  "id": 2619,
  "origin_website": "Cell",
  "title": "In vivo, genome-wide profiling of endogenously tagged chromatin-binding proteins with spatial and temporal resolution using NanoDam in Drosophila",
  "procedures": [
    "Step-by-step method details\nStep-by-step method details\nExtraction of genomic DNA\nTiming: 1 h; enzyme incubation times variable (1 h–16 h)\nThe aim of this step is to extract and isolate genomic DNA from the samples, using the QIAamp DNA Micro Kit. Depending on the type of tissue or amount of material being processed, there are two methods for initial tissue homogenization.\nPre-heat a heat block to 56°C.\nInitial tissue homogenization via one of two options:\nAL Buffer Protocol: recommended for whole Drosophila embryos, whole larvae, whole adult Drosophila heads (with additional mechanical homogenization) and tissue culture cells (no additional mechanical homogenization).\nTake the samples (stored without buffer) from −80°C and add 180 μL 1×PBS to the Eppendorf tubes.\nOptional: For tissue containing gut or any tissue with high concentrations of nucleases and/or proteases, add 145 μL of 1×PBS and 40 μL 500 mM EDTA (50 mM final concentration) to the Eppendorf tube instead.\nAdd 20 μL RNase (12.5 μg/mL stock solution) and gently mix.\nOptional: If samples (whole embryos, whole larvae, adult heads) require mechanical homogenization, use a sterilized pestle (washed in 100% ethanol) attached to an electric drill.\nAdd 20 μL Proteinase K (from QIAamp DNA Micro Kit), mix gently (by pipetting up and down or flicking the tube gently) then leave for 1 min at 21°C–24°C.\nAdd 200 μL Buffer AL, gently invert-mix roughly 50 times and incubate at 56°C for 10 min or 16 h, until the sample is completely lysed and digested.\nCritical: Make sure the sample is completely digested.\nCool to 21°C–24°C, add 200 μL 100% ethanol and mix by gently inverting.\nATL Buffer protocol: Recommended for small volumes (<10 μL) of dissected tissue or cut larvae.",
    "Add 20 μL of 500 mM EDTA (50 mM final concentration and 20 μL of Proteinase K to 180 μL of ATL Buffer, mix by vortexing.\nTake the samples (stored without buffer) from −80°C and add mixture from the previous step. Mix gently by inverting the tube.\nIncubate at 56°C until completely digested and gently invert the tube occasionally to mix.\nNote: Depending on the type of tissue, digestion times can take from 1 h–16 h.\nOptional: If the sample is not properly digested after an 16 h incubation, add another 180 μL Buffer ATL + 20 μL Proteinase K to the sample and incubate for several more hours. Note that the volumes of RNase, Buffer AL and ethanol added in the subsequent steps will be doubled.\nAdd 20 μL RNase (12.5 μg/mL stock solution), mix by inverting the tube and incubate at 21°C–24°C for 2 min.\nIn a separate tube, mix 200 μL buffer AL and 200 μL 100% ethanol by vortexing. (Total volume of 400 μL needed per sample).\nAdd 400 μL of Buffer AL/100% ethanol mix to each sample, mix well by gently inverting and flicking the tubes.\nNote: If a precipitate develops during this step, reheat the sample to 50°C–56°C for 1 min before mixing.\nAdd all of the solution from either steps 2a.(v.) or 2b.(vi.) to a spin column (QIAamp DNA Micro Kit).\nSpin (>6,000 g) at 21°C–24°C for 1 min; discard the flow-through and collecting tube.\nAdd 500 μL AW1 solution and spin (>6,000 g) for 1 min; discard flow-through and collecting tube.\nAdd 500 μL AW2 solution and spin (>6,000 g) for 1 min; discard flow-through and collecting tube.\nTransfer the column to a new tube and spin at 20,000 g for 3 min to dry the column.",
    "Note: Spinning at maximum speed of a standard benchtop centrifuge is recommended. A Qiavac vacuum can be used for steps 3–6 if there are many samples to be processed, but the drying step must be done using a centrifuge.\nTransfer the column to a new 1.5 mL Eppendorf tube, add 50 μL of buffer AE and leave at 21°C–24°C for a minimum of 10 min. Spin at (>6,000 g) for 1 min and keep the flow-through (elution).\nRun 1 μL of the elution on a 0.8% agarose gel to check sample quality. The genomic DNA should be a single band on the top the gel and not a smear, which could indicate DNA shearing. Troubleshooting 1[href=https://www.wicell.org#sec6.1] and Troubleshooting 2[href=https://www.wicell.org#sec6.3].\nOptional: Step 9 can be done while proceeding with the next major step. Set aside 1 μL of elution for quality checking and use the remainder for the next step.\nIsolation of methylated DNA\nTiming: 1–2 days\nAt this stage, the sample will be digested with DpnI, which only cuts at adenine-methylated GATC sites. After enzyme digestion, the genomic DNA will be cleaned up using the QIAGEN PCR purification kit. The DNA will also be ligated with adaptors as the methylated fragments will serve as a template for PCR amplification. To ensure that only methylated regions of the DNA are amplified, the sample is digested with DpnII, which cuts at unmethylated GATC fragments.\nTransfer 43.5 μL of elution to a new 1.5 mL Eppendorf tube.\nIn a separate tube, prepare a master mix with 5 μL of NEB CutSmart buffer and 1.5 μL of DpnI enzyme per sample, flick to mix and spin down.",
    "Add 6.5 μL of the mix from above to the elution, very gently flicking the tube or pipetting up and down with a P1000 pipette to mix. Digest the mixture for 2 h–16 h at 37°C.\nCritical: Do not vortex this mixture as this can lead to shearing of genomic DNA.\nClean up the digested DNA according to the instructions in the QIAGEN PCR purification kit.\nElute in a final volume of 32 μL of dH2O. Pipette the H2O directly on to the filter in the spin column and leave for 5 min at 21°C–24°C before spinning.\nPause point: DNA can be stored for up to 6 months at −20°C.\nMeasure the DNA concentration using a Qubit or NanoDrop fluorometer. Dilute samples to a maximum of 750 ng in 15 μL of dH2O. If the amount of DNA is lower than 750 ng, use 15 μL of the undiluted elution.\nNote: It is not unusual to have very low yields of DNA (minimum 5 ng) at this stage, as uncut genomic DNA (which should compose the majority of the sample initially) will be discarded during the purification steps. The yield of DNA is dependent upon the starting material, cell type and number of cells that are profiled by NanoDam.\nOptional: The diluted elution or any unused DNA can be stored at −20°C (as spare sample or for troubleshooting if necessary).\nTransfer 15 μL of sample to 0.2 mL PCR tubes.\nAdd 4 μL of pre-made adaptor ligation buffer and 1 μL of T4 DNA ligase to the sample, mixing gently. Adaptor ligation buffer and T4 DNA ligase can be premixed in a master mix.\nUsing a PCR machine, incubate the ligation reaction for 2 h at 16°C, then 10 min at 65°C to inactivate the T4 DNA ligase.",
    "Add 19 μL of pre-made DpnII digestion buffer and 1 μL of DpnII enzyme. These two can be premixed in a master mix before adding to the sample.\nDigest at 37°C for a minimum of 2 h and maximum of 16 h (overnight).\nHeat inactivate the enzyme by incubating the mixture at 65°C for 20 min.\nFurther purification of methylated DNA\nTiming: 40 min\nThis cleaning step greatly improves the efficiency of NanoDam-PCR through the removal of the buffer solution from previous steps. This step is recommended but optional if there are time constraints to the experiment. Clean-up is done using Sera-mag beads.\nAdd 60 μL of Sera-mag beads to the 40 μL sample (bead volume=1.5 × sample volume) and mix well by vortexing.\nVortex for around 5 s and pulse down for 5 s. Rapid mixing of beads and sample is important.\nIncubate at 21°C–24°C for 10 min.\nPlace on magnetic stand for 2 min or until the solution is clear.\nDiscard the supernatant.\nWash for 30 s with 190 μL 80% ethanol/H2O.\nLet tubes stand for 1 min to air dry (avoid over-drying).\nA P10 pipette can be used to remove the last drops of 80% ethanol.\nResuspend in 32 μL of dH2O and remove from the magnetic stand.\nMix well and incubate for 2 min at 21°C–24°C.\nPlace on magnetic stand for 2 min or until the solution is clear.\nPut 30 μL of the supernatant into a new clean 0.2 mL PCR tube.\nNanoDam-PCR: Amplification of methylated DNA fragments\nTiming: 2.5 h\nUsing the digested methylated DNA fragments as a template, fragments can be amplified via PCR.",
    "Add 19 μL of MyTaq Master Mix and 1 μL MyTaq HS DNA polymerase to the supernatant from step 35 and mix well. MyTaq Master Mix and MyTaq HS DNA polymerase can be premixed in a master mix.\nRun PCR with the following conditions (total volume 50 μL):\ntable:files/protocols_protocol_2116_11.csv\nPause point: PCR-amplified DNA can be stored 16 h at 4°C or for up to 6 months at −20°C.\nSonication and quality checks\nTiming: 16 h\nThe DNA from the previous step is purified and the adaptors used for PCR amplification are removed. The quality checks are performed prior to the preparation of the libraries for next-generation sequencing.\nTransfer the 50 μL sample to a 1.5 mL Eppendorf tube and purify the DNA following the instructions of the QIAGEN PCR purification kit. Elute in 32 μL of dH2O, leaving it for 5 min before the final spin.\nRun 1 μL of the elution on a 0.8% agarose gel for a quality check. A smear between 400 bp–2 kb is expected.\nMeasure DNA concentration using Quantus/Qubit/NanoDrop. Troubleshooting 3[href=https://www.wicell.org#sec6.5].\nDilute samples to 2 μg DNA (or less) in 90 μL of dH2O in 1.5 mL or 0.2 mL sonication tube.\nCritical: Using tubes designed for sonication is important for consistent results.\nAdd 10 μL of NEB CutSmart buffer and mix well, cool on ice.\nSonicate the DNA to generate an average fragment size of roughly 300 bp.\nIf using a Diagenode Bioruptor/Bioruptor Pico (at 4°C), switch on cooling unit at least 10 min before use, until the water temperature is 4°C.\nSonicate for 6 cycles (30 s on, 20 s off) on high power if using Diagenode Bioruptor with 1.5 mL tubes or 17 cycles (30 s on, 20 s off) if using Diagenode Bioruptor Pico with 0.2 mL tubes.",
    "Critical: The sonication conditions depend on the type of sonicator used and should be optimized appropriately. Slight variations of fragment size are acceptable but very large variations (>600 bp) may impede clustering efficiency on the sequencing flow cell and thus the sequencing yields.\nOptional: Check the fragment size on the Tapestation (genomic tape) to ensure that the average fragment size is around 300 bp. If the sonication conditions have been optimized, it is not necessary to check fragment size for every experiment. Troubleshooting 4[href=https://www.wicell.org#sec6.7].\nAdd 1 μL AlwI enzyme, mix well and digest 2 h–16 h at 37°C.\nNote: AlwI digestion (which removes the dsAdR primer) can be carried out either before or after sonication. AlwI cannot be heat inactivated but will not affect the steps downstream.\nTransfer 70 μL of each sample to 8-well PCR strips for library preparation.\nPause point: Sonicated DNA can be stored for up to 6 months at −20°C.\nSequencing library preparation\nTiming: 3–4 h\nThis step involves the generation of libraries for sequencing and can be summarized as follows: purification of DNA, adjusting concentration, end repair, adenylation of 3′ ends, sequencing adaptor ligation, another round of DNA purification, enrichment of DNA fragments and a final DNA clean-up.\nPerform DNA cleanup via bead purification.\nAdd 105 μL Sera-mag beads to 70 μL sample and mix well.\nVortex and pulse down for 5 s. Rapid mixing of beads and sample is important.\nIncubate at 21°C–24°C for 10 min.\nPlace on magnetic stand for 2 min or until the solution is clear.\nDiscard the supernatant.\nWash for 30 s with 190 μL 80% ethanol/dH2O. Perform 2 washes.\nLet samples stand for 1 min to air dry (avoid over-drying).\nA P10 pipette can be used to remove the last drops of 80% ethanol.",
    "Resuspend in 25 μL Resuspension buffer and remove from the magnetic stand.\nMix well by vortexing and incubate for 2 min at 21°C–24°C.\nPlace on magnetic stand for 2 min or until the solution is clear.\nPut 22.5 μL of the supernatant into a new, clean PCR tube.\nPause point: DNA can be stored for up to 6 months at −20°C.\nMeasure DNA library concentration by using 1 μL on the Qubit or similar fluorometer.\nDilute samples to (no more than) 500 ng of DNA in 20 μL Resuspension buffer.\nEnd repair of the DNA fragments by:\nAdd 7.5 μL End Repair Buffer to the diluted samples.\nAdd 2.5 μL End Repair Enzymes and mix well by vortexing (total volume at this stage: 30 μL). End Repair Buffer and End Repair Enzymes can be premixed in a master mix.\nIncubate for 30 min at 30°C.\nHeat inactivate enzymes for 20 min at 75°C.\nAdenylate 3′ ends by:\nAdd 0.75 μL Klenow 3′ to 5′ exo-enzyme and mix well.\nIncubate for 30 min at 37°C.\nProceed immediately to adaptor ligation:\nAdd 2.5 μL of the relevant adaptor.\nCritical: Try to limit barcode base overlap (Table 1[href=https://www.wicell.org#tbl1]) as much as possible, especially if multiplexing 4 libraries or fewer. If barcodes are too similar, this may reduce the number of reads passing the filter. Refer to Illumina recommendations for more information.\nAdd 2.5 μL of NEB Quick Ligase enzyme.\nIncubate for 10 min at 30°C (Total volume at this stage: 35 μL).\nAdd 5 μL of 0.5 M EDTA to stop the ligation.\nPause point: DNA can be stored for up to 6 months at −20°C.\nPerform bead clean-up of DNA:\nAdd 40 μL Sera-mag beads to the 40 μL sample and mix well.",
    "Vortex and pulse down for 5 s. Rapid mixing of beads and sample is important.\nIncubate for 10 min at 21°C–24°C.\nPlace on magnetic stand for 2 min or until the solution is clear.\nDiscard the supernatant.\nWash for 30 s with 190 μL 80% ethanol/dH2O. Perform 2 washes.\nLet samples stand for 1 min to air dry (avoid over-drying).\nA P10 pipette can be used to remove the last drops of 80% ethanol.\nResuspend in 22.5 μL Resuspension buffer and remove from the magnetic stand.\nMix well by vortexing and incubate for 2 min at 21°C–24°C.\nPlace on magnetic stand for 2 min or until the solution is clear.\nPut 20 μL of the supernatant into a new, clean PCR tube.\nPause point: DNA can be stored for up to 6 months at −20°C.\nEnrich the DNA fragments by:\nAdd 5 μL NGS PCR Primer mix.\nAdd 25 μL NEBNext High-Fidelity 2× PCR Master Mix. NGS PCR Primer mix and NEBNext High-Fidelity 2× PCR Master Mix can be premixed in a master mix.\nPerform PCR with the following conditions (total volume: 50 μL):\ntable:files/protocols_protocol_2116_12.csv\nPerform a final round of bead clean-up of the sample:\nAdd 45 μL Sera-mag beads (0.9× sample volume) to the 50 μL sample and mix well.\nVortex and pulse down for 5 s. Rapid mixing of beads and sample is important.\nIncubate for 10 min at 21°C–24°C.\nPlace on magnetic stand for 2 min or until the solution is clear.\nDiscard the supernatant.\nWash for 30 s with 190 μL 80% ethanol/dH2O. Perform 2 washes.\nLet samples stand for 1 min to air dry (avoid over-drying).\nA P10 pipette can be used to remove the last drops of 80% ethanol.\nResuspend in 32.5 μL Resuspension buffer and remove from the magnetic stand.",
    "Mix well by vortexing and incubate for 2 min at 21°C–24°C.\nPlace on magnetic stand for 2 min or until the solution is clear.\nPut 30 μL of the supernatant into a new, clean PCR tube.\nLibrary quality check, multiplexing and sequencing\nTiming: 1 h (QC + Multiplexing)\nA final quality check is performed prior to multiplexing all the libraries generated. Samples are then sequenced on an Illumina sequencer.\nCheck the DNA sample generated from step 49 on an Agilent Tapestation or Bioanalyzer. Take note of the average fragment length for each sample for step 52.\nMeasure DNA concentration with a Qubit or Quantus fluorometer.\nTroubleshooting 5[href=https://www.wicell.org#sec6.9] Troubleshooting 6[href=https://www.wicell.org#sec6.11] Troubleshooting 7[href=https://www.wicell.org#sec6.13].\nNote: If there is 500 ng of starting material, the final concentration should be 15–30 ng/μL.\nOptional: Libraries can be more accurately quantified using the NEBNext® Library Quant Kit for Illumina.\nCalculate the molarity of each sample using fragment length and concentration and pool samples to give a final DNA concentration of 20 nM (ensure that all libraries are at equal concentration).\nMolarity = (1500/Average Fragment Size) × (DNA concentration in ng/μL).\nLibrary volume to add = (Final DNA concentration (20 nM)/Molarity) × (Final volume (50 μL)/Number of samples).\nH2O to add = Final volume (50 μL) – Sum of library volumes.\nNote: The final DNA concentration of 20 nM was determined based on the recommended concentration for Illumina sequencing.\nCheck the multiplexed library on the Agilent Tapestation before proceeding to sequencing.\nSequence single-ended 50 nt (SE50) or single-ended 100 nt (SE100) reads on an Illumina sequencer. Troubleshooting 8[href=https://www.wicell.org#sec6.15].\nCritical: For Drosophila samples, aim for a minimum of 20 million reads per library. Other organisms may require a higher number of reads, depending on genome size. For instance, around 40 million reads for human samples.",
    "Computational analysis and visualization of NanoDam data\nThe workflow for analyzing NanoDam data builds upon the existing damidseq_pipeline (Marshall and Brand, 2015[href=https://www.wicell.org#bib8]) and takes into account cross-comparisons of multiple replicates. It is composed of a suite of Python scripts (collectively called damMer) which generates normalized binding tracks (∗.bedgraph format) and identifies statistically significant and reproducible peaks (across replicates) (∗.bed format). Data analyzed by this pipeline can then be used for other downstream analysis, such as ChIPseeker, principal component analysis and can be visualized using the Integrative Genome Viewer (IGV) (Robinson et al., 2011[href=https://www.wicell.org#bib13]) (Figure 3[href=https://www.wicell.org#fig3]).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2116-Fig3.jpg\nFigure 3. Summary flowchart of the basic workflow of NanoDam binding data analysis\nThe damMer suite consists of 3 python scripts that build on each other and is used to run all pairwise comparisons between the experimental and control samples. The resulting track and peak files can be used in downstream analyses.\nHere we will summarize the main steps of using this pipeline for a NanoDam experiment to generate binding tracks and peak sets. Additional steps on assessing the quality of binding data, including comparisons of replicates and complexities of libraries generated from the experiments will also be discussed. Please note that additional technical notes to supplement the NanoDam data analysis are provided in the corresponding GitHub repository: https://github.com/AHBrand-Lab/NanoDam_analysis[href=https://github.com/AHBrand-Lab/NanoDam_analysis]. All references to Python scripts (i.e., ∗.py) and R markdowns (i.e., ∗.Rmd) refer to code that was deposited in this repository.",
    "damMer applies the statistical framework of the damidseq_pipeline in an automated manner to all possible pairs of the provided NanoDam-tagged protein and NanoDam-alone samples, averaging across all pairs. As these individual tasks benefit greatly from parallelization, the suite utilizes the workload manager slurm (https://slurm.schedmd.com/documentation.html[href=https://slurm.schedmd.com/documentation.html]). All tasks (e.g., copying fastq files, running damidseq_pipeline, averaging, quantile normalization) are submitted as individual jobs to slurm, which automatically schedules these jobs.\nInstall or download the following packages and scripts in preparation for running damMer:\nTo run damMer.py:\nsamtools.\nbowtie2.\ndamidseq_pipeline.\nTo run damMer_tracks.py:\nbedGraphtoBigWig.\nquantile_norm_bedgraph.pl.\naverage_tracks.pl.\nMACS2.\nPerform “quality check” on NanoDam sequencing files (∗.fastq format) by filtering out low quality reads, removing residual adapter sequences or trim nucleotides not passing Phred quality score thresholds.\nUse cutadapt (Martin, 2011[href=https://www.wicell.org#bib9]) to trim adaptors (‘--action=trim’, default setting).\nDiscard reads that are too long after adapter trimming (--maximum-length=50) or too short (--minimum-length=30).\nMonitor results of filtering using fastqc and use multiqc to aggregate results across all sequencing files to facilitate comparison.\n>files=($(find . -type f -iname “∗.fastq∗”))\n>for f in ${fs[@]}; do ∖\n>  fastqc ${f}; ∖\n>  cutadapt -m 30 -M 50 -o ${f/fastq/_trim.fastq} ${f}; ∖\n>  fastqc ${f/fastq/_trim.fastq}; ∖\n>done\n>multiqc\nRun the damMer suite of Python3 scripts in the following order: (1) damMer.py, (2) damMer_tracks.py, (3) damMer_peaks.py.\ndamMer.py: maps trimmed reads to a reference genome via the damid_seq pipeline.\nObtain the relevant reference genome for the experiment (e.g., from https://ftp.ncbi.nih.gov/genomes/refseq/[href=https://ftp.ncbi.nih.gov/genomes/refseq/] or Illumina iGenomes https://support.illumina.com/sequencing/sequencing_software/igenome.html[href=https://support.illumina.com/sequencing/sequencing_software/igenome.html]).\nPrepare a file with bowtie-2 indices for the corresponding genome (acquired online: http://bowtie-bio.sourceforge.net/bowtie2/index.shtml[href=http://bowtie-bio.sourceforge.net/bowtie2/index.shtml] or generated with the bowtie2-build command based on the genome sequence in ∗.fasta format).\nPrepare a file specifying all genomic NanoDam-methylation sites (i.e., GATC-motifs) which can be generated by the gatc.track.maker.pl script (∗.gff format).",
    "To avoid leaving samples out, provide all NanoDam-tagged protein and NanoDam-alone sequence files as shell arrays.\n>ctrls=($(find . -type f -iname “∗_trim.fastq∗” -and -iname “dam_∗”))\n>exps=($(find . -type f -iname “∗_trim.fastq∗” -and -iname “tf_gfp_∗”))\n>python3 damMer.py -e ${exps[@]} -c ${dam[@]} ∖\n>    -i path/to/bowtie2_index ∖\n>    -g path/to/motifs.GATC.gff ∖\n>    -b path/to/bowtie2 ∖\n>    -s path/to/samtools ∖\n>    -q path/to/damidseq_pipeline_vR.1.pl\nNote: damMer.py will generate folders for every pairwise comparison (i.e., ∗_vs_∗, Figure 4[href=https://www.wicell.org#fig4]), copy the required fastq files with trimmed reads into them, validate the file formats, generate shell scripts to run the damidseq_pipeline in all folders and submits them as jobs to slurm while ensuring that all jobs are running. A separate log-file with all information provided to and by damMer.py is also generated which enables users to retrace all parameters and arguments used to run this script. Similarly, all shell scripts submitted to slurm are kept.\nCritical: damMer_tracks.py will adjust names for all files generated by damMer.py, therefore it is not recommended to manually change filenames in the folder created by damMer.py.\ndamMer_tracks.py: generates tracks of averaged, normalized binding intensities for the NanoDam experiment across the entire genome using tracks generated across all pairwise comparisons of NanoDam-tagged protein and NanoDam-alone samples (Figure 4[href=https://www.wicell.org#fig4]).\nTo include all tracks generated by all pairwise comparisons by specifying the folders (i.e., ∗_vs_∗) in which they are located when running damMer_tracks.py.\nPrepare a file with the corresponding genome sizes (∗.tsv format) (e.g., dm.chrom.sizes from https://www.encodeproject.org/files/dm6.chrom.sizes/[href=https://www.encodeproject.org/files/dm6.chrom.sizes/]).\n>dirs=($(find . -type f -iname “∗_vs_∗”))\n>python3 damMer_tracks.py -r ${dirs[@]} ∖\n>    -o ∗output_folder_name∗ ∖\n>    -p ∗name_NanoDam_fusion_protein∗ ∖\n>    -c ∗name_NanoDam∗ ∖\n>    -m path/to/MACS2 ∖\n>    -n path/to/quantile_norm_bedgraph.pl ∖\n>    -a path/to/average_tracks.pl ∖\n>    -b path/to/bedGraphToBigWig ∖\n>    -l path/to/∗genome∗.chrom.sizes",
    "Note: damMer_tracks.py creates a folder ending in ∗_tracks (beginning of folder name defined via ‘-o’ argument) that includes copies of all individual tracks from all folders generated by damMer.py (i.e., ∗_vs_∗), as well as quantile normalized and averaged versions in ∗.bedgraph and ∗.bw (bigwig) format.\nOptional: Alternatively, all individual tracks can also be read into R via the functions import.bedgraph() or import.bw() into a combined matrix and quantile normalized via preprocessCore::normalize.quantiles() (see genomewide_correlation.Rmd).\nNote: damMer_tracks.py also submits jobs for peak calling with MACS2 based on bam-files acquired from damMer.py (i.e., ∗-ext300.bam). For each pairwise comparison, peaks will be called for the bam-file corresponding to the tagged protein of interest compared to its NanoDam-alone control. As NanoDam-dependent methylation signals are not as locally confined as ChIPseq-signal, we always obtain broad peaks (i.e., MAC2 argument --broad).\nTo obtain both normalized tracks for the binding intensities of the tagged protein of interest and tracks specifying putative open chromatin sites, damMer.py makes use of damidseq_pipeline_vR.1.pl and damMer_tracks.py creates a second folder, named ∗_DamOnly_tracks. damidseq_pipeline_vR.1.pl is a modified version of the initial damidseq_pipeline.pl that also generates unnormalized (i.e., not compared to a control) NanoDam-alone tracks in line with the ideas of CATaDa (Aughey et al., 2018[href=https://www.wicell.org#bib1]). Copies of these NanoDam-only tracks are gathered, quantile normalized to each other and averaged in the ∗_DamOnly_tracks folder by damMer_tracks.py.\ndamMer_peaks.py: identifies sets of statistically significant peaks and sets of reproducible peaks for a defined list of FDR-thresholds (i.e., reproducible peaks that occur in at least 50% of all pairwise comparisons).\nThis script will use the folder names (and file names) generated by damMer.py (i.e., ∗_vs_∗) and create “∗_peaks and ∗_DamOnly_peaks folders to store the final output peak files (code chunk 4).\n>dirs=($(find . -type f -iname “∗_vs_∗”))\n>python3 damMer_peaks.py -r ${dirs[@]} ∖\n>    -o ∗output_folder_name∗",
    "Note: All ∗.broadPeak files with peaks identified in individual pairwise comparisons will be gathered in a new ∗_peaks folder by damMer_peaks.py. The peaks in this set of files will be thresholded multiple times according to a defined list of 41 FDR cut-offs (i.e., -log10(FDR) = 0, 1, 2 ..., 5, 10 ... 100, 125 ..., 1900, 2000). All peaks left after thresholding with a particular FDR-value (-log10(FDRpeak) ≥ FDRthreshold) will be combined into a single file, sorted and merged to obtain a consensus set of peaks for each FDR, leaving the user with a set of 41 files corresponding to the FDR-values (i.e., ∗.mergePeak file format). In addition, all peaks are filtered by their appearance throughout the set of ∗.broadPeak files belonging to the pairwise comparisons and only peaks occurring in at least 50% across all files will be kept as reproducible set (i.e., ∗.reproPeak file format).\nDownload the latest version of Integrative Genome Viewer (IGV) and load the desired binding tracks (files in ∗.bedgraph or ∗.bw format) and significant peaks (files in ∗.bed format corresponding to the desired FDR).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2116-Fig4.jpg\nFigure 4. Diagram showing the naming convention employed in the damMer suite and the pairwise manner in which all samples are compared to each other\nAll names include the ∗_vs_∗ phrase to separate the indicators for the experimental and control samples.\nNote: Other visualization methods can be used (e.g., UCSC genome browser) though IGV is the standard.\nAnalysis of NanoDam binding data quality",
    "While the necessary quality check of the sequencing libraries accounts for low quality reads and nucleotides, as well as adapter contamination, the sensitivity of the assay and reproducibility of the experiment have to be determined separately. In order to detect problems occurring during NanoDam-induction and -methylation, library preparation and sequencing that may impact the entire library, genome-wide correlation analysis, signal enrichment analysis, and assessing the complexity of all sequenced libraries is recommended.\nPerform genome-wide correlation analysis on unnormalized (i.e., normalization against a NanoDam-alone control) sequencing libraries.\nUse the ∗-ext3000.bam files (generated by damMer.py) located in its individual output folders (one per pairwise comparison).\nMap and bin the reads via bamCoverage from the deeptools suite (Ramírez et al., 2016[href=https://www.wicell.org#bib11]) (Code chunk 5).\nThe expected outputs are ∗.bedgraph files which can be read into R and genome-wide correlation analysis can be executed by following the workflow of genomewide_correlation.Rmd.\nPerform correlation analysis on the normalized data derived from pairwise comparisons of NanoDam-tagged protein and control NanoDam-alone samples.\nUse the normalized ∗.bedgraph files generated from damMer.py and damMer_tracks.py, stored in the ∗_tracks folder.\nProcess these files following the workflow of genomewide_correlation.Rmd.\n>files=($(find . -type f -iname “∗.fastq∗”))\n>for f in ${fs[@]}; do ∖\n>  gunzip -c ${f} | bowtie2 ∖\n>    -x path/to/bowtie2_index ∖\n>    -U - ∖\n>    -S ${f/%.fastq∗/.sam};\n>  samtools view ∖\n>    -Sb ${f/%.fastq∗/.sam} ∖\n>    > ${f/%.fastq∗/.unsort.bam};\n>  samtools sort ∖\n>    -o ${f/%.fastq∗/.sort.bam} ∖\n>    ${f/%.fastq∗/.unsort.bam};\n>  samtools index ${f/%.fastq∗/.sort.bam};\n>  bamCoverage ∖\n>    --bam ${f/%.fastq∗/.sort.bam}\" ∖\n>    --outFileName ${f/%.fastq∗/.sort.bam}.bin500.ext150.bedgraph\" ∖\n>    --outFileFormat bedgraph ∖\n>    --binSize 500 ∖\n>    --extendReads 150;\n>done\nAssess the intrinsic complexity of NanoDam libraries via two analyses:",
    "Use the preseq c-curve software (Daley and Smith, 2013[href=https://www.wicell.org#bib3]) to calculate the alignment complexity of libraries: reads with unique sequencing information are plotted as a function of all reads across a gradually increasing number of reads included in the library (i.e., sequencing depth).\nUse the c-curve function on aligned reads in ∗.bam file format (Code chunk 6) or using the ∗-ext300.bam files in the individual folders for pairwise comparisons.\nPlot the results of the output ∗.txt files in R as outlined in signal_enrichment.Rmd (section [5.0]).\n>fs=($(find . -type f -iname “∗.sort.bam”))\n>for f in ${fs[@]}; do ∖\n>  preseq c_curve ∖\n>    -output ${f}_preseq.txt ∖\n>    -bam ${f};\n>done\nPerform cumulative enrichment analysis (Diaz et al., 2012[href=https://www.wicell.org#bib4]) and generate a fingerprint plot which determines how the signal from the NanoDam-tagged protein samples can be differentiated from the background read distribution in the NanoDam-alone control samples.\nAssess whether signal (i.e., tracks) are enriched on binding sites deemed statistically significant (i.e., peaks) by following the workflow of signal_enrichment.Rmd in R:\nUse the normalized, averaged tracks from NanoDam-tagged protein experiments (from damMer_tracks.py) and significant, reproducible peaks (∗.reproPeak files from damMer_peaks.py).\nExtract the binding signal over the peaks using the extract_matrix() function and plot the results.\n>dirs=($(find . -type f -iname “∗_vs_∗”))\n>for f in ${dirs[@]}; do ∖\n>  a=$(echo ${f} | awk -F_vs_ '{print $1}' | awk -F_ '{print $NF}'); ∖\n>  b=$(echo ${f} | awk -F_vs_ '{print $2}' | awk -F_ '{print $NF}'); ∖\n>  if [[ ${a} -ne ${b} ]] then ∖\n>    echo ${f};\n>    fsf+=${f};\n>  fi;\n>done\n>python3 damMer_tracks.py -r ${fsf[@]} ∖\n>  -o ∗output_folder_name∗",
    "Note: For these analyses it is recommended to use other NanoDam-tagged protein datasets with the same FDR-threshold as a comparison and negative controls derived from comparing NanoDam-alone samples to each other (e.g., NanoDam-alone_2_vs_NanoDam-alone_1 …, NanoDam-alone_3_vs_NanoDam-alone_4). This requires damMer to run on NanoDam-alone samples as experimental (-e argument) and control samples (-c samples). When starting damMer_tracks.py and damMer_peaks.py, the folders (i.e., ∗_vs_∗) where the same NanoDam-alone sample is both experimental and control (e.g., NanoDam-alone_1_vs_NanoDam-alone_1) can be left out (Code chunk 7)."
  ],
  "subjectAreas": [
    "Genomics",
    "Cell Biology",
    "Developmental Biology",
    "Sequencing",
    "Model Organisms"
  ],
  "bigAreas": [
    "Molecular Biology & Genetics"
  ]
}