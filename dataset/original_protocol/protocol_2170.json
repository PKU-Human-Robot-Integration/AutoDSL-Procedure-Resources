{
  "id": 2286,
  "origin_website": "Cell",
  "title": "Simultaneous recording of neuronal and vascular activity in the rodent brain using fiber-photometry",
  "procedures": [
    "Step-by-step method details\nStep-by-step method details\nFiber-photometry recording\nTiming: 2–4 h\nFor manuals of operating the Ocean QE-Pro spectrometer and its software OceanView, please refer to: https://www.oceaninsight.com/globalassets/catalog-blocks-and-images/manuals--instruction-old-logo/software/oceanviewio.pdf[href=https://www.oceaninsight.com/globalassets/catalog-blocks-and-images/manuals--instruction-old-logo/software/oceanviewio.pdf].\nConduct the experiments either in a dark room or place the animal in a dark chamber.\nCritical: To minimize the potential impact of the ambient light, recordings should be performed in a dark environment.\nMeasure the power of the 488 nm laser at the tip of the patch cable.\nAdjust the laser power to get the peak photon count > 1000 (Figure 2[href=https://www.wicell.org#fig2]) for both GCaMP6f and tdTomato, which empirically yields reliable results.\nUsually, set the laser power at ∼ 50 μW and should not exceed 100 μW.\nCritical: The 488 nm laser serves as the single laser source for both GCaMP and tdTomato because the brightness of tdTomato (95.22) is more than twice that of GCaMP (43.75, in the presence of Ca2+). tdTomato excited by the green laser (e.g., 561 nm) would have been too strong to balance well with the signal from GCaMP. If a different red sensor was used and requires green laser, interleaved recording (Optional A, see below) is recommended as mixed laser source would affect the computation of hemodynamic changes.\nSubtract the background noise before connecting the patch cable to the implanted fiber probe.\nClick the “light bulb” button while pointing the end of the patch cable to an optical beam trap.\nAfter clicking the “light bulb” button, the background spectrum will be stored and automatically subtracted from subsequently recorded signals.\nCritical: If a beam trap is not available, a dark enclosure will suffice as long as there is no reflective surface in the vicinity (20 cm) of the free end of the cable.\nConnect the patch cable with the implanted fiber.\nStart recording.",
    "Note: Problem 1: spectral peaks of GCaMP and tdTomato are unbalanced. See troubleshooting 1[href=https://www.wicell.org#sec6.1].\nNote: Problem 2: Noisy data. See troubleshooting 2[href=https://www.wicell.org#sec6.3].\nOptional A: Interleaved recording of GCaMP signals with 405 nm and 488 nm excitation lasers.\nNote: This step is an option for multiplexed studies where the red channel is occupied by a functional fluorescent signal (e.g., jRGECO). A spectrometer is highly recommended for this option.\nPrepare for the interleaved recording (Figure 4[href=https://www.wicell.org#fig4]). A master “clock” (e.g., smart control panel, Med Associates Inc., DIG-716P2) is used to control the timing of two lasers and the spectrometer.\nNote: Require dichroic mirror and emission filters for 405 and 488 nm lasers in this setting (see ∗ in key resources table[href=https://www.wicell.org#key-resources-table]).\nMeasure the power of 488 nm and 405 nm lasers at the tip of the patch cable.\nAdjust the 488 nm laser power to get the peak photon count > 1000 for GCaMP488. The required power is usually ∼ 50 μW,\n405 nm laser usually requires a higher power due to the much weaker GCaMP405 emission signal.\nRecord the background noise signals with the interleaved paradigm for 2 min (for details on how to record the background noise, please see Main step 3).\nNote: Background noise is not automatically subtracted in this option. The mean of the background noise will be subtracted manually in the data processing.\nConnect the patch cable with the implanted fiber.\nStart interleaved recording.\nNote: Problem 3: frame loss during interleaved recording. See troubleshooting 3[href=https://www.wicell.org#sec6.5].\nOptional B: Intravenous injection of Rhodamine B to obtain CBV signals.",
    "Note: For groups equipped with a spectrally resolved spectrometer, this option is suboptimal. For groups equipped with non-spectrally resolved photodetectors, adding an extra red channel to measure the Rhodamine B in addition to the green channel of the GCaMP signal is a robust approach to measure neuronal and vascular activity simultaneously.\nDissolve Rhodamine B (Fisher Scientific, 25 mg) powder with 1 mL sterile PBS (0.1 M).\nInject the Rhodamine B via tail vein at the dose of 25 mg/kg.\nPause point: Wait for at least 30 min for the Rhodamine B signal to get stabilized.\nCritical: A 30-min wait is necessary because, following the injection of Rhodamine B bolus, the signal follows a fast exponential decay and then stabilizes in about 30 min.\nMeasure the power of 488 nm and 561 nm lasers at the tip of the patch cable.\nAdjust the laser power to get the peak photon count > 1000 for both GCaMP6f and Rhodamine B (Figure 5[href=https://www.wicell.org#fig5]).\nUsually, set the laser power at ∼ 50 μW and should not exceed 100 μW.\nSubtract the background noise.\nConnect the patch cable with the implanted fiber.\nStart recording.\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/1753-Fig4.jpg\nFigure 4. Interleaved acquisition paradigm with 405 nm and 488 nm excitation lasers\nCa2+-independent GCaMP signals (GCaMP405) were excited by a 405 nm laser, whereas Ca2+-dependent GCaMP signals (GCaMP488) were excited by a 488 nm laser. This interleaved paradigm was used because GCaMP405 and GCaMP488 share nearly identical emission spectra and thus cannot be spectrally unmixed. Data were acquired at 50% duty cycle every 50 ms using a box-paradigm to avoid spectrometer frame loss during the trigger mode. The final sampling rate is 10 Hz for all signals. Images are reprinted with permission from (Zhang et al., 2022[href=https://www.wicell.org#bib6]).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/1753-Fig5.jpg",
    "Figure 5. An example of in vivo spectral signals of GCaMP6f and Rhodamine B\nPreprocessing\nTiming: 10 min\nFull emission spectra of GCaMP, Rhodamine, and tdTomato could be downloaded from https://www.chroma.com/spectra-viewer[href=https://www.chroma.com/spectra-viewer].\nMATLAB codes to generate the reference spectra of GCaMP, Rhodamine, and tdTomato are available here: https://github.com/CAMRIatUNC/MakeReference[href=https://github.com/CAMRIatUNC/MakeReference].\nGenerate the reference emission spectra for measured signals. This step only needs to be run once for each fluorophore.\n[ref1]= make_reference(em_txt_file1,wavelength,emiss_filter_index)\n[ref2]= make_reference(em_txt_file2,wavelength,emiss_filter_index)\nref=[ref1,ref2];\nCritical: Compare the generated reference emission spectra carefully with the real data. There might be a systematic error which is related to each spectrometer. We recommend generating the reference emission spectra for each spectrometer.\nLinear unmixing, deriving the vascular changes, and correction of Hb-absorption\nTiming: 30 min\nMATLAB codes for hemodynamic correction are available here: https://github.com/CAMRIatUNC/HemoCorrection[href=https://github.com/CAMRIatUNC/HemoCorrection].\nCompute the uncorrected GCaMP, uncorrected tdTomato, oxygenated Hb (HbO), deoxygenated Hb (HbR), and total Hb (HbT) as follows:\nNote: Run the script in the same directory where the raw text file generated by the spectrometer was saved.\ntmp = detectImportOptions(TextFile);%TextFile is the raw data file\nNumOfHeaderlines = tmp.DataLines(1,1);\nM = dlmread(TextFile,'\\t',NumOfHeaderLines,2);\nM = M';\n[Output]=HemoCalcGreen163(M);\nNote: Problem 4: empirically, the goodness-of-fit (L) ≤ 0.05 is considered acceptable for fitting the hemodynamic changes. For goodness-of-fit (L) > 0.05, see troubleshooting 4[href=https://www.wicell.org#sec6.7].\nOptional A: For the interleaved recording of GCaMP signals with 405 nm and 488 nm excitation lasers, compute the HbO, HbR, HbT, GCaMP488, and GCaMP405 as follows:\nNote: Run the script in the same directory where the raw text file generated by the spectrometer was saved.\n[BG488,BG405]=interleaving_fix_V2(BG_file,’datalength’,1200,’hz’,10,’interp’,’no’); % BG_file: Background raw text file\n[G488,G405]=interleaving_fix_V2(DATA_file,’datalength’,7920,’hz’,10,’interp’,’yes’);% DATA_file: Real raw data file\nmean_BG405 = nanmean(BG405,2); mean_BG488 = nanmean(BG488(:,2:end),2);\n% Next manually subtract the background noise and discard the first 6-min data\nG405_fix = G405 – mean_BG405; G405_fix = G405_fix(:,4801:end);",
    "G488_fix = G488 – mean_BG488; G488_fix = G488_fix(:,4801:end);\nG488_uncor = sum(G488_fix(200:230,:),1)’;\nG405_uncor = sum(G405_fix(200:230,:),1)’;\n[Output] = HemoCalcBlue400(G405_fix);\nOptional B: For GCaMP and Rhodamine B data, perform linear unmixing and compute ΔF/F of GCaMP and Rhodamine B for changes in neuronal and vascular signal, respectively.\nLinear Unmixing.\ntmp = detectImportOptions(TextFile);%TextFile is the raw data file\nNumOfHeaderlines = tmp.DataLines(1,1);\nM = dlmread(‘RhodamineSampleData.txt’,'\\t',NumOfHeaderLines,2);\nref= csvread(‘Dual-GCaMP&Rho.csv’,1,1);\ncoef=zeros(size(ref,2),size(M,1));\nfor i=1:size(M,1)\n  coef(:,i)=lsqnonneg(ref(140:500,:),M(i,140:500)');\nend\ncoef = coef’;\nCompute ΔF/F, then skip step 12.\ndeltaCoef1 = (coef(:,1) – mean(coef(1:290,1))) ./std(coef(1:290,1));\ndeltaCoef2 = (coef(:,2) – mean(coef(1:290,2))) ./std(coef(1:290,2));\n% 290 is the length of the baseline.\nNote: Problem 5: empirically, the goodness-of-fit R2 ≥ 0.90 is considered acceptable for the linear unmixing. For R2 < 0.90, see troubleshooting 5[href=https://www.wicell.org#sec6.9].\nCorrection of Hb-absorption artifacts in GCaMP and tdTomato signals.\n[G_cor,G_uncor_perc]=BlueSignalsCorrectedbyHb(G_uncor,HbO,HbR);\n[Td_cor,Td_uncor_perc]=GreenSignalsCorrectedbyHb(Td_uncor,HbO,HbR);\nComputing the hemodynamic response function (HRF)\nAfter deriving vascular activity changes and corrected GCaMP signal dynamics, HRF can be calculated via deconvolving the vascular activity time-course with the concurrently measured GCaMP time-course. Detail methods can be found in (Chao et al., 2022[href=https://www.wicell.org#bib1]). We use a homemade script running in MATLAB for the HRF calculation, which is available at https://github.com/CAMRIatUNC/Photometry-tools/blob/main/HRF.m[href=https://github.com/CAMRIatUNC/Photometry-tools/blob/main/HRF.m].\nMake sure the HRF.m is located under your MATLAB folder or under one of your Set Path folders.\nImport the vascular and GCaMP activity time-courses into MATLAB as single column variables.\nOnce the vascular and GCaMP activity time-courses were imported, HRF could be calculated as follows:\nSampling_rate = 10; % in Hz;\nHRF_length = 25; % in seconds;\n[hrf]=HRF(GCaMP time-course, Vascular time-course, Sampling_rate, HRF_length);\nNote: Problem 6: noise and baseline drift in neuronal and vascular time-courses. See troubleshooting 6[href=https://www.wicell.org#sec6.11]."
  ],
  "subjectAreas": [
    "Neuroscience",
    "Molecular/Chemical Probes",
    "Model Organisms",
    "Bioinformatics"
  ],
  "bigAreas": [
    "Biomedical & Clinical Research",
    "Molecular Biology & Genetics",
    "Bioinformatics & Computational Biology"
  ]
}