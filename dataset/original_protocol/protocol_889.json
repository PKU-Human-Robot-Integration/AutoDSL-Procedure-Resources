{
  "id": 948,
  "origin_website": "Nature",
  "title": "DNA methylation signatures analysis with Illumina Infinitum MethylationEPIC and Infinium Human Methylation 450K BeadChip",
  "procedures": [
    "1. Rawdata processing \n  \n1 a) download raw data:\nIllumina Infinium Human Methylation 450K BeadChip Discovery Data:\nhttps://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE100264\nIllumina Infinium MethylationEPIC BeadChip Replication Data:\nhttps://www.synapse.org/#\\!Synapse:syn11455620\n1 b). Detection Pvalue determination\n A total of 416 probes on chromosome Y were selected. \n A set of p-values, 5e-2, 1e-2, 1e-5, 1e-8, 1e-10, 1e-12, … 1e-30, was used to calculate the call rate of each female subject using the 416 probes. \n A detection p-value was chosen considering ratio of non-0-call-rate subjects, and not too stringent to exclude too many signals.  \nFinally, the intensity values with detection P ≥ 1e-12 were set to missing data. \n<a href=\"https://www.nature.com/protocolexchange/system/uploads/6003/original/Figure_2.png?1511338465\" > <img src=\"https://www.nature.com/protocolexchange/system/uploads/6003/original/Figure_2.png?1511338465\"  height=\"300\" width=\"400\"> </a>\nFigure 2 450K Pvalue determination\n1 c) Data QC\nThe data quality was checked by using minfi R package.\nProbe QC:\nAll the probes located in sex chromosome probes and within 10 bp SNP were removed.\nSex chromosome: 11,648 probes on sex chromosomes \nWithin 10 bp SNP: 36,142 probes within 10 bp SNPs. \nA total of 437,722 probes remained after removing the above probes.\nSample QC:\nWe determined the proportion of missing data per sample, enabling calculation of the sample call rate, and excluded samples with sample call rate < 98%. We also compared the predicted sex with the self-reported sex.  One sex mismatched sample and three samples with lower call rate than 0.98 were found and excluded in the further analysis. \n<a href=\"https://www.nature.com/protocolexchange/system/uploads/6009/original/Figure_4.png?1511339418\" > <img src=\"https://www.nature.com/protocolexchange/system/uploads/6009/original/Figure_4.png?1511339418\" height=\"400\" width=\"400\"> </a>\nFigure 3 sex prediction results\n<a href=\"https://www.nature.com/protocolexchange/system/uploads/6011/original/Figure_5.png?1511339514\" > <img src=\"https://www.nature.com/protocolexchange/system/uploads/6011/original/Figure_5.png?1511339514\"  height=\"400\" width=\"400\"> </a>\nFigure 4 whole beta value distribution\n<a href=\"http://www.nature.com/protocolexchange/system/uploads/6013/original/sample_quality.png?1508176431\" > <img src=\"http://www.nature.com/protocolexchange/system/uploads/6013/original/sample_quality.png?1508176431\"  height=\"400\" width=\"400\"> </a>\nFigure 5 sample data quality check\nR code:\n#############################\nqc <- getQC\\(MSet)\nhead\\(qc)\n#plot QC\nplotQC\\(qc)\n#check sex\nplotSex\\(getSex\\(gRatioSet.quantile, cutoff = -2))\n#############################\n1 d) Intensity data processing and normalization",
    "Background correction and within array normalization was conducted with preprocessIllumina function in minfi package. The original Green/Red channel intensity data was also transformed to Meth/Unmeth data. \nAll probes were divided to 3 types: Type I Green, Type I Red, and Type II. \nMeth/Unmeth data were subsequently divided into 6 groups: Meth and Unmeth for each type as above. \nEach group was normalized independently by using normalizeBetweenArrays function in Limma R package \\(version 3.26.2), and then were merged. Then Beta value of each probe was generated using getBeta function in minfi. \nR code:\n#############################\n#background correction & within-array normalization\nMSet.illumina <- preprocessIllumina\\(RGSet, bg.correct = TRUE,\n                               normalize = \"controls\")\n                               \n#between-array normalization after dividing the signals into 6 parts                             \nmeth.1 = normalizeBetweenArrays\\(my.meth\\[typeIProbesGrn,])\nmeth.2 = normalizeBetweenArrays\\(my.meth\\[typeIProbesRed,])\nmeth.3 = normalizeBetweenArrays\\(my.meth\\[typeIIProbes,])\nunmeth.1 = normalizeBetweenArrays\\(my.unmeth\\[typeIProbesGrn,])\nunmeth.2 = normalizeBetweenArrays\\(my.unmeth\\[typeIProbesRed,])\nunmeth.3 = normalizeBetweenArrays\\(my.unmeth\\[typeIIProbes,])\n#############################\n2. EWAS \n  The EWAS pipeline mainly contains four steps:\nPrincipal component analysis \\(PCA) on intensities of positive control probes \\(to remove batch effect)\nBlood cell type proportion was estimated \\(to adjust cell type confounders)\nPCA on intermediary residuals \\(to control global biological confounders)\nGeneral linear model of IDUs\n2 a) PCA on intensities of control probes\nPCA on the intensities of 237 positive control probes. \nPrior-adjustment: Top PCs were correlated with some technical biases. \nPost-adjustment: batch effect was significantly eliminated.\n2 b) Blood cell type proportions estimation\nSix blood cell sub-populations were estimated using the approach described by Houseman et al. \n600 probes highly correlated with blood cell types were applied to estimate each cell type composition. \nMinfi R package was used.\nR code:\n#############################\ncellCounts <- estimateCellCounts\\(RGSet)\n#############################\n2 c) PCA on intermediary residuals\nRegression model 1: adjusted for technical bias using Control probe PCA and some essential biological factors \nGLM model:",
    "Beta ~ Age + WBC_total + CD8T + CD4T + Gran + NK + Bcell + Mono + PC1-30ControlProbe \n2 d) Final EWAS model\nRegression model 2:\nGLM model:\nBeta ~ ivdused + Age + logVL+ WBC_total + CD8T + CD4T + Gran + NK + Bcell + Mono + PC1-30ControlProbe + PC1-5residual\nPC1-30ControlProbe was used to control technical bias\nPC1-5residual was used to control other global confounders\nlogVL: lg\\(HIV Viral Load); to control HIV VL\nWBC_total, CD8T, CD4T, Gran, NK, Bcell, Mono: to control cell type\n3 Clustering\n3 a) hirarchical clustering\nR library heatmap3 was used.\nR code:\n#############################\nresult <- heatmap3\\(dat,\n    distfun = distfunc,\n    hclustfun = hclustfunc,\n    ColSideCut = ColSideCut,\n    ColSideAnn = ColSideAnn,\n    ColSideFun = function\\(x) \\{\n        showAnn\\(x)\n    },\n    ColSideWidth = ColSideWidth,\n    ColSideColors = ColSideColors,\n    RowAxisColors = RowAxisColors,\n    breaks  = breaks,\nl   egendfun = legendfun,\n    col = cols,\n    verbose = T,\n    scale = scale,\n    showRowDendro = T,\n    showColDendro = T,\n    RowSideLabs = F,\n    ColSideLabs = F\n    )\n#############################\n<a href=\"https://www.nature.com/protocolexchange/system/uploads/6027/original/sig_probe_residual_hm_v4.png?1508358384\" > <img src=\"https://www.nature.com/protocolexchange/system/uploads/6027/original/sig_probe_residual_hm_v4.png?1508358384\" height=\"500\" width=\"500\"> </a>\nFigure 6 hierarchical clustering\n3 b) T-SNE visualization\nR library Rtsne was used\nR code:\n#############################\ntrain = dat\nlibrary\\(Rtsne)\nset.seed\\(123456789)\ntsne <- Rtsne\\(t\\(train), dims = 2, perplexity = 50, verbose = TRUE, max_iter = 2000, theta = 0)\n#############################\n4 Genome-wide differential DNA methylation region \\(DMR) analysis using bumphunter protocol. \nFirst define a regression model very similar with EWAS final model \\(refre to 2 d), and then define gene clusters with R object gRatioSet. At last produce DMRs with bumphunter fucntions in minfi. \nR code:\ndesignMatrix_cov <- model.matrix\\(~ logVL_new + adhmed+dcq1pot+dcq2coke+dcq3stim+dcq4opio+alcohol+ivdused+AGEBL+RACECOMG+WBC_new+CD8T+CD4T+Gran+NK+Bcell+Mono+Control_Probe_PC1+Control_Probe_PC2+Control_Probe_PC3+Control_Probe_PC4+Control_Probe_PC5+Control_Probe_PC6+Control_Probe_PC7+Control_Probe_PC8+Control_Probe_PC9+Control_Probe_PC10+Control_Probe_PC11+Control_Probe_PC12+Control_Probe_PC13+Control_Probe_PC14+Control_Probe_PC15+Control_Probe_PC16+Control_Probe_PC17+Control_Probe_PC18+Control_Probe_PC19+Control_Probe_PC20+Control_Probe_PC21+Control_Probe_PC22+Control_Probe_PC23+Control_Probe_PC24+Control_Probe_PC25+Control_Probe_PC26+Control_Probe_PC27+Control_Probe_PC28+Control_Probe_PC29+Control_Probe_PC30+resiPC1+resiPC2+resiPC3+resiPC4+resiPC5+resiPC6+resiPC7+resiPC8+resiPC9+resiPC10, targets)\nR code:\n#############################\nget_pos_chr_cluter_from_gRatio = function \\(cc_gRatioSet, maxGap=200000) \\{\n    annotation <- getAnnotation\\(cc_gRatioSet);\n    chr = annotation$chr;\n    pos = annotation$pos;\n    cl <- clusterMaker\\(chr, pos, maxGap = maxGap)\n    print\\(table\\(cl))\n    Indexes <- split\\(seq_along\\(cl), cl)\n    ret = list\\(chr=chr, pos=pos, cl=cl, Indexes = Indexes)",
    "}\ncluster_info = get_pos_chr_cluter_from_gRatio\\(cc_gRatioSet, maxGap);\ndmrs_cov.cl <- bumphunter\\(getBeta\\(cov_gRatioSet), design = designMatrix_cov, chr=cluster_info$chr, pos=cluster_info$pos, cluster=cluster_info$cl, cutoff = NULL, pickCutoff=T, maxGap = maxGap,  B=perm_num, type=\"Beta\", smooth=F, nullMethod=\"bootstrap\")\n#############################\n5 Machine learning analysis \n5 a) Support vector machine \\(SVM) algorithm and R package caret was used. The 386 samples in EWAS and 748 CpG sites were used as training set. A different set of 238 samples also from VACS was used as independent testing set. The training samples were divided into 5 equal number of subgroups with indexes of <16, 17–24, 25–34, 35–50, and >50.  In the testing samples, high and low HIV frailty was defined as VACS index scores above 50 \\(the upper 20% quantile in 386 training samples) and below 16 \\(lower 20% quantile). We then tested prediction performance on subjects with high \\(VACS index >50 vs. ≤50) and low HIV frailty \\(VACS index <16 vs. ≥16), respectively.\n5 b) 1000 times permutation test was conducted to study that if the 748 probes has a significant performance than random ones. AUROC was used in the analysis.\n<a href=\"https://www.nature.com/protocolexchange/system/uploads/6029/original/independent_test_HIVIndex_ROC.png?1508360021\" > <img src=\"https://www.nature.com/protocolexchange/system/uploads/6029/original/independent_test_HIVIndex_ROC.png?1508360021\" height=\"400\" width=\"400\"> </a>\nFigure 7 independent test, TP \\(true positive), FP \\(false positive), TN \\(true negative), FN \\(false negative) distribution\n6 Pathway enrichment analysis\nIPA was used on pathway enrichment analysis of DMP and DMR genes\n<a href=\"http://www.nature.com/protocolexchange/system/uploads/6031/original/enrichment_plot_v2.png?1508360057\" > <img src=\"http://www.nature.com/protocolexchange/system/uploads/6031/original/enrichment_plot_v2.png?1508360057\" height=\"300\" width=\"550\"> </a>\nFigure 8 Pathway enrichment analysis"
  ],
  "subjectAreas": [
    "Genetics"
  ],
  "bigAreas": [
    "Molecular Biology & Genetics"
  ]
}