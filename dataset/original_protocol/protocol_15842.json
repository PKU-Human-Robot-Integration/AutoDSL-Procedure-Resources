{
  "id": 19668,
  "origin_website": "Wiley",
  "title": "Analysis of Genetic Ancestry from NGS Data Using EthSEQ",
  "procedures": [
    "This protocol provides complete instructions for performing the ancestry analysis using a pre-computed reference model and three alternative file formats as input files. First, we show how to perform the analysis using a target model .vcf (VCF) file as input (alternative a steps). A VCF file contains sequence variations, and can be obtained from NGS data using Support Protocol 2[href=https://currentprotocols.onlinelibrary.wiley.com/doi/10.1002/cpz1.663#cpz1663-prot-0005] or any other of several available genotyping tools (FreeBayes (Garrison & Marth, 2012[href=https://currentprotocols.onlinelibrary.wiley.com/doi/10.1002/cpz1.663#cpz1663-bib-0007]), GATK HaplotypeCaller (Poplin et al., 2017[href=https://currentprotocols.onlinelibrary.wiley.com/doi/10.1002/cpz1.663#cpz1663-bib-0012]), VarScan (Koboldt et al., 2012[href=https://currentprotocols.onlinelibrary.wiley.com/doi/10.1002/cpz1.663#cpz1663-bib-0009]), or SAMtools/BCFtools (Danecek et al., 2021[href=https://currentprotocols.onlinelibrary.wiley.com/doi/10.1002/cpz1.663#cpz1663-bib-0004])). Then, we show how to perform ancestry analysis using a GDS file as target model input (alternative b steps). To manage GDS files, EthSEQ uses a set of functions provided by the SNPRelate and gdsfmt R packages. Also, in this case, a minimum required set of variables should be stored in the GDS file (see Strategic Planning). Last, we show how to perform the ancestry analysis using a list of .bam (BAM) files as input (alternative c steps). A BAM format file is the compressed version of a SAM format file, and contains NGS aligned reads. EthSEQ expects a list of BAM files representing control (non-tumor) WES or TS NGS DNA data files obtained from a set of individuals of interest. EthSEQ determines the genotype calls for all available reference models’ SNPs for each individual from the corresponding BAM file, then merges the genotype calls of all individuals, and finally performs the ancestry analysis. Genotype information is extracted and computed by EthSEQ, exploiting the tool ASEQ. More specifically, EthSEQ downloads ASEQ and runs it automatically using its genotype mode to compute the genotype of all available reference model's SNPs across all input BAM files. Details about ASEQ are available at http://bcglab.cibio.unitn.it/aseq[href=http://bcglab.cibio.unitn.it/aseq].\nNecessary Resources\nHardware",
    "A 64-bit computer with ≥8 GB RAM\nAn internet connection to download the reference model\nNote that the RAM required for using the tool is proportional to the size of the input VCF file (only alternative a steps). Usually, the maximum RAM required for processing a file with approximately 250,000 variants and 1000 individuals will not exceed 4.5 GB when performing the file conversion from VCF to GDS format. Using GDS or a list of BAM files as input files (alternative b and c steps, respectively) the minimum RAM required is 1 GB.\nSoftware\nThe library has been tested with R version 3.6.3+. The R software is free and can be downloaded from the official website https://cran.r-project.org/[href=https://cran.r-project.org/], where installation instructions are also available. Although EthSEQ is an R package and can be run across different operating systems (e.g., Windows, MacOS and Linux), the code provided in this protocol is designed to run under Linux systems.\nInput files\nTarget model: one of the following file formats must be provided as target model: VCF file format, GDS file format, or a list of BAM files. VCF files provided in input to EthSEQ should respect the following constraints:\n               \nGenotype field “GT” is used for the analysis and must be present;\nOnly positions with single reference and single alternative base are admitted;\nNo duplicated sample names are admitted;\nNo duplicated positions are admitted.\nGDS files must instead be formatted as explained in the Strategic Planning section.\nSample data\nInput data for the example analyses reported here are included and installed along with the EthSEQ package. The user can manually download and explore these data from https://github.com/cibiobcg/EthSEQ/tree/master/inst/extdata[href=https://github.com/cibiobcg/EthSEQ/tree/master/inst/extdata].",
    "Output results of the example analyses reported here are available at https://github.com/cibiobcg/EthSEQ_Data/tree/master/example_outputs/[href=https://github.com/cibiobcg/EthSEQ_Data/example_outputs/]. The user can explore and compare the expected results available on the GitHub page with the results obtained by running the protocol.\nR installation\nTo download and install R, refer to the documentation available at the official website https://cran.r-project.org/[href=https://cran.r-project.org/]. R is provided there as a precompiled binary for multiple operating systems.\nInstall and load EthSEQ\n1. Run R from the command line:\n         \n$ R\n2. Install EthSEQ for the first time:\n         \n> install.packages(\"EthSEQ\")\n3. Load the library:\n         \n> library(EthSEQ)\nThe user performs the ancestry analysis using the function ethseq.Analysis and, as previously described, must provide a reference model and a target model.\nThe user defines the reference model using the parameters model.available, model.assembly, and model.pop (see Strategic Planning). The model is automatically downloaded and used by EthSEQ. Then, the user must follow one of the alternative steps based on the target model format available. The user can provide a genotype data file in VCF format (alternative a steps), a GDS data file (alternative b steps), or a list of BAM files (alternative c steps). A different set of parameters must be used when running the ethseq.Analysis function, depending on the target model file format used.\na. Ancestry analysis using a VCF file as input\n4a. Run the analysis:\n         \n> ethseq.Analysis(target.vcf = system.file(\"extdata\", \"Samples.HGDP.10000SNPs.vcf\",\n    package = \"EthSEQ\"),\nmodel.available = \"Gencode.Exome\",\nmodel.assembly = \"hg38\",\nmodel.pop = \"All\",\nout.dir = file.path(tempdir(),\"EthSEQ_Analysis/\"),\nverbose=TRUE,\ncores = 1,\ncomposite.model.call.rate = 1,\nspace = \"3D\")\nIn this mode, the function ethseq.Analysis takes as input the following parameters:\n         \ntarget.vcf: Path to the samples’ genotype data in VCF format;\nmodel.available: String specifying the pre-computed reference model to use (use getModelsList() function to retrieve the list of all available reference models);",
    "model.assembly (default = ‘hg38’): Version of the human assembly used to build the reference model (‘hg19’ or ‘hg38’);\nmodel.pop (default = ‘All’): Population of the samples to be included in the reference model; use “All” to perform the ancestry analysis using all the superpopulation defined by the 1000 Genomes Project or set the parameter to a specific available superpopulation (e.g., “EUR”) to perform the analysis across the corresponding subpopulation groups (use getSamplesInfo() function to retrieve all available populations);\nout.dir (default = tempdir()): Path to the folder where the output of the analysis is saved;\nmodel.folder (default = tempdir()): Path to the folder where reference models are already present or downloaded when needed;\ncores (default = 1): Number of parallel cores used for the analysis;\nverbose (default = TRUE): Print detailed execution information;\ncomposite.model.call.rate (default = 1): Minimum SNP call rate to include a SNP in the Principal Component Analysis (PCA);\nspace (default = ‘2D’): Dimensions of PCA space used to infer ancestry (2D or 3D). 2D will use the first two principal components to infer the ancestry and generate the plot. 3D will use the first three principal components to infer the ancestry and generate the plots.\nOf note, the function:\n         \n> system.file(\"extdata\", \"Samples.HGDP.10000SNPs.vcf, package=\"EthSEQ\")\nretrieves the path to the sample VCF data file included in the EthSEQ package. Importantly, the file can also be manually downloaded from https://github.com/cibiobcg/EthSEQ/tree/master/inst/extdata[href=https://github.com/cibiobcg/EthSEQ/tree/master/inst/extdata] and provided to the ethseq.Analysis function specifying the corresponding file system path.\nThe output of the analysis is written into the out.dir folder. EthSEQ produces a collection of textual and visual files reporting the inferred ancestries for all the target model's individuals. See Guidelines for Understanding Results for a detailed description of all EthSEQ outputs and their interpretation.\nb. Ancestry analysis using a GDS file as input\n4b. Run the analysis:",
    "> ethseq.Analysis(target.gds = system.file(\"extdata\", \"Samples.HGDP.10000SNPs.gds\",\n    package=\"EthSEQ\"),\nmodel.available = \"Gencode.Exome\",\nmodel.assembly = \"hg38\",\nmodel.pop = \"All\",\nout.dir = file.path(tempdir(),\"EthSEQ_Analysis/\"),\nverbose= TRUE,\ncores = 1,\ncomposite.model.call.rate = 1,\nspace = \"3D\")\nIn this mode, the function ethseq.Analysis takes as input the following parameters:\n         \ntarget.gds: Path to the samples’ genotype data in GDS format;\nmodel.available: String specifying the pre-computed reference model to use (use getModelsList() function to retrieve the list of all available reference models);\nmodel.assembly (default = ‘hg38’): Version of the human assembly used to build the reference model model (‘hg19’ or ‘hg38’);\nmodel.pop (default = ‘All’): Population of the samples to be included in the reference model; use “All” to perform the ancestry analysis with all the superpopulation defined by the 1000 Genomes Project or set the parameter to a specific available superpopulation (e.g., “EUR”) to perform the analysis across the corresponding subpopulation groups (use getSamplesInfo() function to retrieve all available populations);\nout.dir (default = tempdir()): Path to the folder where the output of the analysis is saved;\nmodel.folder (default = tempdir()): Path to the folder where reference models are already present or downloaded when needed;\ncores (default = 1): Number of parallel cores used for the analysis;\nverbose (default = TRUE): Print detailed execution information;\ncomposite.model.call.rate (default = 1): Minimum SNP call rate to include a SNP in the Principal Component Analysis (PCA);\nspace (default = ‘2D’): Dimensions of PCA space used to infer ancestry (2D or 3D). 2D will use the first two principal components to infer the ancestry and generate the plot. 3D will use the first three principal components to infer the ancestry and generate the plots.\nAs before, the function:\n         \n> system.file(\"extdata\", \"Samples.HGDP.10000SNPs.gds, package=\"EthSEQ\")",
    "retrieves the path to the sample GDS data file included in the EthSEQ package. Importantly, the file can be also manually downloaded from https://github.com/cibiobcg/EthSEQ/tree/master/inst/extdata[href=https://github.com/cibiobcg/EthSEQ/tree/master/inst/extdata] and provided to the ethseq.Analysis function specifying the corresponding file system path.\nAlso, in this case the output of the analysis is written into the out.dir folder, producing the same collection of textual and visual files reporting the inferred ancestries for all the target model's individuals. See Guidelines for Understanding Results for a detailed description of all EthSEQ outputs formats and their interpretation.\nc. Ancestry analysis using a list of BAM files as input\n4c. Create a text file containing the list of paths to the BAM files to use in the analysis:\n         \n> write(c(file.path(tempdir(),\"HGDP00228.sub_GRCh38.bam\"),\nfile.path(tempdir(),\"HGDP01200.sub_GRCh38.bam\"),\nfile.path(tempdir(),\"HGDP01201.sub_GRCh38.bam\")),\nfile.path(tempdir(),\"BAMs_List.txt\"))\nOf note, in this example we rely on BAM files and their corresponding index files available in a temporary folder created with the function tempdir(). To download and save the files in the aforementioned temporary folder the user has to run the following R code:\n         \n>download.file(\"https://github.com/cibiobcg/EthSEQ_Data/raw/master/BAM/HGDP00228.sub_GRCh38.bam\",destfile = file.path(tempdir(),\"HGDP00228.sub_GRCh38.bam\"))\n>download.file(\"https://github.com/cibiobcg/EthSEQ_Data/raw/master/BAM/HGDP00228.sub_GRCh38.bam.bai\",destfile = file.path(tempdir(),\"HGDP00228.sub_GRCh38.bam.bai\"))\n>download.file(\"https://github.com/cibiobcg/EthSEQ_Data/raw/master/BAM/HGDP01200.sub_GRCh38.bam\",destfile = file.path(tempdir(),\"HGDP01200.sub_GRCh38.bam\"))\n>download.file(\"https://github.com/cibiobcg/EthSEQ_Data/raw/master/BAM/HGDP01200.sub_GRCh38.bam.bai\",destfile = file.path(tempdir(),\"HGDP01200.sub_GRCh38.bam.bai\"))\n>download.file(\"https://github.com/cibiobcg/EthSEQ_Data/raw/master/BAM/HGDP01201.sub_GRCh38.bam\",destfile = file.path(tempdir(),\"HGDP01201.sub_GRCh38.bam\"))\n>download.file(\"https://github.com/cibiobcg/EthSEQ_Data/raw/master/BAM/HGDP01201.sub_GRCh38.bam.bai\",destfile = file.path(tempdir(),\"HGDP01201.sub_GRCh38.bam.bai\"))\n5c. Run the analysis:\n         \n> ethseq.Analysis(bam.list = file.path(tempdir(),\"BAMs_List.txt\"),\nmodel.available = \"Gencode.Exome\",\nout.dir = file.path(tempdir(),\"EthSEQ_Analysis/\"),\nverbose = TRUE,\ncores = 1,\naseq.path = file.path(tempdir(),\"EthSEQ_Analysis/\"),\nrun.genotype = TRUE,\nmbq = 20,\nmrq = 20,\nmdc = 10,\ncomposite.model.call.rate = 1,\nspace = \"3D\",\nbam.chr.encoding = TRUE)\nIn this mode, the function ethseq.Analysis takes as input the following parameters:\n         \nbam.list: Path to a file containing a list of BAM files paths;\nmodel.available: String specifying the pre-computed reference model to use (use getModels() function to retrieve the list of all available reference models);\nmodel.assembly (default = ‘hg38’): Version of the human assembly used to build the reference model (‘hg19’ or ‘hg38’);",
    "model.pop (default = ‘All’): Population of the samples to be included in the reference model; use “All” to perform the ancestry analysis using all the superpopulation defined by the 1000 Genomes Project or set the parameter to a specific available superpopulation (e.g., “EUR”) to perform the analysis across the corresponding subpopulation groups (use getSamplesInfo() function to retrieve all available populations);\nout.dir (default = tempdir()): Path to the folder where the output of the analysis is saved;\nmodel.folder (default = tempdir()): Path to the folder where reference models are already present or downloaded when needed;\nrun.genotype (default = FALSE): Logical values indicating whether the ASEQ genotype should be run;\naseq.path (default = tempdir()): Path to the folder where ASEQ binary is available or is downloaded when needed;\nmbq (default = 20): Minimum base quality used in the pileup by ASEQ;\nmrq (default = 20): Minimum read quality used in the pileup by ASEQ;\nmdc (default = 10): Minimum read count acceptable for genotype inference by ASEQ;\ncores (default = 1): Number of parallel cores used for the analysis;\nverbose (default = TRUE): Print detailed execution information;\ncomposite.model.call.rate (default = 1): Minimum SNP call rate to include a SNP in the Principal Component Analysis (PCA);\nspace (default = ‘2D’): Dimensions of PCA space used to infer ancestry (2D or 3D). 2D will use the first two principal components to infer the ancestry and generate the plot. 3D will use the first three principal components to infer the ancestry and generate the plots.\nbam.chr.encoding (default = FALSE): Logical value indicating whether input BAM files have chromosomes encoded with \"chr\" prefix.",
    "As previously mentioned, when NGS is used as input, EthSEQ invokes ASEQ to produce for each input BAM file a VCF file reporting the genotype calls for the reference model's SNPs. Specifically, ASEQ calls a heterozygous genotype for an SNP if the proportion of the coverage for the alternative base with respect to the total coverage is in the range [0.2,0.8]; otherwise, ASEQ calls a homozygous genotype, either for the reference or the alternative base. The precision of this approach is shown and discussed in Romanel et al. (2015[href=https://currentprotocols.onlinelibrary.wiley.com/doi/10.1002/cpz1.663#cpz1663-bib-0015]). Although the execution of ASEQ and the processing of its output is managed automatically and transparently to the user by EthSEQ, when several BAM files are analyzed, the ASEQ processing step can take some time. In those cases, ASEQ could also be run externally (Support Protocol 2[href=https://currentprotocols.onlinelibrary.wiley.com/doi/10.1002/cpz1.663#cpz1663-prot-0005]) and its output could be passed in input to EthSEQ in a secondary moment, setting the run.genotype parameter to FALSE. Importantly, in this case the ASEQ VCF output files should be provided to EthSEQ in the same format and folder as EthSEQ would have done automatically.\nSetting the parameter run.genotype to FALSE is also useful when the user wants to re-run only the ancestry analysis (e.g., with different parameters) without running the entire ASEQ genotyping again.\nAlso in this case, the output of the analysis is written into the out.dir folder, producing the same collection of textual and visual files reporting the inferred ancestries for all the target model's individuals. See Guidelines for Understanding Results for a detailed description of all EthSEQ outputs formats and their interpretation.",
    "This protocol provides complete instructions to perform ancestry analysis with a user-specified GDS file as reference model. In this case, a minimum set of variables should be stored in the GDS file, as described in Strategic Planning. In this protocol we show how to perform the analysis using a target model VCF file as in Basic Protocol 1[href=https://currentprotocols.onlinelibrary.wiley.com/doi/10.1002/cpz1.663#cpz1663-prot-0001], a steps.\nNecessary Resources\nHardware\n64-bit computer with ≥1 GB RAM\nSoftware\nAs described in Basic Protocol 1[href=https://currentprotocols.onlinelibrary.wiley.com/doi/10.1002/cpz1.663#cpz1663-prot-0001]\nInput files\nAs described in Basic Protocol 1[href=https://currentprotocols.onlinelibrary.wiley.com/doi/10.1002/cpz1.663#cpz1663-prot-0001]\nSample data\nInput data for the example analyses reported here are included and installed along with the EthSEQ package. The user can manually download and explore these data from https://github.com/cibiobcg/EthSEQ/tree/master/inst/extdata[href=https://github.com/cibiobcg/EthSEQ/tree/master/inst/extdata].\nOutput results of the example analyses reported here are available at https://github.com/cibiobcg/EthSEQ_Data/tree/master/example_outputs/[href=https://github.com/cibiobcg/EthSEQ_Data/example_outputs/]. The user can explore and compare the expected results available on the GitHub page with the results obtained by running the protocol.\nThe user should start by running step 1 to 3 as described in Basic Protocol 1[href=https://currentprotocols.onlinelibrary.wiley.com/doi/10.1002/cpz1.663#cpz1663-prot-0001] and then:\n4. Run the analysis:\n         \n> ethseq.Analysis(target.vcf = system.file(\"extdata\", \"Samples.HGDP.10000SNPs.vcf\",\n     package = \"EthSEQ\"),\nmodel.gds = system.file(\"extdata\", \"Reference.Gencode.Exome.10000SNPs.gds\",\npackage = \"EthSEQ\"),\nout.dir = file.path(tempdir(),\"EthSEQ_Analysis/\"),\nverbose = TRUE,\ncores = 1,\ncomposite.model.call.rate = 1,\nspace = \"3D\")\nIn this mode, the function ethseq.Analysis takes as input the following parameters:\n         \ntarget.vcf: path to the samples’ genotype data file in VCF format. Only one file is allowed as input in the analysis;\nmodel.gds: path to a GDS file specifying the reference model;\nout.dir (default = tempdir()): path to the folder where the output of the analysis is saved;\nverbose (default = TRUE): print detailed execution information;\ncores (default = 1): number of parallel cores used for the analysis;",
    "composite.model.call.rate (default = 1): SNP call rate used to run the Principal Component Analysis (PCA). The SNPs with a call rate lower than this value are not included in the analysis;\nspace (default = ‘2D’): Dimensions of PCA space used to infer ancestry (2D or 3D). 2D will use the first two principal components to infer the ancestry and generate the plot. 3D will use the first three principal components to infer the ancestry and generate the plots.\nOf note, the functions:\n         \n> system.file(\"extdata\", \"Samples.HGDP.10000SNPs.vcf, package=\"EthSEQ\")\n> system.file(\"extdata\",\"Reference.Gencode.Exome.10000SNPs.gds,package=\"EthSEQ\")\nretrieve the paths to the sample data files included in the EthSEQ package. Importantly, these files can be also manually downloaded from https://github.com/cibiobcg/EthSEQ/tree/master/inst/extdata[href=https://github.com/cibiobcg/EthSEQ/tree/master/inst/extdata] and provided to the ethseq.Analysis function specifying the corresponding file system paths.\nAlso, in this case the output of the analysis is written into the out.dir folder, producing the same collection of textual and visual files reporting the inferred ancestries for all the target model's individuals. See Guidelines for Understanding Results for a detailed description of all EthSEQ outputs formats and their interpretation.\nThe same analysis can be performed using as target input a GDS file (similar to Basic Protocol 1[href=https://currentprotocols.onlinelibrary.wiley.com/doi/10.1002/cpz1.663#cpz1663-prot-0001], b steps) or a list of BAM files (similar to Basic Protocol 1[href=https://currentprotocols.onlinelibrary.wiley.com/doi/10.1002/cpz1.663#cpz1663-prot-0001], c steps). Specifically, using the procedure described in Basic Protocol 1[href=https://currentprotocols.onlinelibrary.wiley.com/doi/10.1002/cpz1.663#cpz1663-prot-0001], b steps and Basic Protocol 1[href=https://currentprotocols.onlinelibrary.wiley.com/doi/10.1002/cpz1.663#cpz1663-prot-0001], c steps, it is enough to replace the parameters model.available, model.assembly, and model.pop with the parameter model.gds to perform the analysis using a user-specified GDS reference model, as described above.",
    "This protocol provides complete instructions to perform an ancestry analysis using a VCF file as input (as Basic Protocol 1[href=https://currentprotocols.onlinelibrary.wiley.com/doi/10.1002/cpz1.663#cpz1663-prot-0001], a steps), but exploiting a multi-step refinement procedure to better discern ancestry annotations across ancestrally close groups. This approach relies on a tree structure (Fig. 2A[href=https://currentprotocols.onlinelibrary.wiley.com/doi/10.1002/cpz1.663#cpz1663-fig-0002]), provided in input to EthSEQ as a matrix encoding (Fig. 2B[href=https://currentprotocols.onlinelibrary.wiley.com/doi/10.1002/cpz1.663#cpz1663-fig-0002]), that represents recursively the annotation of close ancestry groups that we want to refine. Specifically, given a tree of ancestry group sets such that sibling nodes have non-intersecting ancestry groups and child nodes have ancestry groups included in the parent node ancestry groups, ancestry of individuals is inferred following a pre-order traversal of the tree (Fig. 2C[href=https://currentprotocols.onlinelibrary.wiley.com/doi/10.1002/cpz1.663#cpz1663-fig-0002]). At each node with ancestry groups S, annotations resulting from the analysis of the parent node are refined by reducing both reference and target models on individuals with annotations in S only, and performing again the PCA analysis on these individuals. Global annotation of all individuals is updated throughout the tree traversal.\n<p>imgsrc:https://currentprotocols.onlinelibrary.wiley.com/cms/asset/14535f45-82b3-4594-a0d4-91122d911b99/cpz1663-fig-0002-m.jpg</p>\nFigure 2\nMulti-step refinement analysis. (A) Example of a tree used in the multi-step refinement analysis with P1, P2, etc., representing different reference ancestry groups. (B) Traversal of the tree representing the ancestry refinement steps. (C) Matrix representation of the tree that is given to EthSEQ.\nNecessary Resources\nHardware\nAs described in Basic Protocol 1[href=https://currentprotocols.onlinelibrary.wiley.com/doi/10.1002/cpz1.663#cpz1663-prot-0001]\nSoftware\nAs described in Basic Protocol 1[href=https://currentprotocols.onlinelibrary.wiley.com/doi/10.1002/cpz1.663#cpz1663-prot-0001]\nInput files\nAs described in Basic Protocol 1[href=https://currentprotocols.onlinelibrary.wiley.com/doi/10.1002/cpz1.663#cpz1663-prot-0001]\nSample data\nInput data for the example analyses reported here are included and installed along with the EthSEQ package. The user can manually download and explore these data from https://github.com/cibiobcg/EthSEQ/tree/master/inst/extdata[href=https://github.com/cibiobcg/EthSEQ/tree/master/inst/extdata].",
    "Output results of the example analyses reported here are available at https://github.com/cibiobcg/EthSEQ_Data/tree/master/example_outputs/[href=https://github.com/cibiobcg/EthSEQ_Data/example_outputs/]. The user can explore and compare the expected results available on the GitHub page with the results obtained by running the protocol.\nThe user should start by running step 1 to 3 as described in Basic Protocol 1[href=https://currentprotocols.onlinelibrary.wiley.com/doi/10.1002/cpz1.663#cpz1663-prot-0001] and then:\n4. Prepare the multi-step refinement tree encoding:\n         \n> m = matrix(\"\",ncol=2,nrow=2)\n> m[1,1] = \"EUR|AFR|AMR\"\n> m[2,2] = \"EUR|AMR\"\nA 2 × 2 matrix is created representing a tree with a root node containing three populations and a child node containing two populations.\n5. Run the ancestry analysis:\n         \n> ethseq.Analysis(target.vcf = system.file(\"extdata\",\n    \"Samples.HGDP.10000SNPs.vcf\", package=\"EthSEQ\"),\nout.dir = file.path(tempdir(),\"EthSEQ_Analysis/\"),\nmodel.available = \"Gencode.Exome\",\nverbose = TRUE,\nrefinement.analysis = m,\ncomposite.model.call.rate = 1,\nspace = \"3D\")\nThe same analysis can be performed using as target input: a GDS file (similar to Basic Protocol 1[href=https://currentprotocols.onlinelibrary.wiley.com/doi/10.1002/cpz1.663#cpz1663-prot-0001], b steps) or a list of BAM files (similar to Basic Protocol 1[href=https://currentprotocols.onlinelibrary.wiley.com/doi/10.1002/cpz1.663#cpz1663-prot-0001], c steps). Briefly, using the same procedure described in the Basic Protocol 1[href=https://currentprotocols.onlinelibrary.wiley.com/doi/10.1002/cpz1.663#cpz1663-prot-0001], b steps, and Basic Protocol 1[href=https://currentprotocols.onlinelibrary.wiley.com/doi/10.1002/cpz1.663#cpz1663-prot-0001], c steps, it is enough to add, in the “Run the analysis” step, the refinement.analysis parameter to perform the multi-step refinement procedure, as described above.",
    "This protocol provides complete information to generate a reference model given genotype data for a set of individuals already annotated for ancestry. This function takes as input a list of paths to VCF files to build the reference model. Optionally, the user can provide a path to a Browser Extensible Data (BED) file describing a set of genomic regions of interest to subset the VCF files. This is particularly useful when reference models for TS panels are to be created.\nNecessary Resources\nHardware\nA 64-bit computer with ≥8 GB RAM. Note that the RAM required for performing this step is proportional to the size of each input VCF file. In most cases, less than 8 GB are enough. The maximum RAM required for processing a file with approximately 250,000 variants and 1000 individuals will not exceed 4.5 GB when performing the file conversion from VCF to GDS format.\nSoftware\nAs described in Basic Protocol 1[href=https://currentprotocols.onlinelibrary.wiley.com/doi/10.1002/cpz1.663#cpz1663-prot-0001]\nInput files\nAs described in Basic Protocol 1[href=https://currentprotocols.onlinelibrary.wiley.com/doi/10.1002/cpz1.663#cpz1663-prot-0001]\nSample data\nInput data for the example analyses reported here are included and installed along with the EthSEQ package. The user can manually download and explore these data from https://github.com/cibiobcg/EthSEQ/tree/master/inst/extdata[href=https://github.com/cibiobcg/EthSEQ/tree/master/inst/extdata].\nOutput results of the example analyses reported here are available at https://github.com/cibiobcg/EthSEQ_Data/tree/master/example_outputs/[href=https://github.com/cibiobcg/EthSEQ_Data/example_outputs/]. The user can explore and compare the expected results available on the GitHub page with the results obtained by running the protocol.\nThe user should start by running step 1 to 3 as described in Basic Protocol 1[href=https://currentprotocols.onlinelibrary.wiley.com/doi/10.1002/cpz1.663#cpz1663-prot-0001] and then:\n4. Prepare the input data:\n         \n> vcf.files = c(system.file(\"extdata\",\"RefSample1.vcf\", package=\"EthSEQ\"),\nsystem.file(\"extdata\",\"RefSample2.vcf\", package=\"EthSEQ\"))\n> annot.samples = read.delim(system.file(\"extdata\", \"Annotations_Test_v3.txt\",\npackage=\"EthSEQ\"))\n5. Run the analysis:\n         \n> ethseq.RM(vcf.fn = vcf.files,\nannotations = annot.samples,\nout.dir = file.path(tempdir(),\"EthSEQ_Analysis/\"),\nmodel.name = \"Reference.Model\")\nThe function ethseq.RM takes as input the following parameters:\n         \nvcf.fn: Vector of paths to genotype files in VCF format;",
    "annotations: data.frame with mapping of all samples names, known ancestries and sex;\nout.dir (default = tempdir()): Path to output folder;\nmodel.name (default = “Reference.Model”): Name of the output model;\nbed.fn (default = NA): Path to a BED file with a list of genomic regions of interest;\ncall.rate (default = 1): SNP call rate cutoff for inclusion in the final reference model;\ncores (default = 1): Number of parallel cores to be use in the generation of the reference model.\nOf note, the functions:\n         \n> system.file(\"extdata\",\"RefSample1.vcf\", package=\"EthSEQ\")\n> system.file(\"extdata\",\"RefSample2.vcf\", package=\"EthSEQ\")\n> system.file(\"extdata\", \"Annotations_Test_v3.txt\",package=\"EthSEQ\")\nretrieve the paths to the sample data files included in the EthSEQ package. Importantly, these files can be also manually downloaded from https://github.com/cibiobcg/EthSEQ/tree/master/inst/extdata[href=https://github.com/cibiobcg/EthSEQ/tree/master/inst/extdata] and provided to the ethseq.Analysis function specifying the corresponding file system paths.\nTable 2[href=https://currentprotocols.onlinelibrary.wiley.com/doi/10.1002/cpz1.663#cpz1663-tbl-0002] shows the header and the first 10 rows of the annotation data.frame. Three columns (sample, pop, sex) must be present and are used to perform the analysis. The sample column reports the sample name—all the sample id's in the genotype files must be present in the sample column of the annotation data.frame. The pop column reports the known ancestry for each sample. The sex column reports the sex of each individual. If more columns are present in the data.frame, they will be ignored by EthSEQ and not included in the reference model.\nThe output of the analysis will be written to the out.dir folder. EthSEQ produces the file Reference.Model.gds that can be used as input reference model, as described in the Alternate Protocol[href=https://currentprotocols.onlinelibrary.wiley.com/doi/10.1002/cpz1.663#cpz1663-prot-0002]. See Guidelines for Understanding Results for details on all EthSEQ outputs and their interpretation.\nTable 2.\n                Example of the Annotation Table for Generating the Reference Model (annotations Parameter)a[href=https://currentprotocols.onlinelibrary.wiley.com/doi/10.1002/cpz1.663#cpz1663-tbl2-note-0001_72]\ntable:\n﻿Sample,pop,sex\nHG00096,EUR,M\nHG00100,EUR,F\nHG00101,EUR,M\nHG00103,EUR,M\nHG00106,EUR,F\nHG00108,EUR,M\nHG00111,EUR,F\nHG00112,EUR,M\nHG00116,EUR,M\nHG00117,EUR,M",
    "a First column represents individuals’ names, the second column contains the associated known ancestry and column three contains the individuals’ sex.",
    "This protocol provides complete information to generate the genotype calls of a set of SNPs positions from a BAM file using ASEQ. Here we describe also how to use the output VCF genotype data file as input to perform ancestry analysis as in Basic Protocols 1[href=https://currentprotocols.onlinelibrary.wiley.com/doi/10.1002/cpz1.663#cpz1663-prot-0001], a and c steps, Alternate Protocol and Basic Protocol 2[href=https://currentprotocols.onlinelibrary.wiley.com/doi/10.1002/cpz1.663#cpz1663-prot-0003].\nNecessary Resources\nHardware\n64-bit computer with ≥8 GB RAM\nSoftware\nASEQ and wget. Although ASEQ can be run across different operating systems (e.g., Windows, MacOS and Linux), the code provided in this protocol is designed to run under Linux systems.\nInput files\nA BAM file containing aligned reads\nA VCF file containing a list of SNP positions. Of note, only positions with single reference and single alternative base are admitted in the file.\nSample data\nInput data are already included and installed along with the EthSEQ package. The user can manually download these data from https://github.com/cibiobcg/EthSEQ/tree/master/inst/extdata[href=https://github.com/cibiobcg/EthSEQ/tree/master/inst/extdata].\nOutput results are available from (https://github.com/cibiobcg/EthSEQ_Data/tree/master/example_outputs/[href=https://github.com/cibiobcg/EthSEQ_Data/example_outputs/]). The user can explore and compare the expected results on the GitHub page with the results obtained from the protocol.\n1. From the command line, download ASEQ:\n         \n$ wget https://github.com/cibiobcg/EthSEQ_Data/raw/master/ASEQ_binaries/linux64/ASEQ\n2. Add execute permission to ASEQ:\n         \n$ chmod u+x ASEQ\n3. Run the analysis:\n         \n$./ASEQ vcf=ModelPositions.vcf bam=HGDP00228.sub_GRCh38.bam mode=GENOTYPE threads=1 htperc=0.2 mbq=20 mrq=20 mdc=20 out=./\nASEQ takes as input the following parameters:\n         \nbam: path to the sequence alignment data in BAM format;\nvcf: path to the SNP positions in VCF format;\nout: Path to the folder where the output of the analysis is saved;\nmode (default = PILEUP): execution mode;\nthreads (default = 1): number of threads to be use for ASEQ computation;\nhtperc (default = 0.2): this value specifies the allelic fraction range [htperc,1-htperc] to call a SNP as heterozygous;\nmbq (default = 1): Minimum base quality used in the pileup;",
    "mrq (default = 1): Minimum read quality used in the pileup;\nmdc (default = 1): Minimum read count acceptable for genotype calculation.\nThis example relies on the data that can be downloaded from the command line using the following commands:\n         \n$ wget https://github.com/cibiobcg/EthSEQ_Data/raw/master/BAM/HGDP00228.sub_GRCh38.bam\n$ wget https://github.com/cibiobcg/EthSEQ_Data/raw/master/ModelPositions.vcf\nThe output of the analysis is written to the out folder. In this example, ASEQ produces the file HGDP00228.sub_GRCh38.genotype.vcf, containing the genotype calls for all SNPs position listed in the ModelPositions.vcf file. Having obtained a VCF file for each target individual of interest, the user can either run Basic Protocol 1[href=https://currentprotocols.onlinelibrary.wiley.com/doi/10.1002/cpz1.663#cpz1663-prot-0001], c steps, moving the files into the expected EthSEQ folder (see Guidelines for Understanding Results for details), or aggregate all VCF files into a single VCF file and run Basic Protocol 1[href=https://currentprotocols.onlinelibrary.wiley.com/doi/10.1002/cpz1.663#cpz1663-prot-0001], a steps, Alternate Protocol and Basic Protocol 2[href=https://currentprotocols.onlinelibrary.wiley.com/doi/10.1002/cpz1.663#cpz1663-prot-0003]."
  ],
  "subjectAreas": [
    "Bioinformatics"
  ],
  "bigAreas": [
    "Bioinformatics & Computational Biology"
  ]
}