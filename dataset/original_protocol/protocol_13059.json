{
  "id": 16209,
  "origin_website": "Jove",
  "title": "A Robust Single-Particle Cryo-Electron Microscopy (cryo-EM) Processing Workflow with cryoSPARC, RELION, and Scipion",
  "procedures": [
    "1. Creating a new cryoSPARC v3 project and importing data\nNOTE: Data was acquired at Oregon Health and Science University (OHSU) in Portland using a 300 kV Titan Krios electron microscope equipped with a Falcon 3 direct electron detector. Images were collected in a counting mode with a total dose of 28.38 e−/Å2 fractioned across 129 frames, and a defocus range from -0.5 µm to -2.5 µm, at a pixel size of 1.045 Å using EPU. The sample of AAV-DJ was provided by the staff of OHSU.\nOpen cryoSPARC v3 in a web browser and click the Projects header. Select + Add to create a new project. Title the project accordingly and provide a path to an existing directory where jobs and data will be saved.\nCreate a workspace for the project by opening the project, clicking + Add, and selecting New Workspace. Title the workspace and click on Create.\nNavigate to the new workspace and open the Job Builder on the right panel. This tab displays all functions available in cryoSPARC v3. Click on Import Movies and provide the movies path, gain reference file path, and set acquisition parameters as follows: Raw Pixel Size 1.045 Å, Accelerating Voltage 300 kV, Spherical Aberration 2.7 mm, Total Exposure Dose 28.38 e-/Å^2.\nClick on Queue, select a lane to run the job and a workspace, and click on Create.\n\tNOTE: The acquisition parameters are sample and microscope dependent.\n2. CryoSPARC v3 - movie alignment and CTF estimation\nOpen Patch Motion Correction (Multi). This job requires the movies imported in step 1.3 as input. Open the import movies job card in the workspace and drag the Imported_movies output to the movies placeholder on the new job. Queue the job.",
    "NOTE: For more information about the cryoSPARC methods outlined in this article, see the cryoSPARC tutorial16.\nTo perform CTF estimation, open Patch CTF Estimation (Multi). Input the micrographs generated in step 2.1 and Queue the job.\nTo inspect the averaged and CTF-corrected micrographs and select a subset for further processing, open Curate Exposures and input the exposures obtained in step 2.2. Queue the job.\nAfter the job enters Waiting mode, click on the Interaction tab on the job card, adjust parameter thresholds, and accept or reject individual micrographs for further processing. Accept micrographs with well-matched estimated and experimental CTFs (Figure 2) and discard those with high astigmatism, poor CTF fit, and thick ice.\nWhile processing the current data, set the upper threshold of Astigmatism to 400 Å, CTF fit resolution to 5 Å, and relative ice thickness to 2. Click on Done to select the micrographs for downstream processing.\n3. CryoSPARC v3 - manual and template-based particle picking\nOpen Manual Picker, input the accepted exposures from steps 2.4-2.5, and Queue the job. Click on the Interactive tab, set the Box Size (px) to 300, and click on a few hundred particles across multiple micrographs and avoid selecting overlapping particles. Here, 340 particles across 29 micrographs were selected. When finished, click on Done Picking! Extract Particles.\n\tNOTE: This protocol uses manual particle picking to generate templates for automatic selection. However, other methods are also available17.\nTo generate templates for automated particle picking, click on 2D Classification and input the particle picks generated in step 3.1. Change the number of 2D Classes to 10 and Queue the job.\nOpen Select 2D classes. Input the particles and class averages obtained in step 3.2 and click on the Interactive tab. Select representative 2D classes with good SNR and click on Done.",
    "NOTE: The class averages reflect different particle views. Select class averages that reflect each view. The goal is to produce well-defined templates representing different views of the specimen for automated picking.\nOpen Template Picker and input the 2D classes selected in step 3.3 and micrographs from steps 2.4-2.5. Set the Particle Diameter (Å) to 220 Å and Queue the job.\nTo inspect the automated picks, open Select Particle Picks, input the particles and micrographs generated in step 3.4, and Queue the job.\nOn the Select Particle Picks job card, click on the Interactive tab and set the Box size (px) to 300. Click on an individual micrograph, adjust the lowpass filter until particles are clearly visible, and set the Normalized Cross Correlation (NCC) Threshold to 0.41 and Power Threshold between 54000 and 227300 .\nInspect several micrographs and, if needed, adjust thresholds such that most particles are selected without including false positives. When finished, click Done Picking! Extract Particles.\n\tNOTE: True particles typically have a high NCC and power score, indicating they are similar to the template and have a high SNR, respectively.\nOpen Extract from Micrographs and input the micrographs and particles from step 3.7. Set the Extracted Box Size (px) to 300 and Queue the job.\n4. CryoSPARC v3 - 2D classification\nClick on 2D Classification and input the extracted particles from step 3.8. Set the Number of 2D classes to 50 and Queue the job.\nTo select the best 2D classes for further processing, open Select 2D classes. Input the particles and class averages obtained in step 4.1. Click on the Interactive tab and choose 2D classes based upon the resolution and the number of particles in the class (Figure 3). Do not select classes containing artifacts. After selecting, click on Done.",
    "NOTE: Usually, multiple rounds of 2D classification are required to remove particles, which do not converge into distinct, well-defined classes. Run as many rounds of 2D classification as needed to remove such particles from the data set (Figure 3).\n5. CryoSPARC v3 - ab-initio reconstruction and homogeneous refinement\nTo generate an initial 3D volume, open Ab-initio Reconstruction and input the particles obtained in step 4.2 or from the final 2D classification. Adjust Symmetry to icosahedral. Queue the job.\n\tNOTE: Symmetry is sample-dependent and should be changed accordingly. If unknown, use C1 symmetry.\nOpen Homogeneous Refinement. Input the volume from step 5.1 and particles from 4.2 or the final 2D classification. Change the Symmetry and Queue the job. When the job is finished, inspect the Fourier Shell Correlation (FSC) curve and download the volume to examine in UCSF Chimera18.\n6. Exporting particle coordinates from cryoSPARC v3 and importing them to RELION-3 using PyEM\nNOTE: Particle coordinates carry information about the location of individual particles in each micrograph. Transfer of coordinates instead of particle stacks to RELION-3 allows for running refinement steps which otherwise would not be available. For example, particle polishing requires access to initial movie frames. Hence, prior to exporting particle coordinates from cryoSPARC v3 to RELION-3, import movies and perform motion correction and CTF estimation in RELION-3. See the RELION-3 tutorial19 for details.\nNavigate to the RELION-3 project directory and launch RELION-3.\nOpen Import from the job-type browser and specify the path to the movies and acquisition parameters as in step 1.3.\nTo perform motion correction, use UCSF MotionCor220 through the RELION-3 GUI, open Motion Correction and set the default parameters as in the UCSF MotionCor2 manual21. Input the path to the movies imported in step 6.2. On the Motion tab, specify the path to motioncor2 executable.",
    "NOTE: MotionCor2 can be run in parallel using multiple GPUs.\nPerform CTF estimation using CTFFIND-4.122 through the RELION-3 GUI. Open CTF Estimation and input the micrographs.star generated in step 6.3. On the CTFFIND-4.1 tab, specify the path to CTFFIND-4.1 executable and set parameters as in the RELION-3.1 tutorial19.\nIn order to import particle stacks from cryoSPARC v3 to RELION-3, they first must be exported from cryoSPARC v3. In cryoSPARC v3, open the job card of the Select 2D class job from step 4.2 or the final 2D classification. On the Details tab, click on Export Job. Export job outputs the particles_exported.cs file.\nPrior to importing particle coordinates from cryoSPARC v3 to RELION-3, the particles_exported.cs file from step 6.5 must be converted to .star format. Using PyEM23, convert the particles_exported.cs file to .star format by executing the following command: csparc2star.py particles_exported.cs particles_exported.star\nIn RELION-3, click on the Manual Picking tab and on the I/O tab, input the micrographs from CTF refinement described in step 6.4. On the Display tab, input the following parameters: Particle diameter (A): 220, Lowpass Filter (A): -1 , Scale for CTF image: 0.5. Run the job. A directory called ManualPick is generated in the RELION-3 home folder.\n\tNOTE: This step is performed to create a manual picking folder structure in RELION-3. While running manual picking, a single .star file containing coordinates of picked particles is created for each averaged micrograph used for picking in the RELION-3 GUI.\nNavigate to the folder containing the particles_exported.star file from step 6.6 and run a home-written script producing a single manualpick.star file for each averaged micrograph used for picking of cryo-SPARC v3 particles, which contributed to the final 2D classification exported in step 6.5. The resultant coordinate files are saved in the ManualPick/Movies folder.",
    "Return to RELION-3 and re-open the Manual Picking job. Click on Continue. This will display particles previously picked in cryoSPARC v3 in the RELION-3 GUI. Inspect a few micrographs to verify if the transfer of particle coordinates has been accomplished and if particles are properly selected.\n7. RELION-3 - Particle extraction and 2D classification\nClick on Particle Extraction. On the I/O tab, input the CTF corrected micrographs from step 6.4 and coordinates from step 6.9. Click on the Extract tab and change the Particle Box Size (pix) to 300. Run the job.\nPerform 2D classification to further clean the particle set generated in cryoSPARC v3 to achieve a higher-resolution reconstruction. Click on 2D Classification and on the I/O tab, input the particles.star file generated in step 7.1. On the Optimisation tab, set the Number of Classes to 50 and Mask Diameter (A) to 280. Run the job.\n\tNOTE: The mask should encompass the entire particle.\nTo choose the best 2D classes, click on the Subset Selection method, input the _model.star file from step 7.2, and Run the job. Select classes as described in step 4.2.\nRepeat steps 7.2 and 7.3 to remove non-converging particles.\n8. RELION-3 - 3D refinement, mask creation, and post-processing\nUse the map generated in cryoSPARC v3 (step 5.2) as an initial model for 3D refinement in RELION-3. Select the Import method and set the following parameters on the I/O tab: Import Raw Movies/Micrographs: No, Raw Input Files: Movies/*.mrc.\nSupply the MTF file and input the movie acquisition parameters as described in step 1.3. On the Others tab, select the cryoSPARC v3 map as the input file, change Node Type to 3D reference (.mrc), and Run the job.",
    "Select 3D Auto-Refine and on the I/O tab, set Input Images as the particles.star file from step 7.3 or the last selection job. Give the cryoSPARC v3 reconstruction as the Reference Map. Click on the Reference tab and change Initial Low-Pass filter (Å) to 50 and Symmetry to icosahedral. On the Optimisation tab, change the Mask Diameter (Å) to 280 and Run the job.\nAfter the run is finished, open run_class001.mrc in UCSF Chimera.\nIn UCSF Chimera, click on Tools and under Volume Data, select Volume Viewer. This will open a new window to adjust volume settings. Change the Step to 1 and adjust the slider until reaching the level value where the map has no noise. Record this value, as it will be used for mask creation in the next step.\nThe map produced from auto-refinement does not reflect the true FSC, as noise from the surrounding solvent lowers the resolution. Before post-processing, create a mask to distinguish the specimen from the solvent region.\n\t\nClick on Mask Creation and input run_class001.mrc from step 8.3.\nClick on the Mask tab and adjust parameters as follows: Lowpass Filter Map (Å): 10, Pixel Size (Å): 1.045, Initial Binarization Threshold: the level value obtained in step 8.5, Extend Binary Map this many Pixels: 3, and Add a Soft-Edge of this many Pixels: 3. Run the job.\nExamine the mask in UCSF Chimera. If the mask is too tight, increase Extend Binary Map this many Pixels and/or Add a Soft-Edge of this many Pixels. It is important to create a mask with soft edges, as a sharp mask may lead to overfitting.",
    "Click on Post-Processing and on the I/O tab, input the half-maps created in step 8.3 and mask from 8.6. Set Calibrated Pixel Size to 1.045 Å. On the Sharpen tab, input the following: Estimate B-Factor Automatically?: Yes, Lowest Resolution for Auto-B Fit (A): 10, Use Your Own B-Factor?: No. On the Filter tab, set Skip Fsc-Weighting? to No. Run the job.\n9. RELION-3 - Polishing training and particle polishing\nBefore correcting for per-particle beam-induced motion, first use the training mode to identify optimal motion tracks for the data set. Open Bayesian Polishing and on the I/O tab, input the motion-corrected micrographs from step 6.3, particles from step 8.3, and postprocess .star file from step 8.8. Click the Training tab and set the following parameters: Train Optimal Parameters: Yes, Fraction of Fourier Pixels for Testing: 0.5, Use this many Particles: 5000. Run the job.\n\tNOTE: This script will produce opt_params_all_groups.txt file in the RELION-3 Polish folder containing optimized polishing parameters required for executing the following step.\nOnce the training job has finished, click on Bayesian Polishing. Click on the Training tab and set Train Optimal Parameters? to No. Select the Polish tab and in Optimised Parameter File specify the path to the opt_params_all_groups.txt file from step 9.1. Click on Run.\nRepeat 3D refinement (step 8.3) and post-processing (step 8.8) with a set of polished particles.\n10. RELION-3 - CTF and per-particle refinements\nTo estimate higher order aberrations, open CTF Refinement and, on the I/O tab under Particles, select the path to the .star file containing polished particles from the recent Refine 3D job (run_data.star).\n\t\nUnder Postprocess Star File, set the path to the output from the latest post-processing job (step 9.3).",
    "Select the Fit tab and set the following parameters: Estimate (Anisotropic Magnification): No, Perform CTF Parameter Fitting? No, Estimate Beamtilt: Yes, Also Estimate Trefoil? Yes, Estimate 4th Order Abberations? Yes. Run the job.\nRepeat step 10.1 using as input Particles (from Refine3D) generated in the previous job (particles_ctf_refine.star). On the Fit tab, change Estimate (Anisotropic Magnification) to Yes and Run the job.\nRepeat step 10.2 using as input Particles (from Refine3D) produced in the previous job (particles_ctf_refine.star). On the Fit tab, set the following parameters: Estimate (Anisotropic Magnification): No, Perform CTF Parameter Fitting?: Yes, Fit Defocus?: Per-particle, Fit Astigmatism? Per-micrograph, Fit B-factor?: No, Fit Phase-Shift: No, Estimate Beamtilt?: No, Estimate 4th Order Aberrations?: No. Run it.\n\tNOTE: Given the particle has sufficient contrast, the Fit Astigmatism? tab can be set to Per-particle. For this dataset, Per-Particle astigmatism refinement did not improve the quality and resolution of the map.\nRepeat 3D refinement with the particles from step 10.3 and on the I/O tab, set Use Solvent-Flattened FSCs? to yes. When finished running, execute a post-processing job (step 8.8) and examine the map in UCSF Chimera (step 5.2).\n11. Transferring RELION-3 particle coordinates and 3D map to Scipion 3\nTo further refine and validate the RELION-3 map, first import the volume and particles from the last post-processing job (step 10.4) to Scipion 3. Launch Scipion 3 and create a new project.\nOn the left Protocols panel, select the Imports drop-down and click on Import Particles. Change the following parameters: Import From: RELION-3, Star File: postprocess.star, and specify acquisition parameters as in step 1.3. Click on Execute.\nClick on the Imports drop-down and select Import Volumes. Under Import From give the path to the RELION-3 map. Change Pixel Size (Sampling Rate) Å/px to 1.045 and Execute.",
    "12. Scipion 3 - High - resolution refinement\nFirst, perform a global alignment. Select the Refine drop-down on the Protocols panel and click on Xmipp3 - highres24. Input the imported particles and volumes from steps 11.2 and 11.3 as Full-Size Images and Initial Volumes, respectively and set the Symmetry Group to icosahedral. On the Image Alignment tab under Angular Assignment, choose Global and set the Max Target Resolution to 3 Å, and Run the job.\nWhen the job is finished, click on Analyze Results. In the new window, click on the UCSF Chimera icon to examine the refined volume. Additionally, click on Display Resolution Plots (FSC) to see how the FSC has changed after the refinement, as well as Plot Histogram with Angular Changes to see if the Euler angle assignments have changed.\n\tNOTE: Depending on the resolution of the input RELION-3 structure, this step may be repeated several times with different values set for the Max Target Resolution under the Angular Assignment tab. For more information see the Scipion tutorial25.\nRepeat step 12.1 with a local alignment. Copy the previous job and change Select Previous Run to Xmipp3 - highres Global. On the Angular Assignment tab, change Image Alignment to Local. Set the Max Target Resolution to 2.1 Å.\nExamine the refined map in UCSF Chimera and analyze the change in FSC and angular assignments (step 12.2). Repeat local refinement until resolution does not improve and the angular assignments have converged, adjusting Max Target Resolution as needed.\nThe output map from Scipion 3 can be additionally density-modified and sharpened in Phenix26.\n13. Scipion 3 - Map validation",
    "Examine the local resolution of the final map generated in Xmipp3 - highres. Open Xmipp - local MonoRes27 and input the final volume from the previous job and mask generated in step 8.6. Set Resolution Range from 1 to 6 Å with a 0.1 Å interval and Execute the job.\nWhen finished running, click on Analyze Results and examine the resolution histogram and volume slices colored by resolution.\nTo see if particles are well-aligned, open Multireference Alignability28 and input the particles and volume from step 12.3. Click on Analyze Results to display the validation plot. Ideally, all points should be clustered around (1.0,1.0).\nOpen Xmipp3 - Validate Overfitting. Input the particles and volumes from step 12.3. When finished running, analyze results and inspect the overfitting plot. Crossing of the aligned Gaussian noise and aligned particles curves indicates overfitting.\nSubscription Required. Please recommend JoVE to your librarian."
  ],
  "subjectAreas": [
    "Biochemistry"
  ],
  "bigAreas": [
    "Molecular Biology & Genetics"
  ]
}