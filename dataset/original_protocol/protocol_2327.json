{
  "id": 2452,
  "origin_website": "Cell",
  "title": "Protocol for the isolation of CD8+ tumor-infiltrating lymphocytes from human tumors and their characterization by single-cell immune profiling and multiome",
  "procedures": [
    "Step-by-step method details\nStep-by-step method details\nProcessing of ovarian tumor to single-cell suspensions\nTiming: ∼1 h\nPour fresh tumor sample into plastic petri dish previously pre-scoured with scalpels (Figure 1[href=https://www.wicell.org#fig1]).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/1935-Fig1.jpg\nFigure 1. Steps for the generation of single-cell suspension from tumor biopsies\nRepresentative photographs of the used materials. 1) Scoured petri dish to press the tumor. 2) Filter first through a 100 μm nylon cell strainer. 3) Add RBC lysis buffer for 5 min. 4) Filter after centrifugation through a 70 μm nylon cell strainer.5) Count the single cell suspension. 6) Freeze in Mr. Frostis.\nUse the plastic part of a plunger from a 10 mL syringe to gently press the minced tumor on the scoured petri dish, trying to be as careful as possible using the plastic part and not the rubber part of the plunger.\nFilter tumor mash through a 100 μm nylon cell strainer. Use plunger from the 1 mL syringe to press through.\nCritical: Pass media through strainer also to help mash through filter.\nCentrifuge sample at 500 × g at 4°C for 5 min and aspirate/pour off media to remove debris and dead cells.\nCritical: All media/material waste from sample is treated in at least 10% bleach.\nAdd 5–10 mL of RBC lysis buffer and resuspend the pellet. Incubate for 5 min with rotation at RT.\nCritical: Longer incubation times could significantly affect to the viability of the immune cells.\nAdd 10 mL R10 media to stop the RBC lysis reaction.\nCentrifuge sample at 500 × g at 4°C for 5 min and aspirate/pour off media to remove debris and dead cells.\nNext, fully re-suspend pellet in fresh R10 media and pass through a 70 μm strainer in a new 50 mL conical tube.",
    "Calculate the total viable cell number using trypan blue solution and the Neubauer chamber. Spin down sample at 500 × g at 4°C for 5 min while counting cells.\nRemove supernatant completely and re-suspend in freezing media.\nCritical: We recommend to resuspend the pellet at a density of maximum 5 × 106 cells/mL in freezing medium (from 5 × 105 to 10 × 106 per cryovial).\nStore samples in Mr. Frosty, remove from −80°C the next morning and transfer into LN2 tank.\nPrepare sample for FACs sorting prior to encapsulation\nTiming: ∼5 h\nWarm ∼5 mL of complete culture medium in a 37°C water bath.\nThaw one vial of ovarian tumor cells rapidly in a 37°C water bath with gentle agitation.\nImmediately upon thawing, remove from the water bath and wipe the outside of the vial with 70% ethanol.\nUnscrew the top of the vial slowly and, using 1 mL pipet, transfer the contents of the vial to a 15-mL conical centrifuge tube containing ∼5 mL of prewarmed medium.\nMix gently.\nRemove the freezing media.\nCentrifuge at 500 × g for 5 min, 4°C.\nCarefully aspirate the supernatant, and gently resuspend the cells in ∼5 mL of complete medium.\nFilter the single cell suspension through a 70 μm nylon cell strainer. Pass another 5 mL of media through the filter.\nWash the cells a second time.\nCentrifuge at 500 × g for 5 min, 4°C.\nCarefully aspirate the supernatant, and gently resuspend the cells in ∼5 mL of complete medium.\nFilter the single cell suspension through a 45 μm nylon cell strainer. Pass another 5 mL of media through the filter.\nCalculate the total cell number.\nCentrifuge at 500 × g for 5 min, 4°C.\nCarefully aspirate the supernatant, and gently resuspend the cells in ∼5 mL of complete medium.",
    "Count the total number of cells.\nCritical: Keep the cells on ice while counting.\nFill the tube with dead cell removal Kit buffer and centrifuge at 500 × g for 5 min, 4°C and resuspend the pellet at a density of at 1 × 108 cells/mL.\nFollow the instructions of the manufacturer: https://www.stemcell.com/products/easysep-dead-cell-removal-annexin-v-kit[href=https://www.stemcell.com/products/easysep-dead-cell-removal-annexin-v-kit].\nPipette the 2.5 mL of enriched cell suspension into a new 15 mL tube and fill up the tube with 10 mL of sorting buffer.\nCentrifuge and resuspend the pellet.\nTake an aliquot for counting and wash again with sorting buffer.\nResuspend the pellet at 1 × 106 cells in 100 μL of sorting buffer with Human TruStain FcX (5 μL/100 μL).\nCritical: Since the viability is very important, centrifuge always at 4°C and keep the sample on ice during waiting times, unless otherwise specified.\nIncubate 10 min at RT and add the antibodies for sorting: CD45, CD3, CD4, CD8, CD69 and CD103. Incubate for 1 h at 4°C in the dark.\nNote: Prepare a mix with antibodies in sorting buffer at 5:100, then add to the samples (1 × 106 cells in 100 μL) for final antibody dilution of 5:200.\nAfter 1 h of incubation, wash the cells with sorting buffer.\nResuspend the cells at approx. 5 × 106 cells/mL.\nFilter again through a 40 μm filter to avoid clumps and add DAPI at a final concentration 100 ng/mL.\nNote: We use BD FACS ARIA for sorting but another sorter like MACSQuant® Tyto® could be also.\nSetup the sorter. We use 20 psi with a 100 μm nozzle.\nSet the gates for singlets, viable, CD45+, CD3+ CD8+; CD69+CD103+ for TRM cells and CD69+/-CD103- for recirculating T cells (Figure 2[href=https://www.wicell.org#fig2]).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/1935-Fig2.jpg\nFigure 2. FACS sorting gating strategy for TRM CD8+ TILs and their re-circulating counterpart",
    "Dot plots show gates in a hirarchical order: P1 (SSC-A/FSC-A; lymphocytes according to size and granularity); P2 (FSC-H/FSC-A; singlets); P3 (DAPI/FSC-A; live cells); P4 (CD45/CD3; T cells); P5 (CD8/CD4; CD8+ T cells); P6 and P7 (CD103/CD69; TRM CD8+ TILs and re-circulating CD8+ T cells, respectively).\nCritical: Use 1.5 mL Eppendorf for recollection since the number of sorted cells is low. Use filtered FBS as a recollection buffer to increase cell viability of sorted cells. However, it is important to have everything ready that you need after sorting to proceed and not leave the cells on ice for long.\nNote: If number of cells is high, it is good to verify the cell purity using flow cytometry.\nPrepare cells for encapsulation and following steps of single-cell RNA-seq + VDJ profiling\nTiming: ∼10 min\nAfter sorting, fill up the Eppendorf tube with cells with 1 mL resuspension solution.\nCentrifuge 300 g for 5 min and resuspend the pellet to the concentration of 700–1,200 cells/uL.\nAdd 10 ul cell suspension to 10 ul AO/PI staining solution and visualize on Nexcelon cellometer Auto 2K. Repeat the cell count two more times for a total of 3 times if cell number permits. The viability should be at least >70%.\nAdjust the cell concentration with resuspension buffer if needed.\nCritical: If total cell number is less than required input cell number, centrifuge the cell suspension and remove the supernatant to make the final volume around 25 ul and use all for encapsulation.\nCritical: Do not exceed the number of cells allowed by 10× per encapsulation (10,000 cells). The doublets rate increase by 0.8% every 1,000 cells.\nFollow the cell suspension volume calculator table (Table 1[href=https://www.wicell.org#tbl1]) to load the cells onto the 10× Genomics Chromium Single Cell Controller.\ntable:files/protocols_protocol_1935_12.csv",
    "Follow the manufacturing recommendations: https://www.10xgenomics.com/support/single-cell-gene-expression/documentation/steps/library-prep/chromium-single-cell-3-reagent-kits-user-guide-v-3-1-chemistry[href=https://www.10xgenomics.com/support/single-cell-gene-expression/documentation/steps/library-prep/chromium-single-cell-3-reagent-kits-user-guide-v-3-1-chemistry]. Encapsulate the single cells, reagents, and 10× Genomics gel beads into individual nanoliter-sized Gelbeads in Emulsion (GEMs) and then perform reverse transcription of poly-adenylated mRNA inside each droplet.\nComplete the cDNA and VDJ-enriched libraries in a single bulk reaction using the 10× Genomics Chromium NextGEM Single Cell 5′ v 1.1 and V(D)J Reagent Kits.\nCritical: Run 1 μL library on the Agilent Bioanalyzer High Sensitive DNA chip to determine fragment size. Low molecular weight product (=<150 bp) and /or a high molecular weight product (> = 200 bp) may be present. This does not affect sequencing.\nCritical: Generate 50,000 or 5,000 sequencing reads per cell for scRNA-seq or VDJ libraries, respectively, on the Illumina NextSeq 500 or NextSeq 2000 instruments.\nPerform demultiplexing, barcode processing, alignment, and gene counting using the 10× Genomics CellRanger v6.1.2 software.\nPrepare cells for encapsulation and following steps of Multiome\nTiming: ∼3 days\nAfter sorting, prepare the cell suspension the same way as single cell RNAseq+VDJ protocol: use 100,000–1,000,000 cells for lysis.\nLyse the cells, and isolate and dilute nuclei in diluted nuclei buffer according to the manufacturer’s protocol: https://www.10xgenomics.com/support/single-cell-multiome-atac-plus-gene-expression/documentation/steps/sample-prep/chromium-nuclei-isolation-kit-sample-prep-user-guide[href=https://www.10xgenomics.com/support/single-cell-multiome-atac-plus-gene-expression/documentation/steps/sample-prep/chromium-nuclei-isolation-kit-sample-prep-user-guide].\nAdd 10 ul nuclei suspension to 10 ul AO/PI staining solution and visualize on Nexcelon cellometer Auto 2K. Repeat the nuclei count two more times for a total of 3 times if nuclei number permits.\nCritical: After lysis, the optimal viability should be 2%–10%. The cells are underlysed if viability >10%, overlysed if viability <2%.\nAdjust the nuclei concentration with Diluted Nuclei buffer following the table (Table 2[href=https://www.wicell.org#tbl2]) if needed:\ntable:files/protocols_protocol_1935_13.csv\nEncapsulate the nuclei, reagents, and 10× Genomics gel beads into individual nanoliter-sized Gelbeads in Emulsion (GEMs) and then perform reverse transcription of poly-adenylated mRNA and 10× barcode attachment of transposed DNA inside each droplet.",
    "Following pre-amplification, complete the cDNA and ATAC-seq libraries in a single bulk reaction using the 10× Genomics Chromium NextGEM Single Cell Multiome ATAC + Gene Expression Reagent Kit.\nGenerate 50,000 or 25,000 sequencing reads per cell for scRNA-seq or ATAC-seq libraries, respectively, on dedicated Illumina NextSeq 500 or NextSeq 2000 sequencing runs according to the vendor protocol: https://support.illumina.com/downloads/nextseq-500-user-guide-15046563.html[href=https://support.illumina.com/downloads/nextseq-500-user-guide-15046563.html] and https://support.illumina.com/downloads/nextseq-2000-sequencing-system-guide-1000000109376.html[href=https://support.illumina.com/downloads/nextseq-2000-sequencing-system-guide-1000000109376.html].\nPerform demultiplexing, barcode processing, alignment, and gene counting using the 10× Genomics CellRanger v6.1.2 software.\nIntegration of single-cell RNA-seq data from different samples\nTiming: 2 days\nThe sorted TRM and recirculating CD8+ T cells from different patients were encapsulated individually, which posed an unique challenge to the downstream analysis.\nIt is important to correct for the batch effects while maintaining the biological differences between TRM and recirculating CD8+ T cells within the same patient.\nBelow we provide a two-stage analytical plan for integrating sorted TRM and recirculating CD8+ T cells across patients using R package Seurat (Stuart et al., 2019[href=https://www.wicell.org#bib6]).\nCritical: For this analysis the filtered gene-barcodes matrices generated by CellRanger are required. These matrices are formatted either as filtered_feature_bc_matrix.h5 or a folder named as filtered_feature_bc_matrix.\nCritical: This script first merges data from TRM and recirculating CD8+ T cells within the same patient, and then integrates merged data across patients. This is based on the assumptions that all patients have similar level of heterogeneity in the merged TRM recirculating CD8+ T cells. It is advised to examine whether the assumption holds in data, before using this script.\nProcessing the individual single-cell RNA-seq data. For each sample:\nLoad the filtered gene-barcodes matrices generated by CellRanger to Seurat.\nRemove cells with less than 200 genes expressed or more than 10% UMIs originated from mitochondrial genes.\nRemove genes expressed in less than three cells.\n>install.packages(\"Seurat\")\n>library(Seurat)\n>P1_ReCir_h5 <- Read10X_h5(\"filtered_feature_bc_matrix.h5\")",
    ">P1_ReCir <- CreateSeuratObject(P1_ReCir_h5, min.cells = 3)\n>P1_ReCir$percent.mt <- PercentageFeatureSet(P1_ReCir, pattern = \"ˆMT-\")\n>P1_ReCir <- subset(P1_ReCir, subset = nFeature_RNA > 200 & percent.mt < 10\nRepeat above steps for all TRM and recirculating single-cell RNA-seq data.\nMerge TRM and recirculating data from the same patient.\n>P1 <- merge(P1_TRM, P1_ReCir, add.cell.ids = c(\"P1_TRM\", \"P1_ReCir\"), project = \"P1”)\n>P1 <- NormalizeData(P1)\n>P1 <- FindVariableFeatures(P1, selection.method = \"vst\", nfeatures = 5000)\nVgene <- VariableFeatures(P1)\nP1[[\"RNA\"]]@var.features <- Vgene[!grepl(\"ˆIG\",Vgene) & !grepl(\"ˆTR\",Vgene))]\nCritical: To avoid cell clustering by V(D)J transcripts, it is important to remove T cell receptor and immunoglobulin genes from variable gene list of each merged data.\nRepeat above step for all patients.\nIntegrate merged data across different patients.\n>anchors <- FindIntergrationAnchors(object.list = list(P1, P2, P3, P4), dims = 1:40, anchor.features = 8000)\n>integrated <- IntegrateData(anchorset = anchors, dims = 1:40)\nScale the integrated data and perform clustering analysis.\n>cc.genes <- readLines(con = “regev_lab_cell_cycle_genes.txt”)\n>integrated <- CellCycleScoring(object = integrated, s.features = cc.genes[1:43], g2m.features = cc.genes[44:97])\n>integrated <- ScaleData(object = integrated, vars.to.regress = c(\"percent.mt\",\"S.Score\", \"G2M.Score\"))\n>integrated <- RunPCA(integrated, verbose = FALSE, npcs = 50)\n>integrated <- RunUMAP(integrated, dims = 1:40, reduction = \"pca\",verbose = FALSE)\n>integrated <- FindNeighbors(object = integrated, dims = 1:40)\n>integrated <- FindClusters(object = integrated, reduction = \"pca\", resolution =1)\n>saveRDS(integrated, \"integrated.rds\")\nCritical: The FindClusters parameter resolution should be decided based on heterogeneity levels within user’s own datasets. For datasets of sorted CD8+ tumor resistant memory T cells, we recommend resolution ranges from 0.8 to 1.2. For more heterrogenious samples (for example, sorted tumor infiltrating T cells), larger resolution (1.5–2) might be used.\nIdentification of T cell trajectory\nTiming: 2 days\nThe following steps include the analysis of T cell differentiation trajectory: Recirculating→TRMstem → TRMeffector → TRMproliferative → TRMexhaustive. Please see https://github.com/xxy39/TRM_OV_sc[href=https://github.com/xxy39/TRM_OV_sc] (https://doi.org/10.5281/zendo.6828033) for the detailed scripts.",
    "Assign T cell differentiation states to clusters using markers derived from Anadon et al. (Anadon et al., 2022[href=https://www.wicell.org#bib2]), following script deposited at GitHub https://github.com/xxy39/TRM_OV_sc/blob/main/DiffPlot.R[href=https://github.com/xxy39/TRM_OV_sc/blob/main/DiffPlot.R].\nCalculate gene set activity scores for stemness, effector, proliferative, and exhaustive T cell differentiation states using R package AUCell (Aibar et al., 2017[href=https://www.wicell.org#bib1]). Marker genes for each differentiation states are shown in table (Table 3[href=https://www.wicell.org#tbl3]) below.\ntable:files/protocols_protocol_1935_14.csv\nGenerate a cluster-based dotplot for activity scores (Figure 3[href=https://www.wicell.org#fig3]A). Determine cell type of each cluster based on the average activity score and percentage of cells expressing the genes.\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/1935-Fig3.jpg\nFigure 3. Identify T cell differentiation trajectory from TRM and recirculating CD8+ T cells using single-cell RNA/TCR/ATAC-seq data\n(A) AUCell scores for T cell states stemness/effector/proliferative/exhaustive in clusters. Color of dot presents the average normalized expression from high (red) to low (blue). Size of dot represents the percentage of positive cells for each gene.\n(B) Stemness score versus Exhaustion score from all the clusters. Color represents the percentage of TRM cells within each cluster. Size represents number of cells of each cluster.\n(C) AUCell scores by 8 groups. Within each of groups “Stemlike”, “Effector”, “Proliferative”, and “Exhausted”, cells were separated based on cell types (TRM or recirculating).\n(D) Heatmap of Morisita-Horn similarity of the 5 major groups identified based on gene expression.\n(E) Example of clonotype with full trajectory. Cells are projected onto the UMAP generated from gene expression and cells of a particular clonotype are colored by their groups.\n(F) Gene activity of T cell differentiation states genes measured in ATAC assay of Multiome data. Color of dot presents the average normalized gene activity from high (red) to low (blue). Size of dot represents the percentage of positive cells for each gene.",
    "Plot the relationship between stemness and exhaustive scores for clusters (Figure 3[href=https://www.wicell.org#fig3]B). This step helps to exam major cell type (TRM or Recirculating) in each cluster. The proliferative and exhaustive clusters tend to have higher TRM %, while stemness clusters tend to have lower TRM %. In the example data shown in https://github.com/xxy39/TRM_OV_sc[href=https://github.com/xxy39/TRM_OV_sc], the proligerative and exhaustive clusters have TRM% > 60% while the stemness clusters have TRM% < 40%.\nAssign groups to cells based on cell type (TRM or Recirculating) and differentiation states (Figure 3[href=https://www.wicell.org#fig3]C).\nThe following steps include the analysis of T cell clonotypes, following script https://github.com/xxy39/TRM_OV_sc/blob/main/Clonotype.R[href=https://github.com/xxy39/TRM_OV_sc/blob/main/Clonotype.R].\nAdd V(D)J clonotypes identified by VDJ assay from the same cells to meta data of Seurat object integrated.\nMeasure between-group clonotype similarity by Morisita-Horn similarity index (Rempala and Seweryn, 2013[href=https://www.wicell.org#bib5]) using R package fossil (Vavrek, 2011[href=https://www.wicell.org#bib8]). This index compares overlap between clonotypes of any two groups and ranges from 0 (no overlap) and 1 (complete overlap). The similarity index can be visualized by heatmap (Figure 3[href=https://www.wicell.org#fig3]D).\nPlot trajectory of individual clonotypes onto UMAP projection generated by step 48 (Figure 3[href=https://www.wicell.org#fig3]E).\nValidate the T cell trajectory using ATAC assay in Multiome data. Refer the scripts at GitHub https://github.com/xxy39/TRM_OV_sc/blob/main/ATAC.plot.R[href=https://github.com/xxy39/TRM_OV_sc/blob/main/ATAC.plot.R].\nProcess the ATAC data generated from CellRanger-arc workflow using R package Signac (Stuart et al., 2021[href=https://www.wicell.org#bib7]). Merge TRM and recirculating cells from the same patient.\nCritical: For this analysis following files generated by CellRanger-arc are required: atac_fragments.tsv.gz, atac_fragments.tsv.gz.tbi, atac_peaks.bed, per_barcode_metrics.csv.\nRemove low-quality cells with total number of fragments in peaks < 3,000 or > 20,000, fraction of fragments in peaks < 15%, ratio of mononucleosomal to nucleosome-free fragments > 4, or transcriptional start site (TSS) enrichment score < 2.\nCritical: These filtering criteria are dataset specific. We recommend choosing the cutoff after careful examination of the data.",
    "Perform a latent semantic indexing (LSI) dimension reduction on the filtered cells.\nIntegrate merged data across patients and perform batch correction using RunHarmony() function implemented in R package harmony (Korsunsky et al., 2019[href=https://www.wicell.org#bib3]).\nCreate a gene activity matrix by counting reads mapped to gene body and promoter regions (extended 2 kb upstream from gene coordinates) using GeneActivity() function in Signac, and further log-normalize the matrix using NormalizeData() function in Seurat with default settings.\nAssign cells into major groups based on their grouping information obtained from Multiome GEX data following steps 42–48.\nVisualize the activity of T cell differentiation states markers in each group (Figure 3[href=https://www.wicell.org#fig3]F). This step is to further confirm the T cell trajectory using chromatin accessibility data."
  ],
  "subjectAreas": [
    "Rnaseq",
    "Sequence Analysis",
    "Gene Expression",
    "Bioinformatics",
    "Cell Isolation",
    "Flow Cytometry",
    "Clinical Protocol",
    "Sequencing",
    "Single Cell"
  ],
  "bigAreas": [
    "Molecular Biology & Genetics",
    "Bioinformatics & Computational Biology",
    "Bioengineering & Technology"
  ]
}