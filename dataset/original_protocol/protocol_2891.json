{
  "id": 3060,
  "origin_website": "Cell",
  "title": "Identification and analysis of the DNA content of small extracellular vesicles isolated from Leishmania parasites",
  "procedures": [
    "Step-by-step method details\nStep-by-step method details\nIn vitro production of EVs\nDay 1\nTiming: 6 h\nThis protocol describes the steps necessary to remove culture media from late-log phase parasites to prevent contamination with FBS vesicles and to increase the release of Leishmania vesicles.\nCritical: Steps 1–4 are important to remove FBS from the culture medium, as it contains bovine EVs that can contaminate the isolated Leishmania vesicles.\nOnce the cultures reach late-log phase, transfer 50 mL of culture to ten 50 mL centrifuge tubes and centrifuge at 1000 × g for 5 min.\nRemove the supernatants and add an additional 50 mL culture to each centrifuge tube. Centrifuge the tubes again at 1000 × g for 5 min to concentrate the parasites.\nRemove the supernatants and fill each tube with 50 mL 1× PBS and resuspend the pellet by pipetting. Centrifuge the tubes at 1000 × g for 5 min to wash parasites.\nRepeat step 3.\nResuspend the concentrated parasites in 10 mL of RPMI-1640 medium (without FBS and phenol red) at a final concentration of 108 parasites/mL and transfer the content of each tube to a single non-ventilated 25 cm2 culture flask for each tube.\nIncubate the concentrated parasites for 4 h at 37°C with low agitation speed (40 rpm or less using an orbital shaker) to maximize the release of small EVs into the media.\nEvaluate the viability of the parasites using propidium iodide (PI). Collect 200 μL of parasites before and after the 4 h incubation.\nAdd PI at a final concentration of 50 μg/mL and pass the cells through a flow cytometer.\nCritical: Only preparations with cell viability >90% (i.e., <10% of parasites are stained with PI) should be used for EVs isolation.",
    "Note: The PI, a cell-impermeable DNA binding dye, is used to differentiate viable from dead cells. The entry of the dye into the cell is associated with cell death because cell-membrane integrity is disrupted.\nAfter 4 h of incubation, centrifuge the samples at 1000 × g at 21°C for 5 min to eliminate the parasites.\nTransfer the supernatant to new 50 mL centrifuge tubes.\nCentrifuge the samples a second time at 1000 × g to remove remaining debris.\nRecover and filter the supernatant using a 20 mL syringe and a 0.45 μm filter.\nRepeat the filtering using a 0.22 μm syringe filter and a new 20 mL syringe.\nPause point: At this step, EV-containing samples can be stored at 4°C for ultracentrifugation the next day.\nSmall EV purification by ultracentrifugation\nDay 2\nTiming: 3 h\nThis section of protocol details the process of isolating small EVs using differential centrifugation.\nDistribute the filtered supernatant into 6 ultracentrifuge tubes.\nFill the tubes with ice-cold exosome buffer, leaving about 1–2 cm of empty space.\nNote: Polypropylene thin-wall open centrifuge tubes with a volume of 17 mL and dimensions of 16 × 102 mm are used in this protocol.\nBalance the tubes in pairs using an electronic scale, ensuring that tubes directly opposite of each other are balanced (within 0.01 g).\nCentrifuge the tubes at 4°C for 1 h at 100,000 × g using a SW 32 Ti Swinging-Bucket Rotor (Beckman Coulter, USA) in the Beckman Coulter Optima L-100 XP ultracentrifuge.\nNote: The faintly visible yellowish pellet will be found at the very bottom of the tube, so no extra labelling is required for this step.\nCarefully remove the supernatants using a pipette gun with 5 mL serological pipettes without disturbing the pellet, leaving about 200–300 μL of buffer in each tube.",
    "Note: This will take 3 rounds of pipetting.\nUsing a P200 pipette with filter tips, gently resuspend the EV pellet in the remaining 200–300 μL and pool the remaining volumes into one single tube.\nFill the tube with exosome buffer, leaving about 1–2 cm of empty space, and balance it using a tube filled with exosome buffer.\nCentrifuge the tubes for an additional 1 h at 100,000 × g and 4°C.\nCarefully remove the supernatant, leaving the small EVs in a single pellet in about 200–300 μL of exosome buffer.\nUsing a P200 pipette with low retention filter tips, resuspend the small EV pellet in the remaining 200–300 μL exosome buffer\nNote: This should yield a concentration of 200–300 μg/mL of total protein.\nIn low-binding microtubes, save 10 μL for protein quantification using the MicroBCA assay kit, 10 μL for nanoparticle tracking analysis (NTA), and 10 μL for transmission electron microscopy (TEM).\nAliquot 100 μL of the remaining volume per microtube and freeze EVs at -80°C until needed.\nPause point: EVs are conserved in aliquots in exosome buffer at -80°C for subsequent experiments.\nEVs purity assessment\nNext, the small EV samples will be assessed for purity and size using protein quantification and nanoparticle tracking analysis.\nPerform the quantification of protein contained in the EV samples in duplicate.\nSlowly thaw on ice the 10 μL EV aliquots reserved for protein quantification.\nDilute each aliquot by a factor of 1:20 using ultrapure water to facilitate EV lysis and protein release.\nQuantify the EV protein using MicroBCA™ Protein assay kit (Thermo Scientific), following the manufacturer’s instructions[href=https://www.thermofisher.com/order/catalog/product/23235].\nNote: Other quantification methods could be used at this step: Qubit Protein assay and Qubit Protein BR assay. However, these are less-sensitive methods and required larger volumes of sample to quantify.",
    "The size and concentration of the purified EV samples must be measured using a ZetaView (Particle Metrix) Nanoparticle Tracking analysis Instrument (NTA) or an equivalent instrument.\nFor video acquisition, set the shutter frame rate to 45 and the sensitivity of 85, according to the system’s software guidance algorithms.\nBefore performing the sample measurements, verify the accuracy of the ZetaView using 100 nm standard beads.\nSlowly thaw on ice the 10 μL EV aliquots reserved for NTA.\nCritical: To achieve a particle count in the range of 1,000–2,000, it is recommended to dilute the samples in 0.22 μm filtered exosome buffer with a dilution factor of 1:1,000–1:10,000.\nRun each sample at 25°C to measure particle size and concentration.\nNote: Other NTA instruments can be used at this step with similar outcomes, such as the NanoSight NS300 (Malvern Panalytical), or others.\nNote: This protocol has been optimized to recover small EVs (under 200 nm). Purifications using this protocol will yield a population of small EVs with a median situated under the 200 nm threshold. It is strongly recommended that the EV diameter distribution of a population be reported (examples in Figure 1[href=https://www.wicell.org#fig1]), rather than summarized as a single metric.\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2603-Fig1.jpg\nFigure 1. Examples of the estimated particle size distribution (in nanometers) of a sample of Leishmania infantum EVs isolated by ultracentrifugation, using a Nanoparticle tracking analyzer (NTA)\nThis distribution provides valuable information about the characteristics of the EVs in the sample.\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2603-Fig2.jpg\nFigure 2. Example of how the glutaraldehyde fixative, water, and uranyl acetate stain are set up as a sequence of drops on a clean parafilm sheet\nThis sequence of drops should be set up for each sample being negative stained.",
    "Critical: To ensure high purity in small EV preparations, the ratio of particles to micrograms of protein must be equal to or greater than 1010. Preparations with a ratio between 109 and 1010 are considered to have low purity, and those below 109 are considered impure (Troubleshooting 2[href=https://www.wicell.org#troubleshooting]).\nCritical: Before any downstream use of the frozen EV aliquots, slowly thaw them on ice and avoid refreezing.\nEVs visualization by TEM\nTiming: 1–3 h\nThe following protocol outlines the steps for preparing EV samples for visualization by electron microscopy using negative staining from either freshly isolated or thawed EVs. Each sample should take about 10 min to process and be allowed to dry for at least 30 min.\nUsing a pipette, add side-by-side onto a clean piece of parafilm, in the following order (Figure 2[href=https://www.wicell.org#fig2]):\n1 drop (10 μL) of 2.5% glutaraldehyde\n3 drops of distilled water\n1 drop of 1% uranyl acetate\nUsing precision tweezers, gently pick up a 200 mesh Cu TEM grid with carbon support (Agar Scientific).\nCritical: The grid should be glow discharged before use to clean the grid and enhance sample binding (Pelco easiGlow Glow Discharge Cleaning System).\nUsing a micropipette, add 5 μL of the EV sample to the carbon side of the grid (black side) and let sit for 1 min.\nNote: If EV-protein concentration is within the expected range (200–300 μg/mL), no further dilutions are required at this step.\nDry excess sample by touching the side of the grid to a filter paper or Kimwipe.\nPlace the grid carbon-side down on the glutaraldehyde droplet for 1 min to fix the sample.\nWash the grid by placing it carbon-side down on the first water droplet for 1 min. Repeat for each water droplet to wash the grid a total of three times.",
    "Place the grid, carbon-side down, on the uranyl acetate droplet for 1 min to stain the sample.\nCritical: The timing of this step is very important to avoid under- or over-staining the sample (Troubleshooting 3[href=https://www.wicell.org#troubleshooting]).\nDry the excess uranyl acetate by touching the side of the grid to a filter paper or Kimwipe.\nAllow the grid to air dry for 30 min on its grid holder\nNote: Alternatively, the grid can be stored in a Petri dish on filter paper.\nView the grid using a FEI Tecnai G2 Spirit Twin 120 kV Cryo-TEM with the beam set to 120kV accelerating voltage and take images using the Gatan Ultrascan 4000 4k × 4k CCD Camera System Model 895.\nNote: 30,000× magnification should be used to image fine EV structure and 9,300x magnification can be used to demonstrate EV concentration. Convert the proprietary Digital Micrograph 16-bit images (DM3) to unsigned 8-bit TIFF images (Troubleshooting 4[href=https://www.wicell.org#troubleshooting]).\nNote: If NTA shows the expected EV profile, TEM grids should easily yield high quality pictures of EVs mostly in the expected size range of 80–220 nm (Figure 3[href=https://www.wicell.org#fig3]). EVs should be spherical and often have a cup shape due to sample drying during preparation (Troubleshooting 5[href=https://www.wicell.org#troubleshooting]).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2603-Fig3.jpg\nFigure 3. EVs collected from Leishmania infantum after a 37°C temperature shock, at 30,000x (left panel) and 9,300x magnification (center and right panels)\nThe samples were negatively stained with uranyl acetate and viewed using the FEI Tecnai G2 Spirit Twin 120 kV Cryo-TEM. Images were captured using the Gatan Ultrascan 4000 4k × 4k CCD Camera System Model 895.\nTotal DNA extraction from purified small EVs\nTiming: 60 min",
    "Once the quality of EVs has been confirmed, an aliquot of the EV sample is used to extract the DNA. A minimum of 100 μg of EVs is recommended to recover enough EV DNA.\nTo extract EV-associated DNA, use the DNeasy Blood and Tissue Kit (QIAGEN, USA) from one aliquot of purified EVs, following the manufacturer’s instructions[href=https://www.qiagen.com/us/products/discovery-and-translational-research/dna-rna-purification/dna-purification/genomic-dna/dneasy-blood-and-tissue-kit/]. Elute the columns with 100 μL of elution buffer.\nNote: Other low-input DNA purification columns could be used or classical protocols for DNA extraction with the addition of 20 μg of glycogen as carrier.\nOptional: Prior to purifying the DNA, purified EVs can be treated with TURBO DNase (Thermo Fisher Scientific, USA) for 30 min to degrade DNA outside the vesicles.\nOptional: If needed, further concentrate the DNA using a SpeedVac Concentrator with low-binding tubes.\nThe expected DNA yield will vary depending on the amount of input EVs, but the concentration can be below the detection limit of most spectrophotometers (See troubleshooting[href=https://www.wicell.org#troubleshooting] section for more details).\nNote: To measure the DNA concentration, a fluorometric approach is recommended. The purified DNA can be quantified using the Quant-iT PicoGreen dsDNA Assay Kit (P7589, Thermo Fisher Scientific, USA) in a Take 3 platform (BioTek, USA), or other instruments (Troubleshooting 6[href=https://www.wicell.org#troubleshooting]).\nPause point: The DNA can be stored at -20°C until it is ready to be used for next-generation sequencing library preparation.\nLibrary preparation and sequencing\nTiming: 3–4 h\nThe recovered EVs DNA has a low concentration and has a fragment size suitable for direct library preparation; no additional shearing is required. Therefore, we use a low input library preparation method, as we do for chromatin immunoprecipitations.\nConstruct the EV DNA libraries using the KAPA HyperPrep kit (Roche) following the manufacturer’s protocol[href=https://sequencing.roche.com/global/en/products/group/kapa-hyperprep-kits.html] without fragmentation.",
    "Note: The number of PCR cycles for library amplification is determined by qPCR and typically ranges between 10-15 cycles, depending on the amount of input DNA (see KAPA HyperPrep kit troubleshooting[href=https://www.wicell.org#troubleshooting] document for extended information).\nTo confirm the fragment size distribution of the library, an aliquot of each library is run on a Bioanalyzer High Sensitivity DNA Assay chip (Agilent) following manufacturer’s guidelines[href=https://www.agilent.com/cs/library/usermanuals/Public/G2938-90321_SensitivityDNA_KG_EN.pdf].\nNote: The DNA fragment size obtained from EVs should mostly range from 200-500 bp (Figure 4[href=https://www.wicell.org#fig4]).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2603-Fig4.jpg\nFigure 4. Example of a Bioanalyzer fragment size profile for a Leishmania infantum EV-DNA library prepared using the KAPA HyperPrep kit\nNote: Fragment-size distribution could be also assessed using the TapeStation (Agilent) or Experion (Bio-Rad) systems.\nThe EV DNA libraries are sent for sequencing using an Illumina sequencer of your choice and sequenced in paired-end (PE) 50 or 100 bp aiming for a theorical genome coverage of 30X.\nNote: In this study, a NovaSeq 6000 in PE 50 bp was used and an average of 29-fold and 32-fold genome coverage was obtained for the EV-DNA samples from the wildtype (WT) and the antimony (Sb)-resistant mutant, respectively.\nNote: In this study, whole-genome DNA sequencing (WGS) libraries were also generated to compare the background copy number variations found in the parasites themselves. The libraries are prepared from genomic DNA with the PCR-free Lucigen NxSeq library kit. The average library fragment size distribution is between 500 and 2,500 bp. The WGS libraries are sequenced on an Illumina NovaSeq 6000 in a PE 100 bp configuration. A minimum of 25-fold genome coverage is recommended.\nSequencing analysis",
    "Timing: Since this is a bioinformatics pipeline (Figure 5[href=https://www.wicell.org#fig5]), the executed steps can be saved and paused at any time. The time required to run each step will depend on the size of the dataset. Detailed information about each tool used in the pipeline can be found in Douanne et al. 2022.1[href=https://www.wicell.org#bib1]\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2603-Fig5.jpg\nFigure 5. Flowchart explaining the sequence analysis and the copy number variation analysis pipeline using Illumina reads\nThe green boxes refer to the files and the blue boxes refer to the tools used in the pipeline. The names of the tools are italicized to distinguish from the files. “n” represents the number of samples where the steps in the gray box will be iterated n times.\nWhen obtaining the raw sequence files in FASTQ format, assess the sequencing quality using FastQC.8[href=https://www.wicell.org#bib8] After installing FastQC, it can be run in an interactive or a non-interactive mode. To run it, a list of FASTQ files to process needs to be provided on the command line. For example:\n>module load fastqc\n>fastqc somefile.fastq.gz someotherfile.fastq.gz\nNote: The program will generate a HTML report for each file as an output. The report contains summary graphs and tables to evaluate the quality of the data. Example reports with explanations are available here[href=https://www.bioinformatics.babraham.ac.uk/projects/fastqc/].\nAfter analyzing the FastQC reports for each sample, trim the sequencing adapters and low-quality bases using Trimmomatic.14[href=https://www.wicell.org#bib14]\nNote: The trimming parameters may need to be adjusted depending on the library type (i.e., EV-DNA vs. WGS) and quality.\nFor EVs, the following command and parameters were used.\n>module load trimmomatic/0.36\n>java -jar $EBROOTTRIMMOMATIC/trimmomatic-0.36.jar PE ∖\n  somefile_R1.fastq.gz ∖\n  somefile_R2.fastq.gz ∖\n  somefile_R1_Paired.fastq.gz ∖\n  somefile_R1_Unpaired.fastq.gz ∖\n  somefile_R2_Paired.fastq.gz ∖\n  somefile_R2_Unpaired.fastq.gz ∖\n  ILLUMINACLIP:TruSeq3-PE.fa:2:30:10 ∖\n  LEADING:3 ∖\n  TRAILING:3 ∖\n  SLIDINGWINDOW:4:20 ∖\n  MINLEN:36\nFor the WGS libraries, the following command and parameters were used.\n>module load trimmomatic/0.36",
    ">java -jar $EBROOTTRIMMOMATIC/trimmomatic-0.36.jar PE ∖\n  somefile_R1.fastq.gz ∖\n  somefile_R2.fastq.gz ∖\n  somefile_R1_Paired.fastq.gz ∖\n  somefile_R1_Unpaired.fastq.gz ∖\n  somefile_R2_Paired.fastq.gz ∖\n  somefile_R2_Unpaired.fastq.gz ∖\n  ILLUMINACLIP:TruSeq3-PE.fa:2:30:10 ∖\n  LEADING:3 ∖\n  TRAILING:3 ∖\n  SLIDINGWINDOW:4:15 ∖\n  MINLEN:80\nThese commands will perform the following tasks.\nFirst, it will remove the Illumina adapters provided in the TruSeq3-PE.fa file. Trimmomatic will search for seed matches (16 bases) allowing up to 2 mismatches. These seeds will be extended and clipped if the score reaches 30 for paired-end reads or 10 for single-ended reads.\nRemove leading low-quality or N bases (below quality 3).\nRemove trailing low-quality or N bases (below quality 3).\nScan the read with a 4-base wide sliding window, cutting the read if the average quality per base drops below 20 for EVs and 15 for WGS libraries.\nDiscard reads that are less than 36 bases long after these steps for the EV libraries and less than 80 bases for the WGS libraries.\nNext, create an index of the Leishmania infantum reference genome assembly (LINF GCA_900500625.2) and align the trimmed EV-DNA sequences using the short-read aligner Bowtie2 with default parameters.3[href=https://www.wicell.org#bib3]\n>module load bowtie2\n#Creating index for the reference genome\n>bowtie2-build Leishmania_infantum_gca_900500625.LINF.dna.toplevel.fa\nL.infantum\n#Running alignment\n>bowtie2 --very-sensitive -x L.infantum ∖\n-1 ∗.R1_Paired.fastq.gz ∖\n-2 ∗.R2_Paired.fastq.gz ∖\n-S output.sam\nFor the WGS DNA alignment, BWA-MEM can be used with default parameters, as it supports better the alignment of longer Illumina sequences ranging from 70 to 100 bp.4[href=https://www.wicell.org#bib4]\n>module load bwa\n#Creating index for the reference genome\n>bwa index Leishmania_infantum_gca_900500625.LINF.dna.toplevel.fa\n#Running alignment\n>bwa mem Leishmania_infantum_gca_900500625.LINF.dna.toplevel.fa\n∗.R1_Paired.fastq.gz ∗.R2_Paired.fastq.gz > bwa_output.sam\nConvert the alignment output from the SAM format into a BAM format using Samtools.13[href=https://www.wicell.org#bib13]\nNote: During this step, the sequence reads are sorted by chromosomal position and an index file is created during this process.\n>module load samtools\n#File conversion from sam to bam",
    ">samtools view -S -b output.sam > output.bam\n#Sorting the bam file\n>samtools sort output.bam -o output.sorted.bam\n#Creating index for the bam file\n>samtools index output.sorted.bam\nFlag the reads with low mapping quality score (MAPQ <2) using Qualimap.12[href=https://www.wicell.org#bib12]\n#Flagging the reads of the sorted bam file with MAPQ\n>module load qualimap/2.2.1\n>qualimap bamqc -bam output.sorted.bam\nNote: This step will also create a new directory that contains a HTML report with the summary of the MAPQ for all the reads. After analyzing the summary, a threshold of <2 was chosen for filtering low-mapping quality reads. Example Qualimap reports for an EV and a WGS sample are shown in Figure 6[href=https://www.wicell.org#fig6] below.\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2603-Fig6.jpg\nFigure 6. Examples of MAPQ summaries\nMAPQ summary for (A) an example EV library and (B) an example WGS library.\nReads with MAPQ <2 can be removed using Samtools.13[href=https://www.wicell.org#bib13]\n>samtools view -bq 2 output.sorted.bam > output.filtered.bam\nNote: This step will avoid having low-quality mapping reads, which often accumulate at repeated genomic regions, creating false-positive copy number variation (CNV) calls.\nTo perform the CNV analysis, PCR duplicates that may have arisen during the EV DNA library preparation need to be flagged and removed using Picard.11[href=https://www.wicell.org#bib11]\nNote: To run Picard, it is important to have the picard.jar file in the same directory, and the BAM file needs to be sorted before marking duplicates. The following command can be used:\n>module load java/11.0.2\n>java -jar picard.jar MarkDuplicates I=input.sorted.bam\nO=output.duplicate_marked.bam M=output.txt REMOVE_DUPLICATES=true\nNote: This will mark duplicates in the sorted BAM file and output a new BAM file with the duplicates removed. A metrics file with statistics about the duplicates will also be generated.\nAfter marking and removing duplicates, create coverage tracks (in BigWig format) using deepTools for visualization on a genome browser such as the Integrated Genome Viewer (IGV).6[href=https://www.wicell.org#bib6],10[href=https://www.wicell.org#bib10]",
    "Note: The default bin size (-bs) for generating the BigWig files is 50 bases; to have higher resolution we use -bs 1. The coverage tracks need to be normalized with scaling factors calculated using the following formula:\nScaling factor (S) = genome size / (mapped read pairs ∗ read length)\n>module load python/3.7\n>module load deepTools/3.5.0\n>bamCoverage -bs 1 –bam input.sorted.bam -o output.bw –scaleFactor S\nThis process should be repeated for each sample to generate BigWig (bw) tracks that can be visualized using the IGV.10[href=https://www.wicell.org#bib10] An example of IGV visualization is provided for the mrpA locus on LinJ23 (Figure 7[href=https://www.wicell.org#fig7]).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2603-Fig7.jpg\nFigure 7. Visualization of the BigWig tracks using IGV\nThe orange and blue tracks represent the antimony resistant (Sb) and the wild type (WT) L. infantum samples respectively (both EV and WGS). The enriched region in the antimony resistant mutant samples corresponds to the mrpA locus on LinJ23.\nCopy number variation (CNV) analysis\nTo analyze CNV, split the reference genome into 5 kbp non-overlapping genomic windows using the multiBigwigSummary function of deepTools.6[href=https://www.wicell.org#bib6] The input of this function is the BigWig tracks generated in the previous step. For this study, the bin size (-bs) was fixed to 5,000 bases.\n>module load python/3.7\n>module load deepTools/3.5.0\n>multiBigwigSummary bins -b ∗.bw -bs 5000 -out results.npz --\noutRawCounts genomic_window.txt\nNote: Here, results.npz is the default output which is a compressed version of a Numpy array carrying the raw counts of each sample for the 5kbp genomic intervals. We only used the genomic_window.txt file for the downstream analyses.",
    "To count the number of reads that are aligned in each 5 kbp genomics bin, use the featureCounts tool from the subread package.9[href=https://www.wicell.org#bib9] Prior to analysis, an annotation file listing the genomic intervals to be analyzed needs to be prepared. The first three columns “chr”, “start”, and “end” of the genomic_window.txt file which was generated by deepTools can be used to create the annotation file. To follow the required format of the annotation file, the “Strand” column was set as positive for all genomic windows. An example of the annotation.txt file is provided in Figure 8[href=https://www.wicell.org#fig8] below.\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2603-Fig8.jpg\nFigure 8. Example of the annotation.txt file which was generated from the genomic_window.txt file\nNote: The next steps will be performed in RStudio.\nUse the featureCounts tool with the BAM files and the annotation file as inputs to generate a read count matrix.\n#Loading the annotation file\n>ann <- read.table(“./annotation.txt”, sep=“∖t”, header=TRUE)\n#Creating a count matrix from BAM files\n>library(Rsubread)\n>fc_PE <- featureCounts(files=dir(“.”, “bam”), annot.ext = ann,\nisPairedEnd=TRUE)\n>fc_count <- fc_PE$counts\nOnce generated, the read count matrix is then used as an input in edgeR, where it is normalized based on the library size (number of reads aligned to the genome).7[href=https://www.wicell.org#bib7]\nNote: This normalization step is necessary to accurately compare the read counts across different samples.\nNote: Other methods such as DESeq2 could be used for analyzing differential abundance with similar outcomes.\n>library(edgeR)\n#Specify the counts and the groups in the function DGEList().\n>group <-c(\"Sb_exosome\",\"Sb_exosome\",\"Sb_exosome\",\n\"WT_Exosome\",\"WT_Exosome\",\"WT_Exosome\")\n>d <- DGEList(counts=fc_count,group=factor(group))\n#Calculate the library sizes and transform the read counts in Counts per\n#million (CPM).\n>d$samples$lib.size <- colSums(d$counts)\n>d <- calcNormFactors(d)\n>cpm_d <- cpm(d)\nThe differential abundance analysis for EV DNA was performed using edgeR with the exactTest method and Benjamini-Hochberg multiple testing correction (with an adjusted p value threshold of 0.05).",
    "Critical: Only 5kbp genomic windows with a minimum coverage of 50 counts per million in at least three samples, corresponding to the number of samples per group, were included in the downstream analysis to avoid false CNV calls.\n#Filtering based on the CPM value\n#Keep bins with at least 50 reads/million in at least 3 samples\n>keep <- rowSums(cpm_d>50) >= 3\n>d50 <- d[keep,]\n>cpm_d50 <- cpm(d50)\n#Estimation of dispersion\n>d1_50 <- estimateCommonDisp(d50, verbose=T)\n>d1_50 <- estimateTagwiseDisp(d1_50)\n>design.mat <- model.matrix(∼ 0 + d50$samples$group)\n>colnames(design.mat) <- levels(d50$samples$group)\n#Differential abundance analysis by Exact test\n>et_sbe_wte_50 <- exactTest(d1_50, pair=c(\"WT_Exosome\", \"Sb_exosome\"))\n>topTags(et_sbe_wte_50, n=20)\n#The total number of differentially abundant bins at FDR< 0:05 is:\n#Sb resistant exosome vs WT exosome\n>de_wt_sb_50 <- decideTestsDGE(et_sbe_wte_50, adjust.method=\"BH\",\np.value=0.05)\n>summary(de_wt_sb_50)\n#Differentially expressed tags from the naive method in d1\n>detags_wt_sb_50 <- rownames(d1_50)[as.logical(de_wt_sb_50)]\n>plotSmear(et_sbe_wte_50, de.tags=detags_wt_sb_50)\n>abline(h = c(-2, 2), col = \"blue\")\nNote: The output file in each subdivision of this code was used as an input for the next subdivision which can be run all at once or can be split into multiple code blocks. The above code will generate plots shown in Figure 9[href=https://www.wicell.org#fig9]. These demonstrate the effect of the low coverage and high variability of bin filtering.\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2603-Fig9.jpg\nFigure 9. MA plots comparing the differential abundance (log2 FC) of each 5 kbp genomics interval between the EV content of Sb-resistant and WT Leishmania versus their average read counts (logCPM)\nMA plots after (A) and before (B) low coverage filtering is shown.\nGenerating the Miami plots\nTo visualize the results of the CNV analysis, the CMplot package can be used to create circular and linear Miami plots.5[href=https://www.wicell.org#bib5] These plots provide a convenient way to visualize the CNV ratios and can aid in the interpretation of the results.",
    "First, the cpm_d50 data frame from the previous step must be saved as a CSV file. The first column of the data carries information regarding the chromosome number, and its starting and ending positions (example in Figure 10[href=https://www.wicell.org#fig10]).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2603-Fig10.jpg\nFigure 10. Example of the cpm_d50 data frame which contains the normalized CPM values for each bin for the EV samples\n>write.csv(cpm_d50,\"cm_plot_data.csv\", row.names = TRUE)\nNote: A similar data frame was generated for the WGS samples. To use this data frame as an input for CMplot, we first saved it as a CSV file named cm_plot_data.csv and modified it using the following steps:\nCalculate the average CPM for the three WT EV samples and three Sb-resistant mutant EV samples for each bin.\nCalculate the fold change for each bin following this formula for EV samples.\nFC = average CPM of Sb resistant mutant/ average CPM of WT\nAnd for WGS samples using the following formula.\nFC = CPM of Sb resistant mutant/ CPM of WT\nAny FC value < 0 was inversed and then multiplied by -1 to show the FC in Sb-resistant mutant EVs compared to the WT in the positive scale, and the FC in WT EVs compared to the Sb-resistant mutant EVs in the negative scale. The formula for FC modification was:\nmodified_FC = (1/FC) × -1\nWe then added 1 to all the negative FC and subtracted 1 from all the positive FC, so that FC = 1 becomes FC = 0 which represent the bins with no fold change.",
    "Optional: If some bins have very high FC, to ensure the visibility of lower FC bins, any FC higher than 4 can be modified to equal 3.5 and any FC lower than -4 can be changed to -3.5 to set the scale of the Miami plots to be -4 to 4. This change should be clearly stated in the methods and figure legends, and the true FC should be reported. We optimized this scale so that the two circles in the circos plot can be easily visualized and interpreted.\nFinally, the first column of the data frame was split into three columns, Bin, Chr, and Position. The Position column is calculated as the center between the starting and ending positions of the bin, as indicated in the Bin column. The resulting data frame, cm_plot_data.csv has the format depicted in Figure 11[href=https://www.wicell.org#fig11].\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2603-Fig11.jpg\nFigure 11. Example of the cm_plot_data.csv that was used as an input for the CMplot package\nThis final data frame was used as an input for the CMplot package. Using the provided code, circular (whole genome) and linear (individual chromosomes) Miami plots were generated. Example plots from1[href=https://www.wicell.org#bib1] can be found in Figure 12[href=https://www.wicell.org#fig12].\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2603-Fig12.jpg\nFigure 12. Differential enrichment of EV DNA in Sb-sensitive and Sb-resistant parasites\nThe circular plot (A) and linear Miami plot for chromosome 23 (B) were generated using the provided code. The labels of the plots were manually edited. Reproduced from.1[href=https://www.wicell.org#bib1]\n(A) Circos plot showing the differential abundance between the whole genome (WGS; outer ring) and the EVs (inner ring) comparing Sb-resistant versus WT parasites for each chromosome. For the y axis which represents the fold change, the maximum range was set to -4 to +4, with a region on chromosome LinJ23 highlighted in red and with the above axis fold differences indicated.",
    "(B) Miami plots showing the enrichment of a 20 kbp genomic window (position 80–100 kbp) on LinJ23 in both WGS and EVs.\n#Creating the circular Miami plot\n>cm_plot_data <- read.delim(\"./cm_plot_data.csv\",header = TRUE, sep =\n\",\")\n>library(\"CMplot\")\n>CMplot(cm_plot_data,band= 0.8,col=c(\"grey30\",\"grey60\"), ylim= list(c(-\n4,4),c(-4,4)),cir.chr.h=0.5,chr.den.col=c(\"lightblue\",\"yellow\",\"grey\"),\nbin.size=5000,outward=TRUE,r=1.5,LOG10=FALSE,\nfile=\"jpg\",memo=\"\",dpi=300,file.output=TRUE,verbose=TRUE,width=10,height\n=10)\n#Creating linear Miami plot for individual chromosomes. For this plot we\n#skipped the data modification step (e) and kept the real FC.\n>cm_plot_data_real_FC <- read.delim(\"./cm_plot_data_real_FC.csv\",header\n= TRUE, sep = \",\")\n>CMplot(cm_plot_data_real_FC[cm_plot_data_real_FC$Chromosome==23,\n],plot.type=\"m\", col=c(\"grey60\"),highlight.col=\"orange\",highlight.cex=3,\nylim= list(c(-4,35),c(-4,35)),threshold=c(5,34),\nthreshold.col=c(\"white\",\"white\"),\nbin.size=5000,outward=TRUE,r=1.5,LOG10=FALSE,signal.col=c(\"blue\",\n\"orange\"),signal.cex=c(3,3), ylab=\"Fold Change\", cex=3,\ncex.axis=1.8,ylab.pos=5,\nfile=\"jpg\",memo=\"\",dpi=300,file.output=TRUE,verbose=TRUE,width=25,height=\n10)"
  ],
  "subjectAreas": [
    "Genomics",
    "Sequence Analysis",
    "Microscopy",
    "Cell Biology",
    "Microbiology",
    "Sequencing"
  ],
  "bigAreas": [
    "Molecular Biology & Genetics",
    "Bioengineering & Technology"
  ]
}