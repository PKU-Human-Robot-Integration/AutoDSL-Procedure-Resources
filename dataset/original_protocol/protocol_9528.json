{
  "id": 9939,
  "origin_website": "Jove",
  "title": "Fully Automated Leg Tracking in Freely Moving Insects using Feature Learning Leg Segmentation and Tracking (FLLIT)",
  "procedures": [
    "1. System setup\nEnsure that the recording station has a high-speed camera and a stage over it to hold the arena chamber (Figure 1). Adjust the camera to record at a minimum of 250 frames per second (fps), with an accordingly fast shutter speed (in this case, recording is performed at 1000 fps with a shutter speed of 1 ms).\n\tNOTE: Check that the video is suitable for tracking by ensuring that there is minimal or no motion blur of moving legs in all frames. If the moving leg is so blurred that a human annotator cannot track it, then the camera recording speed and/or shutter speed must be increased.\nPlace the infrared LED lights at the top of the stage with a diffuser (translucent sheet) between the camera and sample (Figure 1A,B).\nMake the recording chamber by cutting a 1.6 mm thick acrylic sheet. In this experiment, use a field-of-view of 11 mm x 11 mm. Place the chamber between two glass slides (Figure 1C).\n2. Preparation of flies for recording\nTransfer the flies to be recorded into a new food vial 24 h prior to recording.\n\tNOTE: Do not use CO2 (usually used to anesthetize the flies upon first collection) on the flies less than 24 h before recording.\nAbout 40 min before recording, transfer the flies into empty vials and keep on ice for 5-7  min. \nIn the meantime, wipe the arena and clear glass slides with water and a wipe.\n\tNOTE: Do not use ethanol to clean the chambers and the slides.\nPrepare the recording chamber. Fix one of the microscopic glass slides below the chamber with tape.\nWhen the flies have been anesthetized on ice, transfer one fly in each chamber using a clean brush.",
    "NOTE: Both male and female flies can be used in this setup, and, as far as possible, flies of both sexes should be analyzed to avoid sex-specific bias.\nSecure the chamber with another microscopic glass slide with tape (Figure 1C).\nKeep the chambered flies at room temperature for 15 - 20 min for acclimatization.\n3. Generation of videos for FLLIT analysis\nNOTE: This step is specific to the video camera used. In this case, a commercially available video camera is used (see Table of Materials).\nTurn on the power source. Wait for the green LED for power and the orange LED for the ethernet interface connection to stabilize. Switch on the power for the infrared LED. Ensure that the voltage remains at 12.5 V.\nOpen the Viewer application on the connected computer system.\nChange the recording frame rate to 1000 fps. Set the shutter speed to 1/1000 s (1 ms).\nPlace the chamber with the fly on the recording arena and select the LIVE button. Ensure that the camera is focused on the leg tips when the fly is walking upright on the floor of the chamber; the leg tips should be in sharp focus.\nClick Record (Figure 2).\nRecord the fly walking, ensuring that: \n\tThe fly walked in a relatively straight trajectory without touching the edge of the arena.\n\tThe fly walked at least three strides per leg.\n\tThe fly does not pause during the walk.\n\tThe distance walked is equivalent to at least one body length. \n\tNOTE: Having the background subtracted cleanly is critical for accurate segmentation. The automated background subtraction algorithm employed by FLLIT requires that the imaged fly moves at least one body length in distance.\nClick Rec Done to stop recording (Figure 2).",
    "Crop the video to ensure that the recording encompasses only a straight walk of the fly (as described in Step 3.6).\nClick Save (Figure 2). Save the files in ‘.mraw’ or ‘.tiff’ format in the respective folders.\n\tNOTE: ‘.mraw’ format gives greater flexibility to change the file name (if required) and for storage of videos compared to ‘.tiff’ file format.\n4. Installation of FLLIT program\nNOTE: Up-to-date instructions can be found at: https://github.com/BII-wushuang/FLLIT/blob/master/Compiled/Readme.pdf\nDownload FLLIT on any operating system\n\t\nDownload FLLIT from the following Github link: https://github.com/BII-wushuang/FLLIT/archive/master.zip. Extract the contents of the zip file.\nDownload sample datasets from the following Google Drive link: https://bit.ly/2EibvNY. Create a folder Data under FLLIT-master/Compiled and place dataset folders in this Data directory.\nInstall FLLIT In Ubuntu\n\t\nNavigate to the FLLIT/Compiled directory.\nRight-click and select Open in Terminal.\nIssue the following command to download and install the MATLAB runtime libraries to $HOME/MCR:\nbash MCR_2016a.sh\nAfter installation of the MATLAB runtime libraries has been completed, issue the following command to ensure that executable rights are accorded to FLLIT:\nchmod +x FLLIT\nOpen a terminal in the FLLIT/Compiled directory and issue the following command to execute FLLIT:\nbash run_FLLIT.sh $HOME/MCR/v901\nInstall FLLIT in Windows\n\t\nFor 7 and 10th Home Edition, install Docker Toolbox at:\n\t\t(https://github.com/docker/toolbox/releases/download/v19.03.1/DockerToolbox-19.03.1.exe).\nFor Windows 10 Pro or Enterprise Edition, install Docker Desktop for Windows at: (https://download.docker.com/win/stable/Docker\\%20Desktop\\%20Installer.exe).\nTo enable execution of GUI applications in a Docker container on Windows, first install VcXSrV (https://sourceforge.net/projects/vcxsrv). On starting VcXsrv, configure the settings as in Figure S1.\n\t\tNOTE: Make sure Docker and VcXsrv are running before starting FLLIT.\nDouble click FLLIT.bat to run FLLIT.\n\t\tNOTE: When executing for the first time, it will take some time to pull the Docker image from Docker Hub.\nInstall FLLIT in MacOS\n\t\nDownload Docker Desktop for MacOS at https://download.docker.com/mac/stable/Docker.dmg",
    "Install socat by opening a terminal and issuing the following command:\nbrew install socat\nStart socat with:\nsocat TCP-LISTEN:6000,reuseaddr,fork UNIX-CLIENT:\\\"$DISPLAY\\\" & disown\nInstall XQuartz (https://www.xquartz.org) to enable execution of GUI applications in a Docker container on MacOS. Start XQuartz and change the preferences by checking the Allow connections from network clients in the Security tab as shown in Figure S2.\n\t\tNOTE: Make sure that Docker, socat and XQuartz are all running before starting FLLIT. \nOpen a terminal in the FLLIT/Compiled directory and execute FLLIT with the following command:\nbash FLLIT_Mac.sh\n\t\tNOTE: When executing for the first time, it will take some time to pull the Docker image from Docker Hub.\n5. Running FLLIT for automated leg tracking\nSegmentation\n\t\nConvert the video into individual TIFF files and copy into the FLLIT data folder.\nRun FLLIT (In Ubuntu, right click to open FLLIT in Terminal).\nSelect the folder containing the frame-by-frame TIFF images of the video to be tracked and click the Add button.\nIn the pop-up window choose 0 for carrying out leg segmentation only, or 1 to include leg tracking with leg segmentation.\nClick Done to initiate segmentation and tracking of the selected video. \nTracking\n\t\nTo check the accuracy of tracking and carry out error corrections (if any), click on Select Data Folder. Select the folder to be tracked and click Open.\nClick on View Tracking.\n\t\tNOTE: Check that Viewer Mode remains selected while viewing the tracked leg positions. Otherwise, any previous corrections made will be over-ridden.\nCheck labeling for all the legs in the first frame",
    "NOTE: Since the leg labels are placed according to the position on the screen, if the fly is walking upright, the fly’s RIGHT side is labelled as L1 (fore-leg), L2 (mid-leg), L3 (hind-leg) and the fly’s LEFT side is labelled as R1 (fore-leg), R2 (mid-leg), R3 (hind-leg), respectively (Figure 3). If the fly is walking upside, down the leg labels will be correctly annotated.\nIf a leg is wrongly labeled and a correction is required, click Pause viewing, followed by Adjust Prediction (Figure 3).\nFrom the right panel headed Leg to Adjust, select the leg that requires correction. \nDouble click on the correct position for this leg in the image window, click on Save, and then Exit. To go to the previous frame or subsequent frame, click Pause viewing followed by the forward and backward <I and I> buttons, respectively (Figure 3).\nTo correct any incorrectly tracked videos, open the Data folder of the video to be retracked and select Manually Initiate Tracking.\nClick the Tracking button, which will then change its label to Initial.\nClick Adjust Prediction and correct the leg labels by double-clicking each leg tip and then assigning it with the correct leg label. Click Save and Exit.\nClick on Resume to initiate tracking.\nData processing and video generation\n\t\nClick on Data Process. In the popup window, type in the number of frames per second (fps) at which the videos were recorded (e.g., 1,000 fps). \nUse the following equation to calculate the actual field of view of the captured video so that gait parameters can be measured in millimeters:\nimgsrc://cloudfront.jove.com/files/ftp_upload/61012/61012eq1.jpg",
    "NOTE: For example, if the actual chamber size is 7 mm, the width of the image frame is 137 mm, the width of the chamber in the image frame on the computer screen is 81 mm, and the width of the field of view was 11.83 mm (Figure S3).\nTo see the tracking results, go to the Tracking folder under the Results folder.\nTo generate a video of the tracked fly, select Make video. The video will be saved in the same Results folder as that of the original video data analyzed.\n\t\tNOTE: The Start (first) and End (last) frames of the video can be selected.\nNormalization to body length of each fly.\n\tNOTE: As each fly may be slightly different in size, certain gait parameters should be normalized to the body length of each fly to facilitate comparisons (e.g., stride length may be longer in larger flies, and shorter in smaller flies).\n\t\nOpen three still images from the video of each fly (usually first, middle and last frames) using image software.\nMagnify each image frame to 800% and label the anterior-most pixel of the head and posterior-most pixel of the abdomen at the midline using a bright color (e.g., yellow).\nOpen the labeled images in ImageJ.\nUse Set Scale to input the scale accordingly: Set Distance in pixels: 512; Known distance: Actual Field of view (mm) as measured in step 5.3.2.; Unit of length: mm.\nDraw a straight line between the labelled head and abdomen tip pixels to obtain the body length.\nOpen Set Scale again to obtain the value in a known distance, which is the body length in mm.\nTake an average of the length determined in each of the three images to obtain the average body size in mm."
  ],
  "subjectAreas": [
    "Behavior"
  ],
  "bigAreas": [
    "Ecology & Environmental Biology"
  ]
}