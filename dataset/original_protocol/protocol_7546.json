{
  "id": 7941,
  "origin_website": "Bio",
  "title": "<em>LiverQuant:</em> An Improved Method for Quantitative Analysis of Liver Pathology",
  "procedures": [
    "Immunohistochemistry and scanning The method utilized for isolation, preparation, and scanning of liver sections will not be covered within this protocol. All mouse liver sections that were used for this method were fixed in a standard approach with paraformaldehyde, embedded in paraffin, sectioned at 5 μm thickness, and stained using the appropriate immunohistochemical techniques. Within this study, we will be using mouse sections that were stained using primary antibodies against cytokeratin 19 (cholangiocytes) with α-smooth muscle actin as an endothelial counterstain, F4/80 (macrophages), and picosirius red (collagen) with a Fast Green counterstain. For additional details see Hellen et al. (2023). All sections were imported into QuPath in NDPI file format taken using a Vectra Polaris scanner at 40× magnification. QuPath supports a bank of file extensions for importing, spanning greater than 150 different file formats. Prior to importing files for downstream analysis using QuPath, it is suggested to transfer the desired files onto the computer that will be used for quantification. This will aid in speed and processing time, as internal file access speed is typically the most rate-limiting factor in any of these analyses. It is additionally recommended that an entire cross-section (whole slide) is scanned into QuPath, rather than individual smaller ROIs.Downloading GitHub files (https://github.com/DominickHellen/LiverQuant[href=https://github.com/DominickHellen/LiverQuant])Navigate to the GitHub repository link.Download the ZIP file of contents by clicking <> Code → Download ZIP (Figure 1A).imgsrc:https://en-cdn.bio-protocol.org/attached/image/e4776/bioprotoc-13-14-4776-g001.jpgFigure 1. Retrieving LiverQuant files from GitHub. (A) All files necessary for the protocol are available for download online. The red arrow indicates exactly where to download the necessary files. B) All .GROOVY and .JSON files should be available for use after download and unzipping.Unpack ZIP files by right-clicking → Open.All files for LiverQuant Bio-Protocol should be within the code folder (Figure 1B).",
    "Preparing the project Preparing a project in QuPath starts with creating a folder in a file manager of choice (e.g., Mac Finder, Windows File Explorer). To have all files of interest in the right place, it is better to create a folder on the computer and place all files within that folder.Within the designated folder that contains all the files of interest, create another folder. This will be the hub that QuPath will use for all related paths and metadata (Figure 2A).Note: Keep this folder empty and entitle it New Folder. imgsrc:https://en-cdn.bio-protocol.org/attached/image/e4776/bioprotoc-13-14-4776-g002.jpgFigure 2. Preparing LiverQuant. A) Representative image of the New Folder where the images and scripts needed for analysis will be stored. B) Example of images ready to be imported into QuPath. C) Within New Folder, generate the scripts folder, where D) all downloaded .GROOVY scripts should be placed. E) Within the classifiers folder, generate pixel_classifiers folder, and F) place all downloaded .JSON files.Download the most recent edition of QuPath and start the program.Note: These scripts have been designed and tested using QuPath v0.4.3. Create a project within QuPath using the Create Project button.Navigate to the empty New Folder that has been created in step 1 and click Select folder.The Add images button within QuPath should now be accessible. Click Add images and proceed to add the desired histological image files.After selecting chosen images, click Open.Verify that all of the images are added to the Import Images to project pop-up and click Import (Figure 2B).Leave the Image provider as Default (let QuPath decide).Leave the image type blank.Note: Image type will vary depending on the analysis (Brightfield H-DAB – Macrophages, Brightfield Other – Fibrosis, or Fluorescence – Cholangiocytes) and is automatically selected within the detection scripts.",
    "Do not choose to rotate the image, as it can occasionally slow down QuPath’s ability to read the file.Leave Auto-generate pyramids checked.Note: Most whole-slide scanned images are pyramidal, which carries data at multiple resolutions and can be sub-sampled depending on the analysis. The Import objects option can remain unchecked for a new project.Finally, navigate back to the New Folder in the file manager and add a folder entitled scripts (Figure 2C).Place Fibrosis detection script, Macrophage detection script, Cholangiocyte detection script, Fibrosis intensity script, and Macrophage intensity script (.GROOVY files), taken from the GitHub link, into the scripts folder (Figure 2D).Note: These scripts should show up in the toolbar under Automate > Project scripts… Within New Folder, open classifiers, and create a new folder entitled pixel_classifiers (Figure 2E).Add the Fibrosis and Macrophage .JSON files into the pixel_classifiers folder (Figure 2F).QuPath immunohistochemical and immunofluorescent analysis Whole-slide analysis of immune cell types, fibrosis, and biliary tract composition (cholangiocytes) can provide researchers with an efficient understanding of liver health. This protocol will outline the automated quantification of macrophages, fibrosis, and cholangiocytes within whole-slide sections of liver tissue, respectively. This section will be divided by the respective arc of liver histology chosen for analysis. Each protocol relies heavily upon customizable scripts written in the Groovy language within QuPath. The scripts are open-source and contain detailed annotations of each function and command used for their respective analysis. It is highly recommended to analyze the scripts prior to performing analyses in order to avoid potential pitfalls, optimize, and understand possible errors.Automated quantification of macrophages within QuPath Note: For this type of analysis, the 3,3′-Diaminobenzidine (DAB) chromogenic dye was used to detect the secondary antibody attached to the primary anti-F4/80 antibody. Open one image by double-clicking the image icon.Set the image type to Brightfield H-DAB (Figure 3A).",
    "(Automatic Thresholding) Annotate three ROIs (using the brush tool) within the image that are good samples of how intense the macrophage stain is (Figure 3B).Tip: The larger the ROIs, the more accurate the downstream analysis will be. Note: Self-thresholding is outlined in section H. When finished annotating, run the macrophage intensity analysis by going to Automate → Project scripts… and clicking on Macrophage intensity script.For this script to run effectively, researchers need to type in their directory pathname on lines 24 and 29.Note: This protocol segment provides the Macrophage detection script with an average intensity threshold for quantification specific to the selected histological samples. Once the Macrophage intensity script is completed, open the Macrophage detection script in Automate → Project scripts… → Macrophage detection script.Within the Macrophage detection script, right-click and click Run… > Run for project.The script will automate whole tissue annotation (Figure 3C) and quantify macrophages for each image (Figure 3D).Notes:  i. The running time for each image is approximately 3 min. ii. Self-annotation for each image is covered in section I. imgsrc:https://en-cdn.bio-protocol.org/attached/image/e4776/bioprotoc-13-14-4776-g003.jpgFigure 3. Macrophage detection using LiverQuant. A) Upon opening the chosen DAB-stained image, set the image type to Brightfield H-DAB. B) Example of three annotations used for the Macrophage intensity script to gather an average intensity of DAB staining. C) The Macrophage detection script will automate tissue annotation and D) generate positive macrophage detections (red). B and C, scale bars: 2 mm. D, scale bars: 25 μm.If satisfied with the analysis, proceed to section J to export measurements.Automated quantification of fibrosis within QuPath Note: For this analysis, a picosirius red stain with a Fast Green counterstain was used. Of course, a different counterstain can be used and still achieve accurate results. Open one image by double-clicking the image icon.",
    "Set the image type to Brightfield Other (Figure 4A).(Automatic Thresholding) Annotate three ROIs (using the brush tool) within the image that are good samples of how intense the picosirius red stain is (Figure 4B).Tip: The larger the ROIs, the more accurate the downstream analysis will be. Note: Self-thresholding is outlined in section H. When finished annotating, run the fibrosis intensity analysis by going to Automate → Project scripts… and clicking on Fibrosis intensity script.For this script to run effectively, researchers need to type in their directory pathname on lines 24 and 29.Note: This protocol segment provides the Fibrosis detection script with an average intensity threshold for quantification specific to the samples. Once the Fibrosis intensity script is completed, open the Fibrosis detection script in Automate → Project scripts… → Fibrosis detection script.Within the Fibrosis detection script, right-click and click Run… > Run for project.The script will automate whole-tissue annotation (Figure 4C) and quantify fibrosis for each image (Figure 4D).Notes:  i. The running time for one image is approximately 2 min. ii. Self-annotation is outlined in section I. imgsrc:https://en-cdn.bio-protocol.org/attached/image/e4776/bioprotoc-13-14-4776-g004.jpgFigure 4. Fibrosis detection using LiverQuant. A) After opening the chosen picosirius red–stained image, set the image type to Brightfield Other. B) Example of three annotations used for the Fibrosis intensity script to gather an average intensity of picosirius red staining. C) The Fibrosis detection script will automate tissue annotation and D) differentiate between positive (fibrotic septa-red) and negative (parenchymal-blue) staining. B and C, scale bars: 2 mm. D, scale bars: 50 μm.If satisfied with the analysis, proceed to section J to export measurements.Automated detection of cholangiocytes within QuPath Note: The script that was written for cholangiocyte detection utilizes the positive cell detection plugin found within QuPath.",
    "It may be useful to further optimize the Positive cell detection plugin to a ROI within the slide and apply its values to the .GROOVY script for batch analysis. The most important parameter to adjust, as mentioned in the .GROOVY script is threshold. Open one image by double-clicking the image icon.Set the image type to Fluorescence (Figure 5A).imgsrc:https://en-cdn.bio-protocol.org/attached/image/e4776/bioprotoc-13-14-4776-g005.jpgFigure 5. Cholangiocyte detection using LiverQuant. A) Upon opening the chosen cytokeratin 19 (CK19) stained image, set the image type to Fluorescence. B) The Cholangiocyte detection script will automate tissue annotation and C) generate positive cholangiocyte detections. B, scale bar: 2 mm. C, scale bars: 50 μm. αSMA: Smooth muscle alpha-actin.Begin the analysis by going to Automate → Project scripts… and clicking on Cholangiocyte detection script.Within the Cholangiocyte detection script, right-click and click Run… > Run for project.The script will automate whole tissue annotation (Figure 5B) and quantify cholangiocytes for each image (Figure 5C).Notes:  i. The running time for one image is approximately 5 min. ii. Self-annotation is outlined in section I. Proceed to section J for exporting measurements if satisfied with the analysis.Self-thresholding for fibrosis and macrophages detection within QuPath Open one image by double-clicking the image icon.Set the image type to Brightfield (H-DAB) (Figure 3A) for macrophages or Brightfield (other) (Figure 4A) for fibrosis.Annotate an area of interest (using the brush tool).When finished annotating, zoom in on any area of interest.This area will be used as a probe to determine the appropriate filters to quantify the macrophages or fibrosis within the scanned image.Open the Pixel classification tool within the Classify menu bar and select Pixel classification > Create thresholder.Within the Create thresholder pop-up, adjust the parameters to accurately quantify macrophages (Figure 6A) or Fibrosis (Figure 6B).",
    "Note: To visualize the positive and negative selections, make sure the Show pixel classification button has been clicked (the button with the letter C on it). imgsrc:https://en-cdn.bio-protocol.org/attached/image/e4776/bioprotoc-13-14-4776-g006.jpgFigure 6. Self-thresholding for downstream LiverQuant analysis. A) Representative photo of Create thresholder tool in QuPath for macrophage, and B) fibrosis detection, respectively. A, scale bars: 50 μm. B, scale bars: 100 μm.For macrophage detection:Set Above threshold to Positive and Below threshold to Negative.For fibrosis detection:Set Above threshold to Negative and Below threshold to Positive.Set Channel to Dab for macrophages and Residual for fibrosis.Set Resolution to High.Note: The higher the resolution, the slower QuPath will function in the analysis of the section of interest. Smoothing Sigma can remain at 0 and can be changed to 1 if background staining is strong to help eliminate possible false positive detections.Starting threshold should be 0.2 for macrophages and 0.0 for fibrosis and optimized from there to isolate true-positive dab or picosirius staining, respectively. Macrophages will show up as red and the background as blue (Figure 6A). Fibrotic septa will show up as red and the background as blue (Figure 6B).Set Region to Any annotations.Enter the Classifier name as LiverQuantM to utilize the Macrophage detection script and LiverQuantF to utilize the Fibrosis detection script.After optimizing the threshold for LiverQuantM or LiverQuantF, proceed to step E6 or F6 for batch detection of macrophages or fibrosis, respectively.Annotating slides by hand within QuPath Note: Self-annotation must be followed by the specific steps outlined below. Annotate the desired areas within each image that require quantification using QuPath’s brush tool (Figure 7A).Tip: Avoid liver borders, and longitudinally cut large central veins or portal triads, as some will have false-positive staining. Tip: To subtract annotation, hold Alt for Windows or Command for Mac while annotating. imgsrc:https://en-cdn.bio-protocol.org/attached/image/e4776/bioprotoc-13-14-4776-g007.jpgFigure 7. Self-annotation for downstream LiverQuant analysis.",
    "A) Location of the brush annotation tool in the QuPath toolbar is indicated with a black arrow. B) Representative photo of where two slashes // should be placed for self-annotation within any of the detection scripts. Red arrow indicates exact location to place //.Open the detection script for the specified analysis (e.g., Macrophage detection script, Fibrosis detection script, and Cholangiocyte detection script).Place two // before lines 17 and 21 of the script (Figure 7B).Tip: An alternative is to delete both of these lines. Note: If this is not done, each annotation that is already created will be deleted and replaced by an automated annotation. Proceed to step E6, F6, or G4 for batch detection of macrophages, fibrosis, or cholangiocytes, respectively.Exporting measurements To export measurements, click on Measure > Export measurements, move all the samples analyzed to the Selected side, choose the appropriate Output file destination, and make sure the Export type is set to Annotations and the Separator is set to Comma (.csv). Finally, click Export.The exported .csv file should contain all the data needed for analysis.For macrophages, the measurement for comparative analysis is Detections (Figure 8A).Note: Divide Detections by Area μm2 and multiply by 1,000,000 to normalize to area. For fibrosis, the measurement for comparative analysis is LiverQuantF: Positive% (Figure 8B).For cholangiocytes, the measurement for comparative analysis is Num Positive per mm2 (Figure 8C).imgsrc:https://en-cdn.bio-protocol.org/attached/image/e4776/bioprotoc-13-14-4776-g008.jpgFigure 8. Measurements generated by LiverQuant for comparative analyses. Representative photos from the .csv files generated by exporting LiverQuant measurements for A) macrophages, B) fibrosis, and C) cholangiocytes. Red box indicates the important metric for data analysis."
  ],
  "subjectAreas": [
    "Cell Biology",
    "Immunology"
  ],
  "bigAreas": [
    "Biomedical & Clinical Research",
    "Molecular Biology & Genetics"
  ]
}