{
  "id": 2551,
  "origin_website": "Cell",
  "title": "Assessment of protein inclusions in cultured cells using automated image analysis",
  "procedures": [
    "Step-by-step method details\nStep-by-step method details\nWe begin this protocol by detailing the culturing of cells for transfection. We then describe the fixation and imaging of cells using microscopes. Following this, we describe the processing of images through ImageJ and CellProfiler to accurately identify nuclei and segment cells respectively. Finally, we describe the usage of CellProfiler Analyst to classify cells and determine the number of cells containing inclusions. There are some optional steps in the protocol that depend on how the initial experimental design is performed by the user.\nThe overall protocol can be seen below in Figure 1[href=https://www.wicell.org#fig1].\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2055-Fig1.jpg\nFigure 1. Overview of the workflow for identification of cultured cells containing protein inclusions\nLight gray boxes denote optional steps. White boxes denote that the step can be achieved using either CellProfiler or StarDist.\nCell culture, plating, and transient transfection\nTiming: 3 days\nWe carried out all cell culture according to standard protocols that can be found from cell bank databases (https://www.lgcstandards-atcc.org/[href=https://www.lgcstandards-atcc.org/]). NSC-34 and U-2 OS cells were maintained under humidified conditions at 37°C/5% CO2 in DMEM/F12 supplemented with 10% fetal bovine serum (FBS) and 2 mM L-glutamine.\nNote: We recommend that the user chooses a cell line on the basis of its ease of transfection, ability to recapitulate the aggregation phenotype of the POI, and morphology being simple (flat, large, adherent, lack of extensions). If you do not know what cell line might be best, we recommend U-2 OS cells due to their large size, flat morphology, high transfection efficiency, and high transgene expression levels.\nThawing cells from cryogenic storage.\nPre-warm to 37°C:\n10 mL of serum free culture medium per vial of cells.\na culture flask’s volume of culture media supplemented with FBS (e.g., 20 mL for a T-75 flask).",
    "Once the media is warmed, remove the cells from the cryogenic storage and place the vial into a 37°C water bath.\nCritical: Once cells begin to defrost in the water bath, work quickly to perform the next steps so that the cells spend the least amount of time in contact with high DMSO concentrations in the cryogenic preservation medium.\nGently swirl the vial during the defrosting cells until there is a small particle of ice remaining.\nSpray the vial with ethanol to sterilize it, and transfer the contents to 10 mL of warm serum medium in a 50 mL conical tube.\nCentrifuge the conical tube at an appropriate g-force for 5 min to pellet your cells (e.g., 300 × g for NSC-34 cells, 150 × g for U-2 OS cells).\nDiscard the supernatant and resuspend the pellet in 500 μL of serum-supplemented culture medium.\nTransfer the resuspended cells into a culture flask containing an appropriate volume of serum-supplemented culture medium.\nAllow 2–3 passages of cells prior to performing experiments with them.\nCritical: All mammalian cell culture should be performed in biosafety cabinets with sterile reagents and equipment.\nPlating cells.\nPre-warm to 37°C:\n500 mL 1× PBS 0.5 mM EDTA.\n50 mL of serum free culture medium per T-75 flask of cells.\n25 mL of Trypsin-EDTA dissociation solution.\nAn appropriate volume of culture media supplemented with FBS (a good rule is 12 mL per multi-well plate of cells.\nView your cells under a microscope to determine the confluency and health.\nUse this formula to calculate volumes for plating OR use a hemocytometer to specifically count cell numbers.\n  x =    ( Stock Vessel Confluency )  ×  ( Surface Area of Stock Vessel )     ( Desired Confluency in Plate )  ×  ( Surface Area of Single Well in Plate )",
    "V o l u m e  o f  M e d i a  p e r  W e l l =    R e s u s p e n i o n  V o l u m e  x   \nDiscard growth medium from the cultured cells and wash the cells carefully twice with ∼10 mL of 1× PBS 0.5 mM EDTA.\nWash the cells once with ∼10 mL of serum free culture medium.\nAdd an appropriate volume of Trypsin-EDTA dissociation solution to the cells (e.g., 5 mL for a T-75 flask) and incubate for 5 min.\nCheck the cells under the microscope to see if they have dissociated from the flask bottom. If they are still adhered, you can lightly tap the flask side to release them.\nPour the cell suspension into a sterile conical 50 mL tube.\nWash the stock vessel with ∼10 mL serum free culture medium twice and pour each wash into the tube containing the cell suspension.\nPellet the cell suspension via centrifugation at an appropriate g-force for 5 min (e.g., 300 × g for NSC-34 cells or 150 × g for U-2 OS).\nDiscard the supernatant and gently but thoroughly resuspend the cells into 1 mL (resuspension volume) of growth media.\nDilute the cells for hemocytometer counting (1 in 5 dilution) here or proceed via confluency calculations.\nDilute the needed volume of cell resuspension into an appropriate volume for plating (this information will depend on the user’s preferences).\nPlate the cells and place them into the incubator.",
    "Note: We recommend that the user plate into wells with relatively large surface areas so that a large pool of cells is available for transfection (i.e., a well of a 6-well plate). This cell pool can then be re-plated following transfection to decrease intra-assay variability that occurs from transfection.\nTransfecting and re-plating cells.\nView plated cells under a microscope to ensure correct confluency and high viability (> 90% viable cells).\nEquilibrate ∼10 mL Opti-MEM media to room temperature.\nDefrost frozen plasmid stocks to room temperature.\nCarry out transfection reagent protocol according to the manufacturer’s instructions using your predetermined optimized DNA:reagent ratio.\nNote: For TransIT-X2 transfection reagent the manufacturer’s protocol can be found here (https://www.mirusbio.com/products/transfection/transit-x2-dynamic-delivery-system[href=https://www.mirusbio.com/products/transfection/transit-x2-dynamic-delivery-system]).\nAdd Transfection mixture to cells and incubate cells for 24 h.\nFollowing transfection incubation for 24 h, re-plate the cells into multi-well plates according to the above protocol for plating cells (be sure to account for changes in cell number and media volume).\nThe user is free to treat cells with drugs if doing so at this point.\nNote: Some cell lines are not amenable to replating following transfection and will not re-adhere to tissue culture vessel. In these cases, transfect well-by-well.",
    "Note: There are many different methods of transfection available. The user should perform a search of literature and commercial sources to determine what transfection method/reagent may be the most appropriate for their experiment. The best option is empirical testing of reagents in the users own hands. Transfections should result in a substantial proportion of the cell population expressing the transgene and minimal toxicity to cells. For example, we find that the TransIT-X2 reagent (Mirus Bio) is good for NSC-34 transfection but results in high levels of toxicity in U-2 OS cells. Therefore, for U-2 OS cells we use ViaFect (Promega) or Lipofectamine LTX reagent (Thermo Fisher Scientific).\nNote: Transfection efficiencies between cell lines are not always the same and must be optimized for each plasmid and transfection method/reagent. We highly recommend that the user perform a transfection optimization to ensure the best transfections before imaging the cells. Instructions for transfection optimization are found in transfection reagent manufacturer protocols.\nNote: Test transfections and optimization transfections can be performed using plasmids purified via miniprep kits. Once optimizations have been carried out, we recommend using endotoxin-free plasmid preparation kits to ensure optimal transfection and low toxicity of plasmid transfections.\nNote: Be sure that your imaging vessel (multiwell plate, chamber slide, dish, etc) has the appropriate bottom thickness for the objective lens(es) you will use and can be held on the microscope stage. Plastic-bottomed plates (usually 1 mm thick bottom) are too thick for high numerical aperture (NA) air objectives and immersion objectives to image the plane at which the cells adhere (expect a 170 μm thick bottom). If in doubt, consult with your microscope technician.\nFixing and counterstaining transfected cells\nTiming: 1 h",
    "This phase of the protocol is aimed at carrying out the fixation of the cells in a manner that retains cellular morphology and provides the least disruption to fluorescent protein qualities. This is achieved by fixing the cells in warm PFA solution in growth media. We find that cold PFA solution, and sometimes warm neat PFA solution, significantly alters the morphology of neuronal cell types. By using warm PFA solution mixed with growth medium, excessive pH and temperature changes are avoided, leading to the maintenance of cellular morphology. The outcome of this step should be fixed and stained cells of a quality that is acceptable for fluorescence microscopy.\nNote: If the user thinks that their image acquisition will result in long exposure times to the samples (potentially caused by software-based autofocusing or low-quality cameras) they can utilize anti-fade solutions to maintain fluorophore brightness throughout image acquisition. We have provided a homemade recipe in the materials and equipment[href=https://www.wicell.org#materials-and-equipment] section above.\nFixing cells.\nPre-warm 4% PFA solution to 37°C.\nCritical: PFA is a toxic chemical and should always be used inside a fume hood. Discard PFA solutions according to your local hazardous waste disposal guidelines.\nAdd 1 volume of warmed 4% PFA solution per well of the plate containing transfected cells (e.g., if the cells are cultured at 100 μL per well of a 96-well plate, add 100 μL of 4% PFA solution to result in a 2% PFA final concentration.\nIncubate the cells for 5 min at room temperature.\nNote: Cover your cells from light by placing them in an opaque container or wrapping them in foil. This prevents unwanted fluorescent protein bleaching.\nAspirate the medium off the cells and discard appropriately as PFA is present.",
    "Carefully add 1 volume of 4% PFA solution to each well in the plate and incubate at room temperature for 15 min.\nOptional: Media can be quickly removed from multi-well plates by flicking the plate upside down into a large waste container. We find that this is quicker and results in less cell detachment compared to aspiration with a pipette.\nOptional: PFA fixation can cause increased autofluorescence from samples. Good practice is to quench remaining PFA by addition of 0.1 M Tris (pH 8.0) for 5 min to prevent this.\nPermeabilizing cells.\nAdd 1 volume of 1× PBS 0.1% Triton X-100 to each well in the plate and incubate with gentle rocking for 5 min.\nWash the cells three times with 1× PBS for 5 min per wash. If the user has a low-adherence cell line, washing may be done less often (1×).\nNote: If performing antibody staining, at this point begin with an optimized protocol for your target antigen before proceeding to counterstaining.\nCounterstaining.\nAdd 1 volume of Hoechst-33342 working solution to each well in the plate and incubate for 5 min with gentle rocking.\nWash the cells three times with 1× PBS for 5 min per wash. If the user has a low-adherence cell line, washing may be done less often (1×).\nOptional: The cytoplasm of cells can be counterstained as well to provide the user with an internal control for non-transfected cells. We typically achieve this using ActinRed™ 555 ReadyProbes™ Reagent. We typically stain cell cytoplasm prior to nuclear counter staining (between steps 2 and 3) according to the manufacturer’s directions.\nNote: The manufacturer’s instructions for the usage of the ActinRed™ 555 ReadyProbes™ Reagent can be found here (https://www.thermofisher.com/order/catalog/product/R37112[href=https://www.thermofisher.com/order/catalog/product/R37112]).\nOptional: Discard the 1× PBS and replace with 1 volume of antifade solution.",
    "Store the cells at 4°C protected from light until imaging. Imaging should occur within 3 days of staining.\nImaging of fluorescent cells and image quality determination\nTiming: 1–3 h\nThis step in the protocol is to help the user establish best practices for fluorescence microscopy and imaging in plate-based formats. This can be achieved either manually by a practiced user at the microscope, or automatically using microscope controlling software with automatic focusing and acquisition. Here, we detail automated acquisition protocols for inverted microscopes. Each user will likely have a different microscope setup available to them. Therefore, we recommend that the user consult their microscope technician if they need help. We also recommend the user perform this step with an epi-fluorescent wide-field microscope, however, a laser scanning or spinning disk confocal microscope can also be used. The outcome of this step should be a set of high-quality fluorescence microscopy images that are acceptable for image analysis. Images that are acceptable for analysis are in focus, do not contain artefacts, and have fluorescence channels of adequate brightness (Buchser et al., 2012[href=https://www.wicell.org#bib2]). Users should check their files manually for unacceptable images. Alternatively, previous work has also defined methods of automatically and quantitatively determining poor quality images (Bray et al., 2012[href=https://www.wicell.org#bib1]). As with all quantitative image analysis, it can take a few iterations of acquisition and analysis to find the optimal settings for both.\nMicroscope and sample preparation.\nTurn on the microscope, light source, camera, and any other associated equipment you require.\nPlace samples to be imaged in the same room as the microscope so that they can equilibrate to the same temperature as the microscope (30 min–1 h).\nEnsure the light source is emitting at the lowest setting.",
    "Note: Light sources are most likely to include a mercury lamp or light emitting diodes (LEDs). Emission power settings on a mercury lamp typically control all wavelengths of emission, whereas LED’s at different wavelengths may require individual power control. Check with your technician.\nEnsure the camera is set to acquire images in the highest bit-depth available (typically 16-bit).\nImage acquisition optimization.\nPlace the sample onto the stage.\nMove the stage so that you are imaging in the sample well with the highest expected brightness of your FP-tagged POI (i.e., highest expression/inclusion amount).\nFind the plane where the cells are in-focus using brightfield or another transmitted light imaging method.\nNote: If the cells are too difficult to find by transmitted light, or the microscope does not have the ability to image transmitted light, focus on the cells using the nuclear marker of choice (here we used Hoechst-33342). You may need to turn up the light source emission for your chosen marker. Nuclear counterstains are typically the brightest channel in stained samples.\nView the cells in each channel necessary to excite the fluorophores present in the sample and check that no channel has signal exceeding the detection limits of the camera (i.e., no saturated pixels).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2055-Fig2.jpg\nFigure 2. Examples of overexposed and optimally exposed images\n(Left) an overexposed image of cells using a glow lookup table (LUT) where blue pixels are overexposed. (Right) an optimally exposed image where cells are easily visible but there are no overexposed pixels. Corresponding pixel intensities are plotted under respective images where gray are log-normalized values. Scale bar is 50 μm.",
    "Note: Changing the lookup table on your microscope to one that presents overexposed pixels is useful for determining if you are overexposing your sample (Figure 2[href=https://www.wicell.org#fig2]). If the signal is too high, decrease exposure time or illumination intensity for that channel. If the signal is too low the user can increase excitation power, exposure time, or binning (each has a compromise: potential photobleaching, limitations in kinetics, and lower resolution, respectively). More details on image optimization have been previously published for camera-based systems (Lee and Kitaoka 2018[href=https://www.wicell.org#bib7]; Salmon and Waters 2011[href=https://www.wicell.org#bib12]) and point scanning confocal systems (Jonkman et al., 2020[href=https://www.wicell.org#bib5]).\nMove around to different locations in this well of the sample to ensure that as few as possible cells have saturated pixels.\nCritical: It is highly important to make sure that as few as possible cells have signal above the maximum detection of the camera (saturated pixels). Saturated pixels will make data processing and analysis more difficult later for determining cells with inclusions.\nNote: If a large set of samples makes the above optimization too time consuming or impossible, look for the brightest well in a particular sample and optimize the excitation and acquisition settings so that the camera is detecting ∼60% brightness. This leaves enough collection space for most outlier samples in a large screen. Good practice is to have at least one well of each plate be your brightest sample (e.g., an EGFP only control).\nSwitch between acquisition channels and ensure that focus offsets are applied to compensate for wavelength effects on focal plane.\nSet up the microscope acquisition software to automatically image a proportion (generally > 50% of the well area) of each well of the multi-well plate or sample in it using the settings that were just optimized.",
    "Critical: High-resolution in-focus images are necessary due to the usage of spatial measurements to accurately determine which cells contain inclusions later in the protocol. Setting a correct offset for each channel ensures that the plane of imaging in each channel is appropriate.\nSet up the autofocusing method that the microscope uses. This will be either hardware or software-based. For software-based methods, ensure that you are autofocusing using the brightest channel, which is typically the nuclear marker.\nNote: Plastic multi-well plates are not uniformly flat across the bottom. Each manufacturer will have a different molding process that will introduce variance in the plate bottom height and plastic thickness. Make sure your autofocus method searches a large enough distance in the axial plane to capture each well if you are using plastic-bottomed plates.\nProceed to image your samples and save your data.\nNote: A comprehensive file naming and saving strategy is highly important for the following steps of data export, data import for analysis, and metadata import for analysis. In general, as the complexity of the experiment increases, so should the file naming complexity. A multi-plate experiment carried out across days should have a file naming format similar to the following “DATE_PLATE ID_WELL_REGION_CHANNEL”. If this information is not present in the image name, a hierarchy of folders containing the information are acceptable too, e.g., “C:\\DATA\\PLATE ID\\WELL\\REGION\\CHANNEL”. Both of these formats are compatible with regular expression metadata extraction.\nManually investigate your images for artifacts post acquisition.\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2055-Fig3.jpg\nFigure 3. Examples of some common artifacts in image acquisition\nImages such as these, as well as the corresponding images in other channels, should be removed from analysis. White arrows point to listed artifacts. Scale bar is 50 μm.",
    "Note: Sometimes images are not acquired properly due to focus issues or artifacts are present (e.g., dust or fibers in a sample) and these images need to be identified and removed from analysis. To do this, we recommend manually checking each image for grossly aberrant features such as particulate matter, incorrect image acquisition, or out focus images (Figure 3[href=https://www.wicell.org#fig3]). It is good practice to record why an image is removed from the analysis group. Furthermore, in cases where a low number of cells (less than 300) is detected in an individual treatment, reimaging is suggested at a new location that contains no artifacts.\nData export for processing and analysis\nTiming: 15 min per plate\nFile management is important for the analysis of large image sets. A key component of this management is the naming of files and folders so that they incorporate information about the experiment (metadata). Here, we provide a strategy for naming files so that several levels of metadata may be captured (e.g., date, plate, time-point etc). Other users may encounter differences with their microscope set up. Below we provide naming conventions that will allow for easy capture of metadata later when using CellProfiler.\nExporting metadata in a file name.\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2055-Fig4.jpg\nFigure 4. Example of file naming for effective capture of metadata via regular expression\n(A) Middle of the panel is a filename that is written in DATE_PLATE_WELL_REGION_TIME_CHANNEL.tiff, where colors code for the respective information they give to the file.\n(B) An example of a regular expression used to capture metadata from a filename, in this case the date.\n(C) Two example methods of capturing metadata from the example filename. If users follow this file naming strategy, they should be able to simply copy and paste either of these regular expressions into CellProfiler to capture experiment metadata.",
    "Note: The key information about an imaging experiment includes the date it was performed, the sample identifier, the well number (if multi-well plates/slides are used), image region, time-point (if time-lapse imaging is carried out), and the imaging channel. The naming convention in Figure 4[href=https://www.wicell.org#fig4]A shows a naming strategy that incorporates all of this information. It is important to use underscores to separate this information as this makes later steps to capture metadata much easier. The information in this image is captured in CellProfiler using regular expression (a method of specifying a search pattern of text data). In Figure 4[href=https://www.wicell.org#fig4]B an example of a regular expression is shown that would capture the ‘date’ from the filename shown in Figure 4[href=https://www.wicell.org#fig4]A. In Figure 4[href=https://www.wicell.org#fig4]C we provide two examples of regular expressions that fully capture the information about the experiment from the example filename provided in Figure 4[href=https://www.wicell.org#fig4]A. One is verbose and the other simplified. The verbose regular expression is making use of specific expressions that capture specific information. Meanwhile, the simplified regular expression makes use of ‘.∗’, where full stop captures any character and a star symbol dictates the capture of one or more characters. We recommend that users utilize the naming strategy and regular expressions shown here until they are familiar with these concepts.\nCritical: If you acquired 16-bit images, do not export 8-bit images as you will lose the dynamic range of fluorescence intensity data in each pixel. You must maintain your image bit-depth across steps in this protocol.\nCritical: It is essential that large image datasets contain information about the sample in each image. This allows for easy data handling in later steps and for the user to recall information about a specific image to examine if the image processing is accurate.",
    "Note: Each microscope manufacturer has different file types that they use to store imaging data. Batch export options are typically available from most commercial microscopy software. Check with your technician.\nGeneration of illumination corrected images\nTiming: 30 min per plate\nEvery microscope and sample will have unique features and characteristics that result in uneven sample illumination. This is often observed as a gradient of intensity across an image. Correcting for uneven sample illumination is important for more accurate measurement of sample features such as fluorescence intensity. Some microscopes allow for onboard correction of uneven illumination (check with your technician), however, best practice is to perform illumination correction post-acquisition using a large dataset of images gathered from the same sample plate. Here we detail how to use CellProfiler software to generate illumination corrected images for each channel imaged. The outcome of this step should be illumination corrected images from the user’s data (Figure 5[href=https://www.wicell.org#fig5]).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2055-Fig5.jpg\nFigure 5. Example of the two methods of performing illumination correction\nMake a copy of your images for processing and analysis. This is due to raw data needing to be protected from accidental alterations or deletion.\nOpen CellProfiler.\nDrag and drop the folder(s) containing your copied exported images into the CellProfiler UI.\nNote: We recommend processing illumination correction in a plate-by-plate manner as often the variation may be unique to the plate itself. We find the simplest method to do this is by running illumination correction on individual plates, which is achieved by saving data in a format where images from separate plates have their own folders.\nExtract metadata to your images in the Metadata module of CellProfiler (Figure 6[href=https://www.wicell.org#fig6] shows the main CellProfiler window).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2055-Fig6.jpg\nFigure 6. CellProfiler main window",
    "The main window of CellProfiler contains four main modules that should be configured to make later steps easier. Please see Data S1[href=https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2055-Mmc1.zip] for a downloadable example pipeline that shows the usage of each of these modules.\nNote: If you have exported your images in a format that retained information from the acquisition parameters, you should be able to extract metadata via the use of regular expression (See step 7 and Figure 4[href=https://www.wicell.org#fig4] for more details and the example pipeline supplemental information[href=https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2055-Mmc1.zip]). Help windows within CellProfiler provide more information about regular expressions.\nEstablish the channel identifiers under the NamesAndTypes module.\nAssign a name to “Images matching rules”.\nAlter the rules to capture your specific channels. For example, we capture the GFP channel of our file naming convention (P1_B2_1_GFP) by assigning the rule “File Does Contain GFP”. This option will depend on the user’s own naming convention.\nSet up your image groups under the Groups module so that plates and channels are processed individually. Metadata Category “Plate”.\nOptional: You do not have to group channels or images according to the above step (11) if you process one set of images (one channel from one plate) at a time. We sometimes find it quicker and easier to create illumination functions by only loading one channel at a time into CellProfiler rather than loading all images at one time. This is especially useful if you are working on outdated or slow computer hardware.\nNote: The above steps (8–13) are basic steps that we recommend you follow for each CellProfiler Pipeline that you create.\nCalculate the Illumination Functions for your image sets.\nIn the main CellProfiler window, in the empty space below the Groups module, right-click and go to “Image Processing > CorrectIlluminationCalculate”.",
    "In the CorrectIlluminationCalculate module, select your input images and choose between “Regular” or “Background” calculation.\nCritical: It is important that you understand where the majority of uneven illumination may be coming from. Images with very few bright objects are more likely to have uneven illumination as a background feature, whereas images with many bright objects are likely to have uneven illumination stemming from the objects. In the case of few bright objects, a “Background” calculation is appropriate, and in the case of many bright objects a “Regular” calculation is appropriate (Figure 5[href=https://www.wicell.org#fig5]). For more information on illumination correction please see the tutorial here (https://cellprofiler.org/examples[href=https://cellprofiler.org/examples]).\nIf doing regular calculation, input the following options:\nDilate objects > No.\nRescale illumination function > Yes.\nIndividual calculation or all > All First Cycle.\nSmoothing Filter > Gaussian.\nMethod to calculate filter size > Manual (you will need to choose a size large enough that little to no texture is apparent in the final illumination function. On a 2048 × 2048 pixel image, we typically use a filter size of 1024 pixels.\nIf doing background calculation, input the following options:\nBlock size > A value that captures background without an object in it.\nRescale illumination function > No.\nIndividual calculation or all > All First Cycle.\nSmoothing Filter > Gaussian.\nMethod to calculate filter size > Manual (you will need to choose a size large enough that little to no texture is apparent in the final illumination function.\nSaving the illumination function image.\nIn the main CellProfiler window, in the empty space below the Groups module, right-click and go to “File Processing > SaveImages”.\nIn the SaveImages module, make sure you maintain your original image bit-depth and save the image from the first cycle.\nSelect the type of image to save > Image.",
    "Select method for constructing file names > From image filename.\nSelect image name for file prefix > The name of your image that you defined earlier in the NamesAndTypes module.\nOutput file location > Can be anywhere you want, but we typically export illumination functions to a subfolder within the folder that houses the images to be analyzed.\nOptional: You can either create a new pipeline for applying the illumination correction or add the following to your current pipeline. Creating a new pipeline can sometimes be easier if the user is dealing with multiple datasets from different experiments that require different parameters to be applied.\nApply the illumination function.\nIn the main CellProfiler window, in the empty space below the Groups module, right-click and go to “Image Processing > CorrectIlluminationApply”.\nYour input image will be the images you want to correct, and your illumination function is the image that was generated from the CorrectIlluminationCalculate module.\nSubtract the illumination function if you generated a background function. Divide if you generated a regular illumination function.\nCreate a SaveImages module for each channel being illumination corrected and save the illuminated corrected images to a folder for later use.\nStarDist identification of nuclei\nTiming: 3 h",
    "Accurate identification of nuclei in cell imaging datasets is essential for accurate downstream segmentation of cells and their compartments. There are many nuclei identification options available to the user, some of which are in CellProfiler software. The IdentifyPrimaryObjects module in CellProfiler is adequate for the identification of nuclei that are spaced apart and mostly uniform in fluorescence and size (instructions for the use of this module can be found on the CellProfiler https://cellprofiler.org/examples[href=https://cellprofiler.org/examples]). Here, we detail the usage of the StarDist plugin for ImageJ (Schmidt et al., 2018[href=https://www.wicell.org#bib13]), which is a much more powerful tool for accurate nuclei identification. StarDist is capable of accurately identifying and segmenting nuclei that are partly overlapping. The outcome of this step should be a set of images with highly accurate nuclei identification.\nImport a small subset of illumination corrected nuclear channel images into ImageJ.\nActivate the StarDist plugin.\nPlugins > StarDist > StarDist 2D.\nOptimize StarDist parameters for best detection.\nModel = Versatile > fluorescent nuclei.\nOutput Type = Both.\nRun StarDist. A new image and the ImageJ ROI-manager should open.\nIn the ImageJ ROI-manager, go to “Show All”. This option shows the selected nuclei regions of interest on your raw image.\nAssess the accuracy of the StarDist plugin by looking for cases where it did not identify nuclei or it combined two nuclei into one nucleus. Do this for at least 300 nuclei across your image set. Acceptable accuracy here is > 95%.\nIf the nuclei identification is substandard, alter other parameters to enhance accuracy. This will need to be empirically determined by the user. See the published work for details (Schmidt et al., 2018[href=https://www.wicell.org#bib13]).",
    "Once you have determined settings appropriate for accurate identification of nuclei using StarDist. You can run the process in batch mode using code provided in this work or you can generate your own code.\nDownload the StarDist-BATCH ImageJ macro from either ‘https://github.com/ljr979/Stardist-BATCH[href=https://github.com/ljr979/Stardist-BATCH]’ or ‘https://github.com/PlotkinLab/Stardist-BATCH[href=https://github.com/PlotkinLab/Stardist-BATCH]’ and unzip the file to find the python file.\nDrag and drop the file onto your ImageJ main bar to open it.\nMake sure your language is set to python by using the ‘Language’ option at the top of the new window.\nIn the macro code, lines 9–11 can be altered to the parameters determined in the steps in 18 above, to result in the most accurate nuclei identification.\nFor image identification and export, there are two lines that require input from the user as directed.\nLine 17:\ninput_folder = os.path.expanduser(‘C:\\Data\\Images\\Experiment01\\TileScan\\’)\nReplace the example directory here with your own directory. Note that you should replace the backslashes with forward slashes and add an additional forward slash to the end. For example, ‘C:/Data/Images/Experiment01/TileScan/’.\nLine 20:\nfile_identifier = 'Nuclear channel image identifier goes here'\nFor example, file_identifier = 'DAPI'.\nCritical: It is very important that the user makes the correct inputs as directed above. If the slashes are not replaced, the script will not output any label images.\nOnce you have told the macro where your images are located and what the nuclear channel identifier is, press the ‘Run’ button to execute the macro.\nThe output should be new images that are named as ‘label_(your image name)’. For example, and image named “P1_B2_1_DAPI” will be “label_P1_B2_1_DAPI” after StarDist batch processing. For an example see Figure 7[href=https://www.wicell.org#fig7] and the supplementary example pipeline.\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2055-Fig7.jpg\nFigure 7. Example of StarDist identification of nuclei from fluorescent imaging",
    "Images are loaded into the StarDist plugin and processed according to the settings shown in the middle panel. The output from this is regions of interest (ROIs) and a label image showing identified nuclei. Note that the automation proceeds through the ImageJ macro functions and this window is not viewed when batch processing.\nNote: If the user wishes to change the prefix name given to the StarDist-processed images, they should alter the text bolded and underlined here from line 40:\nio.save(label, os.path.join(output_folder,\"label_%s\" %(name).\nGenerating a CellProfiler pipeline for measurement of features associated with inclusion formation\nTiming: 3 h\nThis step in the protocol is the generation of the main CellProfiler pipeline that both segments cells into nuclear and cytoplasmic compartments, as well as generating the feature measurements for the classification of cells. At this point, the user should have illumination corrected images for each channel of analysis and StarDist identified nuclei images. The main outcome of this step is accurate segmentation of cells, generation of excel spreadsheets with individual cell measurements, and generation of files necessary for input into CellProfiler Analyst. A general workflow is presented in Figure 8[href=https://www.wicell.org#fig8]. See Data S1[href=https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2055-Mmc1.zip] to download an example pipeline for windows systems.\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2055-Fig8.jpg\nFigure 8. General workflow of image processing in CellProfiler\nOptional: As stated above, you can identify nuclei using the CellProfiler IdentifyPrimaryObjects module. See here for more information (https://cellprofiler.org/examples[href=https://cellprofiler.org/examples]).\nNote: The exact parameters that are best to implement at each step in the pipeline are guidelines here. The user will have to empirically determine the parameters that best capture the cells within their image sets. Unless stated, all parameters for each module are default.\nNote: The following step-by-step protocol assumes that StarDist output images are being used for nuclei detection.\nLoad Images into CellProfiler.",
    "The images should be illumination corrected images from each channel and the StarDist identified nuclei images.\nSetup the Metadata module for your image set (see steps 8–11 or the example pipeline for more information).\nCapture Plate number, well number, sample identifier (e.g., mutant/drug) etc.\nSet up NamesAndTypes module.\nAt a minimum, the user should have a nuclear channel, aggregating protein channel, and the StarDist images as separate names/types.\nNote: Since StarDist batch processing results in files named similar to the input images, using “Does not contain” rules help delineate between original nuclear channel images and StarDist images.\nOptional: The Groups module can be set up here but is not necessary for the following steps.\nAdd a ConvertImageToObjects module to the pipeline and change the below settings.\nInput image = StarDist image.\nConvert to Boolean image = No.\nIn some instances, StarDist will detect micro-nuclei in your images. These need to be removed from the analysis as they may confound the identification of cells. To do this add a MeasureObjectSizeShape module followed by a FilterObjects module.\nInput objects = nuclei.\nFiltering Mode = measurements.\nFiltering Method = Limits.\nCategory = AreaShape.\nMeasurement = Area.\nFilter only using a minimum value. You will need to empirically determine the value that removes micronuclei, but not actual nuclei in your experiments.\nKeep removed objects as a separate set? No.\nAdd an ExpandOrShrinkObjects module to the pipeline and shrink the nuclei by at least one pixel. You may need to empirically determine the most appropriate number of pixels for shrinking that prevents the subsequent masking step from not removing untransfected cells.\nAdd an EnhanceOrSuppressFeatures module to the pipeline. This is to subtract unwanted background from the cells.\nInput image = raw image of aggregating protein.",
    "Enhance speckles using an empirically determined feature size. Generally you want to keep the size slightly above the size of the object you want to enhance, which in this case are entire cells.\nAdd a Smooth module to the pipeline.\nInput image = image from EnhanceOrSuppressFeatures.\nSmoothing method = Gaussian filter.\nSmooth the image enough that there are no jagged edges on cells. We typically do 4 or 2 pixels smooths.\nAdd a Threshold module to the pipeline. This step creates a binary image for overlaying onto identified nuclei.\nInput image = image from Smooth.\nThreshold strategy = Global.\nThreshold method = Minimum Cross-Entropy.\nLog transform = yes.\nAdd a MaskObjects module to the pipeline. This step lets us identify truly transfected nuclei and enhance subsequent cytoplasm identification.\nObjects to be masked = Shrunken Nuclei (from step 24).\nMask using an image.\nMasking image = image from Threshold module.\nInvert mask = no.\nHandling of objects that are partially masked = remove.\nNumbering of resulting objects = renumber.\nAdd an IdentifySecondaryObjects module to the pipeline. This step identifies the cell cytoplasm for each nuclei.\nInput image = image from EnhanceOrSuppressFeatures (step 25).\nInput objects = objects from MaskObjects.\nMethod for identification = propagation.\nThreshold Strategy = Global.\nThresholding method = Minimum Cross-Entropy.\nLog transform = yes.\nDiscard secondary objects touching image border = yes.\nAt this point cell identification should be accurate. The user can screen their pipeline on a small set of images by adding an OverlayOutlines module followed by a SaveImages module.",
    "Add the following modules to the pipeline and make sure they are measuring objects from IdentifySecondaryObjects (step 32) in your aggregating protein image (the original illumination corrected images that are NOT processed – i.e., smoothed or masked). To determine how to set the parameters within these settings, we recommend that users measure the size of aggregates using the CellProfiler measurement tool or ImageJ measurement tool. Generally setting spatial measurements to the average size of aggregates within cells is adequate for machine learning to differentiate features.\nMeasureGranularity, MeasureTexture, MeasureObjectIntensityDistribution, MeasureObjectSizeShape, MeasureObjectIntensity.\nNote: Some of these measurement modules will contain options to measure Zernike features. Measurement of these features can be very computationally intensive. If the user is running this pipeline on a desktop PC for large datasets, we recommend turning the measurement of Zernike features off. If a small dataset is being analyzed (<10,000 images) this feature can remain on for enhanced classification accuracy.\nAdd an ExportToDatabase module and configure this.\nDatabase type = SQLite.\nCreate CellProfiler Analyst Properties file = Yes.\nObjects to be used for locations = Objects from IdentifySecondaryObjects.\nClassification type = Object.\nExport measurements for all objects to the database = Select > objects from IdentifySecondaryObjects.\nExport object relationships = no.\nAuto-scale thumbnail pixel intensities = yes.\nRun this pipeline on a subset of images that incorporates the breadth of expected aggregation phenotypes and evaluate accuracy. This is so the pipeline can be tested and enhanced for the larger image sets that a user might have.\nRun the pipeline on your entire data set.\nUsing CellProfiler analyst to classify cells with inclusions\nTiming: 1–3 h",
    "This step details the usage of Analyst to train a classification model to recognize cells containing inclusions. Training of classifiers using machine learning requires careful assessment of the phenotypes that each cell class (no inclusions vs. inclusions) is presenting.\nLoad the properties file created from your CellProfiler pipeline into CellProfiler Analyst.\nOpen the Classifier module.\nFetch 50–100 random cells from the experiment.\nTurn off the overlays of nuclear stains and StarDist so you can effectively see your aggregation protein channel in the thumbnails.\nClick on the menu’s for each channel and turn them off except for your channel of interest.\nSort cells by dragging and dropping from your requested set into classes on the basis of whether they contain inclusions or not (Figure 9[href=https://www.wicell.org#fig9]). You can add more classes if needed by clicking the button in the bottom right corner.\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2055-Fig9.jpg\nFigure 9. Classifier window for sorting cells into their respective classes\nSort approximately 20 cells into each class. Fetch more cells if you run out of a certain phenotype.\nTrain using a classifier of your choice. We find that the random forest classification is the most accurate, however, fast gentle boosting can be fast and highly accurate if the training set is adequate in size and quality.\nTo train the classifier, click on “train” in the window and wait for it to calculate.\nRequest a number of cells from your inclusions class and sort them into their respective bins.\nRequest a number of cells from your no inclusions class and sort them into their respective bins.\nTrain the classifier again as necessary (see next step).\nNote: Make sure to regularly save training sets if an error occurs. The option to save a training set is in the ‘file’ menu.",
    "Repeat the above steps until you have obtained sufficient classification accuracy. Assess accuracy by requesting 100 cells of each class 3 times and scoring the percent that are correct. We only accept an accuracy of > 95% in both classes for our work.\nOnce the classifier is accurate, score all images in the data set by clicking ‘Score All’. This may take some time to calculate.\nExport the data from the table and process in a program of your choice. We use excel followed by GraphPad PRISM but python scripts can be particularly helpful for this output type."
  ],
  "subjectAreas": [
    "Cell Culture",
    "Cell-Based Assays",
    "Microscopy",
    "High Throughput Screening"
  ],
  "bigAreas": [
    "Bioengineering & Technology"
  ]
}