{
  "id": 3545,
  "origin_website": "Cell",
  "title": "Protocol for generating high-quality genome-scale DNA methylation sequencing data from human cancer biospecimens",
  "procedures": [
    "Step-by-step method details\nStep-by-step method details\nExtraction of genomic DNA\nTiming: 1 day\nThe generation of reliable DNA methylome data is highly dependent on the quality and amount of the input DNA. For fresh-frozen cancer tissue and cell lines, this is relatively straightforward if there is a sufficient amount of starting material and best practice is used to ensure minimal degradation of DNA. Extraction of high-quality DNA from FFPE cancer tissue is more complex – the fixation process can cause crosslinking of nucleic acids, random breakages in nucleotide sequences, and introduce sequence artifacts. Obtaining reliable methylome data from FFPE tissue is achievable, as we have shown previously,22[href=https://www.wicell.org#bib22] but results are highly dependent on how the tissue was fixed, how it was stored, and the age of the block. The DNA extraction protocol here is adapted from the QIAGEN QIAamp guidelines, with amendments to improve yield and quality. We provide specific recommendations for optimization of FFPE tissue, fresh-frozen tissue, and cell lines.\nFor FFPE cancer tissue:\nUsing a microtome, cut 5–10 μm thick sections from the sample block.\nDiscard the first 2–3 sections (due to air exposure).\nPlace the next 4–8 sections into a 1.5 mL DNA LoBind microcentrifuge tube.\nAdd 320 μL deparaffinization solution.\nMix thoroughly by vortexing.\nBriefly centrifuge so content is at the bottom of tube.\nIncubate at 56°C for 3 min.\nAllow to cool at room temperature.\nAdd 180 μL QIAamp ATL buffer.\nMix by vortexing.\nCentrifuge for 1 min at 11,000 × g.\nAdd 20 μL proteinase K to the lower phase (clear liquid).\nMix gently by pipetting up and down.\nIncubate cell preparation on Thermomixer overnight (16–20 h) at 56°C, with moderate shaking (300–400 rpm).\nIf the cells have not fully digested, add 20 μL proteinase K and incubate for a further 1–2 h.",
    "Remove tube from the Thermomixer.\nIncrease the temperature to 90°C, and then incubate at 90°C for 1 h.\nBriefly centrifuge to remove drops from inside the lid.\nCarefully pipette the lower phase into a new 1.5 mL DNA LoBind tube.\nAdd 4 μL RNase A (100 mg/mL).\nMix by vortexing.\nIncubate for 2 min at room temperature.\nAdd 200 μL QIAamp AL buffer to the sample.\nMix again by vortexing.\nIncubate at 70°C for 10 min.\nBriefly centrifuge to remove drops from inside the lid and proceed to step 4.\nFor fresh-frozen cancer tissue:\nRetrieve the frozen tissue and equilibrate to room temperature for a short time.\nCut the tissue (up to 20 mg) into small pieces.\nPlace in a 1.5 mL DNA LoBind microcentrifuge tube with 180 μL of QIAamp ATL buffer.\nUse a pellet pestle to grind the tissue pieces.\nAdd 20 μL proteinase K.\nMix by vortexing.\nBriefly centrifuge so content is at the bottom of tube.\nIncubate cell preparation on Thermomixer overnight at 56°C, with moderate shaking (300–400 rpm).\nIf the cells have not fully digested, add 20 μL proteinase K and incubate for a further 1–2 h.\nBriefly centrifuge to remove drops from inside the lid.\nAdd 4 μL RNase A (100 mg/mL).\nMix by vortexing.\nIncubate for 2 min at room temperature.\nAdd 200 μL QIAamp AL buffer to the sample.\nMix again by vortexing.\nIncubate at 70°C for 10 min.\nBriefly centrifuge to remove drops from inside the lid and proceed to step 4.\nFor cancer cell lines:\nTo harvest adherent cultured cells, discard media and wash with 5 mL PBS.\nAdd ∼3 mL trypsin to detach the cells from the surface of the flask.\nIncubate at 37°C for 2–3 min.",
    "Gently shake or tap the bottom of the flask to help detach cells and incubate longer if necessary.\nWhen the cells have detached, add 10 mL of media.\nTransfer cell suspension to a 15 mL Falcon conical centrifuge tube.\nCount the number of cells using a hemocytometer.\nTo pellet the cells, centrifuge the cells at 200 × g for 5 min.\nDiscard the supernatant.\nThe cell pellet can be frozen at −80°C for future use or further processed immediately.\nIn a 1.5 mL DNA LoBind tube, resuspend cell pellet (up to 5 × 106 cells) in PBS to a total volume of 200 μL.\nAdd 20 μL QIAGEN protease solution and 200 μL QIAamp AL buffer to cell suspension.\nMix by vortexing.\nBriefly centrifuge so content is at the bottom of tube.\nIncubate cell preparation on Thermomixer overnight at 56°C, with moderate shaking (300–400 rpm).\nIf the cells have not fully digested, add 20 μL QIAGEN protease solution and incubate for a further 1–2 h.\nBriefly centrifuge to remove drops from inside the lid and proceed to step 4.\nFollowing on from either step 1 (for FFPE tissue), step 2 (for fresh-frozen tissue) or step 3 (for cell lines):\nAdd 200 μL ethanol (100%).\nVortex to mix.\nCarefully apply the mixture to a QIAamp mini spin column (in a 2 mL collection tube).\nCentrifuge at 20,000 × g for 1 min.\nPut the spin column in a clean 2 mL collection tube and discard the filtrate.\nAdd 500 μL QIAamp AW1 buffer to the spin column.\nCentrifuge at 20,000 × g for 1 min.\nPut the spin column in a clean 2 mL collection tube and discard the filtrate.\nRepeat with 500 μL QIAamp AW2 buffer.\nCentrifuge at 20,000 × g for 1 min.",
    "Put the spin column in a clean 2 mL collection tube.\nCentrifuge again at 20,000 × g for 3 min.\nPut the spin column in a 1.5 mL DNA LoBind tube.\nImmediately add 50 μL QIAamp ATE buffer (pre-warmed to 30°C) directly onto the spin column membrane.\nIncubate at room temperature for 5 min.\nCentrifuge at 6000 × g for 1 min.\nImmediately re-apply the 50 μL filtrate onto the spin column membrane.\nCentrifuge again at 6000 × g for 1 min.\nRetain the eluate containing purified DNA for the next step.\nCheck the DNA quality (A260/A280 ratio 1.7–1.9) on a NanoPhotometer and determine the concentration using a Qubit Fluorometer and dsDNA BR Assay Kit. Troubleshooting[href=https://www.wicell.org#troubleshooting].\nNote: DNA can be stored short-term at 4°C and long-term at −20°C.\nCritical: Particularly for FFPE sections, which should be freshly cut, it is important to process the samples as soon as possible. Exposure of sections to air negatively impacts DNA quality, which gets worse with time.\nCritical: QIAGEN guidelines indicate a protease/proteinase K digestion time of 1 h, but a much longer time is required for DNA used in methylome sequencing libraries to enable complete dissociation of genomic DNA from contaminating nucleosomal or DNA binding proteins.\nCritical: Using the QIAamp mini spin columns requires careful pipetting and liquid handling. Avoid wetting the rim of the spin column or touching the membrane with the pipette tip. After the wash steps with QIAamp AW1 and AW2 buffers, the column is centrifuged for a further 3 min to completely dry the membrane and remove any ethanol carryover. However, the membrane should not be left dry for too long before the elution buffer is added.\nDNA methylome library preparation\nTiming: 3 days",
    "Here we present a detailed protocol for the generation of libraries for reduced representation bisulfite sequencing (RRBS), a technique for comprehensive profiling of genome-scale DNA methylation patterns.23[href=https://www.wicell.org#bib23],24[href=https://www.wicell.org#bib24],25[href=https://www.wicell.org#bib25] RRBS library preparation involves digesting genomic DNA with MspI restriction enzyme, which cuts at 5′-C↓CGG-3′ irrespective of the methylation status, to enrich for CpG-dense regions of the genome. Adapter-ligated fragments are bisulfite-converted and amplified by PCR, which allows for sequence-based distinction between methylated and unmethylated CpGs, and then 40–220 bp fragments are size-selected. Although the 4 million CpG sites that RRBS covers is less than for whole genome bisulfite sequencing, it is significantly more than the <850 k CpG sites covered by Infinium MethylationEPIC arrays. For this reason, RRBS provides ample data for robust genome-scale methylation profiling while also remaining cost-effective.\nSet up MspI restriction endonuclease digest in MAXYMum Recovery 0.2 mL PCR tube.\nIncubate overnight (16–20 h) at 37°C on a 96-well thermal cycler.\ntable:files/protocols_protocol_3115_1.csv\nNote: if the volume of genomic DNA exceeds 28 μL, the total volume can be increased and the other components increased proportionately.\nQIAquick spin column purification:\nAdd 5 volumes of QIAquick PB buffer to 1 volume of the restriction digest from step 5.\nMix by inversion or by pipetting (e.g., 200 μL of PB buffer to 40 μL restriction digest) in a 1.5 mL DNA LoBind tube.\nApply mixture to a QIAquick spin column.\nCentrifuge at 20,000 × g for 1 min and discard the filtrate.\nTo wash, add 700 μL QIAquick PE buffer to the spin column.\nCentrifuge at 20,000 × g for 1 min.\nDiscard the filtrate, place the spin column into a new 2 mL collection tube.\nCentrifuge the column for an additional 1 min.\nPlace spin column in a clean well-labeled 1.5 mL DNA LoBind tube.",
    "To elute DNA, add 60 μL QIAquick EB buffer (pre-warmed to 30°C) directly to the center of the spin column membrane.\nIncubate at room temperature for 10 min.\nCentrifuge at 20,000 × g for 1 min.\nRe-apply the 60 μL eluate directly on the spin column membrane.\nIncubate at room temperature for 1 min.\nCentrifuge at 20,000 × g for 1 min.\nRetain the eluate for the next step.\nPause point: DNA can be stored short-term at 4°C and long-term at −20°C.\nSet up End Repair reaction in a 1.5 mL LoBind tube.\nAdd 40 μL thawed TruSeq Nano ERP2 to the 60 μL of purified MspI-digested DNA from step 6.\nIncubate for 30 min at 30°C on a Thermomixer (hold at 4°C).\nMinElute spin column purification:\nAdd 500 μL of MinElute PB buffer to the 100 μL end repair reaction.\nMix by inversion.\nApply the mixture to a MinElute spin column.\nCentrifuge at 20,000 × g for 1 min, and discard the filtrate.\nTo wash, add 700 μL MinElute PE buffer to the spin column.\nCentrifuge at 20,000 × g for 1 min.\nDiscard filtrate and place the spin column into a new 2 mL collection tube.\nCentrifuge the column for an additional 1 min at 20,000 × g.\nPlace spin column in a clean well-labeled 1.5 mL LoBind tube.\nTo elute DNA, add 18 μL MinElute EB buffer (pre-warmed to 30°C) directly to the center of the spin column membrane.\nIncubate at room temperature for 10 min.\nCentrifuge the column at 20,000 × g for 1 min.\nRe-apply the 18 μL eluate directly on the spin column membrane.\nIncubate at room temperature for 1 min.\nCentrifuge at 20,000 × g for 1 min.\nRetain the eluate for the next step.",
    "Pause point: DNA can be stored short-term at 4°C and long-term at −20°C.\nSet up A-Tailing reaction in a MAXYMum Recovery 0.2 mL PCR tube.\nAdd 12 μL thawed TruSeq Nano ATL to the 18 μL of purified DNA from step 8.\nIncubate on a 96-well thermal cycler:\ntable:files/protocols_protocol_3115_2.csv\nSet up Adapter Ligation reaction in a MAXYMum Recovery 0.2 mL PCR tube.\nIncubate for 11 min at 30°C on a 96-well thermal cycler.\nImmediately following the reaction, add 5 μL TruSeq Nano STL.\ntable:files/protocols_protocol_3115_3.csv\nNote: for low-input RRBS libraries (<100 ng), use adapter index and ligation mix which has been diluted 1 in 5 to prevent excessive adapter dimers in subsequent steps.\nNote: there are 24 different TruSeq Nano Adapter indexes to allow for multiplexing of samples. We recommend using the Illumina Experiment Manager software to determine the best multiplexing adapter combinations.\nMinElute spin column purification:\nAdd 215 μL of MinElute PB buffer to the 37.5 μL adapter ligation reaction from step 10.\nMix by inversion.\nApply the mixture to a MinElute spin column.\nCentrifuge at 20,000 × g for 1 min and discard the filtrate.\nTo wash, add 700 μL MinElute PE buffer to the spin column.\nCentrifuge at 20,000 × g for 1 min.\nDiscard filtrate and place the spin column into a new 2 mL collection tube.\nCentrifuge the column for an additional 1 min and place spin column in a clean well-labeled 1.5 mL LoBind tube.\nTo elute DNA, add 20 μL MinElute EB buffer (pre-warmed to 30°C) directly to the center of the spin column membrane.\nIncubate at room temperature for 10 min.\nCentrifuge the column at 20,000 × g for 1 min.\nRe-apply the 20 μL eluate directly on the spin column membrane.\nIncubate at room temperature for 1 min.",
    "Centrifuge at 20,000 × g for 1 min.\nRetain the eluate for the next step.\nPause point: DNA can be stored short-term at 4°C and long-term at –20°C.\nBisulfite conversion:\nPrepare EZ DNA Methylation-Direct CT conversion reagent.\nAdd 790 μL of M-Solubilization buffer and 300 μL of M-Dilution Buffer to a tube of CT Conversion Reagent.\nMix thoroughly by vortexing for 1 min.\nIncubate CT reagent mixture on Thermomixer for 1 h at room temperature with high shaking (>2000 rpm). By visual inspection, the powder should be completely dissolved.\nAdd 160 μL of M-Reaction Buffer.\nMix for an additional 1 min.\nSet up Bisulfite conversion reaction in a MAXYMum Recovery 0.2 mL PCR tube.\nAdd 130 μL of the CT reagent to the 20 μL of adapter-ligated DNA from step 11.\nIncubate on a 96-well thermal cycler:\ntable:files/protocols_protocol_3115_4.csv\nEZ DNA spin column purification:\nAdd 600 μL of EZ DNA M-Binding Buffer to the 150 μL bisulfite conversion reaction from 12 to a Zymo-Spin IC Column in a 2 mL collection tube.\nMix by inversion.\nCentrifuge at 20,000 × g for 1 min and discard the filtrate.\nTo wash, add 100 μL of EZ DNA M-Wash Buffer to the spin column.\nCentrifuge at 20,000 × g for 1 min.\nAdd 200 μL of EZ DNA M-Desulfonation Buffer to the spin column.\nIncubate at room temperature for 15–20 min.\nCentrifuge at 20,000 × g for 1 min.\nTo wash, add 200 μL of EZ DNA M-Wash Buffer to the spin column.\nCentrifuge at 20,000 × g for 1 min.\nRepeat by adding a further 200 μL of EZ DNA M-Wash Buffer to the spin column.\nCentrifuge at 20,000 × g for 1 min.\nDiscard the collection tube and place spin column in a clean well-labeled 1.5 mL LoBind tube.",
    "To elute DNA, add 15 μL EZ DNA M-Elution Buffer (pre-warmed to 30°C) directly to the center of the spin column membrane.\nIncubate at room temperature for 10 min.\nCentrifuge the column at 20,000 × g for 1 min.\nRe-apply the 15 μL eluate directly on the spin column membrane.\nIncubate at room temperature for 1 min.\nCentrifuge at 20,000 × g for 1 min.\nRetain the eluate for the next step.\nPause point: bisulfite-converted DNA can be stored for 2–3 days at 4°C and <1 month at −20°C.\nSet up a semi-quantitative PCR reaction in a MAXYMum Recovery 0.2 mL PCR tube.\nMix by flicking the tube.\nBriefly centrifuge to bring content to bottom of tube.\ntable:files/protocols_protocol_3115_5.csv\nAliquot 12 μL of the reaction mix into two 0.2 mL PCR tubes and run separately on a 96-well thermal cycler (one for 15 and the other for 20 cycles of PCR):\ntable:files/protocols_protocol_3115_6.csv\nAdd 2 μL DNA Gel Loading Dye to each PCR reaction.\nLoad PCR reactions on a 3% (w/v) NuSieve agarose gel made up in 0.5x TAE buffer, alongside 7 μL of Quick-Load Purple Low Molecular Weight DNA Ladder.\nSubmerged in 0.5x TAE buffer (0.0024% ethidium bromide), run the gel in an electrophoresis system for ∼90 min at 50 V.\nImage the gel using a UV Gel Imaging System, ensuring that the DNA ladder bands are clearly visible. Assess the gel and determine the optimal number of cycles (between 15 and 20) for large-scale PCR amplification of the library.\nSet up large-scale PCR amplification in a MAXYMum Recovery 0.2 mL PCR tube.\nMix by flicking the tube.\nBriefly centrifuge to bring content to bottom of tube.\nRun on a 96-well thermal cycler using the same cycling conditions in step 14.\ntable:files/protocols_protocol_3115_7.csv",
    "Note: following the semi-quantitative and large-scale amplification PCR steps above, ∼11 μL of bisulfite-converted DNA from step 13 will remain. If any issues arise with remaining steps, this remaining DNA can be used for large-scale amplification.\nBead purification and size-selection:\nBring an aliquot of TruSeq Sample Purification beads to room temperature from 4°C storage and vortex to make a homogenous solution.\nAdd 30 μL of the beads (0.6× volume ratio) to PCR product from step 15.\nPipette up and down to thoroughly mix.\nIncubate at room temperature for 15 min.\nPlace the PCR tube on a magnetic rack for 5 min until the beads form a small dark pellet on the side of the tube and the solution is clear.\nCarefully pipette the clear supernatant, which contains the library, into a new 0.2 mL PCR tube without disturbing the beads. Discard the original PCR tube with the beads.\nTo the new tube with the library, add 20 μL fresh TruSeq Sample Purification beads (0.4× of original volume).\nPipette up and down to thoroughly mix.\nIncubate at room temperature for 15 min.\nPlace the PCR tube on a magnetic rack for 5 min until the bead pellet is visible on the side of the tube and the solution is clear.\nCarefully remove the clear supernatant by pipette, which contains the small molecular weight contaminants, and discard.\nTo wash the beads, add 200 μL of freshly prepared 70% ethanol (v/v).\nCarefully remove the ethanol by pipette and discard.\nRepeat the wash once more and ensure all ethanol is removed.\nRemove the tube from the magnetic rack and allow the bead pellet to dry by leaving the tube open at room temperature for ∼1 min.",
    "Note: This requires watching closely and the pellet will go from shiny to matte. Try not to let bead pellet crack as this can result in a lower yield of purified DNA.\nAdd 20 μL of TruSeq Resuspension Buffer (pre-warmed to 30°C) to the pellet.\nMix well with the pipette to resuspend the beads.\nIncubate at room temperature for a minimum of 15 min.\nReturn the PCR tube to the magnetic rack for 5 min until the bead pellet is visible on the side of the tube and the solution is clear.\nCarefully pipette the clear supernatant, which contains the purified library, into a 1.5 mL LoBind tube without disturbing the beads (∼2 μL of supernatant will be left behind regardless of the elution volume).\nPause point: bisulfite-converted DNA methylome libraries can be stored for 2–3 days at 4°C and long-term at –20°C.\nLibrary quantification and quality assessment:\nUsing a Qubit Fluorometer and dsDNA BR Assay kit according to the manufacturer’s instructions, quantify the DNA library.\nPrepare a ∼2 ng/μL dilution of the DNA library and run on a 2100 Bioanalyzer instrument using a high-sensitivity DNA kit.\nAssess the Bioanalyzer electropherogram, which is a data plot of DNA fragment size (bp) versus fluorescence intensity.\nNote: The profile should display a broad peak at ∼260 bp, corresponding to 150–325 bp size-selected fragments. Troubleshooting[href=https://www.wicell.org#troubleshooting]\nUse the following formula to determine library molarity:\nnM\n=\nQubit\nconcentration\n(\nng\n/\nμ\nL\n)\n/\n(\naverage\nfragment\nlength\n(\nbp\n)\n×\n0.00065\n)\nSequencing submission:\nIn consultation with a sequencing provider, prepare a 30 μL equimolar pool (10 nM) of multiple DNA libraries in a LoBind tube, ensuring the TruSeq Nano Adapter indexes are unique for each.",
    "Note: We typically pool up to 12 libraries for NextSeq 2000 P2 sequencing with 100 bp single-end reads (∼30 million reads/sample). The sequencing provider denatures the pooled library with NaOH and then dilutes it to a final concentration of 8 pM, which is used for cluster generation on the Illumina cBot system and then preliminary QC analysis is performed on a MiSeq platform before proceeding to full sequencing on a high throughput system such as HiSeq or NextSeq.\nCritical: The preparation of the EZ DNA Methylation-Direct CT conversion reagent provides enough for 10 reactions. Any remaining reagent can be stored for up to 1 week at 4°C or up to 4 weeks at –20°C. Following storage, the CT reagent needs to be mixed thoroughly – incubate on Thermomixer for 1 h at room temperature with high shaking.\nCritical: Assessing the gel image from semi-quantitative PCR is necessary to determine the optimal number of cycles for large-scale amplification in the next step. By comparing the products of the PCR with either 15 or 20 cycles: a) there should be a sufficient amount of 150–330 bp product without non-specific amplification; b) the number of cycles should be kept to a minimum to reduce amplification bias – we do not recommend any higher than 20 cycles. A 125 bp adaptor-dimer band is typically present, but this is removed following large-scale PCR amplification of the library using bead purification.\nData processing and quality control\nTiming: 2 days",
    "Next generation sequencing generates large amounts of data, which needs to be processed and quality-checked with specialist software before proceeding with downstream analyses. Here we present a simple workflow to: obtain the raw sequencing data; perform quality control analysis; remove adapter sequences and low-quality reads; map the sequencing reads to a reference genome; extract the methylation information for each MspI fragment/CpG and annotate them with overlapping genomic features.\nData acquisition:\nSequencing providers often have multiple options to give access to the demultiplexed sequencing data, for example:\nUse the BaseSpace platform (https://basespace.illumina.com/[href=https://basespace.illumina.com/]) to access Illumina run metrics and data.\nSecurely transfer large amounts of data using a file-sharing service such as Globus (https://www.globus.org/data-transfer[href=https://www.globus.org/data-transfer]).\nFor rapid copying and synchronization of sequencing data between servers, use the following command in bash:\n$ rsync -avP source_destination\nNote: We recommend retaining a backup of the raw, unprocessed sequencing data in a secure location. FASTQ is the standard file format (.fq or .fastq extensions) for high throughput sequencing data and will often be gzip compressed (.gz extension). Although FASTQ is a text-based format that includes both read sequence and quality information, specialist programs are required to process and analyze the millions of sequencing reads (e.g., we typically use NextSeq 2000 P2 sequencing, which yields up to 400M single-end 100 bp reads).\nFastQC is an efficient program that can be used to perform quality control analysis of high throughput sequencing data. Use the following command to generate a FastQC output:\n$ fastqc --outdir qc ∗.fastq.gz",
    "Note: The summarized output provides useful information on per base sequence quality, per base sequence content, overrepresented sequences, and adapter content. The FastQC analysis of raw sequencing reads will show the presence of adapter sequence and low-quality sequence reads (Phred score <20), which will need to be removed to obtain optimal genome alignment.\nAdaptor sequence clean-up from datasets:\nUse the cleanadaptors function of DMAP to remove adapter sequences provided in the contam.fa file, trims 3 bases back from the adapter to delete the C incorporated during end repair (-t 3) and filters out any reads trimmed to <20 bp (-x 20). Assess the trimming performance by repeating the FastQC analysis on the trimmed FASTQ file.\n$ cleanadaptors -I contam.fa -t 3 -x 20 \\\n-z -F methylome_01.fastq.gz -o methylome_01_trimmed.fastq.gz\nNote: In this example, cleanadaptors removes adapter sequences provided in the contam.fa file, trims 3 bases back from the adapter to delete the C incorporated during end repair (-t 3) and filters out any reads trimmed to <20 bp (-x 20). Assess the trimming performance by repeating the FastQC analysis on the trimmed FASTQ file.\nAlternatively, use Trim Galore for quality and adapter trimming (which also produces a trimming report and FastQC of the trimmed FASTQ file):\n$ trim_galore --rrbs –fastqc methylome_01.fastq.gz\nGenome alignment:\nFollowing trimming and filtering, align the high-quality sequencing reads to the human reference genome (in FASTA format, available from http://ftp.ensembl.org/pub/[href=http://ftp.ensembl.org/pub/]) using Bismark, a program specifically designed for mapping bisulfite-treated sequencing reads. In the same directory as the reference genome files, build the Bismark libraries with a one-off command:\n$ bismark_genome_preparation ./\nAlign the sequencing reads to the Bismark-prepared reference genome, allowing for only one mismatch in the seed (i.e., in the first 28 bp of each read):\n$ bismark -n 1 –genome /path_to_reference_genome/ \\ methylome_01_trimmed.fastq.gz",
    "Note: The standard output file for Bismark is a binary alignment map (BAM), a machine-readable file that contains information on where the sequencing reads map in the human genome. An alignment report file is also produced, which gives an overview of mapping efficiency (number of unique alignments/sequences analyzed in total) and proportions of context-specific cytosine methylation: percentage of methylation (context) = 100 × methylated Cs (context) / (methylated Cs (context) + unmethylated Cs (context)). For libraries generated from fresh-frozen tissues and cultured cells, we routinely obtain 60%–70% alignment efficiency. For FFPE tissues, the alignment efficiency is sometimes decreased, but is dependent on how the tissue was fixed, how it was stored, and the age of the block – all of which affect the quality of the DNA extracted. Troubleshooting[href=https://www.wicell.org#troubleshooting]\nExtraction of DNA methylation data:\nUsing the genome alignment information in a BAM file, run the diffmeth program in DMAP to generate a readable coverage-filtered methylome text file using MspI-digested fragments as the unit of analysis:\n$ diffmeth -F 2 -t 10 -z -G /path_to_reference_genome/ \\\n-L 40,220 -R methylome_01_trimmed_bismark_bt2.bam \\\n> methylome_01_fragments.txt\nNote: In this example, the output will show 40–220 bp fragments (-L 40,220) with at least two CpG sites (-F 2) covered by 10 or more sequenced reads (-t 10). Full documentation and user guide for DMAP are available as a GitHub repository (https://github.com/peterstockwell/DMAP[href=https://github.com/peterstockwell/DMAP]).\nAlso using a BAM as an input, run Bismark methylation extractor to generate a genome-wide cytosine report and a text file in bedgraph format that contains the methylation call for each single C analyzed:\n$ bismark_methylation_extractor --bedGraph --comprehensive \\\n--merge_non_CpG --cutoff 10 \\ methylome_01_trimmed_bismark_bt2.bam\nNote: The output of this example will show each CpG site covered by 10 or more sequenced reads (--cutoff 10) and strand-specific methylation combined into a single context-dependent file (--comprehensive).",
    "Annotate each MspI fragment from the DMAP output file or each CpG from the Bismark methylation extractor with genomic features using the identgeneloc program DMAP:\n$ identgeneloc -i -Q -U -R -B \"protein_coding\" \\\n-G /path_to_feature_tables/ \\\n-r methylome_01_trimmed_bismark_bt2.txt \\\n> methylome_01_trimmed_bismark_bt2_geneloc.txt\nExample of identgeneloc annotated output:\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/3115-Undfig2.jpg\n. \nUse BEDTools for further bespoke annotation with genomic features:\n$ bedtools intersect -wa -wb -a methylome_01_fragments.bed \\\n-b repeatmasker.bed > methylome_01_repeats.txt\nNote: This example identifies where each MspI fragment overlaps a repeat element (obtained from the RepeatMasker track in UCSC genome browser: https://genome.ucsc.edu/[href=https://genome.ucsc.edu/]).\nWith the unionbedg function, use BEDTools to combine multiple sorted methylome outputs from DMAP or Bismark methylation extractor (this approach can also be used to compare the same regions from other datasets):\n$ bedtools unionbedg -i methylome_01_fragments.bed \\ methylome_02_fragments.bed methylome_03_fragments.bed \\\n-header -filler NA > methylomes_combined.txt\nImport the annotated coverage-filtered methylomes into R Studio for further downstream analysis:\n> methylomes_combined.txt <- read.delim(\"∼/methylomes_combined.txt\")\n> View(methylomes_combined.txt)\nTroubleshooting[href=https://www.wicell.org#troubleshooting].\nCritical: Methylation in mammalian somatic tissues is exclusively in a CpG context; however, the Bismark alignment report gives a proportion of “methylated” cytosines in a non-CpG context, and this gives an indirect measure of bisulfite conversion efficiency. If the non-CpG methylation is >2%, this indicates insufficient bisulfite conversion and the methylation data are less reliable.\nAnalysis of DNA methylome data\nTiming: >7 days\nFollowing processing and quality control analysis, the extracted methylome data can now be applied to a wide range of downstream analyses that are dependent on the research questions being asked and the overall design of the project. Here we provide some common approaches to analyze and present cancer methylome data, including differential methylation analysis, imputation of missing data and hierarchical clustering/dimensionality reduction analyses.\nDifferential methylation analysis:",
    "To identify interindividual variability in DNA methylation across multiple samples, run the diffmeth program in DMAP using a Chi-squared (-X) test:\n$ diffmeth -F 2 -t 10 -G /path_to_reference_genome/ -X 40,220 \\\n-z -R methylome_01_trimmed_bismark_bt2.bam \\\n-R methylome_02_trimmed_bismark_bt2.bam \\\n-R methylome_03_trimmed_bismark_bt2.bam \\\n-R methylome_04_trimmed_bismark_bt2.bam \\\n> methylome_chi_squared.txt\nTo identify differentially methylated fragments between two samples (-R and -S), run the diffmeth program in DMAP using a Fisher’s exact (-P) test:\n$ diffmeth -F 2 -t 10 -G /path_to_reference_genome/ \\\n-P 40,220 -z -R methylome_01_trimmed_bismark_bt2.bam \\\n-S methylome_02_trimmed_bismark_bt2.bam \\\n> methylome_FE_test.txt\nTo identify differentially methylated fragments between two groups of samples (-R and -S), run the diffmeth program in DMAP using an ANOVA F ratio (-B) test:\n$ diffmeth -F 2 -t 10 -G /path_to_reference_genome/ \\\n-B 40,220 -z -R methylome_01_trimmed_bismark_bt2.bam \\\n-R methylome_02_trimmed_bismark_bt2.bam \\\n-S methylome_03_trimmed_bismark_bt2.bam \\\n-S methylome_04_trimmed_bismark_bt2.bam \\\n> methylome_anova.txt\nAs the above examples involve large numbers of simultaneous statistical tests, there is an increased likelihood of false positives. To adjust P-values for multiple comparisons, run the R program p.adjust (the Bonferroni correction method is used in the following example):\n> methylome_anova$P_adjust <- p.adjust(methylome_anova$Pvalue, method = “Bonferroni”, n = length(methylome_anova$Pvalue))\nConsideration of groupwise analyses with low coverage or missing data:\nRun the diffmeth program in DMAP using an ANOVA F ratio test, setting the minimum group size threshold (>15 in the following example, -I 15):\n$ diffmeth -F 2 -t 10 -G /path_to_reference_genome/ \\\n-B 40,220 -I 15 -z -R methylome_01_trimmed_bismark_bt2.bam \\\n-R methylome_02_trimmed_bismark_bt2.bam \\\n-S methylome_03_trimmed_bismark_bt2.bam \\\n-S methylome_04_trimmed_bismark_bt2.bam \\\n> methylome_anova.txt\nAs an alternative, filter out fragments or CpGs with a maximum threshold of missing data points (>5 in the following example) using bash commands:",
    "$ cut -f 4-23 group1vsgroup2_methylation.txt | awk -F 'NA' '{print NF-1}' > \\ group1_NA_count.txt #methylation data for group 1 in columns 4-23\n$ cut -f 24-43 group1vsgroup2_methylation.txt | awk -F 'NA' '{print NF-1}' > \\ group1_NA_count.txt #methylation data for group 2 in columns 24-43\n$ paste group1vsgroup2_methylation.txt group1_NA_count.txt \\ group2_NA_count.txt | awk ' $44 <= 5 && $45 <= 5 ' > \\ group1vsgroup2_methylation_filtered.txt\nNote: some samples may not have adequate coverage for specific CpGs or regions. Depending on the size of the groups and whether the groups are of equal size, these CpGs or regions can still be included by setting a minimum threshold to be included in analyses (typically >70% of the group size).\nFollowing statistical analysis, missing data can be imputed but should be interpreted with caution. To impute missing methylation data, run the R package methyLImp:\n> library(methyLImp)\n> methylome_anova.imp <- methyLImp(t(methylome_anova),min=0,max=1)\nTroubleshooting[href=https://www.wicell.org#troubleshooting].\nDownstream analysis and visualization\nGraphical summarization of methylation data:\nHierarchical clustering is a method that can be used to group samples with similar methylation patterns into clusters (Figure 1[href=https://www.wicell.org#fig1]A). To generate a basic hierarchical clustering dendrogram of methylome data, run the following in R:\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/3115-Fig1.jpg\nFigure 1. Examples of downstream analysis and visualization of methylome data\n(A) Hierarchical clustering groups samples with similar methylation patterns into clusters.\n(B) Principal component analysis (PCA) reduces multidimensional methylome data into a format that enables interpretation by identifying clusters of closely related data points.\n(C) A volcano plot provides an overview of all methylation differences between two groups or individual samples.\n(D) A Heatmap shows low to high methylation values on a color gradient and the overall methylation patterns of samples are clustered based on similarity.\n> distance.matrix <- dist(scale(methylome_anova), method = \"euclidean\")\n> hierarchical.clustering <- hclust(distance.matrix, method = \"ward.D2\")\n> plot(as.dendrogram(hierarchical.clustering))\n> library(dendextend)",
    "> distance.matrix <- dist(scale(methylome_anova), method = \"euclidean\")\n> hierarchical.clustering <- as.dendrogram(hclust(distance.matrix, method = \"ward.D2\"))\n> labels_colors(dend) <- c(rep(\"blue\", 20),rep(\"red\", 20),\nrep(\"green\", 20))\n> plot(dend)\nWhen analyzing methylome data, a volcano plot is a type of scatter plot used to show an overview of methylation changes between two groups or individual samples (Figure 1[href=https://www.wicell.org#fig1]B). To generate a volcano plot of methylome data, run the following in R:\n> library(ggplot2)\n> methylome_anova $diffmethylated <- \"NO\"\n> methylome_anova$diffmethylated[methylome_anova$abs_diffmeth > 0.2 & methylome_anova $FDR < 0.05] <- \"YES\" # if absolute methylation difference > 0.2 and FDR-adjusted P-value < 0.05, set as \"YES\"\n> p <- ggplot(data= methylome_anova, aes(x=methdiff, y=-log10(FDR), colour=diffmethylated)) + theme_classic() + geom_point(alpha=0.67, size=1) + theme(legend.position = \"none\") + xlim(c(-0.5,0.5)) + ylim(c(0, 30)) + xlab(\"Methylation difference\") + ylab(expression(-log[10]∼\"FDR-adjusted P-value\")) + scale_colour_manual(values = c(\"darkgray\",\"firebrick\"))\nPrincipal component analysis (PCA) is a method that can transform large amounts of high dimension methylome data into lower dimensions, which are easier to interpret but still retain large amounts of information (Figure 1[href=https://www.wicell.org#fig1]C). To perform PCA of methylome data, run the following in R:\n> library(tidyverse)\n> library(factoextra)\n> pca_prcomp <- prcomp(methylome_anova, center = TRUE, scale = TRUE)\n> summary(pca_prcomp)\n> pca_plot <- fviz_pca_ind(pca_prcomp, col.ind = \"name\", palette = c(rep(\"red\", 20), rep(\"blue\", 20), rep(\"green\", 20)),\nrepel = TRUE))\nHeatmaps are commonly used graphical representations of methylome data, where low to high methylation values are shown on a color gradient and methylation patterns are clustered based on similarity (Figure 1[href=https://www.wicell.org#fig1]D). To generate a heatmap of differentially methylated regions, run the following in R:\n> library(gplots)\n> library(viridis)\n> my_palette <- magma(n = 299)\n> png(\"∼/methylome_heatmap.png\", width = 5∗800, height = 5∗1200, res = 600, pointsize = 6.5)\n> row_distance = dist(methylome.matrix, method = \"euclidean\")\n> row_cluster = hclust(row_distance, method = \"ward.D2\")\n> col_distance = dist(t(methylome.matrix), method = \"euclidean\")",
    "> col_cluster = hclust(col_distance, method = \"ward.D2\")\n> par(font.axis=4)\n> heatmap.2(methylome.matrix, ColSideColors = c(rep(\"red\", 20), rep(\"blue\", 20), rep(\"green\", 20)), main = \"Methylome heatmap\", density.info = \"none\", trace = \"none\", key.xlab = \"Methylation\", colsep=c(20,30), col = my_palette, Rowv = as.dendrogram(row_cluster), Colv = as.dendrogram(col_cluster))\n> dev.off()\nA powerful approach to understanding the functional consequences of DNA methylation changes is to integrate the DNA methylome data with other genome-scale data from the same samples, such as RNA-seq (transcriptome analysis) and ATAC-seq (chromatin accessibility). In the following example in R, combine the methylome data with transcripts per million (TPM) data derived from RNA-seq; calculate the correlation of methylation at a specific locus and expression of the associated gene:\n> methylome_transcriptome <- merge(methylome_data, transcriptome_TPM_data, by = \"GeneID\")\n> CD151_meth <- methylome_transcriptome[methylome_transcriptome$GeneID == \"CD151\",5:7]\n> CD151_tpm <- methylome_transcriptome[methylome_transcriptome$GeneID == \"CD151\",12:14]\n> cor.test(CD151_meth,CD151_tpm)\nExample of integrated methylome and transcriptome data:\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/3115-Undfig3.jpg\n."
  ],
  "subjectAreas": [
    "Genomics",
    "Sequence Analysis",
    "Bioinformatics",
    "Cancer",
    "Molecular Biology",
    "Sequencing"
  ],
  "bigAreas": [
    "Biomedical & Clinical Research",
    "Molecular Biology & Genetics",
    "Bioinformatics & Computational Biology"
  ]
}