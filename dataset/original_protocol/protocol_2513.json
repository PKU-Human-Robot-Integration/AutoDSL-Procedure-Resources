{
  "id": 2652,
  "origin_website": "Cell",
  "title": "Algebraic approach for subspace decomposition and clustering of neural activity",
  "procedures": [
    "Step-by-step method details\nStep-by-step method details\nOur general method first identifies a low dimensional neural subspace that captures most of the energy in neuronal responses. It then takes the ideal templates that delimitate behavioral epochs and projects them onto that subspace to yield ideal neuronal signals representing each of the ideal templates. It then forms a basis from these ideal neuronal signals, and decomposes the data onto this basis to recover coefficients. Finally, it uses these coefficients to cluster the responses.\nReduce dimensions and identify a neural subspace that captures most of the energy in neuronal responses\nTiming: 5 min (for step 1, 2 and 3)\nThis section describes the steps needed to derive a low-dimensional subspace of neuronal responses that captures most of the energy in the responses.\nPerform a singular value decomposition7[href=https://www.wicell.org#bib7],8[href=https://www.wicell.org#bib8],9[href=https://www.wicell.org#bib9] of the prepared data matrix M as USVT where the matrix S is a rectangular diagonal matrix of singular values, and the matrices U and V are orthonormal matrices (Figure 2[href=https://www.wicell.org#fig2]A).\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2146-Fig2.jpg\nFigure 2. Decomposing neural signals in a low dimensional subspace\n(A) Schematic illustrating singular value decomposition of a matrix. Each diagonal element in S corresponds to one row in VT. These elements can be ordered by decreasing magnitude, with VT re-arranged accordingly.\n(B) Graph showing a basis for a four-dimensional subspace that captures more than 80% of the energy in the responses, all pooled together.\n(C) Left. The three initial non-neuronal templates defined for pre-stop, stop and post-stop activity. Middle. The projections of the initial three non-neuronal templates onto a 4-dimensional subspace derived through low-rank approximation. These correspond to the neural responses that represent the non-neuronal templates. Right. The orthonormalized responses that form a basis, generating a 3-dimensional subspace, upon which we can decompose our signals. Adapted from Adam et al.1[href=https://www.wicell.org#bib1] Figure S3A.",
    "(D) Schematic showing the decomposition of a neuronal signal into a linear combination of the basis signals with additional noise.\n> import numpy as np\n> U, s, VT = np.linalg.svd(M, full_matrices=False)\n> S = np.zeros([U.shape[1], VT.shape[0]])\n> for i in range(len(s)):\n                  S[i,i] = s[i]\nNote: Check that USVT is equal to M to verify that all went correctly with the computation.\nEach singular value in S corresponds to a temporal neuronal response in VT (Figure 2[href=https://www.wicell.org#fig2]A). Select the responses v0, v1, v2 and v3 corresponding to the highest 4 singular values in S, which together will span a 4-dimensional space (Figure 2[href=https://www.wicell.org#fig2]B).\n> v0 = VT[0,:]\n> v1 = VT[1,:]\n> v2 = VT[2,:]\n> v3 = VT[3,:]\nNote: We reasoned that we had (not necessarily independent) four-degrees of freedom in our analysis: baseline, pre-stop, stop and post-stop activity, and thus sought to begin with a 4-dimensional space.\nNote: In general, the number of dimensions can be chosen as follows. If K ideal behavioral templates were selected in the data preparation phase, choose K+1 temporal neuronal responses in VT. The reasoning is that each template would need one distinct dimension, and the remaining dimension would correspond to baseline activity which plays a role as offset, better connecting the behavioral templates to neuronal responses despite the difference in baselines. In the next steps 4–6, the ideal behavioral templates will be projected onto the four (or K+1) dimensional subspace, and thus the choice of dimensions only affects the final shape of the templates used for clustering, and will not alter the original neuronal responses.",
    "Note: In some applications, it is also possible that the neural data is inherently high dimensional, and that relevant aspects are captured in dimensions with lower singular values. In such setting, the researcher may not restrict to the highest four (or K+1) singular values but other four (or K+1) singular values that yield interpretable neuronal responses.\nNote: Plot the signals v0,…,v3 to assess and verify that they represent temporally evolving trajectories.\nCompute the fraction of energy of the neuronal responses captured by this subspace by squaring all the singular values σi on the diagonal in S, and dividing the sum of the greatest 4 by the sum of all the squared singular values.8[href=https://www.wicell.org#bib8],9[href=https://www.wicell.org#bib9]\n> energy = sum(s[:4]∗∗2)\n> total_energy = sum(s∗∗2)\n> fraction = energy / total_energy\nNote: The resulting subspace contained more than 80% of the calcium signal energy for the whole population.",
    "Note: In steps 4–6, the ideal behavioral templates will be projected onto the four (or K+1) dimensional subspace. Adding additional dimensions will facilitate capturing more of the shape of the ideal behavioral templates following the projection by capturing more energy in the neuronal responses. Generally, fewer dimensions will lead to a more interpretable and robust analysis that avoids over-fitting. However, in the case where either (i) the fraction of the energy captured is low or (ii) the obtained neuronal template derived in a subsequent step appears too coarse to capture the ideal behavioral template, then the researcher ought to increase the number of dimensions. In such a setting, a principled approach consists of cross-validation, where dimensionality is reduced for a random subset of neurons and then the captured energy is evaluated on the remaining neurons (See e.g., Bro et al.10[href=https://www.wicell.org#bib10]). The reduction is performed over multiple iterations for each number of dimensions to determine at what dimensions noise is more likely being captured by the reduction.\nChange the basis of the subspace to recover neuronal template signals\nTiming: 5 min (for step 4, 5 and 6)\nThis section describes the steps needed to project the behavioral templates selected in the preparatory steps on the low-dimensional subspace, and form a basis upon which to decompose the neuronal signals.\nTake the inner-product (dot-product) of each ideal template signal template_∗ (in Figure 1[href=https://www.wicell.org#fig1]C) with each temporal neuronal response v0, …, v3, to compute a weight coefficient (Figure 2[href=https://www.wicell.org#fig2]C).\n> w_stop_0 = np.dot(template_stop,v0)\n> w_stop_1 = np.dot(template_stop,v1)\n...\n> w_pre_0 = np.dot(template_pre,v0)\n...\n> w_post_0 = np.dot(template_post,v0)\nDefine three neuronal template signals v_stop,v_pre and v_post as a sum of the 4 neuronal responses v0, …, v3, each scaled by its corresponding coefficient in step 4 (Figure 2[href=https://www.wicell.org#fig2]C).",
    "> v_stop= w_stop_0∗v0 + w_stop_1∗v1 + w_stop_2∗v2 + w_stop_3∗v3\n> v_pre= w_pre_0∗v0 + w_pre_1∗v1 + w_pre_2∗v2 + w_pre_3∗v3\n> v_post= w_post_0∗v0 + w_post_1∗v1 + w_post_2∗v2 + w_post_3∗v3\nNote: These neuronal template signals represent the best neuronal response in the 4-dimensional subspace that can explain the ideal template signals representing behavioral outcomes.\nUsing the gram-schmidt orthonormalization process,9[href=https://www.wicell.org#bib9] transform v_stop, v_pre and v_post into an orthonormal basis b_stop, b_pre and b_post (Figure 2[href=https://www.wicell.org#fig2]C).\n> def norm(v):\n      return np.sqrt(np.dot(v,v))\n> v = v_stop\n> b_stop = v/norm(v)\n> v = v_pre - b_stop∗np.dot(b_stop,v_pre)\n> b_pre = v/norm(v)\n> v = v_post – b_stop∗np.dot(b_stop,v_post) - b_pre∗np.dot(b_pre,v_post)\n> b_post = v/norm(v)\nNote: This step ensures that the templates are orthonormal, and thereby form a basis onto which we can project. Verify that the inner-product of any pair of these two basis vectors is zero, and that the norm of each is equal to 1. These 3 basis signals will be used to decompose neuronal signals and then cluster them.\nNote: We first reduced our space to 4 dimensions, and then further restricted to a 3-dimensional subspace within it. The first reduction relies purely on neural data, while the second relies on the behavioral data. We could have directly reduced to 3 dimensions, but we found that having an additional degree of freedom aids in finding the 3-dimension subspace that is best tailored to the information we want. Indeed, ideal behavioral templates have different baseline offsets compared to the neuronal responses, and the additional dimension aids in offsetting that baseline. As we are only interested in 3 epochs (pre-stop, stop and post-stop) in the task, we do not need to keep the fourth dimension after using it to derive the neuronal template signals.\nDecompose neuronal responses onto the neuronal basis signals",
    "Timing: 5 min (for step 7 and 8)\nThis section describes the steps needed to decompose the neuronal signals.\nTake the inner-product (dot-product) of each neuronal response with each basis signal b_stop, b_pre and b_post, to compute a weight coefficient.\n> coefs_stop = np.dot(M, b_stop)\n> coefs_pre = np.dot(M, b_pre)\n> coefs_post = np.dot(M, b_post)\nNote: Each neuronal response can then be written as a weighted sum of the three basis signals plus some additional component orthogonal to the subspace (considered as noise). The weighted sum of the three basis signals gives an approximation of the original neural response, which resides in the 3-dimensional subspace spanned by the basis signals (Figure 2[href=https://www.wicell.org#fig2]D).\nKeep the neurons for which the fraction of their calcium signal energy (area of the squared signal) that came from the three-dimensional subspace is above a chosen threshold, and discard the rest from the analysis.\nimgsrc:https://prod-shared-star-protocols.s3.amazonaws.com/protocols/2146-Fig3.jpg\nFigure 3. Neural response decomposition reveals three clusters of neurons in M2\n(A) Plot showing STN-projecting M2 neurons (n=271), whose neural response energy (area under the squared signal) was more than 80% explained by the subspace, clustered into three groups (pre-stop, stop and post-stop) using the templates in Figure 2[href=https://www.wicell.org#fig2]C. Adapted from Adam et al.1[href=https://www.wicell.org#bib1] Figure 4D.",
    "(B) Each neuronal response can be written as a combination of four components: the first three correspond to weighted versions of the basis functions, and the fourth corresponds to the activity that remains outside the three-dimensional subspace spanned by the basis. The weights on the templates are used to perform clustering. The remaining activity shows some surge after stopping. The 1-dimensional subspace containing the highest energy in the remaining activity will consist of a neural trajectory with activity concentrated after the stop. When added to the three basis functions (pre-stop, stop and post-stop), the new set will span the 4-dimensional space obtained initially. The decomposition is only used for clustering and not to post-process neural signals. Adapted from Adam et al.1[href=https://www.wicell.org#bib1] Figure S3B.\n(C) Scatterplot of the coefficient of contribution of the stop template in Figure 2[href=https://www.wicell.org#fig2]C in spontaneous-stops versus landmark-stops. Each data point represents a stop- neuron (N = 108) taken from (A), and the coefficient represents the energy of the response along the dimension of the basis, obtained by taking the dot product of the calcium response with the stop basis vector, b_stop. Landmark stops have a higher coefficient than spontaneous stops, indicating that b_stop has a greater contribution to responses during landmark stops. Adapted from Adam et al.1[href=https://www.wicell.org#bib1] Figure 2F.\n(D) Box plots for the distribution of the coefficients in (C). The orange lines represent the respective medians. The means of the distributions are significantly different (Paired t-test, ∗∗∗:p=1.09e-6). Adapted from Adam et al.1[href=https://www.wicell.org#bib1] Figure 2G.\n(E) Examples of the calcium activity of six M2 neurons projecting to STN during stops at the landmark and in the middle of the track. The response for spontaneous-stops is normalized to the maximum value of the corresponding response for landmark-stops. Adapted from Adam et al.1[href=https://www.wicell.org#bib1] Figure 2H.",
    "(F) Graph showing 3 templates of ideal neuronal responses related to three epochs in the task: pre-stop, stop and post-stop. The data is derived from extracellular single-unit recordings in M2, and neuronal responses are obtained by deriving firing rates. Each neuronal response can be expressed as a weighted combination of these 3 templates. Adapted from Adam et al.1[href=https://www.wicell.org#bib1] Figure 6B.\n(G) Plots of all the M2 neurons whose neural response energy (area under the squared signal) was more than 80% explained by the subspace, clustered into three groups (pre-stop, stop and post-stop, from top to bottom) using the templates in (F). Adapted from Adam et al.1[href=https://www.wicell.org#bib1] Figure 6C.\n> energy_stop = coefs_stop∗∗2\n> energy_pre = coefs_pre∗∗2\n> energy_post = coefs_post∗∗2\n> percentages=(energy_stop+energy_pre+energy_post)/np.sum(s∗∗2)\nNote: For different approaches, one can either keep the neurons that have their energy ratio above a fixed percentage (e.g., greater than 80% or the fraction of energy captured by the subspace), or above twice the standard deviation from the mean energy, or above a determined percentile in the ratio distribution (e.g., highest 80%).",
    "Note: In step 8, retaining the neurons for which the fraction of their calcium signal energy that came from the three-dimensional subspace is greater than 85% (roughly the fraction of energy captured by the 4-dimensional subspace) kept about 64% of all neurons we started with, and we performed clustering on them as described in steps 9 and 10 below. In these neurons, less than 15% of their energy is explained outside the 3-dimensional subspace, and we expect most of that remainder to be explained by the 4th dimension that complements b_stop, b_pre and b_post to span the 4-dimensional space generated by v0, v1, v2 and v3. Indeed, we find that the remaining activity outside the subspace is concentrated after the stop (Figures 3[href=https://www.wicell.org#fig3]A and 3B). As we investigated only 3 epochs (pre-stop, stop and post-stop) in Adam et al.,1[href=https://www.wicell.org#bib1] we considered that 4th dimension to be ‘noise’ for our purposes. In case we are interested in studying localized surges of activity after stops, that dimension becomes relevant and should be included in the reduced subspace yielding 4 dimensions. More generally, the choice of dimensions reduced to defines everything outside the reduced subspace as irrelevant noise. It is then important to choose the subspace to capture the features essential to the investigation.\nNote: The discarded neurons have more than 15% of their calcium signal energy explained outside the three-dimensional subspace. These neurons might have responses related to pre-stop, stop and post-stop, but these responses are considered weak with respect to our criterion. However, these neurons might be tuned to other features of the task, and therefore other exclusion criteria may be considered if they are more adequate to the application at hand.\nCluster neurons based on decomposition weights\nTiming: 5 min (for step 9 and 10)",
    "This section describes the steps needed to cluster the neuronal signals, using the decomposition.\nMultiply the weight coefficient coefs_stop, coefs_pre and coefs_post, respectively by the maximum value of the basis signals v_stop, v_pre and v_post to account for the template width and get a corrected weight coefficients.\n> corrected_coefs_stop = coefs_stop∗max(v_stop)\nAttribute a neuron to one of three classes (pre-stop, stop and post-stop) whose corresponding corrected weight coefficient is highest.\nNote: Most importantly, the calcium responses in each class were not reduced in dimensions; they were the original averages of the raw DFF traces taken over landmark stop windows. The dimensionality reduction was only used to cluster the neuronal responses, leaving the neural responses unaltered."
  ],
  "subjectAreas": [
    "Bioinformatics",
    "Computer Sciences",
    "Behavior",
    "Cognitive Neuroscience",
    "Neuroscience"
  ],
  "bigAreas": [
    "Biomedical & Clinical Research",
    "Ecology & Environmental Biology",
    "Bioinformatics & Computational Biology"
  ]
}